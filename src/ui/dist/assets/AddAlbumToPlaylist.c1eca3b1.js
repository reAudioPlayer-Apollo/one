import{A as k,a as P}from"./AlbumHeader.2e910121.js";import{F as V}from"./FindSources.678f96f0.js";import{_ as M,e as c,v as I,o as d,c as r,g as m,w as v,a as s,x as u,y as N,F as f,h as b,t as y,z as h,b as F,f as U,k as B,l as E}from"./index.aa38e9d2.js";const O={name:"AddAlbumToPlaylist",components:{FindSources:V,AlbumEntry:k,AlbumHeader:P},props:{cover:String,artist:String,title:String,href:String,id:String},data(){return{showModal:!1,playlists:[],selectedPlaylist:-1,playlist:[],editSong:!1}},methods:{share(){window.open(this.href)},close(){this.showModal=!1,this.$emit("close"),console.log(this.showModal)},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.dTitle=e.title,this.$refs.album.value=e.album,this.dArtist=e.artists.join(", "),this.dCover=e.cover,this.$refs.source.value=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},addAll(){for(let e=0;e<this.playlist.length;e++)this.add(e)},preview(){const e=new CustomEvent("player.play",{detail:{artist:this.artist,title:this.title,source:this.href}});window.dispatchEvent(e)},add(e){const l=this.playlist[e],n=this.playlists.findIndex(p=>p==this.selectedPlaylist);if(console.log(l,n),n<0){alert("no playlist selected");return}fetch(`/api/playlists/${n}/tracks`,{method:"POST",body:JSON.stringify({source:l.src,title:l.title,artist:l.artists.join(", "),album:this.title,cover:this.cover})}).then(p=>{p.status==200&&(l.added=!0)})}},watch:{dSource(){this.loadMetadata()},showModal(){!this.showModal||(fetch("/api/playlists").then(e=>e.json()).then(e=>{this.playlists.length=0,this.playlists.push(...e)}),fetch(`/api/spotify/albums/${this.id}`).then(e=>e.json()).then(e=>{this.playlist.length=0,this.playlist.push(...e)}))}}},i=e=>(B("data-v-ea3787cd"),e=e(),E(),e),D={class:"wrapper"},J={class:"header"},j=i(()=>s("h3",null,"Add album",-1)),z=i(()=>s("span",{class:"material-icons-round"}," close ",-1)),H=[z],L=i(()=>s("h4",null,"To Playlist",-1)),q=i(()=>s("br",null,null,-1)),x={key:0},G=i(()=>s("h4",null,"Source",-1)),K={class:"content"},Q=i(()=>s("h4",null,"Title",-1)),R={class:"content"},W=i(()=>s("h4",null,"Album",-1)),X={class:"content"},Y=i(()=>s("h4",null,"Artist",-1)),Z={class:"content"},$=i(()=>s("h4",null,"Cover",-1)),ee={class:"content"},te=["src"],se={class:"confirm"},le={key:1},oe=["src"],ie={class:"details"},ne={class:"detailswrapper"},de=i(()=>s("hr",null,null,-1)),ae=i(()=>s("hr",null,null,-1)),re={class:"confirm"};function ue(e,l,n,p,a,o){const g=c("FindSources"),w=c("h7"),A=c("album-header"),S=c("album-entry"),C=c("vue-final-modal"),T=I("observe-visibility");return d(),r("div",null,[m(C,{onClick:e.hideFindSourcesCtx,modelValue:a.showModal,"onUpdate:modelValue":l[14]||(l[14]=t=>a.showModal=t),classes:"modal-containerr","content-class":"addAlbumToPlaylistPopup"},{default:v(()=>[s("div",D,[s("div",J,[j,s("button",{class:"modal-close",onClick:l[0]||(l[0]=(...t)=>o.close&&o.close(...t))},H)]),L,u(s("select",{"onUpdate:modelValue":l[1]||(l[1]=t=>a.selectedPlaylist=t)},[(d(!0),r(f,null,b(a.playlists,t=>(d(),r("option",{key:t},y(t),1))),128))],512),[[N,a.selectedPlaylist]]),q,a.editSong?(d(),r("div",x,[G,m(g,{ref:"findSources",src:e.dSource,title:n.title,artist:n.artist},{default:v(()=>[s("div",K,[u(s("input",{type:"text","onUpdate:modelValue":l[2]||(l[2]=t=>e.dSource=t),ref:"source"},null,512),[[h,e.dSource]]),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:l[3]||(l[3]=(...t)=>e.opencontextmenu&&e.opencontextmenu(...t))},"more_vert",512)])]),_:1},8,["src","title","artist"]),Q,s("div",R,[u(s("input",{"onUpdate:modelValue":l[4]||(l[4]=t=>e.dTitle=t),type:"text"},null,512),[[h,e.dTitle]])]),W,s("div",X,[u(s("input",{"onUpdate:modelValue":l[5]||(l[5]=t=>e.dAlbum=t),type:"text",ref:"album"},null,512),[[h,e.dAlbum]])]),Y,s("div",Z,[u(s("input",{"onUpdate:modelValue":l[6]||(l[6]=t=>e.dArtist=t),type:"text"},null,512),[[h,e.dArtist]])]),$,s("div",ee,[u(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":l[7]||(l[7]=t=>e.dCover=t),ref:"cover"},null,512),[[h,e.dCover]]),s("img",{onClick:l[8]||(l[8]=(...t)=>o.openInNewTab&&o.openInNewTab(...t)),class:"addSong cover",src:e.dCover?e.dCover:"/assets/img/music_placeholder.png"},null,8,te)]),s("div",se,[s("button",{onClick:l[9]||(l[9]=(...t)=>o.add&&o.add(...t)),class:"negative"},"Add")])])):(d(),r("div",le,[u((d(),r("div",{class:"padding-20 playlisteditor",onClick:l[12]||(l[12]=(...t)=>e.editPlaylist&&e.editPlaylist(...t))},[s("img",{class:"cover",src:n.cover},null,8,oe),s("div",ie,[s("div",ne,[m(w,null,{default:v(()=>[F("Album")]),_:1}),s("span",{class:"material-icons-round share",onClick:l[10]||(l[10]=(...t)=>o.share&&o.share(...t))},"share"),s("span",{class:"material-symbols-rounded share fill",onClick:l[11]||(l[11]=(...t)=>o.preview&&o.preview(...t))},"play_arrow")]),s("h1",null,y(n.title),1),s("h5",null,y(n.artist),1)])])),[[T,e.headerVisibilityChanged]]),de,m(A),ae,(d(!0),r(f,null,b(a.playlist,(t,_)=>(d(),U(S,{onAdd:o.add,key:_,added:t.added,index:_,cover:t.cover,artist:t.artists.join(", "),title:t.title,source:t.src,preview:t.source},null,8,["onAdd","added","index","cover","artist","title","source","preview"]))),128))])),s("div",re,[s("button",{onClick:l[13]||(l[13]=(...t)=>o.addAll&&o.addAll(...t)),class:"negative"},"Add All")])])]),_:1},8,["onClick","modelValue"])])}const me=M(O,[["render",ue],["__scopeId","data-v-ea3787cd"]]);export{me as A};
