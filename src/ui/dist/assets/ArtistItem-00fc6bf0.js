import{F as b,T as A,a as S,c as k}from"./song-ca46ae84.js";import{P as T}from"./Playlist-fcddcb87.js";import{T as B}from"./ExternalEntry-f0b99876.js";import{m as C,j as P,n as d,o as f,f as j,w as F,g as u,u as I,B as N,a as c,_ as O,e as D,c as v,t as y,d as E}from"./index-fd3eb342.js";const x=c("br",null,null,-1),L=C({__name:"ImportSpotifyArtist",props:{artist:{type:Object,required:!0}},setup(l,{expose:s}){const t=l,m=P(),r=d([{name:"playlist",type:"dropdown",required:!0,value:null,options:m.playlistsAsDropdown}]),n=d(null),i=d(null),o=d([]),g=async()=>{if(n.value.load(),o.value.length==0){const e=await fetch(`/api/spotify/artists/${t.artist.id}`);o.value=await e.json()}n.value.show()},p=async e=>{if(e==="new"){const a=await k(t.artist.name,"",t.artist.image);return r.value[0].options=m.playlistsAsDropdown,r.value[0].value=a,a}return Number(e)},w=async(e,a=null)=>{o.value[e].added||(a??(a=i.value.toObject().playlist),a=await p(a),await S(a??i.value.toObject().playlist,o.value[e]),o.value[e].added=!0)},h=async()=>{let e=i.value.toObject().playlist;e=await p(e),o.value.forEach((a,_)=>{w(_,e)})};return s({show:g}),(e,a)=>(f(),j(A,{ref_key:"modal",ref:n,submit:{label:"Add All",icon:"add"},name:"Import Artist",onClose:a[0]||(a[0]=_=>e.$emit("close")),onSubmit:h},{default:F(()=>[u(B,{cover:l.artist.image,icons:[{name:"share",onClick:()=>I(N)(l.artist.href)}],title:l.artist.name},null,8,["cover","icons","title"]),u(b,{ref_key:"form",ref:i,options:r.value},null,8,["options"]),x,u(T,{songs:o.value,onAdd:w},null,8,["songs"])]),_:1},512))}});const M={components:{AddArtistToPlaylist:L},name:"ArtistItem",methods:{redirect(){this.$refs.import.show()},follow(l){l.stopPropagation();const s=this.following?"DELETE":"POST";fetch("/api/spotify/following",{method:s,body:JSON.stringify({artistId:this.id})}).then(t=>{t.status==200&&(this.following=!this.following)})}},data(){return{following:!1}},props:{cover:String,name:String,description:String,id:String,showFollowButton:Boolean}},V={class:"wrapper drop-shadow-md"},q=["src"],H=["innerHTML"];function J(l,s,t,m,r,n){const i=D("add-artist-to-playlist");return f(),v("div",V,[u(i,{artist:{id:t.id,name:t.name,href:`https://open.spotify.com/artist/${t.id}`,image:t.cover},ref:"import"},null,8,["artist"]),c("div",{class:"item",onClick:s[1]||(s[1]=(...o)=>n.redirect&&n.redirect(...o))},[c("img",{src:t.cover},null,8,q),c("h4",null,y(t.name),1),c("p",{innerHTML:t.description},null,8,H),t.showFollowButton?(f(),v("button",{key:0,onClick:s[0]||(s[0]=(...o)=>n.follow&&n.follow(...o)),class:"followButton"},y(r.following?"Following":"Follow"),1)):E("",!0)])])}const Q=O(M,[["render",J],["__scopeId","data-v-bca4a30f"]]);export{Q as A};
