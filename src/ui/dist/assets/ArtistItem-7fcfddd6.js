import{F as C,T as S}from"./Form-c1908040.js";import{P as k}from"./Playlist-e4bf779d.js";import{T}from"./ExternalEntry-25c642db.js";import{m as B,j as P,n as u,o as p,f as h,w as A,g as m,u as j,L as F,a as d,_ as I,e as y,t as g,c as N,d as O}from"./index-63840441.js";import{a as D,c as E}from"./song-6bfd6160.js";import{C as L}from"./Card-1541fb70.js";const x=d("br",null,null,-1),M=B({__name:"ImportSpotifyArtist",props:{artist:{type:Object,required:!0}},setup(l,{expose:s}){const t=l,f=P(),r=u([{name:"playlist",type:"dropdown",required:!0,value:null,options:f.playlistsAsDropdown}]),n=u(null),i=u(null),a=u([]),c=async()=>{if(n.value.load(),a.value.length==0){const e=await fetch(`/api/spotify/artists/${t.artist.id}`);a.value=await e.json()}n.value.show()},w=async e=>{if(e==="new"){const o=await E(t.artist.name,"",t.artist.image);return r.value[0].options=f.playlistsAsDropdown,r.value[0].value=o,o}return Number(e)},_=async(e,o=null)=>{a.value[e].added||(o??(o=i.value.toObject().playlist),o=await w(o),await D(o??i.value.toObject().playlist,a.value[e]),a.value[e].added=!0)},b=async()=>{let e=i.value.toObject().playlist;e=await w(e),a.value.forEach((o,v)=>{_(v,e)})};return s({show:c}),(e,o)=>(p(),h(S,{ref_key:"modal",ref:n,submit:{label:"Add All",icon:"add"},name:"Import Artist",onClose:o[0]||(o[0]=v=>e.$emit("close")),onSubmit:b},{default:A(()=>[m(T,{cover:l.artist.image,icons:[{name:"share",onClick:()=>j(F)(l.artist.href)}],title:l.artist.name},null,8,["cover","icons","title"]),m(C,{ref_key:"form",ref:i,options:r.value},null,8,["options"]),x,m(k,{songs:a.value,onAdd:_},null,8,["songs"])]),_:1},512))}});const V={components:{Card:L,AddArtistToPlaylist:M},name:"ArtistItem",methods:{redirect(){this.$refs.import.show()},follow(l){l.stopPropagation();const s=this.following?"DELETE":"POST";fetch("/api/spotify/following",{method:s,body:JSON.stringify({artistId:this.id})}).then(t=>{t.status==200&&(this.following=!this.following)})}},data(){return{following:!1}},props:{cover:String,name:String,description:String,id:String,showFollowButton:Boolean}},q=["src"],H=["innerHTML"];function J(l,s,t,f,r,n){const i=y("add-artist-to-playlist"),a=y("Card");return p(),h(a,{class:"wrapper","with-hover":""},{default:A(()=>[m(i,{ref:"import",artist:{id:t.id,name:t.name,href:`https://open.spotify.com/artist/${t.id}`,image:t.cover}},null,8,["artist"]),d("div",{class:"item",onClick:s[1]||(s[1]=(...c)=>n.redirect&&n.redirect(...c))},[d("img",{src:t.cover},null,8,q),d("h4",null,g(t.name),1),d("p",{innerHTML:t.description},null,8,H),t.showFollowButton?(p(),N("button",{key:0,class:"followButton",onClick:s[0]||(s[0]=(...c)=>n.follow&&n.follow(...c))},g(r.following?"Following":"Follow"),1)):O("",!0)])]),_:1})}const U=I(V,[["render",J],["__scopeId","data-v-128ddc2e"]]);export{U as A};
