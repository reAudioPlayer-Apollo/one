import{F as f}from"./FindSources.f805cc71.js";import{_,l as S,e as a,o as b,c as g,g as p,w as h,a as t,v as d,y as r,m as y,p as C,i as w}from"./index.fe4f28aa.js";const x={name:"EditSong",components:{FindSources:f},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number},mounted(){this.$refs.upSong.addEventListener("change",()=>{const s=new FormData;var e=this.$refs.upSong.files[0],c=e.slice(0,e.size,e.type),u=new File([c],this.id+".mp3",{type:e.type});s.append("file",u),fetch("/api/config/tracks",{method:"POST",body:s}).then(o=>o.text()).then(o=>this.dSource=o)}),this.$refs.upCover.addEventListener("change",()=>{const s=new FormData;var e=this.$refs.upCover.files[0],c=e.slice(0,e.size,e.type);const u=e.name.split(".").pop();var o=new File([c],this.id+`.${u}`,{type:e.type});s.append("file",o),fetch("/api/config/images",{method:"POST",body:s}).then(n=>n.text()).then(n=>this.dCover=n)})},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{parseCover:S,opencontextmenu(s){this.$refs.findSourcesEdit.show(s)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/tracks/${this.id}`,{method:"PUT",body:JSON.stringify({source:this.dSource,title:this.dTitle,artist:this.dArtist,album:this.dAlbum,cover:this.dCover})}).then(s=>{console.log(s),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(s=>s.json()).then(s=>{console.log(s),this.dTitle=s.title,this.dAlbum=s.album,this.dArtist=s.artists.join(", "),this.dCover=s.cover,this.dSource=s.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},l=s=>(C("data-v-53f22ab0"),s=s(),w(),s),T={class:"wrapper"},k={class:"header"},A=l(()=>t("h3",null,"Edit song",-1)),F=l(()=>t("span",{class:"material-icons-round"}," close ",-1)),E=[F],V=l(()=>t("h4",null,"Source",-1)),M={class:"content"},N=l(()=>t("span",{class:"material-symbols-rounded"},"file_upload",-1)),I=[N],U={type:"file",ref:"upSong",style:{display:"none"},accept:"audio/mp3"},O=l(()=>t("h4",null,"Title",-1)),P={class:"content"},B=l(()=>t("h4",null,"Album",-1)),D={class:"content"},z=l(()=>t("h4",null,"Artist",-1)),J={class:"content"},L=l(()=>t("h4",null,"Cover",-1)),q={class:"content"},G=l(()=>t("span",{class:"material-symbols-rounded"},"file_upload",-1)),H=[G],K={type:"file",ref:"upCover",style:{display:"none"},accept:"image/*"},Q=["src"],R={class:"confirm"};function W(s,e,c,u,o,n){const m=a("FindSources"),v=a("vue-final-modal");return b(),g("div",null,[p(v,{onContextmenu:e[11]||(e[11]=y(()=>{},["stop"])),onClick:n.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":e[12]||(e[12]=i=>o.showModal=i),classes:"modal-container","content-class":"modal-content"},{default:h(()=>[t("div",T,[t("div",k,[A,t("button",{class:"modal-close",onClick:e[0]||(e[0]=i=>o.showModal=!1)},E)]),V,p(m,{ref:"findSourcesEdit",src:o.dSource,title:o.dTitle,artist:o.dArtist},{default:h(()=>[t("div",M,[t("button",{onClick:e[1]||(e[1]=()=>s.$refs.upSong.click())},I),t("input",U,null,512),d(t("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.dSource=i),type:"text",ref:"source"},null,512),[[r,o.dSource]]),t("span",{class:"material-icons-round more",ref:"sourceMore",onClick:e[3]||(e[3]=(...i)=>n.opencontextmenu&&n.opencontextmenu(...i))},"more_vert",512)])]),_:1},8,["src","title","artist"]),O,t("div",P,[d(t("input",{"onUpdate:modelValue":e[4]||(e[4]=i=>o.dTitle=i),type:"text"},null,512),[[r,o.dTitle]])]),B,t("div",D,[d(t("input",{"onUpdate:modelValue":e[5]||(e[5]=i=>o.dAlbum=i),type:"text",ref:"album"},null,512),[[r,o.dAlbum]])]),z,t("div",J,[d(t("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>o.dArtist=i),type:"text"},null,512),[[r,o.dArtist]])]),L,t("div",q,[t("button",{onClick:e[7]||(e[7]=()=>s.$refs.upCover.click())},H),t("input",K,null,512),d(t("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[8]||(e[8]=i=>o.dCover=i),ref:"cover"},null,512),[[r,o.dCover]]),t("img",{onClick:e[9]||(e[9]=(...i)=>n.openInNewTab&&n.openInNewTab(...i)),class:"addSong cover",src:n.parseCover(o.dCover)},null,8,Q)]),t("div",R,[t("button",{onClick:e[10]||(e[10]=(...i)=>n.add&&n.add(...i)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}const Z=_(x,[["render",W],["__scopeId","data-v-53f22ab0"]]);export{Z as E};
