import{T as g,F as y}from"./Form-ed5b8042.js";import{m as w}from"./song-c81a530a.js";import{m as b,n as s,bq as _,f as h,w as x,o as k,g as S}from"./index-ccfdb71e.js";const j=b({__name:"EditSong",props:{song:{type:Object,required:!0}},emits:["close","update"],setup(p,{expose:c,emit:l}){const a=p,r=async(o,e)=>{const t=new FormData,d="."+e.name.split(".").pop();var v=e.slice(0,e.size,e.type),f=new File([v],a.song.id+d,{type:e.type});return t.append("file",f),await(await fetch(o,{method:"POST",body:t})).text()},n=s([{name:"source",type:"upload",icon:"music_note",accept:"audio/mp3",required:!0,onUpload:o=>{r("/api/config/tracks",o).then(e=>n.value.find(t=>t.name=="source").value=e)},value:a.song.source},{name:"title",type:"text",icon:"title",required:!0,value:a.song.title},{name:"artist",type:"text",icon:"person",required:!0,value:a.song.artist},{name:"album",type:"text",icon:"album",value:a.song.album},{name:"cover",type:"upload",icon:"art_track",accept:"image/*",imagePreview:!0,value:a.song.cover,onUpload:o=>{r("/api/config/images",o).then(e=>n.value.find(t=>t.name=="cover").value=e)}}]),m=async()=>{await w({...a.song,...u.value.toObject()}),l("update")},i=s(null),u=s(null);return c({show:()=>{i.value.show()}}),_(a,()=>{var o;for(const e of n.value.map(t=>t.name))n.value.find(t=>t.name==e).value=(o=a.song)==null?void 0:o[e]},{deep:!0}),(o,e)=>(k(),h(g,{ref_key:"modal",ref:i,submit:{label:"Save",icon:"save"},name:"Edit Song",onClose:e[0]||(e[0]=t=>o.$emit("close")),onSubmit:m},{default:x(()=>[S(y,{ref_key:"form",ref:u,options:n.value},null,8,["options"])]),_:1},512))}});export{j as _};
