import{T as y}from"./Template-1ba334d1.js";import{F as h}from"./Form-7562a847.js";import{P as g}from"./Playlist-d536005f.js";import{T as A}from"./ExternalEntry-2514f2ea.js";import{i as k,k as $,q as s,o as C,f as S,w as P,g as c,u as T,cc as j,a as D,bZ as N,ci as _,x as q}from"./index-6037c2e6.js";const B=D("br",null,null,-1),I=k({__name:"ImportSpotifyAlbum",props:{album:{type:Object,required:!0}},setup(o,{expose:f}){const n=$(),t=o,r=s([{name:"playlist",type:"dropdown",icon:"playlist_add",required:!0,value:null,options:n.playlistsAsDropdown}]),i=s(null),u=s(null),l=s([]),b=async()=>{if(l.value.length>0){i.value.show();return}const a=await i.value.fetch(`/api/spotify/albums/${t.album.id}`);a&&(l.value=await a.json())},v=()=>{const a=new CustomEvent("player.play",{detail:{artist:t.album.artist,title:t.album.title,source:t.album.href}});window.dispatchEvent(a)},m=async a=>{if(a==="new"){const e=await q("classic",t.album.title,`${t.album.releaseDate}, ${t.album.artist}`,t.album.cover);return r.value[0].options=n.playlistsAsDropdown,r.value[0].value=e,e}return a},d=async(a,e=null)=>{l.value[a].added||(e??(e=u.value.toObject().playlist),e=await m(e),await N(e,l.value[a]),l.value[a].added=!0)},w=async()=>{let a=u.value.toObject().playlist;a=await m(a),l.value.forEach((e,p)=>{d(p,a)}),_.addSuccess(t.album.title,`Added ${l.value.length} songs to ${n.playlists[a].name}`,3e3)};return f({show:b}),(a,e)=>(C(),S(y,{ref_key:"modal",ref:i,submit:{label:"Add All",icon:"add"},name:"Import Album",onClose:e[0]||(e[0]=p=>a.$emit("close")),onSubmit:w},{default:P(()=>[c(A,{cover:o.album.cover,icons:[{name:"share",onClick:()=>T(j)(o.album.href)},{name:"play_arrow",onClick:v}],subtitle:o.album.artist,title:o.album.title},null,8,["cover","icons","subtitle","title"]),c(h,{ref_key:"form",ref:u,options:r.value},null,8,["options"]),B,c(g,{songs:l.value,noCover:"",onAdd:d},null,8,["songs"])]),_:1},512))}});export{I as _};
