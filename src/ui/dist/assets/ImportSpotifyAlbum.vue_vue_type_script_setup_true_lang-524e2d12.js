import{T as w}from"./Template-c788da12.js";import{F as h}from"./Form-937a14a0.js";import{P as g}from"./Playlist-e6bad9a0.js";import{T as A}from"./ExternalEntry-36028ad2.js";import{i as k,k as $,q as n,o as C,f as S,w as j,g as c,u as P,cc as T,a as D,bZ as N,ci as O,x as _}from"./index-103cc068.js";const q=D("br",null,null,-1),I=k({__name:"ImportSpotifyAlbum",props:{album:{type:Object,required:!0}},setup(o,{expose:b}){const r=$(),t=o,i=n([{name:"playlist",type:"dropdown",icon:"playlist_add",required:!0,value:null,options:r.playlistsAsDropdown}]),u=n(null),s=n(null),l=n([]),f=async()=>{if(l.value.length>0){u.value.show();return}const e=await u.value.fetch(`/api/spotify/albums/${t.album.id}`);e&&(l.value=await e.json())},v=()=>{const e=new CustomEvent("player.play",{detail:{artist:t.album.artist,title:t.album.title,source:t.album.href}});window.dispatchEvent(e)},m=async e=>{if(e==="new"){const a=await _(t.album.title,`${t.album.releaseDate}, ${t.album.artist}`,t.album.cover);return i.value[0].options=r.playlistsAsDropdown,i.value[0].value=a,a}return e},d=async(e,a=null)=>{l.value[e].added||(a??(a=s.value.toObject().playlist),a=await m(a),await N(a??s.value.toObject().playlist,l.value[e]),l.value[e].added=!0)},y=async()=>{let e=s.value.toObject().playlist;e=await m(e),l.value.forEach((a,p)=>{d(p,e)}),O.addSuccess(t.album.title,`Added ${l.value.length} songs to ${r.playlists[e].name}`,3e3)};return b({show:f}),(e,a)=>(C(),S(w,{ref_key:"modal",ref:u,submit:{label:"Add All",icon:"add"},name:"Import Album",onClose:a[0]||(a[0]=p=>e.$emit("close")),onSubmit:y},{default:j(()=>[c(A,{cover:o.album.cover,icons:[{name:"share",onClick:()=>P(T)(o.album.href)},{name:"play_arrow",onClick:v}],subtitle:o.album.artist,title:o.album.title},null,8,["cover","icons","subtitle","title"]),c(h,{ref_key:"form",ref:s,options:i.value},null,8,["options"]),q,c(g,{songs:l.value,noCover:"",onAdd:d},null,8,["songs"])]),_:1},512))}});export{I as _};
