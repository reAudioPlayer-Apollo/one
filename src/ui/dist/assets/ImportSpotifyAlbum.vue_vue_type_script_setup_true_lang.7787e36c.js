import{F as y,T as h,a as A,c as g}from"./song.d5ee386f.js";import{P as k}from"./Playlist.07136cc4.js";import{T as C}from"./TrackInfo.3d368c6c.js";import{m as j,j as $,n as s,o as P,f as S,w as T,g as i,u as B,B as D,a as N}from"./index.458fd4ed.js";const O=N("br",null,null,-1),V=j({__name:"ImportSpotifyAlbum",props:{album:{type:Object,required:!0}},setup(l,{expose:v}){const t=l,c=$(),r=s([{name:"playlist",type:"dropdown",icon:"playlist_add",required:!0,value:null,options:c.playlistsAsDropdown}]),u=s(null),n=s(null),o=s([]),d=async()=>{if(o.value.length>0){u.value.show();return}const e=await u.value.fetch(`/api/spotify/albums/${t.album.id}`);!e||(o.value=await e.json())},p=()=>{const e=new CustomEvent("player.play",{detail:{artist:t.album.artist,title:t.album.title,source:t.album.href}});window.dispatchEvent(e)},m=async e=>{if(e==="new"){const a=await g(t.album.title,`${t.album.releaseDate}, ${t.album.artist}`,t.album.cover);return r.value[0].options=c.playlistsAsDropdown,r.value[0].value=a,a}return Number(e)},b=async(e,a=null)=>{o.value[e].added||(a!=null||(a=n.value.toObject().playlist),a=await m(a),await A(a!=null?a:n.value.toObject().playlist,o.value[e]),o.value[e].added=!0)},w=async()=>{let e=n.value.toObject().playlist;e=await m(e),o.value.forEach((a,f)=>{b(f,e)})};return v({show:d}),(e,a)=>(P(),S(h,{ref_key:"modal",ref:u,submit:{label:"Add All",icon:"add"},name:"Import Album",onClose:a[0]||(a[0]=f=>e.$emit("close")),onSubmit:w},{default:T(()=>[i(C,{cover:l.album.cover,icons:[{name:"share",onClick:()=>B(D)(l.album.href)},{name:"play_arrow",onClick:p}],subtitle:l.album.artist,title:l.album.title},null,8,["cover","icons","subtitle","title"]),i(y,{ref_key:"form",ref:n,options:r.value},null,8,["options"]),O,i(k,{songs:o.value,noCover:"",onAdd:b},null,8,["songs"])]),_:1},512))}});export{V as _};
