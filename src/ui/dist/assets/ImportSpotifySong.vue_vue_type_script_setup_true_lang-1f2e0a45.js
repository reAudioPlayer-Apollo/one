import{F as w,T as g,a as y,c as h}from"./song-a4c74f09.js";import{T as b}from"./TrackInfo-cccce4f9.js";import{m as k,j as S,n as s,o as C,f as T,w as j,g as u,u as O,B as N}from"./index-b47f60f1.js";const D=k({__name:"ImportSpotifySong",props:{song:{type:Object,required:!0}},setup(n,{expose:d}){const o=n,c=S(),r=s([{name:"playlist",type:"dropdown",icon:"playlist_add",required:!0,value:null,options:c.playlistsAsDropdown}]),a=s(null),l=s(null),i=s(null),m=async()=>{if(i.value){a.value.show();return}const e=await a.value.fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:o.song.href})});e&&(a.value.load(),i.value=await e.json(),a.value.show())},p=()=>{const e=new CustomEvent("player.play",{detail:{artist:o.song.artist,title:o.song.title,source:o.song.href}});window.dispatchEvent(e)},f=async e=>{if(e==="new"){const t=await h(o.song.title,o.song.artist,o.song.cover);return r.value[0].options=c.playlistsAsDropdown,r.value[0].value=t,t}return Number(e)},v=async(e,t=null)=>{t??(t=l.value.toObject().playlist),t=await f(t),await y(t??l.value.toObject().playlist,i.value),o.song.added=!0};return d({show:m}),(e,t)=>(C(),T(g,{ref_key:"modal",ref:a,submit:{label:"Add",icon:"add"},name:"Import Song",onClose:t[0]||(t[0]=P=>e.$emit("close")),onSubmit:v},{default:j(()=>[u(b,{cover:n.song.cover,icons:[{name:"share",onClick:()=>O(N)(n.song.href)},{name:"play_arrow",onClick:p}],title:n.song.title},null,8,["cover","icons","title"]),u(w,{ref_key:"form",ref:l,options:r.value},null,8,["options"])]),_:1},512))}});export{D as _};
