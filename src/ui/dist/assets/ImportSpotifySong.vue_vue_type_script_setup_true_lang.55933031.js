import{F as p,T as g,a as h,c as b}from"./song.d5ee386f.js";import{T as y}from"./TrackInfo.3d368c6c.js";import{m as k,j as S,n as s,o as C,f as T,w as j,g as u,u as O,B as N}from"./index.458fd4ed.js";const D=k({__name:"ImportSpotifySong",props:{song:{type:Object,required:!0}},setup(a,{expose:m}){const t=a,c=S(),r=s([{name:"playlist",type:"dropdown",icon:"playlist_add",required:!0,value:null,options:c.playlistsAsDropdown}]),n=s(null),i=s(null),l=s(null),f=async()=>{if(l.value){n.value.show();return}const o=await n.value.fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:t.song.href})});!o||(n.value.load(),l.value=await o.json(),n.value.show())},v=()=>{const o=new CustomEvent("player.play",{detail:{artist:t.song.artist,title:t.song.title,source:t.song.href}});window.dispatchEvent(o)},w=async o=>{if(o==="new"){const e=await b(t.song.title,t.song.artist,t.song.cover);return r.value[0].options=c.playlistsAsDropdown,r.value[0].value=e,e}return Number(o)},d=async(o,e=null)=>{e!=null||(e=i.value.toObject().playlist),e=await w(e),await h(e!=null?e:i.value.toObject().playlist,l.value),t.song.added=!0};return m({show:f}),(o,e)=>(C(),T(g,{ref_key:"modal",ref:n,submit:{label:"Add",icon:"add"},name:"Import Song",onClose:e[0]||(e[0]=P=>o.$emit("close")),onSubmit:d},{default:j(()=>[u(y,{cover:a.song.cover,icons:[{name:"share",onClick:()=>O(N)(a.song.href)},{name:"play_arrow",onClick:v}],title:a.song.title},null,8,["cover","icons","title"]),u(p,{ref_key:"form",ref:i,options:r.value},null,8,["options"])]),_:1},512))}});export{D as _};
