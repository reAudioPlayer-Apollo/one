import{F as g,T as d,a as h,c as b}from"./song.14734b85.js";import{T as k}from"./TrackInfo.1452ca48.js";import{m as y,j as S,n as a,o as C,f as T,w as j,g as u,u as N,G as O}from"./index.f61d9b0b.js";const $=y({__name:"ImportSpotifySong",props:{song:{type:Object,required:!0}},setup(n,{expose:m}){const t=n,l=S(),s=a([{name:"playlist",type:"dropdown",required:!0,value:null,options:l.playlistsAsDropdown}]),r=a(null),i=a(null),c=a(null),f=async()=>{if(r.value.load(),!c.value){const o=await fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:t.song.href})});c.value=await o.json()}r.value.show()},v=()=>{const o=new CustomEvent("player.play",{detail:{artist:t.song.artist,title:t.song.title,source:t.song.href}});window.dispatchEvent(o)},w=async o=>{if(o==="new"){const e=await b(t.song.title,t.song.artist,t.song.cover);return s.value[0].options=l.playlistsAsDropdown,s.value[0].value=e,e}return Number(o)},p=async(o,e=null)=>{e!=null||(e=i.value.toObject().playlist),e=await w(e),await h(e!=null?e:i.value.toObject().playlist,c.value),t.song.added=!0};return m({show:f}),(o,e)=>(C(),T(d,{ref_key:"modal",ref:r,name:"Import Song",submitName:"Add",onSubmit:p,onClose:e[0]||(e[0]=P=>o.$emit("close"))},{default:j(()=>[u(k,{title:n.song.title,cover:n.song.cover,icons:[{name:"share",onClick:()=>N(O)(n.song.href)},{name:"play_arrow",onClick:v}]},null,8,["title","cover","icons"]),u(g,{ref_key:"form",ref:i,options:s.value},null,8,["options"])]),_:1},512))}});export{$ as _};
