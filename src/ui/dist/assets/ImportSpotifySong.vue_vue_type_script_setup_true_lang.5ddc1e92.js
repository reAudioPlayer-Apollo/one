import{F as p,T as g,a as b,c as h}from"./song.d347a36d.js";import{T as k}from"./TrackInfo.e4c645e5.js";import{m as y,j as S,n as a,o as C,f as T,w as j,g as u,u as O,B as A}from"./index.287edd0f.js";const D=y({__name:"ImportSpotifySong",props:{song:{type:Object,required:!0}},setup(n,{expose:m}){const t=n,c=S(),s=a([{name:"playlist",type:"dropdown",required:!0,value:null,options:c.playlistsAsDropdown}]),r=a(null),l=a(null),i=a(null),f=async()=>{if(r.value.load(),!i.value){const o=await fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:t.song.href})});i.value=await o.json()}r.value.show()},v=()=>{const o=new CustomEvent("player.play",{detail:{artist:t.song.artist,title:t.song.title,source:t.song.href}});window.dispatchEvent(o)},w=async o=>{if(o==="new"){const e=await h(t.song.title,t.song.artist,t.song.cover);return s.value[0].options=c.playlistsAsDropdown,s.value[0].value=e,e}return Number(o)},d=async(o,e=null)=>{e!=null||(e=l.value.toObject().playlist),e=await w(e),await b(e!=null?e:l.value.toObject().playlist,i.value),t.song.added=!0};return m({show:f}),(o,e)=>(C(),T(g,{ref_key:"modal",ref:r,submit:{label:"Add All",icon:"add"},name:"Import Song",onClose:e[0]||(e[0]=N=>o.$emit("close")),onSubmit:d},{default:j(()=>[u(k,{cover:n.song.cover,icons:[{name:"share",onClick:()=>O(A)(n.song.href)},{name:"play_arrow",onClick:v}],title:n.song.title},null,8,["cover","icons","title"]),u(p,{ref_key:"form",ref:l,options:s.value},null,8,["options"])]),_:1},512))}});export{D as _};
