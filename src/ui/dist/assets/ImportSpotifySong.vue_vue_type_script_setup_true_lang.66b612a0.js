import{F as p,T as g,a as h,c as b}from"./song.619409cb.js";import{T as k}from"./TrackInfo.a2d7128f.js";import{m as y,j as S,n as s,o as C,f as T,w as j,g as c,u as O,B as A}from"./index.1d09503d.js";const D=y({__name:"ImportSpotifySong",props:{song:{type:Object,required:!0}},setup(a,{expose:m}){const t=a,u=S(),r=s([{name:"playlist",type:"dropdown",required:!0,value:null,options:u.playlistsAsDropdown}]),n=s(null),l=s(null),i=s(null),f=async()=>{if(!i.value){n.value.show();return}const o=await n.value.fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:t.song.href})});!o||(n.value.load(),i.value=await o.json(),n.value.show())},v=()=>{const o=new CustomEvent("player.play",{detail:{artist:t.song.artist,title:t.song.title,source:t.song.href}});window.dispatchEvent(o)},w=async o=>{if(o==="new"){const e=await b(t.song.title,t.song.artist,t.song.cover);return r.value[0].options=u.playlistsAsDropdown,r.value[0].value=e,e}return Number(o)},d=async(o,e=null)=>{e!=null||(e=l.value.toObject().playlist),e=await w(e),await h(e!=null?e:l.value.toObject().playlist,i.value),t.song.added=!0};return m({show:f}),(o,e)=>(C(),T(g,{ref_key:"modal",ref:n,submit:{label:"Add All",icon:"add"},name:"Import Song",onClose:e[0]||(e[0]=N=>o.$emit("close")),onSubmit:d},{default:j(()=>[c(k,{cover:a.song.cover,icons:[{name:"share",onClick:()=>O(A)(a.song.href)},{name:"play_arrow",onClick:v}],title:a.song.title},null,8,["cover","icons","title"]),c(p,{ref_key:"form",ref:l,options:r.value},null,8,["options"])]),_:1},512))}});export{D as _};
