import{n as z,D as se,j as G,B as I,q as C,E as A,c as V,u as l,f as g,I as ae,d as x,a as o,g as p,J as R,K as L,h as oe,t as T,w as U,C as j,T as re,N as ie,F as ne,l as de,m as ue,o as u,b as q,O as ce,s as me,G as pe,H as ve,_ as ye,V as fe}from"./index-3fbaa329.js";import{F as D}from"./FactCard-32a25035.js";import{P as xe}from"./PlaylistEntry-d67c06f5.js";import{_ as he,F as _e,E as J,M as N,d as ge}from"./FixedPlaylistHeader-57b92c12.js";import{P as be}from"./PlaylistHeader-274e9464.js";import"./EditSong.vue_vue_type_script_setup_true_lang-779cc9a3.js";import"./Template-2a0cab82.js";import"./IconButton-27f34bd5.js";import"./Form-0b99c4bc.js";import"./Dropdown-c4184055.js";import"./playerInPicture-af203fdf.js";const we=a=>{const{search:n,artist:c,title:m,album:v,order:h,sort:e}=a;return n.length||c.length||m.length||v.length||h!="asc"||e!="index"},Ve=(a,n)=>{const{search:c,artist:m,title:v,album:h,sort:e}=n;return a.map(d=>{const f=c.length?d.title.toLowerCase().includes(c.toLowerCase())||d.artist.toLowerCase().includes(c.toLowerCase()):!0,y=m.length?m.includes(d.artist):!0,b=v.length?v.includes(d.title):!0,P=h.length?h.includes(d.album):!0;return{...d,show:f&&y&&b&&P,index:a.indexOf(d)}}).sort((d,f)=>{const y=d[e],b=f[e];return y<b?-1:y>b?1:0})},Pe=a=>a.map(n=>({label:n.title,value:n.title})),ke=a=>a.map(n=>({label:n.album,value:n.album})),Se=a=>{const n=new Set;for(const c of a)for(const m of c.artist.split(", "))n.add(m);return Array.from(n).sort().map(c=>({label:c,value:c}))},F=a=>(de("data-v-c45d2a5c"),a=a(),ue(),a),Ce={class:"playlist p-4"},Ie={key:1,class:"fill-page"},$e=F(()=>o("h2",{class:"text-2xl text-center error"},"Playlist not found",-1)),Te=[$e],Ue={key:2,class:"wrap"},Fe={class:"track__data"},Me={class:"upper relative"},Ae={class:"track__info__details flex flex-col justify-end"},De={class:"trac__info__details__normal"},Ne={key:0,class:"flex flex-row items-center gap-2 playlist-type"},Oe={class:"material-symbols-rounded"},Ee={class:"flex flew-row items-center"},Be={class:"font-black text-5xl ml-4 w-full flex-1"},He={class:"text-muted"},Re={class:"features flex flex-row gap-4 pt-4 pb-2 overflow-x-auto"},Le=F(()=>o("span",{class:"text-muted"},"Add a Song",-1)),je=F(()=>o("span",{class:"text-muted"},"Edit This Playlist",-1)),qe={key:0,class:"filters mt-4"},Je=F(()=>o("hr",{class:"mb-4"},null,-1)),ze={key:1,class:"items"},Ge=z({__name:"Template",props:{id:{type:String,required:!0},coverIcon:{type:String,required:!1}},emits:["rearrange"],setup(a,{emit:n}){var E,B,H;const c=a,m=se(),v=G(),h=me(),e=I(()=>v.getPlaylistById(c.id)),d=C(((E=e.value)==null?void 0:E.songs)??[]),f=C(((B=e.value)==null?void 0:B.name.trim())??""),y=C(((H=e.value)==null?void 0:H.description.trim())??""),b=C(!0),P=C(null),K=()=>({sort:"index",order:"asc",search:"",title:[],artist:[],album:[]}),r=C(null),O=()=>{r.value={...K()}};O();const W=[{value:"title",label:"Title",icon:"title"},{value:"artist",label:"Artist",icon:"person"},{value:"album",label:"Album",icon:"album"},{value:"duration",label:"Duration",icon:"timer"},{value:"index",label:"Added",icon:"date_range"}],Q=I(()=>{let i=0,t=!1;if(!e.value.songs.length)return"";for(const s of e.value.songs){t=t||s.duration<=0;const $=s.duration<=0?3*60:s.duration;i+=$}const w=i,_=Math.floor(w/60),k=Math.floor(_/60),S=t?"about ":"";return k?S+`${k} hr ${_-k*60} min`:_?S+`${_} min ${w-_*60} sec`:S+i+" sec"}),X=i=>{const t=i.moved;t&&n("rearrange",t.oldIndex,t.newIndex)};A([r,e],()=>{e.value&&M()},{deep:!0});const M=()=>{var i;d.value=Ve(((i=e.value)==null?void 0:i.songs)??[],r.value)};M(),A(e,()=>{var i,t;f.value=((i=e.value)==null?void 0:i.name.trim())??"",y.value=((t=e.value)==null?void 0:t.description.trim())??"",M()}),A([f,y],()=>{var t,w;if(f.value===((t=e.value)==null?void 0:t.name)&&y.value===((w=e.value)==null?void 0:w.description))return;const i={...e.value,name:f.value,description:y.value};pe(i),v.fetchPlaylists()});const Y=(i,t)=>{b.value=i},Z=I(()=>e.value.type==="classic"),ee=I(()=>["smart"].includes(e.value.type)),te=I(()=>e.value.type==="classic"),le=()=>{h.push(`/playlist/${e.value.id}/edit`)};return(i,t)=>{var _,k,S;const w=ve("observe-visibility");return u(),V(ne,null,[(_=l(e))!=null&&_.cover?(u(),g(ae,{key:0,placeholder:a.coverIcon,src:l(e).cover},null,8,["placeholder","src"])):x("",!0),o("div",Ce,[p(he,{ref:"addSongPopup",onUpdate:t[0]||(t[0]=s=>l(v).fetchPlaylists())},null,512),l(e)?(u(),g(_e,{key:0,ref:"fixedHeading",class:R({hidden:b.value}),title:l(e).name,onLoadPlaylist:t[1]||(t[1]=s=>l(m).loadPlaylist(a.id))},null,8,["class","title"])):x("",!0),l(e)?(u(),V("div",Ue,[o("div",Fe,[L((u(),V("div",Me,[p(oe,{placeholder:a.coverIcon,src:l(e).cover,class:"max-w-sm rounded-xl",type:"playlist"},null,8,["placeholder","src"]),o("div",Ae,[o("div",De,[l(e).type!="classic"?(u(),V("div",Ne,[o("span",Oe,T(l(e).type=="smart"?"neurology":"bolt"),1),o("span",null,T(l(e).type)+" Playlist",1)])):x("",!0),o("div",Ee,[o("span",{class:"text-5xl cursor-pointer material-symbols-rounded ms-fill my-auto",onClick:t[2]||(t[2]=s=>l(m).loadPlaylist(a.id))}," play_circle "),o("h1",Be,[p(J,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s)},{default:U(()=>[q(T(l(e).name),1)]),_:1},8,["modelValue"])])]),o("p",He,[p(J,{modelValue:y.value,"onUpdate:modelValue":t[4]||(t[4]=s=>y.value=s),placeholder:"No description"},{default:U(()=>[q(T(l(e).description),1)]),_:1},8,["modelValue"])])]),o("div",Re,[p(D,{"primary-text":(k=l(e).songs)==null?void 0:k.length,"secondary-text":((S=l(e).songs)==null?void 0:S.length)===1?"Song":"Songs",class:"w-full"},null,8,["primary-text","secondary-text"]),p(D,{"primary-text":l(Q),class:"w-full","secondary-text":"Total Duration"},null,8,["primary-text"]),l(e).plays?(u(),g(D,{key:0,"primary-text":l(e).plays,class:"w-full","secondary-text":"Plays"},null,8,["primary-text"])):x("",!0),l(Z)?(u(),g(j,{key:1,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:U(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:t[5]||(t[5]=s=>i.$refs.addSongPopup.show())},"add_circle"),Le]),_:1})):x("",!0),l(ee)?(u(),g(j,{key:2,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:U(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:le},"edit"),je]),_:1})):x("",!0)]),l(e).songs?(u(),V("div",qe,[p(re,{modelValue:r.value.search,"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.search=s),icon:"search",placeholder:"Search"},null,8,["modelValue"]),p(N,{modelValue:r.value.title,"onUpdate:modelValue":t[7]||(t[7]=s=>r.value.title=s),options:l(Pe)(l(e).songs),class:"multiselect",icon:"title",placeholder:"Title"},null,8,["modelValue","options"]),p(N,{modelValue:r.value.artist,"onUpdate:modelValue":t[8]||(t[8]=s=>r.value.artist=s),options:l(Se)(l(e).songs),class:"multiselect",icon:"person",placeholder:"Artist"},null,8,["modelValue","options"]),p(N,{modelValue:r.value.album,"onUpdate:modelValue":t[9]||(t[9]=s=>r.value.album=s),options:l(ke)(l(e).songs),class:"multiselect",icon:"album",placeholder:"Album"},null,8,["modelValue","options"]),p(ie,{modelValue:r.value.sort,"onUpdate:modelValue":t[10]||(t[10]=s=>r.value.sort=s),options:W,icon:"filter_list"},null,8,["modelValue"]),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-100 text-5xl",onClick:t[11]||(t[11]=s=>r.value.order=r.value.order=="asc"?"desc":"asc")},T(r.value.order=="asc"?"arrow_drop_up":"arrow_drop_down"),1),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-300 text-3xl mr-2",onClick:O}," delete_sweep ")])):x("",!0)])])),[[w,Y]]),d.value.length?(u(),g(be,{key:0,class:"hideIfMobile mt-8","with-album":"","with-more":""})):x("",!0),Je,d.value.length?(u(),V("div",ze,[d.value.length?(u(),g(l(ge),{key:a.id,modelValue:d.value,"onUpdate:modelValue":t[13]||(t[13]=s=>d.value=s),class:R([r.value.order=="asc"?"flex-col":"flex-col-reverse","flex"]),disabled:l(we)(r.value)||!l(te),"item-key":"id",onChange:X},{item:U(({element:s})=>[L(p(xe,{index:l(e).songs.findIndex($=>$.source==s.source),"playlist-id":a.id,selected:P.value==s.id,song:s,"with-album":"","with-cover":"","with-more":"",onClick:$=>P.value==s.id?P.value=-1:P.value=s.id,onUpdate:t[12]||(t[12]=$=>l(v).fetchPlaylists())},null,8,["index","playlist-id","selected","song","onClick"]),[[ce,s.show]])]),_:1},8,["modelValue","class","disabled"])):x("",!0)])):x("",!0)])])):(u(),V("div",Ie,Te))])],64)}}});const Ke=ye(Ge,[["__scopeId","data-v-c45d2a5c"]]),rt=z({__name:"Normal",setup(a){const n=fe(),c=G(),m=I(()=>n.params.id),v=async(h,e)=>{await fetch(`/api/playlists/${m.value}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:h,songNewIndex:e})}),await c.fetchPlaylists()};return(h,e)=>(u(),g(Ke,{id:l(m),onRearrange:v},null,8,["id"]))}});export{rt as default};
