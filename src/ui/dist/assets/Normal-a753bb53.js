import{n as J,B as te,j as z,A as $,q as S,D as F,c as V,u as l,f as _,H as le,d as y,a as o,g as f,I as H,J as R,h as se,t as C,w as I,C as L,T as ae,K as oe,F as ie,l as ne,m as re,o as d,b as j,N as de,E as ue,G as ce,_ as me,R as pe}from"./index-9b66f4b7.js";import{F as M}from"./FactCard-958d9c90.js";import{P as ve}from"./PlaylistEntry-aac3c7b3.js";import{_ as fe,a as ye,F as xe,E as q,M as D,d as he}from"./EditPlaylist.vue_vue_type_script_setup_true_lang-c2ff4308.js";import{P as _e}from"./PlaylistHeader-2908cf18.js";import"./EditSong.vue_vue_type_script_setup_true_lang-7999b78b.js";import"./Template-9f1b9544.js";import"./IconButton-2c78005e.js";import"./Form-8c5e0247.js";import"./Dropdown-622e9bc6.js";import"./playerInPicture-af203fdf.js";const ge=a=>{const{search:n,artist:c,title:p,album:v,order:e,sort:m}=a;return n.length||c.length||p.length||v.length||e!="asc"||m!="index"},be=(a,n)=>{const{search:c,artist:p,title:v,album:e,sort:m}=n;return a.map(r=>{const x=c.length?r.title.toLowerCase().includes(c.toLowerCase())||r.artist.toLowerCase().includes(c.toLowerCase()):!0,b=p.length?p.includes(r.artist):!0,h=v.length?v.includes(r.title):!0,U=e.length?e.includes(r.album):!0;return{...r,show:x&&b&&h&&U,index:a.indexOf(r)}}).sort((r,x)=>{const b=r[m],h=x[m];return b<h?-1:b>h?1:0})},we=a=>a.map(n=>({label:n.title,value:n.title})),Pe=a=>a.map(n=>({label:n.album,value:n.album})),Ve=a=>{const n=new Set;for(const c of a)for(const p of c.artist.split(", "))n.add(p);return Array.from(n).sort().map(c=>({label:c,value:c}))},T=a=>(ne("data-v-8bdfe64d"),a=a(),re(),a),ke={class:"playlist p-4"},Se={key:2,class:"fill-page"},$e=T(()=>o("h2",{class:"text-2xl text-center error"},"Playlist not found",-1)),Ce=[$e],Ie={key:3,class:"wrap"},Te={class:"track__data"},Ue={class:"upper relative"},Ae={class:"track__info__details flex flex-col justify-end"},Fe={class:"trac__info__details__normal"},Me={key:0,class:"flex flex-row items-center gap-2 playlist-type"},De={class:"material-symbols-rounded"},Ne={class:"flex flew-row items-center"},Ee={class:"font-black text-5xl ml-4 w-full flex-1"},Oe={class:"text-muted"},Be={class:"features flex flex-row gap-4 pt-4 pb-2 overflow-x-auto"},He=T(()=>o("span",{class:"text-muted"},"Add a Song",-1)),Re=T(()=>o("span",{class:"text-muted"},"Edit This Playlist",-1)),Le={key:0,class:"filters mt-4"},je=T(()=>o("hr",{class:"mb-4"},null,-1)),qe={key:1,class:"items"},Je=J({__name:"Template",props:{id:{type:String,required:!0},coverIcon:{type:String,required:!1}},emits:["rearrange"],setup(a,{emit:n}){var E,O,B;const c=a,p=te(),v=z(),e=$(()=>v.getPlaylistById(c.id)),m=S(((E=e.value)==null?void 0:E.songs)??[]),r=S(((O=e.value)==null?void 0:O.name.trim())??""),x=S(((B=e.value)==null?void 0:B.description.trim())??""),b=S(!0),h=S(null),U=()=>({sort:"index",order:"asc",search:"",title:[],artist:[],album:[]}),i=S(null),N=()=>{i.value={...U()}};N();const G=[{value:"title",label:"Title",icon:"title"},{value:"artist",label:"Artist",icon:"person"},{value:"album",label:"Album",icon:"album"},{value:"duration",label:"Duration",icon:"timer"},{value:"index",label:"Added",icon:"date_range"}],K=$(()=>{let u=0,t=!1;if(!e.value.songs.length)return"";for(const P of e.value.songs){t=t||P.duration<=0;const ee=P.duration<=0?3*60:P.duration;u+=ee}const w=u,g=Math.floor(w/60),k=Math.floor(g/60),s=t?"about ":"";return k?s+`${k} hr ${g-k*60} min`:g?s+`${g} min ${w-g*60} sec`:s+u+" sec"}),W=u=>{const t=u.moved;t&&n("rearrange",t.oldIndex,t.newIndex)};F([i,e],()=>{e.value&&A()},{deep:!0});const A=()=>{m.value=be(e.value.songs??[],i.value)};A(),F(e,()=>{var u,t;r.value=((u=e.value)==null?void 0:u.name.trim())??"",x.value=((t=e.value)==null?void 0:t.description.trim())??"",A()}),F([r,x],()=>{var t,w;if(r.value===((t=e.value)==null?void 0:t.name)&&x.value===((w=e.value)==null?void 0:w.description))return;const u={...e.value,name:r.value,description:x.value};ue(u),v.fetchPlaylists()});const Q=(u,t)=>{b.value=u},X=$(()=>e.value.type==="classic"),Y=$(()=>["classic","smart"].includes(e.value.type)),Z=$(()=>e.value.type==="classic");return(u,t)=>{var g,k;const w=ce("observe-visibility");return d(),V(ie,null,[l(e)?(d(),_(le,{key:0,placeholder:a.coverIcon,src:l(e).cover},null,8,["placeholder","src"])):y("",!0),o("div",ke,[f(fe,{ref:"addSongPopup",onUpdate:t[0]||(t[0]=s=>l(v).fetchPlaylists())},null,512),l(e)?(d(),_(ye,{key:0,ref:"editPlaylistPopup",playlist:l(e),onClose:t[1]||(t[1]=s=>l(v).fetchPlaylists())},null,8,["playlist"])):y("",!0),l(e)?(d(),_(xe,{key:1,ref:"fixedHeading",class:H({hidden:b.value}),title:l(e).name,onLoadPlaylist:t[2]||(t[2]=s=>l(p).loadPlaylist(a.id))},null,8,["class","title"])):y("",!0),l(e)?(d(),V("div",Ie,[o("div",Te,[R((d(),V("div",Ue,[f(se,{placeholder:a.coverIcon,src:l(e).cover,class:"max-w-sm rounded-xl",type:"playlist"},null,8,["placeholder","src"]),o("div",Ae,[o("div",Fe,[l(e).type!="classic"?(d(),V("div",Me,[o("span",De,C(l(e).type=="smart"?"neurology":"bolt"),1),o("span",null,C(l(e).type)+" Playlist",1)])):y("",!0),o("div",Ne,[o("span",{class:"text-5xl cursor-pointer material-symbols-rounded ms-fill my-auto",onClick:t[3]||(t[3]=s=>l(p).loadPlaylist(a.id))}," play_circle "),o("h1",Ee,[f(q,{modelValue:r.value,"onUpdate:modelValue":t[4]||(t[4]=s=>r.value=s)},{default:I(()=>[j(C(l(e).name),1)]),_:1},8,["modelValue"])])]),o("p",Oe,[f(q,{modelValue:x.value,"onUpdate:modelValue":t[5]||(t[5]=s=>x.value=s),placeholder:"No description"},{default:I(()=>[j(C(l(e).description),1)]),_:1},8,["modelValue"])])]),o("div",Be,[f(M,{"primary-text":(g=l(e).songs)==null?void 0:g.length,"secondary-text":((k=l(e).songs)==null?void 0:k.length)===1?"Song":"Songs",class:"w-full"},null,8,["primary-text","secondary-text"]),f(M,{"primary-text":l(K),class:"w-full","secondary-text":"Total Duration"},null,8,["primary-text"]),l(e).plays?(d(),_(M,{key:0,"primary-text":l(e).plays,class:"w-full","secondary-text":"Plays"},null,8,["primary-text"])):y("",!0),l(X)?(d(),_(L,{key:1,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:I(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:t[6]||(t[6]=s=>u.$refs.addSongPopup.show())},"add_circle"),He]),_:1})):y("",!0),l(Y)?(d(),_(L,{key:2,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:I(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:t[7]||(t[7]=s=>u.$refs.editPlaylistPopup.show())},"edit"),Re]),_:1})):y("",!0)]),l(e).songs?(d(),V("div",Le,[f(ae,{modelValue:i.value.search,"onUpdate:modelValue":t[8]||(t[8]=s=>i.value.search=s),icon:"search",placeholder:"Search"},null,8,["modelValue"]),f(D,{modelValue:i.value.title,"onUpdate:modelValue":t[9]||(t[9]=s=>i.value.title=s),options:l(we)(l(e).songs),class:"multiselect",icon:"title",placeholder:"Title"},null,8,["modelValue","options"]),f(D,{modelValue:i.value.artist,"onUpdate:modelValue":t[10]||(t[10]=s=>i.value.artist=s),options:l(Ve)(l(e).songs),class:"multiselect",icon:"person",placeholder:"Artist"},null,8,["modelValue","options"]),f(D,{modelValue:i.value.album,"onUpdate:modelValue":t[11]||(t[11]=s=>i.value.album=s),options:l(Pe)(l(e).songs),class:"multiselect",icon:"album",placeholder:"Album"},null,8,["modelValue","options"]),f(oe,{modelValue:i.value.sort,"onUpdate:modelValue":t[12]||(t[12]=s=>i.value.sort=s),options:G,icon:"filter_list"},null,8,["modelValue"]),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-100 text-5xl",onClick:t[13]||(t[13]=s=>i.value.order=i.value.order=="asc"?"desc":"asc")},C(i.value.order=="asc"?"arrow_drop_up":"arrow_drop_down"),1),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-300 text-3xl mr-2",onClick:N}," delete_sweep ")])):y("",!0)])])),[[w,Q]]),m.value.length?(d(),_(_e,{key:0,class:"hideIfMobile mt-8","with-album":"","with-more":""})):y("",!0),je,m.value.length?(d(),V("div",qe,[m.value.length?(d(),_(l(he),{key:a.id,modelValue:m.value,"onUpdate:modelValue":t[15]||(t[15]=s=>m.value=s),class:H([i.value.order=="asc"?"flex-col":"flex-col-reverse","flex"]),disabled:l(ge)(i.value)||!l(Z),"item-key":"id",onChange:W},{item:I(({element:s})=>[R(f(ve,{index:l(e).songs.findIndex(P=>P.source==s.source),"playlist-id":a.id,selected:h.value==s.id,song:s,"with-album":"","with-cover":"","with-more":"",onClick:P=>h.value==s.id?h.value=-1:h.value=s.id,onUpdate:t[14]||(t[14]=P=>l(v).fetchPlaylists())},null,8,["index","playlist-id","selected","song","onClick"]),[[de,s.show]])]),_:1},8,["modelValue","class","disabled"])):y("",!0)])):y("",!0)])])):(d(),V("div",Se,Ce))])],64)}}});const ze=me(Je,[["__scopeId","data-v-8bdfe64d"]]),at=J({__name:"Normal",setup(a){const n=pe(),c=z(),p=$(()=>n.params.id),v=async(e,m)=>{await fetch(`/api/playlists/${p.value}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:e,songNewIndex:m})}),await c.fetchPlaylists()};return(e,m)=>(d(),_(ze,{id:l(p),onRearrange:v},null,8,["id"]))}});export{at as default};
