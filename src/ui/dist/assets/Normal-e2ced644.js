import{i as j,B as P,q as I,D as se,k as q,E as D,c as b,u as t,f as S,I as K,d as w,g as y,J as Q,h as ae,a as n,t as F,w as M,C as E,T as oe,K as ne,F as R,o as p,b as z,s as ie,G as re,N as de,H as ce,m as X,n as Y,_ as Z,O as ue,P as pe,Q as me,W as ve}from"./index-10b115ba.js";import{P as ye}from"./PlaylistEntry-8aab18bf.js";import{F as fe,_ as _e,E as G,M as B,d as xe}from"./AddNewSong.vue_vue_type_script_setup_true_lang-572b1d73.js";import{P as he}from"./PlaylistHeader-b05591bf.js";import{F as H}from"./FactCard-777711af.js";import"./EditSong.vue_vue_type_script_setup_true_lang-1b964ecd.js";import"./Template-dc188e6c.js";import"./IconButton-4ced2022.js";import"./Form-7ad961eb.js";import"./Dropdown-f7642213.js";import"./playerInPicture-af203fdf.js";const ge=s=>{const{search:i,artist:d,title:e,album:a,order:f,sort:u}=s;return(i==null?void 0:i.length)||(d==null?void 0:d.length)||(e==null?void 0:e.length)||(a==null?void 0:a.length)||f!="asc"||u!="index"},be=(s,i)=>{const{search:d,artist:e,title:a,album:f,sort:u}=i;return s.map(c=>{const m=d.length?c.title.toLowerCase().includes(d.toLowerCase())||c.artist.toLowerCase().includes(d.toLowerCase()):!0,v=e.length?e.includes(c.artist):!0,k=a.length?a.includes(c.title):!0,r=f.length?f.includes(c.album):!0;return{...c,show:m&&v&&k&&r,index:s.indexOf(c)}}).sort((c,m)=>{const v=c[u],k=m[u];return v<k?-1:v>k?1:0})},we=s=>s.map(i=>({label:i.title,value:i.title})),Pe=s=>s.map(i=>({label:i.album,value:i.album})),ke=s=>{const i=new Set;for(const d of s)for(const e of d.artist.split(", "))i.add(e);return Array.from(i).sort().map(d=>({label:d,value:d}))},L=s=>(X("data-v-be87eeec"),s=s(),Y(),s),Ve={class:"upper relative"},$e={class:"track__info__details flex flex-col justify-end"},Ie={class:"trac__info__details__normal"},Se={key:0,class:"flex flex-row items-center gap-2 playlist-type"},Ce={class:"material-symbols-rounded"},Me={class:"flex flew-row items-center"},Te={class:"font-black text-5xl ml-4 w-full flex-1"},Ae={class:"text-muted"},Fe={class:"features flex flex-row gap-4 pt-4 pb-2 overflow-x-auto"},Ne=L(()=>n("span",{class:"text-muted"},"Add a song",-1)),Ue=L(()=>n("span",{class:"text-muted"},"Delete this playlist",-1)),De=L(()=>n("span",{class:"text-muted"},"Edit this playlist",-1)),Oe={key:0,class:"filters mt-4"},Ee=j({__name:"PlaylistMeta",props:{playlist:{type:Object,required:!1},coverIcon:{type:String,required:!0}},setup(s,{expose:i}){var J,W;const d=s,e=P(()=>d.playlist),a=I(!0),f=ie(),u=se(),c=q(),m=I(((J=e.value)==null?void 0:J.name.trim())??""),v=I(((W=e.value)==null?void 0:W.description.trim())??""),k=()=>({sort:"index",order:"asc",search:"",title:[],artist:[],album:[]}),r=I(null),T=()=>{r.value={...k()}};T(),i({songFilters:r}),D(()=>e.value,()=>{var _,l;m.value=((_=e.value)==null?void 0:_.name.trim())??"",v.value=((l=e.value)==null?void 0:l.description.trim())??"",T()}),D([m,v],()=>{var l,$;if(m.value===((l=e.value)==null?void 0:l.name)&&v.value===(($=e.value)==null?void 0:$.description))return;const _={...e.value,name:m.value,description:v.value};re(_),c.fetchPlaylists(e.value.id)});const N=(_,l)=>{a.value=_},x=P(()=>e.value.type==="classic"),h=P(()=>["smart"].includes(e.value.type)),U=()=>{f.push(`/playlist/${e.value.id}/edit`)},g=[{value:"title",label:"Title",icon:"title"},{value:"artist",label:"Artist",icon:"person"},{value:"album",label:"Album",icon:"album"},{value:"duration",label:"Duration",icon:"timer"},{value:"index",label:"Added",icon:"date_range"}],A=P(()=>{let _=0,l=!1;if(!e.value.songs.length)return"N/A";for(const O of e.value.songs){l=l||O.duration<=0;const le=O.duration<=0?3*60:O.duration;_+=le}const $=_,V=Math.floor($/60),C=Math.floor(V/60),o=l?"about ":"";return C?o+`${C} hr ${V-C*60} min`:V?o+`${V} min ${$-V*60} sec`:o+_+" sec"}),te=async()=>{await de(e.value.id),await c.fetchPlaylists(),f.push("/")};return(_,l)=>{var V,C;const $=ce("observe-visibility");return p(),b(R,null,[t(e)?(p(),S(fe,{key:0,ref:"fixedHeading",class:K({hidden:a.value}),title:t(e).name,onLoadPlaylist:l[0]||(l[0]=o=>t(u).loadPlaylist(t(e).id))},null,8,["class","title"])):w("",!0),y(_e,{ref:"addSongPopup",onUpdate:l[1]||(l[1]=o=>t(c).fetchPlaylists())},null,512),Q((p(),b("div",Ve,[y(ae,{placeholder:s.coverIcon,src:t(e).cover,class:"max-w-sm rounded-xl",type:"playlist"},null,8,["placeholder","src"]),n("div",$e,[n("div",Ie,[t(e).type!="classic"?(p(),b("div",Se,[n("span",Ce,F(t(e).type=="smart"?"neurology":"bolt"),1),n("span",null,F(t(e).type)+" Playlist",1)])):w("",!0),n("div",Me,[n("span",{class:"text-5xl cursor-pointer material-symbols-rounded ms-fill my-auto",onClick:l[2]||(l[2]=o=>t(u).loadPlaylist(t(e).id))}," play_circle "),n("h1",Te,[y(G,{modelValue:m.value,"onUpdate:modelValue":l[3]||(l[3]=o=>m.value=o)},{default:M(()=>[z(F(t(e).name),1)]),_:1},8,["modelValue"])])]),n("p",Ae,[y(G,{modelValue:v.value,"onUpdate:modelValue":l[4]||(l[4]=o=>v.value=o),placeholder:"No description"},{default:M(()=>[z(F(t(e).description),1)]),_:1},8,["modelValue"])])]),n("div",Fe,[y(H,{"primary-text":(V=t(e).songs)==null?void 0:V.length,"secondary-text":((C=t(e).songs)==null?void 0:C.length)===1?"Song":"Songs",class:"w-full"},null,8,["primary-text","secondary-text"]),y(H,{"primary-text":t(A),class:"w-full","secondary-text":"Total Duration"},null,8,["primary-text"]),t(e).plays?(p(),S(H,{key:0,"primary-text":t(e).plays,class:"w-full","secondary-text":"Plays"},null,8,["primary-text"])):w("",!0),t(x)?(p(),S(E,{key:1,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:M(()=>[n("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:l[5]||(l[5]=o=>_.$refs.addSongPopup.show())},"add_circle"),Ne]),_:1})):w("",!0),y(E,{class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:M(()=>[n("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:te},"delete"),Ue]),_:1}),t(h)?(p(),S(E,{key:2,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:M(()=>[n("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:U},"edit"),De]),_:1})):w("",!0)]),t(e).songs?(p(),b("div",Oe,[y(oe,{modelValue:r.value.search,"onUpdate:modelValue":l[6]||(l[6]=o=>r.value.search=o),icon:"search",placeholder:"Search"},null,8,["modelValue"]),y(B,{modelValue:r.value.title,"onUpdate:modelValue":l[7]||(l[7]=o=>r.value.title=o),options:t(we)(t(e).songs),class:"multiselect",icon:"title",placeholder:"Title"},null,8,["modelValue","options"]),y(B,{modelValue:r.value.artist,"onUpdate:modelValue":l[8]||(l[8]=o=>r.value.artist=o),options:t(ke)(t(e).songs),class:"multiselect",icon:"person",placeholder:"Artist"},null,8,["modelValue","options"]),y(B,{modelValue:r.value.album,"onUpdate:modelValue":l[9]||(l[9]=o=>r.value.album=o),options:t(Pe)(t(e).songs),class:"multiselect",icon:"album",placeholder:"Album"},null,8,["modelValue","options"]),y(ne,{modelValue:r.value.sort,"onUpdate:modelValue":l[10]||(l[10]=o=>r.value.sort=o),options:g,icon:"filter_list"},null,8,["modelValue"]),n("span",{class:"cursor-pointer material-symbols-rounded ms-wght-100 text-5xl",onClick:l[11]||(l[11]=o=>r.value.order=r.value.order=="asc"?"desc":"asc")},F(r.value.order=="asc"?"arrow_drop_up":"arrow_drop_down"),1),n("span",{class:"cursor-pointer material-symbols-rounded ms-wght-300 text-3xl mr-2",onClick:T}," delete_sweep ")])):w("",!0)])])),[[$,N]])],64)}}});const Be=Z(Ee,[["__scopeId","data-v-be87eeec"]]),ee=s=>(X("data-v-96a65e48"),s=s(),Y(),s),He={class:"playlist p-4"},Re={key:0,class:"fill-page"},je=ee(()=>n("h2",{class:"text-2xl text-center error"},"Playlist not found",-1)),qe=[je],Le={key:1,class:"wrap"},Je={class:"track__data"},We=ee(()=>n("hr",{class:"mb-4"},null,-1)),ze={key:1,class:"items"},Ge={key:2,class:"text-muted italic text-sm text-center mt-10"},Ke=j({__name:"Template",props:{id:{type:String,required:!0},coverIcon:{type:String,required:!1}},emits:["rearrange"],setup(s,{emit:i}){var N;const d=s,e=q(),a=P(()=>e.getPlaylistById(d.id)),f=I(),u=I(((N=a.value)==null?void 0:N.songs)??[]),c=I(null),m=P(()=>{var x;return((x=f.value)==null?void 0:x.songFilters)??{}});D([m,a],()=>{a.value&&v()},{deep:!0});const v=()=>{var x;u.value=be(((x=a.value)==null?void 0:x.songs)??[],m.value)};ue(()=>{v()}),D(a,()=>{v()});const k=P(()=>a.value.type==="classic"),r=P(()=>a.value.type==="classic"),T=x=>{const h=x.moved;h&&i("rearrange",h.oldIndex,h.newIndex)};return(x,h)=>{var U;return p(),b(R,null,[(U=t(a))!=null&&U.cover?(p(),S(pe,{key:0,placeholder:s.coverIcon,src:t(a).cover},null,8,["placeholder","src"])):w("",!0),n("div",He,[t(a)?(p(),b("div",Le,[n("div",Je,[y(Be,{ref_key:"playlistMeta",ref:f,playlist:t(a),coverIcon:s.coverIcon},null,8,["playlist","coverIcon"]),u.value.length?(p(),b(R,{key:0},[y(he,{class:"hideIfMobile mt-8","with-album":"","with-more":""}),We],64)):w("",!0),u.value.length?(p(),b("div",ze,[u.value.length?(p(),S(t(xe),{key:s.id,modelValue:u.value,"onUpdate:modelValue":h[1]||(h[1]=g=>u.value=g),class:K([t(m).order=="asc"?"flex-col":"flex-col-reverse","flex"]),disabled:t(ge)(t(m))||!t(k),"item-key":"id",onChange:T},{item:M(({element:g})=>[Q(y(ye,{index:t(a).songs.findIndex(A=>A.source==g.source),"playlist-id":s.id,selected:c.value==g.id,song:g,"with-album":"","with-cover":"","with-more":"",onClick:A=>c.value==g.id?c.value=-1:c.value=g.id,onUpdate:h[0]||(h[0]=A=>t(e).fetchPlaylists())},null,8,["index","playlist-id","selected","song","onClick"]),[[me,g.show]])]),_:1},8,["modelValue","class","disabled"])):w("",!0)])):t(r)?(p(),b("p",Ge," No songs. Add some! ")):w("",!0)])])):(p(),b("div",Re,qe))])],64)}}});const Qe=Z(Ke,[["__scopeId","data-v-96a65e48"]]),rt=j({__name:"Normal",setup(s){const i=ve(),d=q(),e=P(()=>i.params.id),a=async(f,u)=>{await fetch(`/api/playlists/${e.value}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:f,songNewIndex:u})}),await d.fetchPlaylists()};return(f,u)=>(p(),S(Qe,{id:t(e),onRearrange:a},null,8,["id"]))}});export{rt as default};
