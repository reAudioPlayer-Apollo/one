import{n as z,B as se,j as G,A as I,q as C,D as M,c as V,u as l,f as g,H as ae,d as x,a as o,g as p,I as R,J as L,h as oe,t as T,w as U,C as j,T as re,K as ie,F as ne,l as de,m as ue,o as d,b as q,N as ce,s as me,E as pe,G as ve,_ as fe,S as ye}from"./index-65db2c2c.js";import{F as D}from"./FactCard-831b786a.js";import{P as xe}from"./PlaylistEntry-e002ad41.js";import{_ as he,F as _e,E as J,M as N,d as ge}from"./FixedPlaylistHeader-2e42863b.js";import{P as be}from"./PlaylistHeader-9a7963bc.js";import"./EditSong.vue_vue_type_script_setup_true_lang-8ac27373.js";import"./Template-a1dab28f.js";import"./IconButton-4d0597f4.js";import"./Form-bbb0f63a.js";import"./Dropdown-62bf446a.js";import"./playerInPicture-af203fdf.js";const we=a=>{const{search:i,artist:u,title:m,album:v,order:h,sort:e}=a;return i.length||u.length||m.length||v.length||h!="asc"||e!="index"},Ve=(a,i)=>{const{search:u,artist:m,title:v,album:h,sort:e}=i;return a.map(n=>{const y=u.length?n.title.toLowerCase().includes(u.toLowerCase())||n.artist.toLowerCase().includes(u.toLowerCase()):!0,f=m.length?m.includes(n.artist):!0,b=v.length?v.includes(n.title):!0,P=h.length?h.includes(n.album):!0;return{...n,show:y&&f&&b&&P,index:a.indexOf(n)}}).sort((n,y)=>{const f=n[e],b=y[e];return f<b?-1:f>b?1:0})},Pe=a=>a.map(i=>({label:i.title,value:i.title})),ke=a=>a.map(i=>({label:i.album,value:i.album})),Se=a=>{const i=new Set;for(const u of a)for(const m of u.artist.split(", "))i.add(m);return Array.from(i).sort().map(u=>({label:u,value:u}))},A=a=>(de("data-v-caef2514"),a=a(),ue(),a),Ce={class:"playlist p-4"},Ie={key:1,class:"fill-page"},$e=A(()=>o("h2",{class:"text-2xl text-center error"},"Playlist not found",-1)),Te=[$e],Ue={key:2,class:"wrap"},Ae={class:"track__data"},Fe={class:"upper relative"},Me={class:"track__info__details flex flex-col justify-end"},De={class:"trac__info__details__normal"},Ne={key:0,class:"flex flex-row items-center gap-2 playlist-type"},Ee={class:"material-symbols-rounded"},Oe={class:"flex flew-row items-center"},Be={class:"font-black text-5xl ml-4 w-full flex-1"},He={class:"text-muted"},Re={class:"features flex flex-row gap-4 pt-4 pb-2 overflow-x-auto"},Le=A(()=>o("span",{class:"text-muted"},"Add a Song",-1)),je=A(()=>o("span",{class:"text-muted"},"Edit This Playlist",-1)),qe={key:0,class:"filters mt-4"},Je=A(()=>o("hr",{class:"mb-4"},null,-1)),ze={key:1,class:"items"},Ge=z({__name:"Template",props:{id:{type:String,required:!0},coverIcon:{type:String,required:!1}},emits:["rearrange"],setup(a,{emit:i}){var O,B,H;const u=a,m=se(),v=G(),h=me(),e=I(()=>v.getPlaylistById(u.id)),n=C(((O=e.value)==null?void 0:O.songs)??[]),y=C(((B=e.value)==null?void 0:B.name.trim())??""),f=C(((H=e.value)==null?void 0:H.description.trim())??""),b=C(!0),P=C(null),K=()=>({sort:"index",order:"asc",search:"",title:[],artist:[],album:[]}),r=C(null),E=()=>{r.value={...K()}};E();const W=[{value:"title",label:"Title",icon:"title"},{value:"artist",label:"Artist",icon:"person"},{value:"album",label:"Album",icon:"album"},{value:"duration",label:"Duration",icon:"timer"},{value:"index",label:"Added",icon:"date_range"}],Q=I(()=>{let c=0,t=!1;if(!e.value.songs.length)return"";for(const s of e.value.songs){t=t||s.duration<=0;const $=s.duration<=0?3*60:s.duration;c+=$}const w=c,_=Math.floor(w/60),k=Math.floor(_/60),S=t?"about ":"";return k?S+`${k} hr ${_-k*60} min`:_?S+`${_} min ${w-_*60} sec`:S+c+" sec"}),X=c=>{const t=c.moved;t&&i("rearrange",t.oldIndex,t.newIndex)};M([r,e],()=>{e.value&&F()},{deep:!0});const F=()=>{n.value=Ve(e.value.songs??[],r.value)};F(),M(e,()=>{var c,t;y.value=((c=e.value)==null?void 0:c.name.trim())??"",f.value=((t=e.value)==null?void 0:t.description.trim())??"",F()}),M([y,f],()=>{var t,w;if(y.value===((t=e.value)==null?void 0:t.name)&&f.value===((w=e.value)==null?void 0:w.description))return;const c={...e.value,name:y.value,description:f.value};pe(c),v.fetchPlaylists()});const Y=(c,t)=>{b.value=c},Z=I(()=>e.value.type==="classic"),ee=I(()=>["smart"].includes(e.value.type)),te=I(()=>e.value.type==="classic"),le=()=>{h.push(`/playlist/${e.value.id}/edit`)};return(c,t)=>{var _,k,S;const w=ve("observe-visibility");return d(),V(ne,null,[(_=l(e))!=null&&_.cover?(d(),g(ae,{key:0,placeholder:a.coverIcon,src:l(e).cover},null,8,["placeholder","src"])):x("",!0),o("div",Ce,[p(he,{ref:"addSongPopup",onUpdate:t[0]||(t[0]=s=>l(v).fetchPlaylists())},null,512),l(e)?(d(),g(_e,{key:0,ref:"fixedHeading",class:R({hidden:b.value}),title:l(e).name,onLoadPlaylist:t[1]||(t[1]=s=>l(m).loadPlaylist(a.id))},null,8,["class","title"])):x("",!0),l(e)?(d(),V("div",Ue,[o("div",Ae,[L((d(),V("div",Fe,[p(oe,{placeholder:a.coverIcon,src:l(e).cover,class:"max-w-sm rounded-xl",type:"playlist"},null,8,["placeholder","src"]),o("div",Me,[o("div",De,[l(e).type!="classic"?(d(),V("div",Ne,[o("span",Ee,T(l(e).type=="smart"?"neurology":"bolt"),1),o("span",null,T(l(e).type)+" Playlist",1)])):x("",!0),o("div",Oe,[o("span",{class:"text-5xl cursor-pointer material-symbols-rounded ms-fill my-auto",onClick:t[2]||(t[2]=s=>l(m).loadPlaylist(a.id))}," play_circle "),o("h1",Be,[p(J,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=s=>y.value=s)},{default:U(()=>[q(T(l(e).name),1)]),_:1},8,["modelValue"])])]),o("p",He,[p(J,{modelValue:f.value,"onUpdate:modelValue":t[4]||(t[4]=s=>f.value=s),placeholder:"No description"},{default:U(()=>[q(T(l(e).description),1)]),_:1},8,["modelValue"])])]),o("div",Re,[p(D,{"primary-text":(k=l(e).songs)==null?void 0:k.length,"secondary-text":((S=l(e).songs)==null?void 0:S.length)===1?"Song":"Songs",class:"w-full"},null,8,["primary-text","secondary-text"]),p(D,{"primary-text":l(Q),class:"w-full","secondary-text":"Total Duration"},null,8,["primary-text"]),l(e).plays?(d(),g(D,{key:0,"primary-text":l(e).plays,class:"w-full","secondary-text":"Plays"},null,8,["primary-text"])):x("",!0),l(Z)?(d(),g(j,{key:1,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:U(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:t[5]||(t[5]=s=>c.$refs.addSongPopup.show())},"add_circle"),Le]),_:1})):x("",!0),l(ee)?(d(),g(j,{key:2,class:"p-4 w-1/2 flex flex-col items-center justify-center"},{default:U(()=>[o("span",{id:"addToPlaylist",class:"material-symbols-rounded ms-fill",onClick:le},"edit"),je]),_:1})):x("",!0)]),l(e).songs?(d(),V("div",qe,[p(re,{modelValue:r.value.search,"onUpdate:modelValue":t[6]||(t[6]=s=>r.value.search=s),icon:"search",placeholder:"Search"},null,8,["modelValue"]),p(N,{modelValue:r.value.title,"onUpdate:modelValue":t[7]||(t[7]=s=>r.value.title=s),options:l(Pe)(l(e).songs),class:"multiselect",icon:"title",placeholder:"Title"},null,8,["modelValue","options"]),p(N,{modelValue:r.value.artist,"onUpdate:modelValue":t[8]||(t[8]=s=>r.value.artist=s),options:l(Se)(l(e).songs),class:"multiselect",icon:"person",placeholder:"Artist"},null,8,["modelValue","options"]),p(N,{modelValue:r.value.album,"onUpdate:modelValue":t[9]||(t[9]=s=>r.value.album=s),options:l(ke)(l(e).songs),class:"multiselect",icon:"album",placeholder:"Album"},null,8,["modelValue","options"]),p(ie,{modelValue:r.value.sort,"onUpdate:modelValue":t[10]||(t[10]=s=>r.value.sort=s),options:W,icon:"filter_list"},null,8,["modelValue"]),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-100 text-5xl",onClick:t[11]||(t[11]=s=>r.value.order=r.value.order=="asc"?"desc":"asc")},T(r.value.order=="asc"?"arrow_drop_up":"arrow_drop_down"),1),o("span",{class:"cursor-pointer material-symbols-rounded ms-wght-300 text-3xl mr-2",onClick:E}," delete_sweep ")])):x("",!0)])])),[[w,Y]]),n.value.length?(d(),g(be,{key:0,class:"hideIfMobile mt-8","with-album":"","with-more":""})):x("",!0),Je,n.value.length?(d(),V("div",ze,[n.value.length?(d(),g(l(ge),{key:a.id,modelValue:n.value,"onUpdate:modelValue":t[13]||(t[13]=s=>n.value=s),class:R([r.value.order=="asc"?"flex-col":"flex-col-reverse","flex"]),disabled:l(we)(r.value)||!l(te),"item-key":"id",onChange:X},{item:U(({element:s})=>[L(p(xe,{index:l(e).songs.findIndex($=>$.source==s.source),"playlist-id":a.id,selected:P.value==s.id,song:s,"with-album":"","with-cover":"","with-more":"",onClick:$=>P.value==s.id?P.value=-1:P.value=s.id,onUpdate:t[12]||(t[12]=$=>l(v).fetchPlaylists())},null,8,["index","playlist-id","selected","song","onClick"]),[[ce,s.show]])]),_:1},8,["modelValue","class","disabled"])):x("",!0)])):x("",!0)])])):(d(),V("div",Ie,Te))])],64)}}});const Ke=fe(Ge,[["__scopeId","data-v-caef2514"]]),rt=z({__name:"Normal",setup(a){const i=ye(),u=G(),m=I(()=>i.params.id),v=async(h,e)=>{await fetch(`/api/playlists/${m.value}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:h,songNewIndex:e})}),await u.fetchPlaylists()};return(h,e)=>(d(),g(Ke,{id:l(m),onRearrange:v},null,8,["id"]))}});export{rt as default};
