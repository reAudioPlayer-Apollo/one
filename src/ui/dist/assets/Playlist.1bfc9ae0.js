import{F}from"./FixedPlaylistHeader.6e8358aa.js";import{a as H,P as O}from"./PlaylistEntry.32b7dbad.js";import{F as C,T as N,b as q,a as A,e as M,h as U,i as V,g as R}from"./song.ef42d390.js";import{m as k,n as _,o as P,f as I,w as S,g as u,P as z,Q as D,v as B,E as J,q as L,_ as K,j as Q,h as $,K as j,p as G,R as W,S as X,c as x,x as Y,z as Z,a as c,t as w,e as f,J as ee,k as te,l as se}from"./index.08918264.js";import{d as ae}from"./vuedraggable.umd.ac7b9f65.js";import"./EditSong.vue_vue_type_script_setup_true_lang.629ea41c.js";import"./playerInPicture.37a9ab56.js";import"./Dropdown.27fca163.js";const le=k({__name:"AddNewSong",setup(s,{expose:i}){const o=z(),r={title:"",artist:"",album:"",cover:"",src:""},l=async(d,e)=>{const t=B(String(new Date().getTime())),m=new FormData,n="."+e.name.split(".").pop();var g=e.slice(0,e.size,e.type),b=new File([g],t+n,{type:e.type});return m.append("file",b),await(await fetch(d,{method:"POST",body:m})).text()},a=_([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:d=>{l("/api/config/tracks",d).then(e=>r.src=e)},onChange:async d=>{const e=await q(d);a.value.find(t=>t.name==="title").value=e.title,a.value.find(t=>t.name==="artist").value=e.artist,a.value.find(t=>t.name==="album").value=e.album,a.value.find(t=>t.name==="cover").value=e.cover,a.value.find(t=>t.name==="src").value=e.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:d=>{l("/api/config/images",d).then(e=>r.cover=e)}}]),p=_(null),y=_(null),h=()=>{p.value.show()},v=async d=>{const e=Number(D(String(o.params.id)));await A(e,y.value.toObject())};return i({show:h}),(d,e)=>(P(),I(N,{ref_key:"modal",ref:p,name:"Add Song",submitName:"Save",onSubmit:v,onClose:e[0]||(e[0]=t=>d.$emit("close"))},{default:S(()=>[u(C,{ref_key:"form",ref:y,options:a.value},null,8,["options"])]),_:1},512))}}),ie=k({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(s,{expose:i}){const o=s,r=async(e,t)=>{const m=new FormData,n="."+t.name.split(".").pop();var g=t.slice(0,t.size,t.type),b=new File([g],o.playlist.name+n,{type:t.type});return m.append("file",b),await(await fetch(e,{method:"POST",body:m})).text()};J(()=>o.playlist,e=>{l.value.find(t=>t.name=="name").value=e.name,l.value.find(t=>t.name=="description").value=e.description,l.value.find(t=>t.name=="cover").value=e.cover},{deep:!0});const l=_([{name:"name",type:"text",required:!0,value:o.playlist.name},{name:"description",type:"text",required:!0,value:o.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:o.playlist.cover,onUpload:e=>{r("/api/config/images",e).then(t=>o.playlist.cover=t)}}]),a=_(null),p=_(null),y=L(),h=()=>{a.value.show()},v=async()=>{await M({...o.playlist,...p.value.toObject()})},d=async()=>{await U(o.playlist.id),await y.push("/collection/playlists")};return i({show:h}),(e,t)=>(P(),I(N,{ref_key:"modal",ref:a,name:"Edit Playlist",submitName:"Save",onSubmit:v,onClose:t[0]||(t[0]=m=>e.$emit("close")),secondaryName:"Delete",secondaryType:"danger",onSecondary:d},{default:S(()=>[u(C,{ref_key:"form",ref:p,options:l.value},null,8,["options"])]),_:1},512))}});Q();const oe={components:{PlaylistEntry:H,FixedPlaylistHeader:F,PlaylistHeader:O,AddSong:le,EditPlaylist:ie,draggable:ae,Cover:$},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:j(),selectedSongId:-1}},methods:{parseCover:G,parsePlaylistCover:W,download(s){var o;const i=(o=this.playlist)==null?void 0:o[s];window.open(`/api/tracks/${i.id}/download`)},onPlaylistRearrange(s){const i=s.moved;!i||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:i.oldIndex,songNewIndex:i.newIndex})})},headerVisibilityChanged(s){this.fixedHeaderHidden=s},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(s=>{s.playing=s.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){V().then(s=>{const i=X(s);this.$router.push(i)});return}R(this.id).then(async s=>{if(!s){this.$router.push("/");return}this.playlist=s.songs,this.playlistName=s.name,this.playlistDescription=s.description,this.playlistCover=s.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return D(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let s=0,i=!1;if(!this.playlist.length)return"";for(const p of this.playlist){i=i||p.duration=="-1:59";const y=p.duration=="-1:59"?"3:00":p.duration,[h,v]=y.split(":");s+=Number(h*60)+Number(v)}const o=s,r=Math.floor(o/60),l=Math.floor(r/60),a=i?", about ":", ";return l?a+`${l} hr ${r-l*60} min`:r?a+`${r} min ${o-r*60} sec`:a+s+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},E=s=>(te("data-v-690f23b5"),s=s(),se(),s),ne={class:"playlist"},re={class:"details"},de={class:"text-muted text-xs my-0 description"},ce={class:"mobileMenu showIfMobile"},pe=E(()=>c("hr",null,null,-1)),ue={class:"padding-20"},ye={class:"grid"},me=E(()=>c("hr",null,null,-1)),he={class:"playlistEntries"};function ve(s,i,o,r,l,a){const p=f("AddSong"),y=f("EditPlaylist"),h=f("fixed-playlist-header"),v=f("Cover"),d=f("PlaylistHeader"),e=f("PlaylistEntry"),t=f("draggable"),m=ee("observe-visibility");return P(),x("div",ne,[u(p,{onClose:a.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),u(y,{onClose:a.updatePlaylist,playlist:{name:l.playlistName,description:l.playlistDescription,cover:l.playlistCover,id:a.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),u(h,{onLoadPlaylist:a.loadPlaylist,ref:"fixedHeading",class:Y({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),Z((P(),x("div",{class:"padding-20 playlisteditor",onClick:i[0]||(i[0]=(...n)=>a.editPlaylist&&a.editPlaylist(...n))},[u(v,{src:l.playlistCover,type:"playlist"},null,8,["src"]),c("div",re,[c("h1",null,w(l.playlistName),1),c("h6",null,w(l.playlistDescription),1),c("p",de,w(a.autogeneratedDescription),1)])])),[[m,a.headerVisibilityChanged]]),c("div",ce,[c("span",{onClick:i[1]||(i[1]=()=>s.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),pe,c("div",ue,[c("span",{id:"loadPlaylist",onClick:i[2]||(i[2]=(...n)=>a.loadPlaylist&&a.loadPlaylist(...n)),class:"material-symbols-rounded"},"play_circle"),c("span",{id:"addToPlaylist",onClick:i[3]||(i[3]=(...n)=>a.addToPlaylist&&a.addToPlaylist(...n)),class:"material-symbols-rounded"},"add_circle"),c("div",ye,[u(d,{class:"hideIfMobile","with-more":""}),me,c("div",he,[u(t,{modelValue:l.playlist,"onUpdate:modelValue":i[4]||(i[4]=n=>l.playlist=n),onChange:a.onPlaylistRearrange},{item:S(({element:n})=>[u(e,{index:l.playlist.findIndex(g=>g.source==n.source),song:n,"with-cover":"","with-album":"","with-more":"","playlist-id":Number(a.id),onClick:g=>l.selectedSongId==n.id?l.selectedSongId=-1:l.selectedSongId=n.id,onUpdate:a.updatePlaylist,selected:l.selectedSongId==n.id},null,8,["index","song","playlist-id","onClick","onUpdate","selected"])]),_:1},8,["modelValue","onChange"])])])])])}const Ce=K(oe,[["render",ve],["__scopeId","data-v-690f23b5"]]);export{Ce as default};
