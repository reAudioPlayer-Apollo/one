import{F as O,G as F}from"./FixedPlaylistHeader.72c743db.js";import{P as E}from"./PlaylistEntry.a7286818.js";import{F as C,T as S,a as H,f as V}from"./song.e52b21df.js";import{B as N,C as g,o as _,f as k,w as b,g as y,J as q,I as D,m as M,K as j,_ as A,H as U,j as B,p as R,N as J,c as w,s as z,x as G,d as L,a as p,b as $,t as x,e as v,v as K,k as Q,l as W}from"./index.12f03f32.js";import{d as X}from"./vuedraggable.umd.6a1c2ae3.js";import"./EditSong.vue_vue_type_script_setup_true_lang.2b98b6dd.js";const Y=N({__name:"AddNewSong",setup(e,{expose:t}){const n=q(),r={title:"",artist:"",album:"",cover:"",src:""},l=async(s,i)=>{const d=M(String(new Date().getTime())),f=new FormData,o="."+i.name.split(".").pop();var P=i.slice(0,i.size,i.type),T=new File([P],d+o,{type:i.type});return f.append("file",T),await(await fetch(s,{method:"POST",body:f})).text()},a=g([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:s=>{l("/api/config/tracks",s).then(i=>r.src=i)},onChange:async s=>{const i=await V(s);a.value.find(d=>d.name==="title").value=i.title,a.value.find(d=>d.name==="artist").value=i.artist,a.value.find(d=>d.name==="album").value=i.album,a.value.find(d=>d.name==="cover").value=i.cover,a.value.find(d=>d.name==="src").value=i.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:s=>{l("/api/config/images",s).then(i=>r.cover=i)}}]),u=g(null),m=g(null),h=()=>{u.value.show()},c=async s=>{const i=Number(D(String(n.params.id)));await H(i,m.value.toObject())};return t({show:h}),(s,i)=>(_(),k(S,{ref_key:"modal",ref:u,name:"Add Song",submitName:"Save",onSubmit:c,onClose:i[0]||(i[0]=d=>s.$emit("close"))},{default:b(()=>[y(C,{ref_key:"form",ref:m,options:a.value},null,8,["options"])]),_:1},512))}}),Z=async e=>{console.log("updatePlaylist",e),await fetch(`/api/playlists/${e.id}`,{method:"POST",body:JSON.stringify({name:e.name,description:e.description,cover:e.cover})})},ee=N({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(e,{expose:t}){const n=e,r=async(c,s)=>{const i=new FormData,d="."+s.name.split(".").pop();var f=s.slice(0,s.size,s.type),o=new File([f],n.playlist.name+d,{type:s.type});return i.append("file",o),await(await fetch(c,{method:"POST",body:i})).text()};j(()=>n.playlist,c=>{l.value.find(s=>s.name=="name").value=c.name,l.value.find(s=>s.name=="description").value=c.description,l.value.find(s=>s.name=="cover").value=c.cover},{deep:!0});const l=g([{name:"name",type:"text",required:!0,value:n.playlist.name},{name:"description",type:"text",required:!0,value:n.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:n.playlist.cover,onUpload:c=>{r("/api/config/images",c).then(s=>n.playlist.cover=s)}}]),a=g(null),u=g(null),m=()=>{a.value.show()},h=async()=>{await Z({...n.playlist,...u.value.toObject()})};return t({show:m}),(c,s)=>(_(),k(S,{ref_key:"modal",ref:a,name:"Edit Playlist",submitName:"Save",onSubmit:h,onClose:s[0]||(s[0]=i=>c.$emit("close"))},{default:b(()=>[y(C,{ref_key:"form",ref:u,options:l.value},null,8,["options"])]),_:1},512))}});const te={components:{PlaylistEntry:E,FixedPlaylistHeader:O,GridHeader:F,AddSong:Y,EditPlaylist:ee,draggable:X},name:"Playlist",data(){return this.updatePlaylist(),fetch("/api/playlists").then(e=>e.json()).then(e=>{this.playlists=e}),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,playlists:[],store:U()}},methods:{parseCover:B,parsePlaylistCover:R,download(e){var n;const t=(n=this.playlist)==null?void 0:n[e];window.open(`/api/tracks/${t.id}/download`)},onPlaylistRearrange(e){const t=e.moved;!t||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:t.oldIndex,songNewIndex:t.newIndex})})},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(e=>{e.playing=e.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlists/new").then(e=>e.text()).then(e=>{const t=J(e);this.$router.push(t)});return}fetch(`/api/playlists/${this.id}`).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();this.playlist=t.songs,this.playlistName=t.name,this.playlistDescription=t.description,this.playlistCover=t.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return D(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let e=0,t=!1;if(!this.playlist.length)return"";for(const u of this.playlist){t=t||u.duration=="-1:59";const m=u.duration=="-1:59"?"3:00":u.duration,[h,c]=m.split(":");e+=Number(h*60)+Number(c)}const n=e,r=Math.floor(n/60),l=Math.floor(r/60),a=t?", about ":", ";return l?a+`${l} hr ${r-l*60} min`:r?a+`${r} min ${n-r*60} sec`:a+e+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},I=e=>(Q("data-v-ca92c248"),e=e(),W(),e),ae={class:"playlist"},se=["src"],ie={class:"details"},le={class:"muted description"},oe={class:"mobileMenu showIfMobile"},ne=I(()=>p("hr",null,null,-1)),re={class:"padding-20"},de={class:"grid"},ce=I(()=>p("hr",null,null,-1)),pe={class:"playlistEntries"};function ue(e,t,n,r,l,a){const u=v("AddSong"),m=v("EditPlaylist"),h=v("fixed-playlist-header"),c=v("h7"),s=v("grid-header"),i=v("playlist-entry"),d=v("draggable"),f=K("observe-visibility");return _(),w("div",ae,[y(u,{onClose:a.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),y(m,{onClose:a.updatePlaylist,playlist:{name:l.playlistName,description:l.playlistDescription,cover:l.playlistCover,id:a.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),y(h,{onLoadPlaylist:a.loadPlaylist,ref:"fixedHeading",class:z({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),G((_(),w("div",{class:"padding-20 playlisteditor",onClick:t[0]||(t[0]=(...o)=>a.editPlaylist&&a.editPlaylist(...o))},[l.playlistCover?(_(),w("img",{key:0,class:"cover",src:a.parsePlaylistCover(l.playlistCover)},null,8,se)):L("",!0),p("div",ie,[y(c,{class:"hideIfMobile"},{default:b(()=>[$("Playlist")]),_:1}),p("h1",null,x(l.playlistName),1),p("h5",null,x(l.playlistDescription),1),p("p",le,x(a.autogeneratedDescription),1)])])),[[f,a.headerVisibilityChanged]]),p("div",oe,[p("span",{onClick:t[1]||(t[1]=()=>e.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),ne,p("div",re,[p("span",{id:"loadPlaylist",onClick:t[2]||(t[2]=(...o)=>a.loadPlaylist&&a.loadPlaylist(...o)),class:"material-symbols-rounded"},"play_circle"),p("span",{id:"addToPlaylist",onClick:t[3]||(t[3]=(...o)=>a.addToPlaylist&&a.addToPlaylist(...o)),class:"material-symbols-rounded"},"add_circle"),p("div",de,[y(s,{class:"hideIfMobile"}),ce,p("div",pe,[y(d,{modelValue:l.playlist,"onUpdate:modelValue":t[4]||(t[4]=o=>l.playlist=o),onChange:a.onPlaylistRearrange},{item:b(({element:o})=>[y(i,{playlists:l.playlists,onDownload:a.download,onRequestUpdate:a.updatePlaylist,index:l.playlist.findIndex(P=>P.source==o.source),source:o.source,playing:o.playing,id:o.id,title:o.title,album:o.album,artist:o.artist,cover:o.cover,favourite:o.favourite,duration:o.duration},null,8,["playlists","onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}const Pe=A(te,[["render",ue],["__scopeId","data-v-ca92c248"]]);export{Pe as default};
