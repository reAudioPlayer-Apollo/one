import{F as M,G as V}from"./FixedPlaylistHeader.b8ace406.js";import{P as U}from"./PlaylistEntry.2af4e234.js";import{F as E}from"./FindSources.6716608c.js";import{_ as P,h as A,l as x,C,e as p,o as v,c as g,g as u,w as b,a as s,v as m,y as _,p as S,i as N,B as O,k as H,D as L,q as R,d as J,b as B,t as w,s as q}from"./index.f7193606.js";import{d as z}from"./vuedraggable.umd.4ae0ca3a.js";import"./SongCtx.6c644dee.js";import"./EditSong.98a69518.js";const G={name:"AddSong",components:{FindSources:E},data(){return{showModal:!1,cover:"",artist:"",title:""}},mounted(){const t=A(String(new Date().getTime()));this.$refs.upSong.addEventListener("change",()=>{const e=new FormData;var n=this.$refs.upSong.files[0],d=n.slice(0,n.size,n.type),l=new File([d],t+".mp3",{type:n.type});e.append("file",l),fetch("/api/config/tracks",{method:"POST",body:e}).then(o=>o.text()).then(o=>this.$refs.source.value=o)}),this.$refs.upCover.addEventListener("change",()=>{const e=new FormData;var n=this.$refs.upCover.files[0],d=n.slice(0,n.size,n.type);const l=n.name.split(".").pop();var o=new File([d],t+`.${l}`,{type:n.type});e.append("file",o),fetch("/api/config/images",{method:"POST",body:e}).then(c=>c.text()).then(c=>this.cover=c)})},watch:{showModal(){!this.showModal||navigator.clipboard.readText().then(t=>{!this.isValidHttpUrl(t)||(this.$refs.source.value=t,this.loadMetadata())})}},methods:{parseCover:x,isValidHttpUrl(t){let e;try{e=new URL(t)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"},opencontextmenu(t){this.$refs.findSources.show(t)},hideFindSourcesCtx(){this.$refs.findSources.hide()},getId(){return Number(C(this.$route.params.id))},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/playlists/${this.getId()}/tracks`,{method:"POST",body:JSON.stringify({source:this.$refs.source.value,title:this.title,artist:this.artist,album:this.$refs.album.value,cover:this.cover})}).then(t=>{console.log(t),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(t=>t.json()).then(t=>{console.log(t),this.title=t.title,this.$refs.album.value=t.album,this.artist=t.artists.join(", "),this.cover=t.cover,this.$refs.source.value=t.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}}},h=t=>(S("data-v-264f144f"),t=t(),N(),t),j={class:"wrapper"},K={class:"header"},Q=h(()=>s("h3",null,"Add song",-1)),W=h(()=>s("span",{class:"material-icons-round"}," close ",-1)),X=[W],Y=h(()=>s("h4",null,"Source",-1)),Z={class:"content"},ee=h(()=>s("span",{class:"material-symbols-rounded"},"file_upload",-1)),te=[ee],se={type:"file",ref:"upSong",style:{display:"none"},accept:"audio/mp3"},le=h(()=>s("h4",null,"Title",-1)),oe={class:"content"},ie=h(()=>s("h4",null,"Album",-1)),ne={class:"content"},ae={type:"text",ref:"album"},re=h(()=>s("h4",null,"Artist",-1)),de={class:"content"},ce=h(()=>s("h4",null,"Cover",-1)),pe={class:"content"},ue=h(()=>s("span",{class:"material-symbols-rounded"},"file_upload",-1)),he=[ue],ye={type:"file",ref:"upCover",style:{display:"none"},accept:"image/*"},me=["src"],fe={class:"confirm"};function _e(t,e,n,d,l,o){const c=p("FindSources"),i=p("vue-final-modal");return v(),g("div",null,[u(i,{onClick:o.hideFindSourcesCtx,modelValue:l.showModal,"onUpdate:modelValue":e[10]||(e[10]=y=>l.showModal=y),classes:"modal-container","content-class":"modal-content"},{default:b(()=>{var y;return[s("div",j,[s("div",K,[Q,s("button",{class:"modal-close",onClick:e[0]||(e[0]=a=>l.showModal=!1)},X)]),Y,u(c,{ref:"findSources",src:(y=t.$refs.source)==null?void 0:y.value,title:l.title,artist:l.artist},{default:b(()=>[s("div",Z,[s("button",{onClick:e[1]||(e[1]=()=>t.$refs.upSong.click())},te),s("input",se,null,512),s("input",{onChange:e[2]||(e[2]=(...a)=>o.loadMetadata&&o.loadMetadata(...a)),type:"text",ref:"source"},null,544),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:e[3]||(e[3]=(...a)=>o.opencontextmenu&&o.opencontextmenu(...a))},"more_vert",512)])]),_:1},8,["src","title","artist"]),le,s("div",oe,[m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>l.title=a),type:"text"},null,512),[[_,l.title]])]),ie,s("div",ne,[s("input",ae,null,512)]),re,s("div",de,[m(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>l.artist=a),type:"text"},null,512),[[_,l.artist]])]),ce,s("div",pe,[s("button",{onClick:e[6]||(e[6]=()=>t.$refs.upCover.click())},he),s("input",ye,null,512),m(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[7]||(e[7]=a=>l.cover=a),ref:"cover"},null,512),[[_,l.cover]]),s("img",{onClick:e[8]||(e[8]=(...a)=>o.openInNewTab&&o.openInNewTab(...a)),class:"addSong cover",src:o.parseCover(l.cover)},null,8,me)]),s("div",fe,[s("button",{onClick:e[9]||(e[9]=(...a)=>o.add&&o.add(...a)),class:"negative"},"Add")])])]}),_:1},8,["onClick","modelValue"])])}const ve=P(G,[["render",_e],["__scopeId","data-v-264f144f"]]);const ge={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String,playlistCover:String},mounted(){this.$refs.upFile.addEventListener("change",()=>{var n,d,l,o;const t=(n=this.$refs.upFile.files)==null?void 0:n[0];if(!!t){this.uploadedCoverName=(o=(l=(d=this.$refs.upFile)==null?void 0:d.files)==null?void 0:l[0])==null?void 0:o.name;var e=new FileReader;e.onloadend=()=>{this.uploadedCover=e.result},e.readAsDataURL(t)}})},data(){return{showModal:!1,name:this.playlistName,description:this.playlistDescription,cover:this.playlistCover,uploadedCover:null,uploadedCoverName:null}},methods:{uploadFile(){console.log(this.$refs.upFile);const t=new FormData;t.append("file",this.$refs.upFile.files[0]),t.append("user","hubot"),fetch("/api/config/images",{method:"POST",body:t}).then(e=>e.text()).then(e=>this.cover=e)},apply(){this.showModal=!1,console.log("fetch"),fetch(`/api/playlists/${C(this.$route.params.id)}`,{method:"POST",body:JSON.stringify({name:this.name||"N/A",description:this.description||"N/A",cover:this.cover||"/assets/img/music_placeholder.png"})}).then(t=>{console.log(t),this.$emit("close")})},remove(){fetch(`/api/playlists/${Number(C(this.$route.params.id))}`,{method:"DELETE"}).then(()=>{this.$router.push("/")})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription},playlistCover(){this.cover=this.playlistCover}}},f=t=>(S("data-v-e9e8f781"),t=t(),N(),t),be={class:"wrapper"},Ce={class:"header"},we=f(()=>s("h3",null,"Edit details",-1)),Pe=f(()=>s("span",{class:"material-symbols-rounded"},"close",-1)),Se=[Pe],Ne=f(()=>s("h4",null,"Name",-1)),xe={class:"content"},Ie=f(()=>s("h4",null,"Description",-1)),ke={class:"content"},De=f(()=>s("h4",null,"Upload Cover",-1)),$e={class:"content"},Fe=f(()=>s("span",{class:"material-symbols-rounded"},"search",-1)),Te=[Fe],Me={type:"file",ref:"upFile",style:{display:"none"},accept:"image/*"},Ve=["src"],Ue=f(()=>s("span",{class:"material-symbols-rounded"},"file_upload",-1)),Ee=[Ue],Ae=f(()=>s("h4",null,"Cover",-1)),Oe={class:"content"},He=["src"],Le={class:"confirm"};function Re(t,e,n,d,l,o){const c=p("vue-final-modal");return v(),g("div",null,[u(c,{modelValue:l.showModal,"onUpdate:modelValue":e[11]||(e[11]=i=>l.showModal=i),classes:"modal-container","content-class":"modal-content"},{default:b(()=>[s("div",be,[s("div",Ce,[we,s("button",{class:"modal-close",onClick:e[0]||(e[0]=i=>l.showModal=!1)},Se)]),Ne,s("div",xe,[m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>l.name=i),type:"text",ref:"name"},null,512),[[_,l.name]])]),Ie,s("div",ke,[m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>l.description=i),type:"text",ref:"description"},null,512),[[_,l.description]])]),De,s("div",$e,[s("button",{onClick:e[3]||(e[3]=()=>t.$refs.upFile.click())},Te),s("input",Me,null,512),m(s("input",{type:"text",class:"addSong cover",readonly:"","onUpdate:modelValue":e[4]||(e[4]=i=>l.uploadedCoverName=i),ref:"cover"},null,512),[[_,l.uploadedCoverName]]),s("img",{onClick:e[5]||(e[5]=(...i)=>o.openInNewTab&&o.openInNewTab(...i)),class:"addSong cover",src:l.uploadedCover?l.uploadedCover:"/assets/img/music_placeholder.png"},null,8,Ve),s("button",{onClick:e[6]||(e[6]=(...i)=>o.uploadFile&&o.uploadFile(...i))},Ee)]),Ae,s("div",Oe,[m(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[7]||(e[7]=i=>l.cover=i),ref:"cover"},null,512),[[_,l.cover]]),s("img",{onClick:e[8]||(e[8]=(...i)=>o.openInNewTab&&o.openInNewTab(...i)),class:"addSong cover",src:l.cover?l.cover:"/assets/img/music_placeholder.png"},null,8,He)]),s("div",Le,[s("button",{onClick:e[9]||(e[9]=(...i)=>o.remove&&o.remove(...i)),class:"negative left"},"Delete"),s("button",{onClick:e[10]||(e[10]=(...i)=>o.apply&&o.apply(...i)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}const Je=P(ge,[["render",Re],["__scopeId","data-v-e9e8f781"]]);const Be={components:{PlaylistEntry:U,FixedPlaylistHeader:M,GridHeader:V,AddSong:ve,EditPlaylist:Je,draggable:z},name:"Playlist",data(){return this.updatePlaylist(),fetch("/api/playlists").then(t=>t.json()).then(t=>{this.playlists=t}),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,playlists:[],store:O()}},methods:{parseCover:x,getId(){return C(this.$route.params.id)},download(t){var n;const e=(n=this.playlist)==null?void 0:n[t];window.open(`/api/tracks/${e.id}/download`)},onPlaylistRearrange(t){const e=t.moved;!e||fetch(`/api/playlists/${this.getId()}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:e.oldIndex,songNewIndex:e.newIndex})})},headerVisibilityChanged(t){this.fixedHeaderHidden=t},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateIsPlaying(){this.playlist.forEach(t=>{t.playing=t.id==this.currentSong})},updatePlaylist(){if(!!this.getId()&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlists/new").then(t=>t.text()).then(t=>{const e=H(t);this.$router.push(e)});return}fetch(`/api/playlists/${this.getId()}`).then(async t=>{if(t.status==404){this.$router.push("/");return}const e=await t.json();this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description,this.playlistCover=L(e.cover),document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"playlist"})})}},computed:{autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let t=0,e=!1;if(!this.playlist.length)return"";for(const c of this.playlist){e=e||c.duration=="-1:59";const i=c.duration=="-1:59"?"3:00":c.duration,[y,a]=i.split(":");t+=Number(y*60)+Number(a)}const n=t,d=Math.floor(n/60),l=Math.floor(d/60),o=e?", about ":", ";return l?o+`${l} hr ${d-l*60} min`:d?o+`${d} min ${n-d*60} sec`:o+t+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},I=t=>(S("data-v-87b40c54"),t=t(),N(),t),qe={class:"playlist"},ze=["src"],Ge={class:"details"},je={class:"muted description"},Ke={class:"mobileMenu showIfMobile"},Qe=I(()=>s("hr",null,null,-1)),We={class:"padding-20"},Xe={class:"grid"},Ye=I(()=>s("hr",null,null,-1)),Ze={class:"playlistEntries"};function et(t,e,n,d,l,o){const c=p("AddSong"),i=p("EditPlaylist"),y=p("fixed-playlist-header"),a=p("h7"),k=p("grid-header"),D=p("playlist-entry"),$=p("draggable"),F=q("observe-visibility");return v(),g("div",qe,[u(c,{onClose:o.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),u(i,{onClose:o.updatePlaylist,playlistCover:l.playlistCover,playlistName:l.playlistName,playlistDescription:l.playlistDescription,ref:"editPlaylistPopup"},null,8,["onClose","playlistCover","playlistName","playlistDescription"]),u(y,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:R({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),m((v(),g("div",{class:"padding-20 playlisteditor",onClick:e[0]||(e[0]=(...r)=>o.editPlaylist&&o.editPlaylist(...r))},[l.playlistCover?(v(),g("img",{key:0,class:"cover",src:l.playlistCover},null,8,ze)):J("",!0),s("div",Ge,[u(a,{class:"hideIfMobile"},{default:b(()=>[B("Playlist")]),_:1}),s("h1",null,w(l.playlistName),1),s("h5",null,w(l.playlistDescription),1),s("p",je,w(o.autogeneratedDescription),1)])])),[[F,o.headerVisibilityChanged]]),s("div",Ke,[s("span",{onClick:e[1]||(e[1]=()=>t.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),Qe,s("div",We,[s("span",{id:"loadPlaylist",onClick:e[2]||(e[2]=(...r)=>o.loadPlaylist&&o.loadPlaylist(...r)),class:"material-symbols-rounded"},"play_circle"),s("span",{id:"addToPlaylist",onClick:e[3]||(e[3]=(...r)=>o.addToPlaylist&&o.addToPlaylist(...r)),class:"material-symbols-rounded"},"add_circle"),s("div",Xe,[u(k,{class:"hideIfMobile"}),Ye,s("div",Ze,[u($,{modelValue:l.playlist,"onUpdate:modelValue":e[4]||(e[4]=r=>l.playlist=r),onChange:o.onPlaylistRearrange},{item:b(({element:r})=>[u(D,{playlists:l.playlists,onDownload:o.download,onRequestUpdate:o.updatePlaylist,index:l.playlist.findIndex(T=>T.source==r.source),source:r.source,playing:r.playing,id:r.id,title:r.title,album:r.album,artist:r.artist,cover:r.cover,favourite:r.favourite,duration:r.duration},null,8,["playlists","onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}const rt=P(Be,[["render",et],["__scopeId","data-v-87b40c54"]]);export{rt as default};
