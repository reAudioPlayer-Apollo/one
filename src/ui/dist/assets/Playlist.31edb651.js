import{F,G as E}from"./FixedPlaylistHeader.cc4800cd.js";import{P as H}from"./PlaylistEntry.d55d9305.js";import{F as C,T as S,a as O,f as V}from"./song.21840599.js";import{v as N,x as g,o as _,f as k,w as b,g as y,I as q,H as D,m as A,J as M,_ as U,G as B,j as R,p as z,K as G,c as w,s as J,B as L,d as K,a as u,b as $,t as x,e as v,A as j,k as Q,l as W}from"./index.789939b0.js";import{u as X,g as Y}from"./playlist.e85eb7bf.js";import{d as Z}from"./vuedraggable.umd.f0be6c9f.js";import"./SongCtx.e97d8c11.js";import"./EditSong.vue_vue_type_script_setup_true_lang.9b01811f.js";const ee=N({__name:"AddNewSong",setup(e,{expose:s}){const n=q(),r={title:"",artist:"",album:"",cover:"",src:""},l=async(a,i)=>{const d=A(String(new Date().getTime())),f=new FormData,o="."+i.name.split(".").pop();var P=i.slice(0,i.size,i.type),T=new File([P],d+o,{type:i.type});return f.append("file",T),await(await fetch(a,{method:"POST",body:f})).text()},t=g([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:a=>{l("/api/config/tracks",a).then(i=>r.src=i)},onChange:async a=>{const i=await V(a);t.value.find(d=>d.name==="title").value=i.title,t.value.find(d=>d.name==="artist").value=i.artist,t.value.find(d=>d.name==="album").value=i.album,t.value.find(d=>d.name==="cover").value=i.cover,t.value.find(d=>d.name==="src").value=i.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:a=>{l("/api/config/images",a).then(i=>r.cover=i)}}]),c=g(null),m=g(null),h=()=>{c.value.show()},p=async a=>{const i=Number(D(String(n.params.id)));await O(i,m.value.toObject())};return s({show:h}),(a,i)=>(_(),k(S,{ref_key:"modal",ref:c,name:"Add Song",submitName:"Save",onSubmit:p,onClose:i[0]||(i[0]=d=>a.$emit("close"))},{default:b(()=>[y(C,{ref_key:"form",ref:m,options:t.value},null,8,["options"])]),_:1},512))}}),te=N({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(e,{expose:s}){const n=e,r=async(p,a)=>{const i=new FormData,d="."+a.name.split(".").pop();var f=a.slice(0,a.size,a.type),o=new File([f],n.playlist.name+d,{type:a.type});return i.append("file",o),await(await fetch(p,{method:"POST",body:i})).text()};M(()=>n.playlist,p=>{l.value.find(a=>a.name=="name").value=p.name,l.value.find(a=>a.name=="description").value=p.description,l.value.find(a=>a.name=="cover").value=p.cover},{deep:!0});const l=g([{name:"name",type:"text",required:!0,value:n.playlist.name},{name:"description",type:"text",required:!0,value:n.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:n.playlist.cover,onUpload:p=>{r("/api/config/images",p).then(a=>n.playlist.cover=a)}}]),t=g(null),c=g(null),m=()=>{t.value.show()},h=async()=>{await X({...n.playlist,...c.value.toObject()})};return s({show:m}),(p,a)=>(_(),k(S,{ref_key:"modal",ref:t,name:"Edit Playlist",submitName:"Save",onSubmit:h,onClose:a[0]||(a[0]=i=>p.$emit("close"))},{default:b(()=>[y(C,{ref_key:"form",ref:c,options:l.value},null,8,["options"])]),_:1},512))}});const ae={components:{PlaylistEntry:H,FixedPlaylistHeader:F,GridHeader:E,AddSong:ee,EditPlaylist:te,draggable:Z},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:B()}},methods:{parseCover:R,parsePlaylistCover:z,download(e){var n;const s=(n=this.playlist)==null?void 0:n[e];window.open(`/api/tracks/${s.id}/download`)},onPlaylistRearrange(e){const s=e.moved;!s||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:s.oldIndex,songNewIndex:s.newIndex})})},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(e=>{e.playing=e.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlists/new").then(e=>e.text()).then(e=>{const s=G(e);this.$router.push(s)});return}Y(this.id).then(async e=>{if(!e){this.$router.push("/");return}this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description,this.playlistCover=e.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return D(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let e=0,s=!1;if(!this.playlist.length)return"";for(const c of this.playlist){s=s||c.duration=="-1:59";const m=c.duration=="-1:59"?"3:00":c.duration,[h,p]=m.split(":");e+=Number(h*60)+Number(p)}const n=e,r=Math.floor(n/60),l=Math.floor(r/60),t=s?", about ":", ";return l?t+`${l} hr ${r-l*60} min`:r?t+`${r} min ${n-r*60} sec`:t+e+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},I=e=>(Q("data-v-3ab4861f"),e=e(),W(),e),se={class:"playlist"},ie=["src"],le={class:"details"},oe={class:"muted description"},ne={class:"mobileMenu showIfMobile"},re=I(()=>u("hr",null,null,-1)),de={class:"padding-20"},pe={class:"grid"},ue=I(()=>u("hr",null,null,-1)),ce={class:"playlistEntries"};function ye(e,s,n,r,l,t){const c=v("AddSong"),m=v("EditPlaylist"),h=v("fixed-playlist-header"),p=v("h7"),a=v("grid-header"),i=v("playlist-entry"),d=v("draggable"),f=j("observe-visibility");return _(),w("div",se,[y(c,{onClose:t.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),y(m,{onClose:t.updatePlaylist,playlist:{name:l.playlistName,description:l.playlistDescription,cover:l.playlistCover,id:t.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),y(h,{onLoadPlaylist:t.loadPlaylist,ref:"fixedHeading",class:J({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),L((_(),w("div",{class:"padding-20 playlisteditor",onClick:s[0]||(s[0]=(...o)=>t.editPlaylist&&t.editPlaylist(...o))},[l.playlistCover?(_(),w("img",{key:0,class:"cover",src:t.parsePlaylistCover(l.playlistCover)},null,8,ie)):K("",!0),u("div",le,[y(p,{class:"hideIfMobile"},{default:b(()=>[$("Playlist")]),_:1}),u("h1",null,x(l.playlistName),1),u("h5",null,x(l.playlistDescription),1),u("p",oe,x(t.autogeneratedDescription),1)])])),[[f,t.headerVisibilityChanged]]),u("div",ne,[u("span",{onClick:s[1]||(s[1]=()=>e.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),re,u("div",de,[u("span",{id:"loadPlaylist",onClick:s[2]||(s[2]=(...o)=>t.loadPlaylist&&t.loadPlaylist(...o)),class:"material-symbols-rounded"},"play_circle"),u("span",{id:"addToPlaylist",onClick:s[3]||(s[3]=(...o)=>t.addToPlaylist&&t.addToPlaylist(...o)),class:"material-symbols-rounded"},"add_circle"),u("div",pe,[y(a,{class:"hideIfMobile"}),ue,u("div",ce,[y(d,{modelValue:l.playlist,"onUpdate:modelValue":s[4]||(s[4]=o=>l.playlist=o),onChange:t.onPlaylistRearrange},{item:b(({element:o})=>[y(i,{playlists:e.playlists,onDownload:t.download,onRequestUpdate:t.updatePlaylist,index:l.playlist.findIndex(P=>P.source==o.source),source:o.source,playing:o.playing,id:o.id,title:o.title,album:o.album,artist:o.artist,cover:o.cover,favourite:o.favourite,duration:o.duration},null,8,["playlists","onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}const xe=U(ae,[["render",ye],["__scopeId","data-v-3ab4861f"]]);export{xe as default};
