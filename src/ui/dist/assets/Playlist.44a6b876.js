import{F}from"./FixedPlaylistHeader.8b130c57.js";import{P as H}from"./PlaylistEntry.75d93026.js";import{F as C,T as k,b as O,a as A,e as U,h as q,P as M,i as V,g as R}from"./song.6a60a886.js";import{m as I,n as _,o as P,f as D,w as S,g as p,P as B,Q as z,R as N,v as J,D as L,q as Q,_ as $,j,h as G,J as K,p as W,S as X,U as Y,c as x,C as Z,y as ee,a as c,t as w,e as g,I as te,k as ae,l as se}from"./index.c970909a.js";import{d as ie}from"./vuedraggable.umd.6e1f6451.js";import"./EditSong.vue_vue_type_script_setup_true_lang.42f3815c.js";import"./playerInPicture.37a9ab56.js";import"./Dropdown.7541a2ee.js";const le=I({__name:"AddNewSong",setup(s,{expose:l}){const n=B(),d={title:"",artist:"",album:"",cover:"",source:""},i=async(o,t)=>{const e=J(String(new Date().getTime())),m=new FormData,r="."+t.name.split(".").pop();var f=t.slice(0,t.size,t.type),b=new File([f],e+r,{type:t.type});return m.append("file",b),await(await fetch(o,{method:"POST",body:m})).text()},a=_([{name:"source",type:"upload",accept:"audio/mp3",required:!0,onUpload:o=>{i("/api/config/tracks",o).then(t=>a.value.find(e=>e.name=="source").value=t)},onChange:async o=>{const t=await O(o);a.value.find(e=>e.name==="title").value=t.title,a.value.find(e=>e.name==="artist").value=t.artist,a.value.find(e=>e.name==="album").value=t.album,a.value.find(e=>e.name==="cover").value=t.cover,a.value.find(e=>e.name==="source").value=t.source},value:d.source},{name:"title",type:"text",icon:"title",required:!0,value:d.title},{name:"artist",type:"text",icon:"person",required:!0,value:d.artist},{name:"album",type:"text",icon:"album",value:d.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:d.cover,onUpload:o=>{i("/api/config/images",o).then(t=>a.value.find(e=>e.name=="cover").value=t)}}]),u=_(null),y=_(null),h=async()=>{if(u.value.show(),!navigator.clipboard)return;const o=await navigator.clipboard.readText();if(!z(o))return;const t=a.value.find(e=>e.name==="source");t.value=o,t.onChange(o)},v=async o=>{const t=Number(N(String(n.params.id)));await A(t,y.value.toObject())};return l({show:h}),(o,t)=>(P(),D(k,{ref_key:"modal",ref:u,submit:{label:"Add",icon:"add"},name:"Add Song",onClose:t[0]||(t[0]=e=>o.$emit("close")),onSubmit:v},{default:S(()=>[p(C,{ref_key:"form",ref:y,options:a.value},null,8,["options"])]),_:1},512))}}),oe=I({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(s,{expose:l}){const n=s,d=async(t,e)=>{const m=new FormData,r="."+e.name.split(".").pop();var f=e.slice(0,e.size,e.type),b=new File([f],n.playlist.name+r,{type:e.type});return m.append("file",b),await(await fetch(t,{method:"POST",body:m})).text()};L(()=>n.playlist,t=>{i.value.find(e=>e.name=="name").value=t.name,i.value.find(e=>e.name=="description").value=t.description,i.value.find(e=>e.name=="cover").value=t.cover},{deep:!0});const i=_([{name:"name",type:"text",icon:"title",required:!0,value:n.playlist.name},{name:"description",type:"text",icon:"description",required:!0,value:n.playlist.description},{name:"cover",type:"upload",icon:"image",accept:"image/*",imagePreview:!0,value:n.playlist.cover,onUpload:t=>{d("/api/config/images",t).then(e=>n.playlist.cover=e)}}]),a=_(null),u=_(null),y=Q(),h=()=>{a.value.show()},v=async()=>{await U({...n.playlist,...u.value.toObject()})},o=async()=>{await q(n.playlist.id),await y.push("/collection/playlists")};return l({show:h}),(t,e)=>(P(),D(k,{ref_key:"modal",ref:a,secondary:{label:"Delete",icon:"delete",type:"danger"},submit:{label:"Save",icon:"save"},name:"Edit Playlist",onClose:e[0]||(e[0]=m=>t.$emit("close")),onSecondary:o,onSubmit:v},{default:S(()=>[p(C,{ref_key:"form",ref:u,options:i.value},null,8,["options"])]),_:1},512))}});j();const ne={components:{PlaylistEntry:H,FixedPlaylistHeader:F,PlaylistHeader:M,AddSong:le,EditPlaylist:oe,draggable:ie,Cover:G},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:K(),selectedSongId:-1}},methods:{parseCover:W,parsePlaylistCover:X,download(s){var n;const l=(n=this.playlist)==null?void 0:n[s];window.open(`/api/tracks/${l.id}/download`)},onPlaylistRearrange(s){const l=s.moved;!l||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:l.oldIndex,songNewIndex:l.newIndex})})},headerVisibilityChanged(s){this.fixedHeaderHidden=s},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(s=>{s.playing=s.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){V().then(s=>{const l=Y(s);this.$router.push(l)});return}R(this.id).then(async s=>{if(!s){this.$router.push("/");return}this.playlist=s.songs,this.playlistName=s.name,this.playlistDescription=s.description,this.playlistCover=s.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return N(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let s=0,l=!1;if(!this.playlist.length)return"";for(const u of this.playlist){l=l||u.duration=="-1:59";const y=u.duration=="-1:59"?"3:00":u.duration,[h,v]=y.split(":");s+=Number(h*60)+Number(v)}const n=s,d=Math.floor(n/60),i=Math.floor(d/60),a=l?", about ":", ";return i?a+`${i} hr ${d-i*60} min`:d?a+`${d} min ${n-d*60} sec`:a+s+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},T=s=>(ae("data-v-933bddee"),s=s(),se(),s),re={class:"playlist"},de={class:"details"},ce={class:"text-muted text-xs my-0 description"},ue={class:"mobileMenu showIfMobile"},pe=T(()=>c("hr",null,null,-1)),ye={class:"padding-20"},me={class:"grid"},he=T(()=>c("hr",null,null,-1)),ve={class:"playlistEntries"};function ge(s,l,n,d,i,a){const u=g("AddSong"),y=g("EditPlaylist"),h=g("fixed-playlist-header"),v=g("Cover"),o=g("PlaylistHeader"),t=g("PlaylistEntry"),e=g("draggable"),m=te("observe-visibility");return P(),x("div",re,[p(u,{ref:"addSongPopup",onClose:a.updatePlaylist},null,8,["onClose"]),p(y,{ref:"editPlaylistPopup",playlist:{name:i.playlistName,description:i.playlistDescription,cover:i.playlistCover,id:a.id},onClose:a.updatePlaylist},null,8,["playlist","onClose"]),p(h,{ref:"fixedHeading",class:Z({hidden:i.fixedHeaderHidden}),title:i.playlistName,onLoadPlaylist:a.loadPlaylist},null,8,["class","title","onLoadPlaylist"]),ee((P(),x("div",{class:"padding-20 playlisteditor",onClick:l[0]||(l[0]=(...r)=>a.editPlaylist&&a.editPlaylist(...r))},[p(v,{src:i.playlistCover,type:"playlist"},null,8,["src"]),c("div",de,[c("h1",null,w(i.playlistName),1),c("h6",null,w(i.playlistDescription),1),c("p",ce,w(a.autogeneratedDescription),1)])])),[[m,a.headerVisibilityChanged]]),c("div",ue,[c("span",{class:"material-symbols-rounded",onClick:l[1]||(l[1]=()=>s.$emit("toggleFullSidebar"))},"menu")]),pe,c("div",ye,[c("span",{id:"loadPlaylist",class:"material-symbols-rounded",onClick:l[2]||(l[2]=(...r)=>a.loadPlaylist&&a.loadPlaylist(...r))},"play_circle"),c("span",{id:"addToPlaylist",class:"material-symbols-rounded",onClick:l[3]||(l[3]=(...r)=>a.addToPlaylist&&a.addToPlaylist(...r))},"add_circle"),c("div",me,[p(o,{class:"hideIfMobile","with-album":"","with-more":""}),he,c("div",ve,[p(e,{modelValue:i.playlist,"onUpdate:modelValue":l[4]||(l[4]=r=>i.playlist=r),onChange:a.onPlaylistRearrange},{item:S(({element:r})=>[p(t,{index:i.playlist.findIndex(f=>f.source==r.source),"playlist-id":Number(a.id),selected:i.selectedSongId==r.id,song:r,"with-album":"","with-cover":"","with-more":"",onClick:f=>i.selectedSongId==r.id?i.selectedSongId=-1:i.selectedSongId=r.id,onUpdate:a.updatePlaylist},null,8,["index","playlist-id","selected","song","onClick","onUpdate"])]),_:1},8,["modelValue","onChange"])])])])])}const ke=$(ne,[["render",ge],["__scopeId","data-v-933bddee"]]);export{ke as default};
