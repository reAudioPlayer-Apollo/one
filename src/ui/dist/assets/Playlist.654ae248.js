import{F}from"./FixedPlaylistHeader.e6338226.js";import{a as H,P as O}from"./PlaylistEntry.94a64364.js";import{F as C,T as N,b as M,a as V,e as q,h as A,i as U,g as B}from"./song.bd0028ce.js";import{m as I,n as _,o as b,f as k,w,g as u,N as z,O as D,v as R,z as J,q as L,_ as K,j as Q,h as $,K as j,p as G,P as W,Q as X,c as x,x as Y,B as Z,a as c,b as ee,t as S,e as h,J as te,k as se,l as ae}from"./index.bb9dc178.js";import{d as le}from"./vuedraggable.umd.c54792cc.js";import"./EditSong.vue_vue_type_script_setup_true_lang.2a364eab.js";import"./playerInPicture.37a9ab56.js";const ie=I({__name:"AddNewSong",setup(s,{expose:i}){const o=z(),r={title:"",artist:"",album:"",cover:"",src:""},l=async(d,e)=>{const t=R(String(new Date().getTime())),m=new FormData,P="."+e.name.split(".").pop();var n=e.slice(0,e.size,e.type),f=new File([n],t+P,{type:e.type});return m.append("file",f),await(await fetch(d,{method:"POST",body:m})).text()},a=_([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:d=>{l("/api/config/tracks",d).then(e=>r.src=e)},onChange:async d=>{const e=await M(d);a.value.find(t=>t.name==="title").value=e.title,a.value.find(t=>t.name==="artist").value=e.artist,a.value.find(t=>t.name==="album").value=e.album,a.value.find(t=>t.name==="cover").value=e.cover,a.value.find(t=>t.name==="src").value=e.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:d=>{l("/api/config/images",d).then(e=>r.cover=e)}}]),p=_(null),y=_(null),v=()=>{p.value.show()},g=async d=>{const e=Number(D(String(o.params.id)));await V(e,y.value.toObject())};return i({show:v}),(d,e)=>(b(),k(N,{ref_key:"modal",ref:p,name:"Add Song",submitName:"Save",onSubmit:g,onClose:e[0]||(e[0]=t=>d.$emit("close"))},{default:w(()=>[u(C,{ref_key:"form",ref:y,options:a.value},null,8,["options"])]),_:1},512))}}),oe=I({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(s,{expose:i}){const o=s,r=async(e,t)=>{const m=new FormData,P="."+t.name.split(".").pop();var n=t.slice(0,t.size,t.type),f=new File([n],o.playlist.name+P,{type:t.type});return m.append("file",f),await(await fetch(e,{method:"POST",body:m})).text()};J(()=>o.playlist,e=>{l.value.find(t=>t.name=="name").value=e.name,l.value.find(t=>t.name=="description").value=e.description,l.value.find(t=>t.name=="cover").value=e.cover},{deep:!0});const l=_([{name:"name",type:"text",required:!0,value:o.playlist.name},{name:"description",type:"text",required:!0,value:o.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:o.playlist.cover,onUpload:e=>{r("/api/config/images",e).then(t=>o.playlist.cover=t)}}]),a=_(null),p=_(null),y=L(),v=()=>{a.value.show()},g=async()=>{await q({...o.playlist,...p.value.toObject()})},d=async()=>{await A(o.playlist.id),await y.push("/collection/playlists")};return i({show:v}),(e,t)=>(b(),k(N,{ref_key:"modal",ref:a,name:"Edit Playlist",submitName:"Save",onSubmit:g,onClose:t[0]||(t[0]=m=>e.$emit("close")),secondaryName:"Delete",secondaryType:"danger",onSecondary:d},{default:w(()=>[u(C,{ref_key:"form",ref:p,options:l.value},null,8,["options"])]),_:1},512))}});Q();const ne={components:{PlaylistEntry:H,FixedPlaylistHeader:F,PlaylistHeader:O,AddSong:ie,EditPlaylist:oe,draggable:le,Cover:$},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:j(),selectedSongId:-1}},methods:{parseCover:G,parsePlaylistCover:W,download(s){var o;const i=(o=this.playlist)==null?void 0:o[s];window.open(`/api/tracks/${i.id}/download`)},onPlaylistRearrange(s){const i=s.moved;!i||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:i.oldIndex,songNewIndex:i.newIndex})})},headerVisibilityChanged(s){this.fixedHeaderHidden=s},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(s=>{s.playing=s.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){U().then(s=>{const i=X(s);this.$router.push(i)});return}B(this.id).then(async s=>{if(!s){this.$router.push("/");return}this.playlist=s.songs,this.playlistName=s.name,this.playlistDescription=s.description,this.playlistCover=s.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return D(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let s=0,i=!1;if(!this.playlist.length)return"";for(const p of this.playlist){i=i||p.duration=="-1:59";const y=p.duration=="-1:59"?"3:00":p.duration,[v,g]=y.split(":");s+=Number(v*60)+Number(g)}const o=s,r=Math.floor(o/60),l=Math.floor(r/60),a=i?", about ":", ";return l?a+`${l} hr ${r-l*60} min`:r?a+`${r} min ${o-r*60} sec`:a+s+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},T=s=>(se("data-v-345a967d"),s=s(),ae(),s),re={class:"playlist"},de={class:"details"},ce={class:"muted description"},pe={class:"mobileMenu showIfMobile"},ue=T(()=>c("hr",null,null,-1)),ye={class:"padding-20"},me={class:"grid"},he=T(()=>c("hr",null,null,-1)),ve={class:"playlistEntries"};function ge(s,i,o,r,l,a){const p=h("AddSong"),y=h("EditPlaylist"),v=h("fixed-playlist-header"),g=h("Cover"),d=h("h7"),e=h("PlaylistHeader"),t=h("PlaylistEntry"),m=h("draggable"),P=te("observe-visibility");return b(),x("div",re,[u(p,{onClose:a.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),u(y,{onClose:a.updatePlaylist,playlist:{name:l.playlistName,description:l.playlistDescription,cover:l.playlistCover,id:a.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),u(v,{onLoadPlaylist:a.loadPlaylist,ref:"fixedHeading",class:Y({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),Z((b(),x("div",{class:"padding-20 playlisteditor",onClick:i[0]||(i[0]=(...n)=>a.editPlaylist&&a.editPlaylist(...n))},[u(g,{src:l.playlistCover,type:"playlist"},null,8,["src"]),c("div",de,[u(d,{class:"hideIfMobile"},{default:w(()=>[ee("Playlist")]),_:1}),c("h1",null,S(l.playlistName),1),c("h5",null,S(l.playlistDescription),1),c("p",ce,S(a.autogeneratedDescription),1)])])),[[P,a.headerVisibilityChanged]]),c("div",pe,[c("span",{onClick:i[1]||(i[1]=()=>s.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),ue,c("div",ye,[c("span",{id:"loadPlaylist",onClick:i[2]||(i[2]=(...n)=>a.loadPlaylist&&a.loadPlaylist(...n)),class:"material-symbols-rounded"},"play_circle"),c("span",{id:"addToPlaylist",onClick:i[3]||(i[3]=(...n)=>a.addToPlaylist&&a.addToPlaylist(...n)),class:"material-symbols-rounded"},"add_circle"),c("div",me,[u(e,{class:"hideIfMobile","with-more":""}),he,c("div",ve,[u(m,{modelValue:l.playlist,"onUpdate:modelValue":i[4]||(i[4]=n=>l.playlist=n),onChange:a.onPlaylistRearrange},{item:w(({element:n})=>[u(t,{index:l.playlist.findIndex(f=>f.source==n.source),song:n,"with-cover":"","with-album":"","with-more":"","playlist-id":Number(a.id),onClick:f=>l.selectedSongId==n.id?l.selectedSongId=-1:l.selectedSongId=n.id,onUpdate:a.updatePlaylist,selected:l.selectedSongId==n.id},null,8,["index","song","playlist-id","onClick","onUpdate","selected"])]),_:1},8,["modelValue","onChange"])])])])])}const Ce=K(ne,[["render",ge],["__scopeId","data-v-345a967d"]]);export{Ce as default};
