import{F as O,G as E}from"./FixedPlaylistHeader.36620c28.js";import{P as q}from"./PlaylistEntry.9ab6a996.js";import{F as C,T as N,a as H,f as V,b as M,d as A,e as U,g as R}from"./song.6b14bab3.js";import{m as D,q as g,o as P,f as k,w as b,g as c,N as B,K as I,x as z,z as J,s as G,_ as L,j as K,J as $,i as j,p as Q,O as W,c as x,n as X,B as Y,d as Z,a as p,b as ee,t as S,e as f,I as te,k as ae,l as se}from"./index.2f8d843b.js";import{d as ie}from"./vuedraggable.umd.df251427.js";import"./SongCtx.7489cf6d.js";import"./EditSong.vue_vue_type_script_setup_true_lang.3ba4fbd9.js";const le=D({__name:"AddNewSong",setup(a,{expose:i}){const n=B(),r={title:"",artist:"",album:"",cover:"",src:""},l=async(d,e)=>{const t=z(String(new Date().getTime())),m=new FormData,o="."+e.name.split(".").pop();var _=e.slice(0,e.size,e.type),w=new File([_],t+o,{type:e.type});return m.append("file",w),await(await fetch(d,{method:"POST",body:m})).text()},s=g([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:d=>{l("/api/config/tracks",d).then(e=>r.src=e)},onChange:async d=>{const e=await V(d);s.value.find(t=>t.name==="title").value=e.title,s.value.find(t=>t.name==="artist").value=e.artist,s.value.find(t=>t.name==="album").value=e.album,s.value.find(t=>t.name==="cover").value=e.cover,s.value.find(t=>t.name==="src").value=e.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:d=>{l("/api/config/images",d).then(e=>r.cover=e)}}]),u=g(null),y=g(null),h=()=>{u.value.show()},v=async d=>{const e=Number(I(String(n.params.id)));await H(e,y.value.toObject())};return i({show:h}),(d,e)=>(P(),k(N,{ref_key:"modal",ref:u,name:"Add Song",submitName:"Save",onSubmit:v,onClose:e[0]||(e[0]=t=>d.$emit("close"))},{default:b(()=>[c(C,{ref_key:"form",ref:y,options:s.value},null,8,["options"])]),_:1},512))}}),oe=D({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(a,{expose:i}){const n=a,r=async(e,t)=>{const m=new FormData,o="."+t.name.split(".").pop();var _=t.slice(0,t.size,t.type),w=new File([_],n.playlist.name+o,{type:t.type});return m.append("file",w),await(await fetch(e,{method:"POST",body:m})).text()};J(()=>n.playlist,e=>{l.value.find(t=>t.name=="name").value=e.name,l.value.find(t=>t.name=="description").value=e.description,l.value.find(t=>t.name=="cover").value=e.cover},{deep:!0});const l=g([{name:"name",type:"text",required:!0,value:n.playlist.name},{name:"description",type:"text",required:!0,value:n.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:n.playlist.cover,onUpload:e=>{r("/api/config/images",e).then(t=>n.playlist.cover=t)}}]),s=g(null),u=g(null),y=G(),h=()=>{s.value.show()},v=async()=>{await M({...n.playlist,...u.value.toObject()})},d=async()=>{await A(n.playlist.id),await y.push("/collection/playlists")};return i({show:h}),(e,t)=>(P(),k(N,{ref_key:"modal",ref:s,name:"Edit Playlist",submitName:"Save",onSubmit:v,onClose:t[0]||(t[0]=m=>e.$emit("close")),secondaryName:"Delete",secondaryType:"danger",onSecondary:d},{default:b(()=>[c(C,{ref_key:"form",ref:u,options:l.value},null,8,["options"])]),_:1},512))}});K();const ne={components:{PlaylistEntry:q,FixedPlaylistHeader:O,GridHeader:E,AddSong:le,EditPlaylist:oe,draggable:ie},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:$()}},methods:{parseCover:j,parsePlaylistCover:Q,download(a){var n;const i=(n=this.playlist)==null?void 0:n[a];window.open(`/api/tracks/${i.id}/download`)},onPlaylistRearrange(a){const i=a.moved;!i||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:i.oldIndex,songNewIndex:i.newIndex})})},headerVisibilityChanged(a){this.fixedHeaderHidden=a},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(a=>{a.playing=a.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){U().then(a=>{const i=W(a);this.$router.push(i)});return}R(this.id).then(async a=>{if(!a){this.$router.push("/");return}this.playlist=a.songs,this.playlistName=a.name,this.playlistDescription=a.description,this.playlistCover=a.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return I(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let a=0,i=!1;if(!this.playlist.length)return"";for(const u of this.playlist){i=i||u.duration=="-1:59";const y=u.duration=="-1:59"?"3:00":u.duration,[h,v]=y.split(":");a+=Number(h*60)+Number(v)}const n=a,r=Math.floor(n/60),l=Math.floor(r/60),s=i?", about ":", ";return l?s+`${l} hr ${r-l*60} min`:r?s+`${r} min ${n-r*60} sec`:s+a+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},T=a=>(ae("data-v-77376fb6"),a=a(),se(),a),re={class:"playlist"},de=["src"],pe={class:"details"},ue={class:"muted description"},ce={class:"mobileMenu showIfMobile"},ye=T(()=>p("hr",null,null,-1)),me={class:"padding-20"},he={class:"grid"},ve=T(()=>p("hr",null,null,-1)),fe={class:"playlistEntries"};function ge(a,i,n,r,l,s){const u=f("AddSong"),y=f("EditPlaylist"),h=f("fixed-playlist-header"),v=f("h7"),d=f("grid-header"),e=f("playlist-entry"),t=f("draggable"),m=te("observe-visibility");return P(),x("div",re,[c(u,{onClose:s.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),c(y,{onClose:s.updatePlaylist,playlist:{name:l.playlistName,description:l.playlistDescription,cover:l.playlistCover,id:s.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),c(h,{onLoadPlaylist:s.loadPlaylist,ref:"fixedHeading",class:X({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),Y((P(),x("div",{class:"padding-20 playlisteditor",onClick:i[0]||(i[0]=(...o)=>s.editPlaylist&&s.editPlaylist(...o))},[l.playlistCover?(P(),x("img",{key:0,class:"cover",src:s.parsePlaylistCover(l.playlistCover)},null,8,de)):Z("",!0),p("div",pe,[c(v,{class:"hideIfMobile"},{default:b(()=>[ee("Playlist")]),_:1}),p("h1",null,S(l.playlistName),1),p("h5",null,S(l.playlistDescription),1),p("p",ue,S(s.autogeneratedDescription),1)])])),[[m,s.headerVisibilityChanged]]),p("div",ce,[p("span",{onClick:i[1]||(i[1]=()=>a.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),ye,p("div",me,[p("span",{id:"loadPlaylist",onClick:i[2]||(i[2]=(...o)=>s.loadPlaylist&&s.loadPlaylist(...o)),class:"material-symbols-rounded"},"play_circle"),p("span",{id:"addToPlaylist",onClick:i[3]||(i[3]=(...o)=>s.addToPlaylist&&s.addToPlaylist(...o)),class:"material-symbols-rounded"},"add_circle"),p("div",he,[c(d,{class:"hideIfMobile"}),ve,p("div",fe,[c(t,{modelValue:l.playlist,"onUpdate:modelValue":i[4]||(i[4]=o=>l.playlist=o),onChange:s.onPlaylistRearrange},{item:b(({element:o})=>[c(e,{playlists:a.playlists,onDownload:s.download,onRequestUpdate:s.updatePlaylist,index:l.playlist.findIndex(_=>_.source==o.source),source:o.source,playing:o.playing,id:o.id,title:o.title,album:o.album,artist:o.artist,cover:o.cover,favourite:o.favourite,duration:o.duration},null,8,["playlists","onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}const Ne=L(ne,[["render",ge],["__scopeId","data-v-77376fb6"]]);export{Ne as default};
