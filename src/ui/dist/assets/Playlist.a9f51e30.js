import{F as J}from"./FixedPlaylistHeader.c47091e1.js";import{m as $,j as M,A as q,B as O,o as f,c as x,r as j,g as n,w as m,b,t as w,u as I,f as N,d as T,F as K,h as W,e as _,I as A,K as U,q as k,a as c,n as D,M as E,_ as F,N as G,O as Q,J as B,x as X,z as Y,s as Z,i as ee,p as te,P as se,k as ae,l as le}from"./index.53c4dab8.js";import{_ as ie}from"./EditSong.vue_vue_type_script_setup_true_lang.3c2b067b.js";import{p as oe}from"./playerInPicture.37a9ab56.js";import{a as V,c as ne,r as de,d as re,f as ue,F as R,T as z,b as ce,e as pe,h as ye,i as me,g as ve}from"./song.914b8395.js";import{d as fe}from"./vuedraggable.umd.13be163b.js";const ge={ref:"box"},he=$({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:Number,required:!1,default:-1}},emits:["update"],setup(e,{emit:o}){const l=e,r=M(),i=q(()=>r.playlists),t=q(()=>l.playlistId==-1),y=()=>{oe(l.song.artist,l.song.title,l.song.src||l.song.source)},v=async d=>{d!=-1&&await V(d,l.song)},g=async()=>{const d=await ne(l.song.title,l.song.artist,l.song.cover);v(d)},h=async()=>{await de(l.playlistId,l.song.id),o("update")};return(d,s)=>{const a=_("v-contextmenu-item"),p=_("v-contextmenu-divider"),u=_("v-contextmenu-submenu"),P=_("v-contextmenu"),C=A("contextmenu");return O((f(),x("div",ge,[j(d.$slots,"default"),n(P,{ref:"contextmenu"},{default:m(()=>[n(a,{onClick:y},{default:m(()=>[b("Preview")]),_:1}),n(p),n(a,{onClick:s[0]||(s[0]=S=>d.$emit("like"))},{default:m(()=>[b(w((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),I(t)?T("",!0):(f(),N(a,{key:0,onClick:h},{default:m(()=>[b(" Remove from this playlist ")]),_:1})),n(u,{title:"Add to playlist"},{default:m(()=>[n(a,{onClick:g},{default:m(()=>[b("Add to new playlist")]),_:1}),n(p),(f(!0),x(K,null,W(I(i),(S,H)=>(f(),N(a,{key:H,onClick:We=>v(H)},{default:m(()=>[b(w(S.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),n(p),n(a,{onClick:s[1]||(s[1]=S=>d.$emit("edit"))},{default:m(()=>[b("Update Metadata")]),_:1}),n(p),n(a,{onClick:s[2]||(s[2]=S=>I(re)(e.song.id))},{default:m(()=>[b("Download")]),_:1})]),_:1},512)])),[[C,void 0,"contextmenu"]])}}}),_e={class:"cover"},Pe=["src"],be={class:"artist-title"},xe={class:"title"},we={class:"artist"},ke={class:"album"},Se={class:"duration text-center"},Ce={key:1,class:"icon text-left material-symbols-rounded"},Ie=$({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:Number,required:!1,default:-1}},emits:["update"],setup(e,{emit:o}){const l=e,r=U(),i=q(()=>l.song.id==r.song.id),t=k(!1),y=()=>{l.song.favourite=!l.song.favourite,ue(l.song.id,l.song.favourite)},v=q(()=>l.playlistId==-1?r.playlist.id:l.playlistId),g=()=>{r.loadSong(v.value,l.index)},h=k(null),d=()=>{h.value.show()},s=()=>{o("update")};return(a,p)=>{const u=_("router-link");return f(),N(he,{song:e.song,onEdit:d,onUpdate:s,onLike:y,playlistId:I(v),liked:e.song.favourite,ref:"ctxMenu"},{default:m(()=>[n(ie,{ref_key:"updatePopup",ref:h,song:e.song,onUpdate:p[0]||(p[0]=P=>a.$emit("update"))},null,8,["song"]),c("div",{class:D(["playlist-entry",{playing:I(i),selected:e.selected,hovering:t.value}]),onMouseenter:p[1]||(p[1]=P=>t.value=!0),onMouseleave:p[2]||(p[2]=P=>t.value=!1),onDblclick:g},[c("div",{class:D(["index text-right",{"material-symbols-rounded":t.value}]),onClick:g},w(t.value?"play_arrow":e.index+1),3),c("div",_e,[c("img",{src:e.song.cover},null,8,Pe)]),c("div",be,[c("span",xe,[n(u,{class:"linkOnHover",to:`/track/${e.song.id}`},{default:m(()=>[n(E,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),c("span",we,[n(u,{class:"linkOnHover",to:`/search/artist:${e.song.artist}`},{default:m(()=>[n(E,{text:e.song.artist},null,8,["text"])]),_:1},8,["to"])])]),c("div",ke,[n(E,{text:e.song.album},null,8,["text"])]),e.selected||t.value||e.song.favourite?(f(),x("div",{key:0,class:D(["icon text-right material-symbols-rounded",{favourite:e.song.favourite}]),onClick:y},w(e.song.favourite?"favorite":"heart_plus"),3)):T("",!0),c("div",Se,w(e.song.duration=="-1:59"?"N/A":e.song.duration),1),e.selected||t.value?(f(),x("div",Ce,"more_horiz")):T("",!0)],34)]),_:1},8,["song","playlistId","liked"])}}});const Ne=F(Ie,[["__scopeId","data-v-4df4ba26"]]),$e={class:"playlist-header"},De=G('<div class="index text-right" data-v-26f2850f>#</div><div class="artist-title" data-v-26f2850f> title </div><div class="album" data-v-26f2850f> album </div><div class="duration" data-v-26f2850f><span class="material-symbols-rounded" data-v-26f2850f>schedule</span></div>',4),qe=[De],Te=$({__name:"PlaylistHeader",props:{index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1}},setup(e){return(o,l)=>(f(),x("div",$e,qe))}});const Ee=F(Te,[["__scopeId","data-v-26f2850f"]]),Fe=$({__name:"AddNewSong",setup(e,{expose:o}){const l=Q(),r={title:"",artist:"",album:"",cover:"",src:""},i=async(d,s)=>{const a=X(String(new Date().getTime())),p=new FormData,u="."+s.name.split(".").pop();var P=s.slice(0,s.size,s.type),C=new File([P],a+u,{type:s.type});return p.append("file",C),await(await fetch(d,{method:"POST",body:p})).text()},t=k([{name:"src",type:"upload",accept:"audio/mp3",required:!0,onUpload:d=>{i("/api/config/tracks",d).then(s=>r.src=s)},onChange:async d=>{const s=await ce(d);t.value.find(a=>a.name==="title").value=s.title,t.value.find(a=>a.name==="artist").value=s.artist,t.value.find(a=>a.name==="album").value=s.album,t.value.find(a=>a.name==="cover").value=s.cover,t.value.find(a=>a.name==="src").value=s.src},value:r.src},{name:"title",type:"text",required:!0,value:r.title},{name:"artist",type:"text",required:!0,value:r.artist},{name:"album",type:"text",value:r.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:r.cover,onUpload:d=>{i("/api/config/images",d).then(s=>r.cover=s)}}]),y=k(null),v=k(null),g=()=>{y.value.show()},h=async d=>{const s=Number(B(String(l.params.id)));await V(s,v.value.toObject())};return o({show:g}),(d,s)=>(f(),N(z,{ref_key:"modal",ref:y,name:"Add Song",submitName:"Save",onSubmit:h,onClose:s[0]||(s[0]=a=>d.$emit("close"))},{default:m(()=>[n(R,{ref_key:"form",ref:v,options:t.value},null,8,["options"])]),_:1},512))}}),He=$({__name:"EditPlaylist",props:{playlist:{type:Object,required:!0}},setup(e,{expose:o}){const l=e,r=async(s,a)=>{const p=new FormData,u="."+a.name.split(".").pop();var P=a.slice(0,a.size,a.type),C=new File([P],l.playlist.name+u,{type:a.type});return p.append("file",C),await(await fetch(s,{method:"POST",body:p})).text()};Y(()=>l.playlist,s=>{i.value.find(a=>a.name=="name").value=s.name,i.value.find(a=>a.name=="description").value=s.description,i.value.find(a=>a.name=="cover").value=s.cover},{deep:!0});const i=k([{name:"name",type:"text",required:!0,value:l.playlist.name},{name:"description",type:"text",required:!0,value:l.playlist.description},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:l.playlist.cover,onUpload:s=>{r("/api/config/images",s).then(a=>l.playlist.cover=a)}}]),t=k(null),y=k(null),v=Z(),g=()=>{t.value.show()},h=async()=>{await pe({...l.playlist,...y.value.toObject()})},d=async()=>{await ye(l.playlist.id),await v.push("/collection/playlists")};return o({show:g}),(s,a)=>(f(),N(z,{ref_key:"modal",ref:t,name:"Edit Playlist",submitName:"Save",onSubmit:h,onClose:a[0]||(a[0]=p=>s.$emit("close")),secondaryName:"Delete",secondaryType:"danger",onSecondary:d},{default:m(()=>[n(R,{ref_key:"form",ref:y,options:i.value},null,8,["options"])]),_:1},512))}});M();const Me={components:{PlaylistEntry:Ne,FixedPlaylistHeader:J,PlaylistHeader:Ee,AddSong:Fe,EditPlaylist:He,draggable:fe},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,store:U(),selectedSongId:-1}},methods:{parseCover:ee,parsePlaylistCover:te,download(e){var l;const o=(l=this.playlist)==null?void 0:l[e];window.open(`/api/tracks/${o.id}/download`)},onPlaylistRearrange(e){const o=e.moved;!o||fetch(`/api/playlists/${this.id}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:o.oldIndex,songNewIndex:o.newIndex})})},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.show()},editPlaylist(){this.$refs.editPlaylistPopup.show()},updateIsPlaying(){this.playlist.forEach(e=>{e.playing=e.id==this.currentSong})},updatePlaylist(){if(!!this.id&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){me().then(e=>{const o=se(e);this.$router.push(o)});return}ve(this.id).then(async e=>{if(!e){this.$router.push("/");return}this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description,this.playlistCover=e.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.id),type:"playlist"})})}},computed:{id(){return B(this.$route.params.id)},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},currentSong(){return this.store.song.id},estimatedDuration(){let e=0,o=!1;if(!this.playlist.length)return"";for(const y of this.playlist){o=o||y.duration=="-1:59";const v=y.duration=="-1:59"?"3:00":y.duration,[g,h]=v.split(":");e+=Number(g*60)+Number(h)}const l=e,r=Math.floor(l/60),i=Math.floor(r/60),t=o?", about ":", ";return i?t+`${i} hr ${r-i*60} min`:r?t+`${r} min ${l-r*60} sec`:t+e+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},L=e=>(ae("data-v-bfac8961"),e=e(),le(),e),Oe={class:"playlist"},Ae=["src"],Ue={class:"details"},Be={class:"muted description"},Ve={class:"mobileMenu showIfMobile"},Re=L(()=>c("hr",null,null,-1)),ze={class:"padding-20"},Le={class:"grid"},Je=L(()=>c("hr",null,null,-1)),je={class:"playlistEntries"};function Ke(e,o,l,r,i,t){const y=_("AddSong"),v=_("EditPlaylist"),g=_("fixed-playlist-header"),h=_("h7"),d=_("PlaylistHeader"),s=_("PlaylistEntry"),a=_("draggable"),p=A("observe-visibility");return f(),x("div",Oe,[n(y,{onClose:t.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),n(v,{onClose:t.updatePlaylist,playlist:{name:i.playlistName,description:i.playlistDescription,cover:i.playlistCover,id:t.id},ref:"editPlaylistPopup"},null,8,["onClose","playlist"]),n(g,{onLoadPlaylist:t.loadPlaylist,ref:"fixedHeading",class:D({hidden:i.fixedHeaderHidden}),title:i.playlistName},null,8,["onLoadPlaylist","class","title"]),O((f(),x("div",{class:"padding-20 playlisteditor",onClick:o[0]||(o[0]=(...u)=>t.editPlaylist&&t.editPlaylist(...u))},[i.playlistCover?(f(),x("img",{key:0,class:"cover",src:t.parsePlaylistCover(i.playlistCover)},null,8,Ae)):T("",!0),c("div",Ue,[n(h,{class:"hideIfMobile"},{default:m(()=>[b("Playlist")]),_:1}),c("h1",null,w(i.playlistName),1),c("h5",null,w(i.playlistDescription),1),c("p",Be,w(t.autogeneratedDescription),1)])])),[[p,t.headerVisibilityChanged]]),c("div",Ve,[c("span",{onClick:o[1]||(o[1]=()=>e.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),Re,c("div",ze,[c("span",{id:"loadPlaylist",onClick:o[2]||(o[2]=(...u)=>t.loadPlaylist&&t.loadPlaylist(...u)),class:"material-symbols-rounded"},"play_circle"),c("span",{id:"addToPlaylist",onClick:o[3]||(o[3]=(...u)=>t.addToPlaylist&&t.addToPlaylist(...u)),class:"material-symbols-rounded"},"add_circle"),c("div",Le,[n(d,{class:"hideIfMobile"}),Je,c("div",je,[n(a,{modelValue:i.playlist,"onUpdate:modelValue":o[4]||(o[4]=u=>i.playlist=u),onChange:t.onPlaylistRearrange},{item:m(({element:u})=>[n(s,{onDownload:t.download,onRequestUpdate:t.updatePlaylist,index:i.playlist.findIndex(P=>P.source==u.source),song:u,"with-cover":"","with-album":"","playlist-id":Number(t.id),onClick:P=>i.selectedSongId==u.id?i.selectedSongId=-1:i.selectedSongId=u.id,onUpdate:t.updatePlaylist,selected:i.selectedSongId==u.id},null,8,["onDownload","onRequestUpdate","index","song","playlist-id","onClick","onUpdate","selected"])]),_:1},8,["modelValue","onChange"])])])])])}const tt=F(Me,[["render",Ke],["__scopeId","data-v-bfac8961"]]);export{tt as default};
