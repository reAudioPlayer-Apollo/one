import{F as N,G as $}from"./FixedPlaylistHeader.75a3d450.js";import{P as I}from"./PlaylistEntry.a954293e.js";import{F as T}from"./FindSources.7b901385.js";import{_ as w,B as g,e as b,o as v,c as f,g as p,w as _,a as t,s as u,u as h,p as P,i as S,A as F,y as U,m as A,d as E,b as O,t as C,C as H,z as x,k as R,q as L}from"./index.d983766d.js";import{d as k}from"./vuedraggable.umd.65621be6.js";import"./SongCtx.95e19385.js";import"./EditSong.09cd973c.js";const J={name:"AddSong",components:{FindSources:T},data(){return{showModal:!1,cover:"",artist:"",title:""}},watch:{showModal(){!this.showModal||navigator.clipboard.readText().then(s=>{!this.isValidHttpUrl(s)||(this.$refs.source.value=s,this.loadMetadata())})}},methods:{isValidHttpUrl(s){let e;try{e=new URL(s)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"},opencontextmenu(s){this.$refs.findSources.show(s)},hideFindSourcesCtx(){this.$refs.findSources.hide()},getId(){return Number(g(this.$route.params.id))},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/playlists/${this.getId()}/tracks`,{method:"POST",body:JSON.stringify({source:this.$refs.source.value,title:this.title,artist:this.artist,album:this.$refs.album.value,cover:this.cover})}).then(s=>{console.log(s),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(s=>s.json()).then(s=>{console.log(s),this.title=s.title,this.$refs.album.value=s.album,this.artist=s.artists.join(", "),this.cover=s.cover,this.$refs.source.value=s.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}}},m=s=>(P("data-v-6aa8abe4"),s=s(),S(),s),B={class:"wrapper"},q={class:"header"},z=m(()=>t("h3",null,"Add song",-1)),G=m(()=>t("span",{class:"material-icons-round"}," close ",-1)),j=[G],K=m(()=>t("h4",null,"Source",-1)),Q={class:"content"},W=m(()=>t("h4",null,"Title",-1)),X={class:"content"},Y=m(()=>t("h4",null,"Album",-1)),Z={class:"content"},ee={type:"text",ref:"album"},se=m(()=>t("h4",null,"Artist",-1)),te={class:"content"},le=m(()=>t("h4",null,"Cover",-1)),oe={class:"content"},ie=["src"],ae={class:"confirm"};function ne(s,e,l,d,o,i){const a=b("FindSources"),n=b("vue-final-modal");return v(),f("div",null,[p(n,{onClick:i.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":e[8]||(e[8]=y=>o.showModal=y),classes:"modal-container","content-class":"modal-content"},{default:_(()=>{var y;return[t("div",B,[t("div",q,[z,t("button",{class:"modal-close",onClick:e[0]||(e[0]=r=>o.showModal=!1)},j)]),K,p(a,{ref:"findSources",src:(y=s.$refs.source)==null?void 0:y.value,title:o.title,artist:o.artist},{default:_(()=>[t("div",Q,[t("input",{onChange:e[1]||(e[1]=(...r)=>i.loadMetadata&&i.loadMetadata(...r)),type:"text",ref:"source"},null,544),t("span",{class:"material-icons-round more",ref:"sourceMore",onClick:e[2]||(e[2]=(...r)=>i.opencontextmenu&&i.opencontextmenu(...r))},"more_vert",512)])]),_:1},8,["src","title","artist"]),W,t("div",X,[u(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>o.title=r),type:"text"},null,512),[[h,o.title]])]),Y,t("div",Z,[t("input",ee,null,512)]),se,t("div",te,[u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>o.artist=r),type:"text"},null,512),[[h,o.artist]])]),le,t("div",oe,[u(t("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[5]||(e[5]=r=>o.cover=r),ref:"cover"},null,512),[[h,o.cover]]),t("img",{onClick:e[6]||(e[6]=(...r)=>i.openInNewTab&&i.openInNewTab(...r)),class:"addSong cover",src:o.cover?o.cover:"/assets/img/music_placeholder.png"},null,8,ie)]),t("div",ae,[t("button",{onClick:e[7]||(e[7]=(...r)=>i.add&&i.add(...r)),class:"negative"},"Add")])])]}),_:1},8,["onClick","modelValue"])])}const M=w(J,[["render",ne],["__scopeId","data-v-6aa8abe4"]]);const de={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String,playlistCover:String},mounted(){this.$refs.upFile.addEventListener("change",()=>{var l,d,o,i;const s=(l=this.$refs.upFile.files)==null?void 0:l[0];if(!!s){this.uploadedCoverName=(i=(o=(d=this.$refs.upFile)==null?void 0:d.files)==null?void 0:o[0])==null?void 0:i.name;var e=new FileReader;e.onloadend=()=>{this.uploadedCover=e.result},e.readAsDataURL(s)}})},data(){return{showModal:!1,name:this.playlistName,description:this.playlistDescription,cover:this.playlistCover,uploadedCover:null,uploadedCoverName:null}},methods:{uploadFile(){console.log(this.$refs.upFile);const s=new FormData;s.append("file",this.$refs.upFile.files[0]),s.append("user","hubot"),fetch("/api/config/images",{method:"POST",body:s}).then(e=>e.text()).then(e=>this.cover=e)},apply(){this.showModal=!1,console.log("fetch"),fetch(`/api/playlists/${g(this.$route.params.id)}`,{method:"POST",body:JSON.stringify({name:this.name||"N/A",description:this.description||"N/A",cover:this.cover||"/assets/img/music_placeholder.png"})}).then(s=>{console.log(s),this.$emit("close")})},remove(){fetch(`/api/playlists/${Number(g(this.$route.params.id))}`,{method:"DELETE"}).then(()=>{this.$router.push("/")})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription},playlistCover(){this.cover=this.playlistCover}}},c=s=>(P("data-v-e9e8f781"),s=s(),S(),s),re={class:"wrapper"},pe={class:"header"},ue=c(()=>t("h3",null,"Edit details",-1)),ce=c(()=>t("span",{class:"material-symbols-rounded"},"close",-1)),he=[ce],me=c(()=>t("h4",null,"Name",-1)),ye={class:"content"},ve=c(()=>t("h4",null,"Description",-1)),fe={class:"content"},_e=c(()=>t("h4",null,"Upload Cover",-1)),ge={class:"content"},be=c(()=>t("span",{class:"material-symbols-rounded"},"search",-1)),Ce=[be],we={type:"file",ref:"upFile",style:{display:"none"},accept:"image/*"},Pe=["src"],Se=c(()=>t("span",{class:"material-symbols-rounded"},"file_upload",-1)),Ne=[Se],$e=c(()=>t("h4",null,"Cover",-1)),Ie={class:"content"},ke=["src"],Me={class:"confirm"};function De(s,e,l,d,o,i){const a=b("vue-final-modal");return v(),f("div",null,[p(a,{modelValue:o.showModal,"onUpdate:modelValue":e[11]||(e[11]=n=>o.showModal=n),classes:"modal-container","content-class":"modal-content"},{default:_(()=>[t("div",re,[t("div",pe,[ue,t("button",{class:"modal-close",onClick:e[0]||(e[0]=n=>o.showModal=!1)},he)]),me,t("div",ye,[u(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>o.name=n),type:"text",ref:"name"},null,512),[[h,o.name]])]),ve,t("div",fe,[u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>o.description=n),type:"text",ref:"description"},null,512),[[h,o.description]])]),_e,t("div",ge,[t("button",{onClick:e[3]||(e[3]=()=>s.$refs.upFile.click())},Ce),t("input",we,null,512),u(t("input",{type:"text",class:"addSong cover",readonly:"","onUpdate:modelValue":e[4]||(e[4]=n=>o.uploadedCoverName=n),ref:"cover"},null,512),[[h,o.uploadedCoverName]]),t("img",{onClick:e[5]||(e[5]=(...n)=>i.openInNewTab&&i.openInNewTab(...n)),class:"addSong cover",src:o.uploadedCover?o.uploadedCover:"/assets/img/music_placeholder.png"},null,8,Pe),t("button",{onClick:e[6]||(e[6]=(...n)=>i.uploadFile&&i.uploadFile(...n))},Ne)]),$e,t("div",Ie,[u(t("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[7]||(e[7]=n=>o.cover=n),ref:"cover"},null,512),[[h,o.cover]]),t("img",{onClick:e[8]||(e[8]=(...n)=>i.openInNewTab&&i.openInNewTab(...n)),class:"addSong cover",src:o.cover?o.cover:"/assets/img/music_placeholder.png"},null,8,ke)]),t("div",Me,[t("button",{onClick:e[9]||(e[9]=(...n)=>i.remove&&i.remove(...n)),class:"negative left"},"Delete"),t("button",{onClick:e[10]||(e[10]=(...n)=>i.apply&&i.apply(...n)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}const D=w(de,[["render",De],["__scopeId","data-v-e9e8f781"]]);const V=s=>(P("data-v-6cf3066c"),s=s(),S(),s),Ve={class:"playlist"},Te=["src"],Fe={class:"details"},Ue={class:"muted description"},Ae={class:"mobileMenu showIfMobile"},Ee=V(()=>t("hr",null,null,-1)),Oe={class:"padding-20"},He={class:"grid"},xe=V(()=>t("hr",null,null,-1)),Re={class:"playlistEntries"},Le={components:{PlaylistEntry:I,FixedPlaylistHeader:N,GridHeader:$,AddSong:M,EditPlaylist:D,draggable:k},name:"Playlist",data(){return this.updatePlaylist(),fetch("/api/playlists").then(s=>s.json()).then(s=>{this.playlists=s}),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null,playlists:[]}},methods:{getId(){return g(this.$route.params.id)},download(s){var l;const e=(l=this.playlist)==null?void 0:l[s];window.open(`/api/tracks/${e.id}/download`)},onPlaylistRearrange(s){const e=s.moved;!e||fetch(`/api/playlists/${this.getId()}/tracks`,{method:"PUT",body:JSON.stringify({songOldIndex:e.oldIndex,songNewIndex:e.newIndex})})},headerVisibilityChanged(s){this.fixedHeaderHidden=s},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateIsPlaying(){this.playlist.forEach(s=>{s.playing=s.id==this.currentSong})},updatePlaylist(){if(!!this.getId()&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlists/new").then(s=>s.text()).then(s=>{const e=R(s);this.$router.push(e)});return}fetch(`/api/playlists/${this.getId()}`).then(async s=>{if(s.status==404){this.$router.push("/");return}const e=await s.json();this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description,this.playlistCover=e.cover,document.title=`${this.playlistName} - reAudioPlayer One`,this.updateIsPlaying()})}},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"playlist"})})}},computed:{autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},estimatedDuration(){let s=0,e=!1;if(!this.playlist.length)return"";for(const a of this.playlist){e=e||a.duration=="-1:59";const n=a.duration=="-1:59"?"3:00":a.duration,[y,r]=n.split(":");s+=Number(y*60)+Number(r)}const l=s,d=Math.floor(l/60),o=Math.floor(d/60),i=e?", about ":", ";return o?i+`${o} hr ${d-o*60} min`:d?i+`${d} min ${l-d*60} sec`:i+s+" sec"}},mounted(){this.updatePlaylist()},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},Je=Object.assign(Le,{setup(s){const e=F();return U(()=>e.song.id),(l,d)=>{const o=b("h7"),i=L("observe-visibility");return v(),f("div",Ve,[p(M,{onClose:l.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),p(D,{onClose:l.updatePlaylist,playlistCover:l.playlistCover,playlistName:l.playlistName,playlistDescription:l.playlistDescription,ref:"editPlaylistPopup"},null,8,["onClose","playlistCover","playlistName","playlistDescription"]),p(N,{onLoadPlaylist:l.loadPlaylist,ref:"fixedHeading",class:A({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),u((v(),f("div",{class:"padding-20 playlisteditor",onClick:d[0]||(d[0]=(...a)=>l.editPlaylist&&l.editPlaylist(...a))},[l.playlistCover?(v(),f("img",{key:0,class:"cover",src:l.playlistCover},null,8,Te)):E("",!0),t("div",Fe,[p(o,{class:"hideIfMobile"},{default:_(()=>[O("Playlist")]),_:1}),t("h1",null,C(l.playlistName),1),t("h5",null,C(l.playlistDescription),1),t("p",Ue,C(l.autogeneratedDescription),1)])])),[[i,l.headerVisibilityChanged]]),t("div",Ae,[t("span",{onClick:d[1]||(d[1]=()=>l.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),Ee,t("div",Oe,[t("span",{id:"loadPlaylist",onClick:d[2]||(d[2]=(...a)=>l.loadPlaylist&&l.loadPlaylist(...a)),class:"material-symbols-rounded"},"play_circle"),t("span",{id:"addToPlaylist",onClick:d[3]||(d[3]=(...a)=>l.addToPlaylist&&l.addToPlaylist(...a)),class:"material-symbols-rounded"},"add_circle"),t("div",He,[p($,{class:"hideIfMobile"}),xe,t("div",Re,[p(x(k),{modelValue:l.playlist,"onUpdate:modelValue":d[4]||(d[4]=a=>H(playlist)?playlist.value=a:null),onChange:l.onPlaylistRearrange},{item:_(({element:a})=>[p(I,{playlists:l.playlists,onDownload:l.download,onRequestUpdate:l.updatePlaylist,index:l.playlist.findIndex(n=>n.source==a.source),source:a.source,playing:a.playing,id:a.id,title:a.title,album:a.album,artist:a.artist,cover:a.cover,favourite:a.favourite,duration:a.duration},null,8,["playlists","onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}}}),We=w(Je,[["__scopeId","data-v-6cf3066c"]]);export{We as default};
