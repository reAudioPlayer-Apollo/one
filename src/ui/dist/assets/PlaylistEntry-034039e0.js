import{e as U,j as K,B as h,n as I,f as b,bp as Q,c2 as W,o as d,c as g,r as X,g as s,w as o,b as m,F as T,h as V,i as D,t as k,d as A,u as $,cj as G,cL as Z,a as i,cc as ee,cr as te,x as se,cB as oe,cM as ne,ce as ae,cE as le,K as ie,cN as de,Q as j,J as re,M as L,z as ue,O as ce,cO as me,ci as ve,cP as fe,_ as ge}from"./index-86bac054.js";import{_ as ye}from"./EditSong.vue_vue_type_script_setup_true_lang-074f578e.js";import{p as pe}from"./playerInPicture-af203fdf.js";const he=i("span",{class:"material-symbols-rounded"},"preview",-1),_e=i("span",{class:"material-symbols-rounded"},"search",-1),we=i("span",{class:"material-symbols-rounded"},"delete",-1),xe=i("span",{class:"material-symbols-rounded"},"playlist_add",-1),be=i("span",{class:"material-symbols-rounded"},"edit",-1),ke=i("span",{class:"material-symbols-rounded"},"file_download",-1),$e=i("span",{class:"material-symbols-rounded"},"replay",-1),Se=i("span",{class:"material-symbols-rounded"},"share",-1),Ce=U({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(t,{expose:E,emit:N}){const a=K(),S=h(()=>a.playlists.filter(n=>n.type==="classic")),e=t,y=N,v=h(()=>e.playlistId==-1),C=()=>{pe(e.song.artist,e.song.title,e.song.source)},f=async n=>{var r;n!=-1&&(await ee(n,e.song),te.addSuccess(e.song.title,`Added to ${(r=S.value.find(l=>l.id==n))==null?void 0:r.name}`,3e3),y("update"))},P=async()=>{const n=await se(e.song.title,e.song.artist,e.song.cover);await f(n),y("update")},q=async()=>{await oe(e.playlistId,e.song.id),y("update")},M=I(null),p=I(null),F=()=>{p.value.visible?B():c()},B=()=>{p.value.hide()},c=()=>{const n=M.value.getBoundingClientRect(),r={top:n.height+n.top+window.scrollY,left:n.width+n.left+window.scrollX};p.value.show(r)};E({show:c,toggle:F,hide:B});const _=h(()=>({Soundcloud:`https://soundcloud.com/search?q=${e.song.artist} ${e.song.title}`,Audius:`https://audius.co/search/${e.song.artist} ${e.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${e.song.artist} ${e.song.title}`,Spotify:`https://open.spotify.com/search/${e.song.artist} ${e.song.title}`})),w=()=>{y("edit")},z=n=>{window.open(_.value[n]),w()},H=()=>{const n=ne(e.song);ae(n,`${e.song.artist} - ${e.song.title}`)};return(n,r)=>{const l=b("v-contextmenu-item"),O=b("v-contextmenu-submenu"),x=b("v-contextmenu-divider"),R=b("v-contextmenu"),Y=Q("contextmenu");return W((d(),g("div",{ref_key:"box",ref:M},[X(n.$slots,"default"),s(R,{ref_key:"contextmenu",ref:p},{default:o(()=>[s(l,{onClick:C},{default:o(()=>[he,m(" Preview ")]),_:1}),s(l,null,{default:o(()=>[_e,s(O,{title:"Find source"},{default:o(()=>[(d(!0),g(T,null,V(Object.keys(_.value),u=>(d(),D(l,{key:u,onClick:J=>z(u)},{default:o(()=>[m(k(u),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),s(x),v.value?A("",!0):(d(),D(l,{key:0,onClick:q},{default:o(()=>[we,m(" Remove from this playlist ")]),_:1})),s(l,null,{default:o(()=>[xe,s(O,{title:"Add to playlist"},{default:o(()=>[s(l,{onClick:P},{default:o(()=>[m(" Add to new playlist ")]),_:1}),s(x),(d(!0),g(T,null,V(S.value,u=>(d(),D(l,{key:u.id,onClick:J=>f(u.id)},{default:o(()=>[m(k(u.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),s(x),s(l,{onClick:w},{default:o(()=>[be,m(" Edit ")]),_:1}),s(x),s(l,{onClick:r[0]||(r[0]=u=>$(G)(t.song.id))},{default:o(()=>[ke,m(" Download ")]),_:1}),s(l,{onClick:r[1]||(r[1]=u=>$(Z)(t.song.id))},{default:o(()=>[$e,m(" Uncache ")]),_:1}),s(x),s(l,null,{default:o(()=>[Se,s(O,{title:"Export..."},{default:o(()=>[s(l,{onClick:r[2]||(r[2]=u=>H())},{default:o(()=>[m(" to file ")]),_:1})]),_:1})]),_:1})]),_:1},512)])),[[Y,void 0,"contextmenu"]])}}}),Pe={key:0,class:"index text-right downloading"},qe={key:2,class:"cover"},Me={class:"artist-title"},Be={class:"title"},De={class:"artist"},Ae={key:3,class:"album"},Ie={class:"duration text-center"},Ee=U({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null},artist:{type:String,required:!1,default:null},album:{type:String,required:!1,default:null}},emits:["update"],setup(t,{emit:E}){const N=le(),a=t,S=E,e=ie(),y=h(()=>a.song.id==e.song.id),v=I(!1),C=()=>{a.song.favourite=!a.song.favourite,fe(a.song.id,a.song.favourite)},f=h(()=>a.playlistId==null?e.playlist.id:a.playlistId),P=async()=>{if(f.value=="track"){e.loadPlaylist("track",a.song.id);return}if(f.value=="artist"){await e.loadPlaylist("artist",a.artist),e.loadSong(null,a.index);return}if(f.value=="album"){await e.loadPlaylist("album",a.album),e.loadSong(null,a.index);return}e.loadSong(f.value,a.index)},q=I(null),M=()=>{q.value.show()},p=()=>{S("update")},F=h(()=>N.isSongDownloading(a.song.id));return(B,c)=>{const _=b("router-link");return d(),D(Ce,{ref:"ctxMenu",liked:t.song.favourite,playlistId:f.value,song:t.song,onEdit:M,onLike:C,onUpdate:p},{default:o(()=>[s(ye,{ref_key:"updatePopup",ref:q,song:t.song,onUpdate:c[0]||(c[0]=w=>B.$emit("update"))},null,8,["song"]),i("div",{class:j([{playing:y.value,selected:t.selected,hovering:v.value,withCover:t.withCover,withAlbum:t.withAlbum,withMore:t.withMore},"playlist-entry"]),onDblclick:P,onMouseenter:c[1]||(c[1]=w=>v.value=!0),onMouseleave:c[2]||(c[2]=w=>v.value=!1)},[F.value?(d(),g("div",Pe,[s(de)])):(d(),g("div",{key:1,class:j([{"material-symbols-rounded":v.value},"index text-right"]),onClick:P},k(v.value?"play_arrow":t.index+1),3)),t.withCover?(d(),g("div",qe,[s(re,{src:t.song.cover,type:"track"},null,8,["src"])])):A("",!0),i("div",Me,[i("span",Be,[s(_,{to:`/track/${$(ue)(t.song.id)}`,class:"linkOnHover"},{default:o(()=>[s(L,{text:t.song.title},null,8,["text"])]),_:1},8,["to"])]),i("span",De,[s(ce,{artist:t.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),t.withAlbum&&!$(me)?(d(),g("div",Ae,[s(_,{to:t.song.album.href,class:"linkOnHover"},{default:o(()=>[s(L,{text:t.song.album.name},null,8,["text"])]),_:1},8,["to"])])):A("",!0),t.selected||v.value||t.song.favourite?(d(),g("div",{key:4,class:j([{favourite:t.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},k(t.song.favourite?"favorite":"heart_plus"),3)):A("",!0),i("div",Ie,k($(ve)(t.song.duration)),1)],34)]),_:1},8,["liked","playlistId","song"])}}});const je=ge(Ee,[["__scopeId","data-v-67cfb148"]]);export{je as P};
