import{m as O,n as x,o as r,f as F,w as a,g as o,j as Y,E as A,y as J,c as C,r as K,b as g,F as V,i as L,t as q,u as k,d as I,e as M,J as W,K as X,a as $,I as D,h as G,M as E,v as Q,N as Z,_ as ee}from"./index-fd3eb342.js";import{F as te,T as oe,u as ne,a as se,c as ae,r as le,d as ie,f as ue}from"./song-ca46ae84.js";import{p as re}from"./playerInPicture-af203fdf.js";const ce=O({__name:"EditSong",props:{song:{type:Object,required:!0}},setup(e,{expose:P}){const n=e,t=async(i,s)=>{const u=new FormData,v="."+s.name.split(".").pop();var d=s.slice(0,s.size,s.type),h=new File([d],n.song.id+v,{type:s.type});return u.append("file",h),await(await fetch(i,{method:"POST",body:u})).text()},f=x([{name:"source",type:"upload",icon:"music_note",accept:"audio/mp3",required:!0,onUpload:i=>{t("/api/config/tracks",i).then(s=>f.value.find(u=>u.name=="source").value=s)},value:n.song.source},{name:"title",type:"text",icon:"title",required:!0,value:n.song.title},{name:"artist",type:"text",icon:"person",required:!0,value:n.song.artist},{name:"album",type:"text",icon:"album",value:n.song.album},{name:"cover",type:"upload",icon:"art_track",accept:"image/*",imagePreview:!0,value:n.song.cover,onUpload:i=>{t("/api/config/images",i).then(s=>f.value.find(u=>u.name=="cover").value=s)}}]),c=async()=>{await ne({...n.song,...p.value.toObject()})},y=x(null),p=x(null);return P({show:()=>{y.value.show()}}),(i,s)=>(r(),F(oe,{ref_key:"modal",ref:y,submit:{label:"Save",icon:"save"},name:"Edit Song",onClose:s[0]||(s[0]=u=>i.$emit("close")),onSubmit:c},{default:a(()=>[o(te,{ref_key:"form",ref:p,options:f.value},null,8,["options"])]),_:1},512))}}),de=O({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:Number,required:!1,default:-1}},emits:["update","edit"],setup(e,{expose:P,emit:n}){const t=e,f=Y(),c=A(()=>f.playlists),y=A(()=>t.playlistId==-1),p=()=>{re(t.song.artist,t.song.title,t.song.source)},b=async l=>{l!=-1&&await se(l,t.song)},i=async()=>{const l=await ae(t.song.title,t.song.artist,t.song.cover);b(l)},s=async()=>{await le(t.playlistId,t.song.id),n("update")},u=x(null),v=x(null),d=()=>{v.value.visible?h():_()},h=()=>{v.value.hide()},_=()=>{const l=u.value.getBoundingClientRect(),S={top:l.height+l.top+window.scrollY,left:l.width+l.left+window.scrollX};v.value.show(S)};P({show:_,toggle:d,hide:h});const T={Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`},j=()=>{n("edit")},R=l=>{window.open(T[l]),j()};return(l,S)=>{const m=M("v-contextmenu-item"),U=M("v-contextmenu-submenu"),N=M("v-contextmenu-divider"),z=M("v-contextmenu"),H=W("contextmenu");return J((r(),C("div",{ref_key:"box",ref:u},[K(l.$slots,"default"),o(z,{ref_key:"contextmenu",ref:v},{default:a(()=>[o(m,{onClick:p},{default:a(()=>[g(" Preview ")]),_:1}),o(U,{title:"Find source"},{default:a(()=>[(r(!0),C(V,null,L(Object.keys(T),w=>(r(),F(m,{key:w,onClick:B=>R(w)},{default:a(()=>[g(q(w),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(N),o(m,{onClick:S[0]||(S[0]=w=>l.$emit("like"))},{default:a(()=>[g(q((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),k(y)?I("",!0):(r(),F(m,{key:0,onClick:s},{default:a(()=>[g(" Remove from this playlist ")]),_:1})),o(U,{title:"Add to playlist"},{default:a(()=>[o(m,{onClick:i},{default:a(()=>[g("Add to new playlist")]),_:1}),o(N),(r(!0),C(V,null,L(k(c),(w,B)=>(r(),F(m,{key:B,onClick:we=>b(B)},{default:a(()=>[g(q(w.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(N),o(m,{onClick:j},{default:a(()=>[g(" Update Metadata ")]),_:1}),o(N),o(m,{onClick:S[1]||(S[1]=w=>k(ie)(e.song.id))},{default:a(()=>[g("Download")]),_:1})]),_:1},512)])),[[H,void 0,"contextmenu"]])}}}),ve={key:0,class:"cover"},me={class:"artist-title"},ge={class:"title"},fe={class:"artist"},ye={key:1,class:"album"},pe={class:"duration text-center"},he=O({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:Number,required:!1,default:null}},emits:["update"],setup(e,{emit:P}){const n=e,t=X(),f=A(()=>n.song.id==t.song.id),c=x(!1),y=()=>{n.song.favourite=!n.song.favourite,ue(n.song.id,n.song.favourite)},p=A(()=>n.playlistId==null?t.playlist.id:n.playlistId),b=()=>{t.loadSong(p.value,n.index)},i=x(null),s=()=>{i.value.show()},u=()=>{P("update")};return(v,d)=>{const h=M("router-link");return r(),F(de,{ref:"ctxMenu",liked:e.song.favourite,playlistId:k(p),song:e.song,onEdit:s,onLike:y,onUpdate:u},{default:a(()=>[o(ce,{ref_key:"updatePopup",ref:i,song:e.song,onUpdate:d[0]||(d[0]=_=>v.$emit("update"))},null,8,["song"]),$("div",{class:D([{playing:k(f),selected:e.selected,hovering:c.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:b,onMouseenter:d[2]||(d[2]=_=>c.value=!0),onMouseleave:d[3]||(d[3]=_=>c.value=!1)},[$("div",{class:D([{"material-symbols-rounded":c.value},"index text-right"]),onClick:b},q(c.value?"play_arrow":e.index+1),3),e.withCover?(r(),C("div",ve,[o(G,{src:e.song.cover,type:"track"},null,8,["src"])])):I("",!0),$("div",me,[$("span",ge,[o(h,{to:`/track/${k(Q)(e.song.id)}`,class:"linkOnHover"},{default:a(()=>[o(E,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),$("span",fe,[o(h,{to:`/search/artist:${e.song.artist}`,class:"linkOnHover"},{default:a(()=>[o(E,{text:e.song.artist},null,8,["text"])]),_:1},8,["to"])])]),e.withAlbum&&!k(Z)?(r(),C("div",ye,[o(E,{text:e.song.album},null,8,["text"])])):I("",!0),e.selected||c.value||e.song.favourite?(r(),C("div",{key:2,class:D([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:y},q(e.song.favourite?"favorite":"heart_plus"),3)):I("",!0),$("div",pe,q(e.song.duration=="-1:59"?"N/A":e.song.duration),1),I("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const _e=ee(he,[["__scopeId","data-v-2ee6be8d"]]);export{_e as P};
