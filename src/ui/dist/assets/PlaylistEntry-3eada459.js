import{i as L,k as W,B as p,q as I,e as S,bb as X,bQ as Z,o as r,c as g,r as G,g as o,w as s,b as d,F as O,j as U,f as A,t as k,d as B,u as b,c4 as J,co as K,bZ as ee,cg as te,x as oe,ci as ne,ck as se,b_ as ae,a as h,cp as ie,aS as j,h as le,M as V,z as re,c1 as ue,cq as de,c3 as ce,cr as ve,_ as ge}from"./index-f1eb661c.js";import{_ as fe}from"./EditSong.vue_vue_type_script_setup_true_lang-cb18c76e.js";import{p as me}from"./playerInPicture-af203fdf.js";import{c as ye,d as pe}from"./collection-b1c10a16.js";const ke=L({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(t,{expose:F,emit:N}){const a=W(),$=p(()=>a.playlists),e=t,m=N,v=p(()=>e.playlistId==-1),C=()=>{me(e.song.artist,e.song.title,e.song.source)},f=async n=>{var i;n!=-1&&(await ee(n,e.song),te.addSuccess(e.song.title,`Added to ${(i=$.value.find(l=>l.id==n))==null?void 0:i.name}`,3e3),m("update"))},_=async()=>{const n=await oe(e.song.title,e.song.artist,e.song.cover);await f(n),m("update")},q=async()=>{await ne(e.playlistId,e.song.id),m("update")},P=I(null),y=I(null),E=()=>{y.value.visible?M():c()},M=()=>{y.value.hide()},c=()=>{const n=P.value.getBoundingClientRect(),i={top:n.height+n.top+window.scrollY,left:n.width+n.left+window.scrollX};y.value.show(i)};F({show:c,toggle:E,hide:M});const D=p(()=>({Soundcloud:`https://soundcloud.com/search?q=${e.song.artist} ${e.song.title}`,Audius:`https://audius.co/search/${e.song.artist} ${e.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${e.song.artist} ${e.song.title}`,Spotify:`https://open.spotify.com/search/${e.song.artist} ${e.song.title}`})),w=()=>{m("edit")},R=n=>{window.open(D.value[n]),w()},z=()=>{const n=ye(e.song);pe(n,`${e.song.artist} - ${e.song.title}`)};return(n,i)=>{const l=S("v-contextmenu-item"),T=S("v-contextmenu-submenu"),x=S("v-contextmenu-divider"),Y=S("v-contextmenu"),H=X("contextmenu");return Z((r(),g("div",{ref_key:"box",ref:P},[G(n.$slots,"default"),o(Y,{ref_key:"contextmenu",ref:y},{default:s(()=>[o(l,{onClick:C},{default:s(()=>[d(" Preview ")]),_:1}),o(T,{title:"Find source"},{default:s(()=>[(r(!0),g(O,null,U(Object.keys(D.value),u=>(r(),A(l,{key:u,onClick:Q=>R(u)},{default:s(()=>[d(k(u),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(x),o(l,{onClick:i[0]||(i[0]=u=>n.$emit("like"))},{default:s(()=>[d(k((t.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),v.value?B("",!0):(r(),A(l,{key:0,onClick:q},{default:s(()=>[d(" Remove from this playlist ")]),_:1})),o(T,{title:"Add to playlist"},{default:s(()=>[o(l,{onClick:_},{default:s(()=>[d("Add to new playlist")]),_:1}),o(x),(r(!0),g(O,null,U($.value,u=>(r(),A(l,{key:u.id,onClick:Q=>f(u.id)},{default:s(()=>[d(k(u.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(x),o(l,{onClick:w},{default:s(()=>[d(" Update Metadata ")]),_:1}),o(x),o(l,{onClick:i[1]||(i[1]=u=>b(J)(t.song.id))},{default:s(()=>[d(" Download ")]),_:1}),o(l,{onClick:i[2]||(i[2]=u=>b(K)(t.song.id))},{default:s(()=>[d(" Uncache ")]),_:1}),o(x),o(T,{title:"Export..."},{default:s(()=>[o(l,{onClick:i[3]||(i[3]=u=>z())},{default:s(()=>[d(" to file ")]),_:1})]),_:1})]),_:1},512)])),[[H,void 0,"contextmenu"]])}}}),we={key:0,class:"index text-right downloading"},xe={key:2,class:"cover"},he={class:"artist-title"},Se={class:"title"},be={class:"artist"},$e={key:3,class:"album"},Ce={class:"duration text-center"},_e=L({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null},artist:{type:String,required:!1,default:null}},emits:["update"],setup(t,{emit:F}){const N=se(),a=t,$=F,e=ae(),m=p(()=>a.song.id==e.song.id),v=I(!1),C=()=>{a.song.favourite=!a.song.favourite,ve(a.song.id,a.song.favourite)},f=p(()=>a.playlistId==null?e.playlist.id:a.playlistId),_=async()=>{if(f.value=="track"){e.loadPlaylist("track",a.song.id);return}if(f.value=="artist"){await e.loadPlaylist("artist",a.artist),e.loadSong(null,a.index);return}e.loadSong(f.value,a.index)},q=I(null),P=()=>{q.value.show()},y=()=>{$("update")},E=p(()=>N.isSongDownloading(a.song.id));return(M,c)=>{const D=S("router-link");return r(),A(ke,{ref:"ctxMenu",liked:t.song.favourite,playlistId:f.value,song:t.song,onEdit:P,onLike:C,onUpdate:y},{default:s(()=>[o(fe,{ref_key:"updatePopup",ref:q,song:t.song,onUpdate:c[0]||(c[0]=w=>M.$emit("update"))},null,8,["song"]),h("div",{class:j([{playing:m.value,selected:t.selected,hovering:v.value,withCover:t.withCover,withAlbum:t.withAlbum,withMore:t.withMore},"playlist-entry"]),onDblclick:_,onMouseenter:c[1]||(c[1]=w=>v.value=!0),onMouseleave:c[2]||(c[2]=w=>v.value=!1)},[E.value?(r(),g("div",we,[o(ie)])):(r(),g("div",{key:1,class:j([{"material-symbols-rounded":v.value},"index text-right"]),onClick:_},k(v.value?"play_arrow":t.index+1),3)),t.withCover?(r(),g("div",xe,[o(le,{src:t.song.cover,type:"track"},null,8,["src"])])):B("",!0),h("div",he,[h("span",Se,[o(D,{to:`/track/${b(re)(t.song.id)}`,class:"linkOnHover"},{default:s(()=>[o(V,{text:t.song.title},null,8,["text"])]),_:1},8,["to"])]),h("span",be,[o(ue,{artist:t.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),t.withAlbum&&!b(de)?(r(),g("div",$e,[o(V,{text:t.song.album},null,8,["text"])])):B("",!0),t.selected||v.value||t.song.favourite?(r(),g("div",{key:4,class:j([{favourite:t.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},k(t.song.favourite?"favorite":"heart_plus"),3)):B("",!0),h("div",Ce,k(b(ce)(t.song.duration)),1)],34)]),_:1},8,["liked","playlistId","song"])}}});const Ae=ge(_e,[["__scopeId","data-v-2189838e"]]);export{Ae as P};
