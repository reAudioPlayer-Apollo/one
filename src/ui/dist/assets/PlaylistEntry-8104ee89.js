import{i as L,k as W,B as p,q as I,e as b,bb as X,bQ as Z,o as d,c as g,r as G,g as o,w as s,b as r,F as O,j as U,f as A,t as k,d as B,u as S,c4 as J,co as K,bZ as ee,cg as te,x as oe,ci as ne,ck as se,b_ as ae,a as h,cp as ie,aS as j,h as le,M as V,z as de,c1 as ue,cq as re,c3 as ce,cr as ve,_ as ge}from"./index-77d57c2a.js";import{_ as fe}from"./EditSong.vue_vue_type_script_setup_true_lang-9093873b.js";import{p as me}from"./playerInPicture-af203fdf.js";import{c as ye,d as pe}from"./collection-9da60d81.js";const ke=L({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(t,{expose:F,emit:N}){const i=W(),$=p(()=>i.playlists),e=t,f=N,v=p(()=>e.playlistId==-1),C=()=>{me(e.song.artist,e.song.title,e.song.source)},m=async n=>{var a;n!=-1&&(await ee(n,e.song),te.addSuccess(e.song.title,`Added to ${(a=$.value.find(l=>l.id==n))==null?void 0:a.name}`,3e3),f("update"))},_=async()=>{const n=await oe(e.song.title,e.song.artist,e.song.cover);await m(n),f("update")},q=async()=>{await ne(e.playlistId,e.song.id),f("update")},M=I(null),y=I(null),E=()=>{y.value.visible?P():c()},P=()=>{y.value.hide()},c=()=>{const n=M.value.getBoundingClientRect(),a={top:n.height+n.top+window.scrollY,left:n.width+n.left+window.scrollX};y.value.show(a)};F({show:c,toggle:E,hide:P});const D=p(()=>({Soundcloud:`https://soundcloud.com/search?q=${e.song.artist} ${e.song.title}`,Audius:`https://audius.co/search/${e.song.artist} ${e.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${e.song.artist} ${e.song.title}`,Spotify:`https://open.spotify.com/search/${e.song.artist} ${e.song.title}`})),w=()=>{f("edit")},R=n=>{window.open(D.value[n]),w()},z=()=>{const n=ye(e.song);pe(n,`${e.song.artist} - ${e.song.title}`)};return(n,a)=>{const l=b("v-contextmenu-item"),T=b("v-contextmenu-submenu"),x=b("v-contextmenu-divider"),Y=b("v-contextmenu"),H=X("contextmenu");return Z((d(),g("div",{ref_key:"box",ref:M},[G(n.$slots,"default"),o(Y,{ref_key:"contextmenu",ref:y},{default:s(()=>[o(l,{onClick:C},{default:s(()=>[r(" Preview ")]),_:1}),o(T,{title:"Find source"},{default:s(()=>[(d(!0),g(O,null,U(Object.keys(D.value),u=>(d(),A(l,{key:u,onClick:Q=>R(u)},{default:s(()=>[r(k(u),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(x),o(l,{onClick:a[0]||(a[0]=u=>n.$emit("like"))},{default:s(()=>[r(k((t.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),v.value?B("",!0):(d(),A(l,{key:0,onClick:q},{default:s(()=>[r(" Remove from this playlist ")]),_:1})),o(T,{title:"Add to playlist"},{default:s(()=>[o(l,{onClick:_},{default:s(()=>[r("Add to new playlist")]),_:1}),o(x),(d(!0),g(O,null,U($.value,u=>(d(),A(l,{key:u.id,onClick:Q=>m(u.id)},{default:s(()=>[r(k(u.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(x),o(l,{onClick:w},{default:s(()=>[r(" Update Metadata ")]),_:1}),o(x),o(l,{onClick:a[1]||(a[1]=u=>S(J)(t.song.id))},{default:s(()=>[r(" Download ")]),_:1}),o(l,{onClick:a[2]||(a[2]=u=>S(K)(t.song.id))},{default:s(()=>[r(" Uncache ")]),_:1}),o(x),o(T,{title:"Export..."},{default:s(()=>[o(l,{onClick:a[3]||(a[3]=u=>z())},{default:s(()=>[r(" to file ")]),_:1})]),_:1})]),_:1},512)])),[[H,void 0,"contextmenu"]])}}}),we={key:0,class:"index text-right downloading"},xe={key:2,class:"cover"},he={class:"artist-title"},be={class:"title"},Se={class:"artist"},$e={key:3,class:"album"},Ce={class:"duration text-center"},_e=L({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null}},emits:["update"],setup(t,{emit:F}){const N=se(),i=t,$=F,e=ae(),f=p(()=>i.song.id==e.song.id),v=I(!1),C=()=>{i.song.favourite=!i.song.favourite,ve(i.song.id,i.song.favourite)},m=p(()=>i.playlistId==null?e.playlist.id:i.playlistId),_=()=>{if(m.value=="track"){e.loadPlaylist("track",i.song.id);return}e.loadSong(m.value,i.index)},q=I(null),M=()=>{q.value.show()},y=()=>{$("update")},E=p(()=>N.isSongDownloading(i.song.id));return(P,c)=>{const D=b("router-link");return d(),A(ke,{ref:"ctxMenu",liked:t.song.favourite,playlistId:m.value,song:t.song,onEdit:M,onLike:C,onUpdate:y},{default:s(()=>[o(fe,{ref_key:"updatePopup",ref:q,song:t.song,onUpdate:c[0]||(c[0]=w=>P.$emit("update"))},null,8,["song"]),h("div",{class:j([{playing:f.value,selected:t.selected,hovering:v.value,withCover:t.withCover,withAlbum:t.withAlbum,withMore:t.withMore},"playlist-entry"]),onDblclick:_,onMouseenter:c[1]||(c[1]=w=>v.value=!0),onMouseleave:c[2]||(c[2]=w=>v.value=!1)},[E.value?(d(),g("div",we,[o(ie)])):(d(),g("div",{key:1,class:j([{"material-symbols-rounded":v.value},"index text-right"]),onClick:_},k(v.value?"play_arrow":t.index+1),3)),t.withCover?(d(),g("div",xe,[o(le,{src:t.song.cover,type:"track"},null,8,["src"])])):B("",!0),h("div",he,[h("span",be,[o(D,{to:`/track/${S(de)(t.song.id)}`,class:"linkOnHover"},{default:s(()=>[o(V,{text:t.song.title},null,8,["text"])]),_:1},8,["to"])]),h("span",Se,[o(ue,{artist:t.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),t.withAlbum&&!S(re)?(d(),g("div",$e,[o(V,{text:t.song.album},null,8,["text"])])):B("",!0),t.selected||v.value||t.song.favourite?(d(),g("div",{key:4,class:j([{favourite:t.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},k(t.song.favourite?"favorite":"heart_plus"),3)):B("",!0),h("div",Ce,k(S(ce)(t.song.duration)),1)],34)]),_:1},8,["liked","playlistId","song"])}}});const Ae=ge(_e,[["__scopeId","data-v-d1d2da96"]]);export{Ae as P};
