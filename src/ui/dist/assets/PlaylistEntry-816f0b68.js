import{i as L,k as Q,B as b,q as A,e as w,bb as W,bQ as X,o as u,c as p,r as Z,g as o,w as n,b as v,F as T,j as V,f as P,t as k,d as _,u as B,c4 as G,bZ as J,cg as K,x as ee,ci as te,b_ as oe,a as y,aS as E,h as se,M as z,z as ne,c1 as ae,co as ie,c3 as le,cp as ue,_ as re}from"./index-bd88f384.js";import{_ as ce}from"./EditSong.vue_vue_type_script_setup_true_lang-f355f746.js";import{p as de}from"./playerInPicture-af203fdf.js";const ve=L({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(e,{expose:I,emit:a}){const D=Q(),g=b(()=>D.playlists),t=e,i=a,$=b(()=>t.playlistId==-1),x=()=>{de(t.song.artist,t.song.title,t.song.source)},h=async s=>{var r;s!=-1&&(await J(s,t.song),K.addSuccess(t.song.title,`Added to ${(r=g.value.find(l=>l.id==s))==null?void 0:r.name}`,3e3),i("update"))},C=async()=>{const s=await ee(t.song.title,t.song.artist,t.song.cover);await h(s),i("update")},N=async()=>{await te(t.playlistId,t.song.id),i("update")},S=A(null),f=A(null),d=()=>{f.value.visible?M():m()},M=()=>{f.value.hide()},m=()=>{const s=S.value.getBoundingClientRect(),r={top:s.height+s.top+window.scrollY,left:s.width+s.left+window.scrollX};f.value.show(r)};I({show:m,toggle:d,hide:M});const F=b(()=>({Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`})),j=()=>{i("edit")},R=s=>{window.open(F.value[s]),j()};return(s,r)=>{const l=w("v-contextmenu-item"),O=w("v-contextmenu-submenu"),q=w("v-contextmenu-divider"),U=w("v-contextmenu"),Y=W("contextmenu");return X((u(),p("div",{ref_key:"box",ref:S},[Z(s.$slots,"default"),o(U,{ref_key:"contextmenu",ref:f},{default:n(()=>[o(l,{onClick:x},{default:n(()=>[v(" Preview ")]),_:1}),o(O,{title:"Find source"},{default:n(()=>[(u(!0),p(T,null,V(Object.keys(F.value),c=>(u(),P(l,{key:c,onClick:H=>R(c)},{default:n(()=>[v(k(c),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(q),o(l,{onClick:r[0]||(r[0]=c=>s.$emit("like"))},{default:n(()=>[v(k((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),$.value?_("",!0):(u(),P(l,{key:0,onClick:N},{default:n(()=>[v(" Remove from this playlist ")]),_:1})),o(O,{title:"Add to playlist"},{default:n(()=>[o(l,{onClick:C},{default:n(()=>[v("Add to new playlist")]),_:1}),o(q),(u(!0),p(T,null,V(g.value,c=>(u(),P(l,{key:c.id,onClick:H=>h(c.id)},{default:n(()=>[v(k(c.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(q),o(l,{onClick:j},{default:n(()=>[v(" Update Metadata ")]),_:1}),o(q),o(l,{onClick:r[1]||(r[1]=c=>B(G)(e.song.id))},{default:n(()=>[v("Download")]),_:1})]),_:1},512)])),[[Y,void 0,"contextmenu"]])}}}),ge={key:0,class:"cover"},fe={class:"artist-title"},me={class:"title"},ye={class:"artist"},pe={key:1,class:"album"},ke={class:"duration text-center"},xe=L({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null}},emits:["update"],setup(e,{emit:I}){const a=e,D=I,g=oe(),t=b(()=>a.song.id==g.song.id),i=A(!1),$=()=>{a.song.favourite=!a.song.favourite,ue(a.song.id,a.song.favourite)},x=b(()=>a.playlistId==null?g.playlist.id:a.playlistId),h=()=>{if(x.value=="track"){g.loadPlaylist("track",a.song.id);return}g.loadSong(x.value,a.index)},C=A(null),N=()=>{C.value.show()},S=()=>{D("update")};return(f,d)=>{const M=w("router-link");return u(),P(ve,{ref:"ctxMenu",liked:e.song.favourite,playlistId:x.value,song:e.song,onEdit:N,onLike:$,onUpdate:S},{default:n(()=>[o(ce,{ref_key:"updatePopup",ref:C,song:e.song,onUpdate:d[0]||(d[0]=m=>f.$emit("update"))},null,8,["song"]),y("div",{class:E([{playing:t.value,selected:e.selected,hovering:i.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:h,onMouseenter:d[2]||(d[2]=m=>i.value=!0),onMouseleave:d[3]||(d[3]=m=>i.value=!1)},[y("div",{class:E([{"material-symbols-rounded":i.value},"index text-right"]),onClick:h},k(i.value?"play_arrow":e.index+1),3),e.withCover?(u(),p("div",ge,[o(se,{src:e.song.cover,type:"track"},null,8,["src"])])):_("",!0),y("div",fe,[y("span",me,[o(M,{to:`/track/${B(ne)(e.song.id)}`,class:"linkOnHover"},{default:n(()=>[o(z,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),y("span",ye,[o(ae,{artist:e.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),e.withAlbum&&!B(ie)?(u(),p("div",pe,[o(z,{text:e.song.album},null,8,["text"])])):_("",!0),e.selected||i.value||e.song.favourite?(u(),p("div",{key:2,class:E([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:$},k(e.song.favourite?"favorite":"heart_plus"),3)):_("",!0),y("div",ke,k(B(le)(e.song.duration)),1),_("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const be=re(xe,[["__scopeId","data-v-718c5b3c"]]);export{be as P};
