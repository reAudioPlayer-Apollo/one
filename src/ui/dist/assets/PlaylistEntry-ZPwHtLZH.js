import{e as H,j as X,A as S,l as F,f as k,ab as G,a1 as J,o as r,c as g,r as Q,g as s,w as n,a as d,b as u,F as L,h as V,i as I,t as P,u as p,b8 as Z,b9 as tt,ba as et,d as B,ai as st,bb as ot,aa as nt,N as at,s as lt,aC as it,bc as dt,ad as ut,aF as rt,a5 as ct,bd as mt,K as j,E as ft,M as _,y as vt,H as yt,be as gt,ah as pt,bf as bt,_ as wt}from"./index-5KRJtp2M.js";import{_ as xt}from"./EditSong.vue_vue_type_script_setup_true_lang-DaXDymvP.js";import{p as kt}from"./playerInPicture-Dfp9IAsf.js";const St=H({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(o,{expose:E,emit:O}){const i=X(),C=S(()=>i.playlists.filter(a=>a.type==="classic")),e=o,b=O,f=()=>{kt(e.song.artist,e.song.title,e.song.source)},A=S(()=>{var a;return((a=i.playlists.find(t=>t.id===e.playlistId))==null?void 0:a.type)!=="classic"}),v=async a=>{var t,l;await nt(a,e.song),at.addSuccess(e.song.title,`Added to ${(t=C.value.find(y=>y.id==a))==null?void 0:t.name}`,3e3,void 0,(l=C.value.find(y=>y.id==a))==null?void 0:l.href),b("update")},M=async()=>{const a=await lt("classic",e.song.title,e.song.artist,e.song.cover);await v(a),b("update")},N=async()=>{await it(e.playlistId,e.song.id),b("update")},D=F(null),w=F(null),T=()=>{w.value.visible?h():m()},h=()=>{w.value.hide()},m=()=>{const a=D.value.getBoundingClientRect(),t={top:a.height+a.top+window.scrollY,left:a.width+a.left+window.scrollX};w.value.show(t)};E({show:m,toggle:T,hide:h});const $=S(()=>({Soundcloud:`https://soundcloud.com/search?q=${e.song.artist} ${e.song.title}`,Audius:`https://audius.co/search/${e.song.artist} ${e.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${e.song.artist} ${e.song.title}`,Spotify:`https://open.spotify.com/search/${e.song.artist} ${e.song.title}`})),q=()=>{b("edit")},U=a=>{window.open($.value[a]),q()},R=()=>{const a=dt(e.song);ut(a,`${e.song.artist} - ${e.song.title}`)};return(a,t)=>{const l=k("v-contextmenu-item"),y=k("v-contextmenu-submenu"),x=k("v-contextmenu-divider"),Y=k("v-context-menu-divider"),z=k("v-contextmenu"),K=G("contextmenu");return J((r(),g("div",{ref_key:"box",ref:D},[Q(a.$slots,"default"),s(z,{ref_key:"contextmenu",ref:w},{default:n(()=>[s(l,{onClick:f},{default:n(()=>t[6]||(t[6]=[d("span",{class:"material-symbols-rounded"},"preview",-1),u(" Preview ")])),_:1}),s(l,null,{default:n(()=>[t[7]||(t[7]=d("span",{class:"material-symbols-rounded"},"search",-1)),s(y,{title:"Find source"},{default:n(()=>[(r(!0),g(L,null,V(Object.keys($.value),c=>(r(),I(l,{key:c,onClick:W=>U(c)},{default:n(()=>[u(P(c),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),s(x),s(l,null,{default:n(()=>[t[11]||(t[11]=d("span",{class:"material-symbols-rounded"},"queue_music",-1)),s(y,{title:"Add to queue"},{default:n(()=>[s(l,{onClick:t[0]||(t[0]=()=>p(Z)(e.song.id))},{default:n(()=>t[8]||(t[8]=[d("span",{class:"material-symbols-rounded"}," play_arrow ",-1),u(" Play Now ")])),_:1}),s(l,{onClick:t[1]||(t[1]=()=>p(tt)(e.song.id))},{default:n(()=>t[9]||(t[9]=[d("span",{class:"material-symbols-rounded"}," add_to_queue ",-1),u(" Play Next ")])),_:1}),s(l,{onClick:t[2]||(t[2]=()=>p(et)(e.song.id))},{default:n(()=>t[10]||(t[10]=[d("span",{class:"material-symbols-rounded"}," queue_play_next ",-1),u(" Play Last ")])),_:1})]),_:1})]),_:1}),s(x),s(Y),A.value?B("",!0):(r(),I(l,{key:0,onClick:N},{default:n(()=>t[12]||(t[12]=[d("span",{class:"material-symbols-rounded"},"delete",-1),u(" Remove from this playlist ")])),_:1})),s(l,null,{default:n(()=>[t[14]||(t[14]=d("span",{class:"material-symbols-rounded"},"playlist_add",-1)),s(y,{title:"Add to playlist"},{default:n(()=>[s(l,{onClick:M},{default:n(()=>t[13]||(t[13]=[u(" Add to new playlist ")])),_:1}),s(x),(r(!0),g(L,null,V(C.value,c=>(r(),I(l,{key:c.id,onClick:W=>v(c.id)},{default:n(()=>[u(P(c.name),1)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}),s(x),s(l,{onClick:q},{default:n(()=>t[15]||(t[15]=[d("span",{class:"material-symbols-rounded"},"edit",-1),u(" Edit ")])),_:1}),s(x),s(l,{onClick:t[3]||(t[3]=c=>p(st)(o.song.id))},{default:n(()=>t[16]||(t[16]=[d("span",{class:"material-symbols-rounded"},"file_download",-1),u(" Download ")])),_:1}),s(l,{onClick:t[4]||(t[4]=c=>p(ot)(o.song.id))},{default:n(()=>t[17]||(t[17]=[d("span",{class:"material-symbols-rounded"},"replay",-1),u(" Uncache ")])),_:1}),s(x),s(l,null,{default:n(()=>[t[19]||(t[19]=d("span",{class:"material-symbols-rounded"},"share",-1)),s(y,{title:"Export..."},{default:n(()=>[s(l,{onClick:t[5]||(t[5]=c=>R())},{default:n(()=>t[18]||(t[18]=[u(" to file ")])),_:1})]),_:1})]),_:1})]),_:1},512)])),[[K,void 0,"contextmenu"]])}}}),Ct={key:0,class:"index text-right downloading"},$t={key:2,class:"cover"},qt={class:"artist-title"},Pt={class:"title"},At={class:"artist"},Mt={key:3,class:"album"},Nt={class:"duration text-center"},Dt=H({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null},artist:{type:String,required:!1,default:null},album:{type:String,required:!1,default:null}},emits:["update"],setup(o,{emit:E}){const O=rt(),i=o,C=E,e=ct(),b=S(()=>i.song.id==e.song.id),f=F(!1),A=()=>{i.song.favourite=!i.song.favourite,bt(i.song.id,i.song.favourite)},v=S(()=>i.playlistId==null?e.playlist.id:i.playlistId),M=async()=>{if(v.value=="track"){e.loadPlaylist("track",i.song.id);return}if(v.value=="artist"){await e.loadPlaylist("artist",i.artist),e.loadSong(null,i.index);return}if(v.value=="album"){await e.loadPlaylist("album",i.album),e.loadSong(null,i.index);return}e.loadSong(v.value,i.index)},N=F(null),D=()=>{N.value.show()},w=()=>{C("update")},T=S(()=>O.isSongDownloading(i.song.id));return(h,m)=>{const $=k("router-link");return r(),I(St,{ref:"ctxMenu",liked:o.song.favourite,playlistId:v.value,song:o.song,onEdit:D,onLike:A,onUpdate:w},{default:n(()=>[s(xt,{ref_key:"updatePopup",ref:N,song:o.song,onUpdate:m[0]||(m[0]=q=>h.$emit("update"))},null,8,["song"]),d("div",{class:j([{playing:b.value,selected:o.selected,hovering:f.value,withCover:o.withCover,withAlbum:o.withAlbum,withMore:o.withMore},"playlist-entry"]),onDblclick:M,onMouseenter:m[1]||(m[1]=q=>f.value=!0),onMouseleave:m[2]||(m[2]=q=>f.value=!1)},[T.value?(r(),g("div",Ct,[s(mt)])):(r(),g("div",{key:1,class:j([{"material-symbols-rounded":f.value},"index text-right"]),onClick:M},P(f.value?"play_arrow":o.index+1),3)),o.withCover?(r(),g("div",$t,[s(ft,{src:o.song.cover,type:"track"},null,8,["src"])])):B("",!0),d("div",qt,[d("span",Pt,[s($,{to:`/track/${p(vt)(o.song.id)}`,class:"linkOnHover"},{default:n(()=>[s(_,{text:o.song.title},null,8,["text"])]),_:1},8,["to"])]),d("span",At,[s(yt,{artist:o.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),o.withAlbum&&!p(gt)?(r(),g("div",Mt,[s($,{to:o.song.album.href,class:"linkOnHover"},{default:n(()=>[s(_,{text:o.song.album.name},null,8,["text"])]),_:1},8,["to"])])):B("",!0),o.selected||f.value||o.song.favourite?(r(),g("div",{key:4,class:j([{favourite:o.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:A},P(o.song.favourite?"favorite":"heart_plus"),3)):B("",!0),d("div",Nt,P(p(pt)(o.song.duration)),1)],34)]),_:1},8,["liked","playlistId","song"])}}}),Ft=wt(Dt,[["__scopeId","data-v-67cfb148"]]);export{Ft as P};
