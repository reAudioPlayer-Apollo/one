import{i as z,k as Q,B as k,q as I,e as w,bb as W,bQ as X,o as i,c as g,r as Z,g as o,w as s,b as c,F as T,j as U,f as A,t as x,d as b,u as _,c4 as G,co as J,bZ as K,cg as ee,x as te,ci as oe,ck as ne,b_ as se,a as h,cp as ae,aS as j,h as ie,M as V,z as le,c1 as re,cq as ue,c3 as de,cr as ce,_ as ve}from"./index-46005676.js";import{_ as ge}from"./EditSong.vue_vue_type_script_setup_true_lang-6c55fd6a.js";import{p as fe}from"./playerInPicture-af203fdf.js";const me=z({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:String,required:!1,default:""}},emits:["update","edit"],setup(e,{expose:N,emit:E}){const a=Q(),S=k(()=>a.playlists),t=e,f=E,v=k(()=>t.playlistId==-1),C=()=>{fe(t.song.artist,t.song.title,t.song.source)},m=async n=>{var l;n!=-1&&(await K(n,t.song),ee.addSuccess(t.song.title,`Added to ${(l=S.value.find(r=>r.id==n))==null?void 0:l.name}`,3e3),f("update"))},$=async()=>{const n=await te(t.song.title,t.song.artist,t.song.cover);await m(n),f("update")},M=async()=>{await oe(t.playlistId,t.song.id),f("update")},q=I(null),y=I(null),F=()=>{y.value.visible?P():d()},P=()=>{y.value.hide()},d=()=>{const n=q.value.getBoundingClientRect(),l={top:n.height+n.top+window.scrollY,left:n.width+n.left+window.scrollX};y.value.show(l)};N({show:d,toggle:F,hide:P});const B=k(()=>({Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`})),p=()=>{f("edit")},L=n=>{window.open(B.value[n]),p()};return(n,l)=>{const r=w("v-contextmenu-item"),O=w("v-contextmenu-submenu"),D=w("v-contextmenu-divider"),R=w("v-contextmenu"),Y=W("contextmenu");return X((i(),g("div",{ref_key:"box",ref:q},[Z(n.$slots,"default"),o(R,{ref_key:"contextmenu",ref:y},{default:s(()=>[o(r,{onClick:C},{default:s(()=>[c(" Preview ")]),_:1}),o(O,{title:"Find source"},{default:s(()=>[(i(!0),g(T,null,U(Object.keys(B.value),u=>(i(),A(r,{key:u,onClick:H=>L(u)},{default:s(()=>[c(x(u),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(D),o(r,{onClick:l[0]||(l[0]=u=>n.$emit("like"))},{default:s(()=>[c(x((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),v.value?b("",!0):(i(),A(r,{key:0,onClick:M},{default:s(()=>[c(" Remove from this playlist ")]),_:1})),o(O,{title:"Add to playlist"},{default:s(()=>[o(r,{onClick:$},{default:s(()=>[c("Add to new playlist")]),_:1}),o(D),(i(!0),g(T,null,U(S.value,u=>(i(),A(r,{key:u.id,onClick:H=>m(u.id)},{default:s(()=>[c(x(u.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(D),o(r,{onClick:p},{default:s(()=>[c(" Update Metadata ")]),_:1}),o(D),o(r,{onClick:l[1]||(l[1]=u=>_(G)(e.song.id))},{default:s(()=>[c(" Download ")]),_:1}),o(r,{onClick:l[2]||(l[2]=u=>_(J)(e.song.id))},{default:s(()=>[c(" Uncache ")]),_:1})]),_:1},512)])),[[Y,void 0,"contextmenu"]])}}}),ye={key:0,class:"index text-right downloading"},pe={key:2,class:"cover"},ke={class:"artist-title"},xe={class:"title"},he={class:"artist"},we={key:3,class:"album"},be={class:"duration text-center"},_e=z({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null}},emits:["update"],setup(e,{emit:N}){const E=ne(),a=e,S=N,t=se(),f=k(()=>a.song.id==t.song.id),v=I(!1),C=()=>{a.song.favourite=!a.song.favourite,ce(a.song.id,a.song.favourite)},m=k(()=>a.playlistId==null?t.playlist.id:a.playlistId),$=()=>{if(m.value=="track"){t.loadPlaylist("track",a.song.id);return}t.loadSong(m.value,a.index)},M=I(null),q=()=>{M.value.show()},y=()=>{S("update")},F=k(()=>E.isSongDownloading(a.song.id));return(P,d)=>{const B=w("router-link");return i(),A(me,{ref:"ctxMenu",liked:e.song.favourite,playlistId:m.value,song:e.song,onEdit:q,onLike:C,onUpdate:y},{default:s(()=>[o(ge,{ref_key:"updatePopup",ref:M,song:e.song,onUpdate:d[0]||(d[0]=p=>P.$emit("update"))},null,8,["song"]),h("div",{class:j([{playing:f.value,selected:e.selected,hovering:v.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:$,onMouseenter:d[2]||(d[2]=p=>v.value=!0),onMouseleave:d[3]||(d[3]=p=>v.value=!1)},[F.value?(i(),g("div",ye,[o(ae)])):(i(),g("div",{key:1,class:j([{"material-symbols-rounded":v.value},"index text-right"]),onClick:$},x(v.value?"play_arrow":e.index+1),3)),e.withCover?(i(),g("div",pe,[o(ie,{src:e.song.cover,type:"track"},null,8,["src"])])):b("",!0),h("div",ke,[h("span",xe,[o(B,{to:`/track/${_(le)(e.song.id)}`,class:"linkOnHover"},{default:s(()=>[o(V,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),h("span",he,[o(re,{artist:e.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),e.withAlbum&&!_(ue)?(i(),g("div",we,[o(V,{text:e.song.album},null,8,["text"])])):b("",!0),e.selected||v.value||e.song.favourite?(i(),g("div",{key:4,class:j([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},x(e.song.favourite?"favorite":"heart_plus"),3)):b("",!0),h("div",be,x(_(de)(e.song.duration)),1),b("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const Me=ve(_e,[["__scopeId","data-v-4bf9fbe1"]]);export{Me as P};
