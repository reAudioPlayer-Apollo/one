import{n as L,j as Y,A as _,q as A,by as H,o as l,c as y,r as K,g as o,w as a,b as f,F as O,i as T,f as P,t as p,u as c,d as w,bK as X,x as G,c0 as J,e as b,aW as Q,B as Z,a as m,aA as D,h as ee,M as V,z as te,bS as oe,c6 as se,bW as ne,_ as ae}from"./index-abeb8a60.js";import{_ as ie}from"./EditSong.vue_vue_type_script_setup_true_lang-9c5d226d.js";import{p as le}from"./playerInPicture-af203fdf.js";import{d as ue,a as re,e as de}from"./song-2fc83751.js";const ce=L({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:Number,required:!1,default:-1}},emits:["update","edit"],setup(e,{expose:B,emit:n}){const t=e,I=Y(),u=_(()=>I.playlists),C=_(()=>t.playlistId==-1),k=()=>{le(t.song.artist,t.song.title,t.song.source)},h=async s=>{var r;s!=-1&&(await re(s,t.song),X.addSuccess(t.song.title,`Added to ${(r=u.value.find(i=>i.id==s))==null?void 0:r.name}`,3e3),n("update"))},$=async()=>{const s=await G(t.song.title,t.song.artist,t.song.cover);await h(s),n("update")},N=async()=>{await J(t.playlistId,t.song.id),n("update")},S=A(null),g=A(null),v=()=>{g.value.visible?q():x()},q=()=>{g.value.hide()},x=()=>{const s=S.value.getBoundingClientRect(),r={top:s.height+s.top+window.scrollY,left:s.width+s.left+window.scrollX};g.value.show(r)};B({show:x,toggle:v,hide:q});const E=_(()=>({Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`})),F=()=>{n("edit")},R=s=>{window.open(E.value[s]),F()};return(s,r)=>{const i=b("v-contextmenu-item"),j=b("v-contextmenu-submenu"),M=b("v-contextmenu-divider"),U=b("v-contextmenu"),W=Q("contextmenu");return H((l(),y("div",{ref_key:"box",ref:S},[K(s.$slots,"default"),o(U,{ref_key:"contextmenu",ref:g},{default:a(()=>[o(i,{onClick:k},{default:a(()=>[f(" Preview ")]),_:1}),o(j,{title:"Find source"},{default:a(()=>[(l(!0),y(O,null,T(Object.keys(c(E)),d=>(l(),P(i,{key:d,onClick:z=>R(d)},{default:a(()=>[f(p(d),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(M),o(i,{onClick:r[0]||(r[0]=d=>s.$emit("like"))},{default:a(()=>[f(p((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),c(C)?w("",!0):(l(),P(i,{key:0,onClick:N},{default:a(()=>[f(" Remove from this playlist ")]),_:1})),o(j,{title:"Add to playlist"},{default:a(()=>[o(i,{onClick:$},{default:a(()=>[f("Add to new playlist")]),_:1}),o(M),(l(!0),y(O,null,T(c(u),d=>(l(),P(i,{key:d.id,onClick:z=>h(d.id)},{default:a(()=>[f(p(d.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(M),o(i,{onClick:F},{default:a(()=>[f(" Update Metadata ")]),_:1}),o(M),o(i,{onClick:r[1]||(r[1]=d=>c(ue)(e.song.id))},{default:a(()=>[f("Download")]),_:1})]),_:1},512)])),[[W,void 0,"contextmenu"]])}}}),ve={key:0,class:"cover"},fe={class:"artist-title"},ge={class:"title"},me={class:"artist"},ye={key:1,class:"album"},pe={class:"duration text-center"},ke=L({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null}},emits:["update"],setup(e,{emit:B}){const n=e,t=Z(),I=_(()=>n.song.id==t.song.id),u=A(!1),C=()=>{n.song.favourite=!n.song.favourite,de(n.song.id,n.song.favourite)},k=_(()=>n.playlistId==null?t.playlist.id:n.playlistId),h=()=>{if(k.value=="track"){t.loadPlaylist("track",n.song.id);return}t.loadSong(Number(k.value),n.index)},$=A(null),N=()=>{$.value.show()},S=()=>{B("update")};return(g,v)=>{const q=b("router-link");return l(),P(ce,{ref:"ctxMenu",liked:e.song.favourite,playlistId:c(k),song:e.song,onEdit:N,onLike:C,onUpdate:S},{default:a(()=>[o(ie,{ref_key:"updatePopup",ref:$,song:e.song,onUpdate:v[0]||(v[0]=x=>g.$emit("update"))},null,8,["song"]),m("div",{class:D([{playing:c(I),selected:e.selected,hovering:u.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:h,onMouseenter:v[2]||(v[2]=x=>u.value=!0),onMouseleave:v[3]||(v[3]=x=>u.value=!1)},[m("div",{class:D([{"material-symbols-rounded":u.value},"index text-right"]),onClick:h},p(u.value?"play_arrow":e.index+1),3),e.withCover?(l(),y("div",ve,[o(ee,{src:e.song.cover,type:"track"},null,8,["src"])])):w("",!0),m("div",fe,[m("span",ge,[o(q,{to:`/track/${c(te)(e.song.id)}`,class:"linkOnHover"},{default:a(()=>[o(V,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),m("span",me,[o(oe,{artist:e.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),e.withAlbum&&!c(se)?(l(),y("div",ye,[o(V,{text:e.song.album},null,8,["text"])])):w("",!0),e.selected||u.value||e.song.favourite?(l(),y("div",{key:2,class:D([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},p(e.song.favourite?"favorite":"heart_plus"),3)):w("",!0),m("div",pe,p(c(ne)(e.song.duration)),1),w("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const _e=ae(ke,[["__scopeId","data-v-f2974070"]]);export{_e as P};
