import{m as U,j as H,y as _,n as A,bw as W,o as l,c as y,r as X,g as o,w as n,b as v,F as L,i as O,f as M,t as p,u as d,d as x,bV as Z,e as b,aU as G,z as J,a as g,ay as E,h as K,M as T,x as Q,bL as ee,bZ as te,bP as oe,_ as se}from"./index-ccfdb71e.js";import{_ as ne}from"./EditSong.vue_vue_type_script_setup_true_lang-83246bcd.js";import{p as ae}from"./playerInPicture-af203fdf.js";import{k as ie,a as le,c as ue,r as re,l as de}from"./song-c81a530a.js";const ce=U({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:Number,required:!1,default:-1}},emits:["update","edit"],setup(e,{expose:I,emit:a}){const t=e,B=H(),u=_(()=>B.playlists),C=_(()=>t.playlistId==-1),k=()=>{ae(t.song.artist,t.song.title,t.song.source)},h=async s=>{var r;s!=-1&&(await le(s,t.song),Z.addSuccess(t.song.title,`Added to ${(r=u.value.find(i=>i.id==s))==null?void 0:r.name}`,3e3))},$=async()=>{const s=await ue(t.song.title,t.song.artist,t.song.cover);h(s)},N=async()=>{await re(t.playlistId,t.song.id),a("update")},S=A(null),m=A(null),c=()=>{m.value.visible?P():w()},P=()=>{m.value.hide()},w=()=>{const s=S.value.getBoundingClientRect(),r={top:s.height+s.top+window.scrollY,left:s.width+s.left+window.scrollX};m.value.show(r)};I({show:w,toggle:c,hide:P});const F=_(()=>({Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`})),V=()=>{a("edit")},R=s=>{window.open(F.value[s]),V()};return(s,r)=>{const i=b("v-contextmenu-item"),j=b("v-contextmenu-submenu"),q=b("v-contextmenu-divider"),z=b("v-contextmenu"),Y=G("contextmenu");return W((l(),y("div",{ref_key:"box",ref:S},[X(s.$slots,"default"),o(z,{ref_key:"contextmenu",ref:m},{default:n(()=>[o(i,{onClick:k},{default:n(()=>[v(" Preview ")]),_:1}),o(j,{title:"Find source"},{default:n(()=>[(l(!0),y(L,null,O(Object.keys(d(F)),f=>(l(),M(i,{key:f,onClick:D=>R(f)},{default:n(()=>[v(p(f),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(q),o(i,{onClick:r[0]||(r[0]=f=>s.$emit("like"))},{default:n(()=>[v(p((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),d(C)?x("",!0):(l(),M(i,{key:0,onClick:N},{default:n(()=>[v(" Remove from this playlist ")]),_:1})),o(j,{title:"Add to playlist"},{default:n(()=>[o(i,{onClick:$},{default:n(()=>[v("Add to new playlist")]),_:1}),o(q),(l(!0),y(L,null,O(d(u),(f,D)=>(l(),M(i,{key:D,onClick:he=>h(D)},{default:n(()=>[v(p(f.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),o(q),o(i,{onClick:V},{default:n(()=>[v(" Update Metadata ")]),_:1}),o(q),o(i,{onClick:r[1]||(r[1]=f=>d(ie)(e.song.id))},{default:n(()=>[v("Download")]),_:1})]),_:1},512)])),[[Y,void 0,"contextmenu"]])}}}),ve={key:0,class:"cover"},fe={class:"artist-title"},me={class:"title"},ge={class:"artist"},ye={key:1,class:"album"},pe={class:"duration text-center"},ke=U({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:String,required:!1,default:null}},emits:["update"],setup(e,{emit:I}){const a=e,t=J(),B=_(()=>a.song.id==t.song.id),u=A(!1),C=()=>{a.song.favourite=!a.song.favourite,de(a.song.id,a.song.favourite)},k=_(()=>a.playlistId==null?t.playlist.id:a.playlistId),h=()=>{if(k.value=="track"){t.loadPlaylist("track",a.song.id);return}t.loadSong(Number(k.value),a.index)},$=A(null),N=()=>{$.value.show()},S=()=>{I("update")};return(m,c)=>{const P=b("router-link");return l(),M(ce,{ref:"ctxMenu",liked:e.song.favourite,playlistId:d(k),song:e.song,onEdit:N,onLike:C,onUpdate:S},{default:n(()=>[o(ne,{ref_key:"updatePopup",ref:$,song:e.song,onUpdate:c[0]||(c[0]=w=>m.$emit("update"))},null,8,["song"]),g("div",{class:E([{playing:d(B),selected:e.selected,hovering:u.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:h,onMouseenter:c[2]||(c[2]=w=>u.value=!0),onMouseleave:c[3]||(c[3]=w=>u.value=!1)},[g("div",{class:E([{"material-symbols-rounded":u.value},"index text-right"]),onClick:h},p(u.value?"play_arrow":e.index+1),3),e.withCover?(l(),y("div",ve,[o(K,{src:e.song.cover,type:"track"},null,8,["src"])])):x("",!0),g("div",fe,[g("span",me,[o(P,{to:`/track/${d(Q)(e.song.id)}`,class:"linkOnHover"},{default:n(()=>[o(T,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),g("span",ge,[o(ee,{artist:e.song.artist,class:"text-muted text-xs"},null,8,["artist"])])]),e.withAlbum&&!d(te)?(l(),y("div",ye,[o(T,{text:e.song.album},null,8,["text"])])):x("",!0),e.selected||u.value||e.song.favourite?(l(),y("div",{key:2,class:E([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:C},p(e.song.favourite?"favorite":"heart_plus"),3)):x("",!0),g("div",pe,p(d(oe)(e.song.duration)),1),x("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const Ce=se(ke,[["__scopeId","data-v-597a0fda"]]);export{Ce as P};
