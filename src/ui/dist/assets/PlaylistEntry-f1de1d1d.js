import{m as E,n as x,E as Y,o as r,f as F,w as i,g as n,j as G,G as N,z as J,c as C,r as K,b as f,F as V,i as z,t as q,u as p,d as M,e as I,K as W,N as X,a as $,J as O,h as Q,M as D,x as Z,O as ee,_ as te}from"./index-59a56c74.js";import{F as oe,T as ne,u as se,d as ae,a as le,c as ie,r as ue,f as re}from"./song-8627c30f.js";import{p as ce}from"./playerInPicture-af203fdf.js";const de=E({__name:"EditSong",props:{song:{type:Object,required:!0}},setup(e,{expose:P}){const o=e,t=async(l,s)=>{const a=new FormData,m="."+s.name.split(".").pop();var d=s.slice(0,s.size,s.type),w=new File([d],o.song.id+m,{type:s.type});return a.append("file",w),await(await fetch(l,{method:"POST",body:a})).text()},v=x([{name:"source",type:"upload",icon:"music_note",accept:"audio/mp3",required:!0,onUpload:l=>{t("/api/config/tracks",l).then(s=>v.value.find(a=>a.name=="source").value=s)},value:o.song.source},{name:"title",type:"text",icon:"title",required:!0,value:o.song.title},{name:"artist",type:"text",icon:"person",required:!0,value:o.song.artist},{name:"album",type:"text",icon:"album",value:o.song.album},{name:"cover",type:"upload",icon:"art_track",accept:"image/*",imagePreview:!0,value:o.song.cover,onUpload:l=>{t("/api/config/images",l).then(s=>v.value.find(a=>a.name=="cover").value=s)}}]),c=async()=>{await se({...o.song,...h.value.toObject()})},y=x(null),h=x(null);return P({show:()=>{y.value.show()}}),Y(o,()=>{var l;for(const s of v.value.map(a=>a.name))v.value.find(a=>a.name==s).value=(l=o.song)==null?void 0:l[s]},{deep:!0}),(l,s)=>(r(),F(ne,{ref_key:"modal",ref:y,submit:{label:"Save",icon:"save"},name:"Edit Song",onClose:s[0]||(s[0]=a=>l.$emit("close")),onSubmit:c},{default:i(()=>[n(oe,{ref_key:"form",ref:h,options:v.value},null,8,["options"])]),_:1},512))}}),ve=E({__name:"SongContext",props:{song:{type:Object,required:!0},playlistId:{type:Number,required:!1,default:-1}},emits:["update","edit"],setup(e,{expose:P,emit:o}){const t=e,v=G(),c=N(()=>v.playlists),y=N(()=>t.playlistId==-1),h=()=>{ce(t.song.artist,t.song.title,t.song.source)},b=async u=>{u!=-1&&await le(u,t.song)},l=async()=>{const u=await ie(t.song.title,t.song.artist,t.song.cover);b(u)},s=async()=>{await ue(t.playlistId,t.song.id),o("update")},a=x(null),m=x(null),d=()=>{m.value.visible?w():_()},w=()=>{m.value.hide()},_=()=>{const u=a.value.getBoundingClientRect(),S={top:u.height+u.top+window.scrollY,left:u.width+u.left+window.scrollX};m.value.show(S)};P({show:_,toggle:d,hide:w});const T=N(()=>({Soundcloud:`https://soundcloud.com/search?q=${t.song.artist} ${t.song.title}`,Audius:`https://audius.co/search/${t.song.artist} ${t.song.title}`,"Youtube Music":`https://music.youtube.com/search?q=${t.song.artist} ${t.song.title}`,Spotify:`https://open.spotify.com/search/${t.song.artist} ${t.song.title}`})),j=()=>{o("edit")},L=u=>{window.open(T.value[u]),j()};return(u,S)=>{const g=I("v-contextmenu-item"),U=I("v-contextmenu-submenu"),A=I("v-contextmenu-divider"),R=I("v-contextmenu"),H=W("contextmenu");return J((r(),C("div",{ref_key:"box",ref:a},[K(u.$slots,"default"),n(R,{ref_key:"contextmenu",ref:m},{default:i(()=>[n(g,{onClick:h},{default:i(()=>[f(" Preview ")]),_:1}),n(U,{title:"Find source"},{default:i(()=>[(r(!0),C(V,null,z(Object.keys(p(T)),k=>(r(),F(g,{key:k,onClick:B=>L(k)},{default:i(()=>[f(q(k),1)]),_:2},1032,["onClick"]))),128))]),_:1}),n(A),n(g,{onClick:S[0]||(S[0]=k=>u.$emit("like"))},{default:i(()=>[f(q((e.song.favourite?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1}),p(y)?M("",!0):(r(),F(g,{key:0,onClick:s},{default:i(()=>[f(" Remove from this playlist ")]),_:1})),n(U,{title:"Add to playlist"},{default:i(()=>[n(g,{onClick:l},{default:i(()=>[f("Add to new playlist")]),_:1}),n(A),(r(!0),C(V,null,z(p(c),(k,B)=>(r(),F(g,{key:B,onClick:ke=>b(B)},{default:i(()=>[f(q(k.name),1)]),_:2},1032,["onClick"]))),128))]),_:1}),n(A),n(g,{onClick:j},{default:i(()=>[f(" Update Metadata ")]),_:1}),n(A),n(g,{onClick:S[1]||(S[1]=k=>p(ae)(e.song.id))},{default:i(()=>[f("Download")]),_:1})]),_:1},512)])),[[H,void 0,"contextmenu"]])}}}),me={key:0,class:"cover"},ge={class:"artist-title"},fe={class:"title"},pe={class:"artist"},ye={key:1,class:"album"},he={class:"duration text-center"},we=E({__name:"PlaylistEntry",props:{song:{type:Object,required:!0},index:{type:Number,required:!0},withCover:{type:Boolean,required:!1,default:!1},withAlbum:{type:Boolean,required:!1,default:!1},withMore:{type:Boolean,required:!1,default:!1},selected:{type:Boolean,required:!1,default:!1},playlistId:{type:Number,required:!1,default:null}},emits:["update"],setup(e,{emit:P}){const o=e,t=X(),v=N(()=>o.song.id==t.song.id),c=x(!1),y=()=>{o.song.favourite=!o.song.favourite,re(o.song.id,o.song.favourite)},h=N(()=>o.playlistId==null?t.playlist.id:o.playlistId),b=()=>{t.loadSong(h.value,o.index)},l=x(null),s=()=>{l.value.show()},a=()=>{P("update")};return(m,d)=>{const w=I("router-link");return r(),F(ve,{ref:"ctxMenu",liked:e.song.favourite,playlistId:p(h),song:e.song,onEdit:s,onLike:y,onUpdate:a},{default:i(()=>[n(de,{ref_key:"updatePopup",ref:l,song:e.song,onUpdate:d[0]||(d[0]=_=>m.$emit("update"))},null,8,["song"]),$("div",{class:O([{playing:p(v),selected:e.selected,hovering:c.value,withCover:e.withCover,withAlbum:e.withAlbum,withMore:e.withMore},"playlist-entry"]),onDblclick:b,onMouseenter:d[2]||(d[2]=_=>c.value=!0),onMouseleave:d[3]||(d[3]=_=>c.value=!1)},[$("div",{class:O([{"material-symbols-rounded":c.value},"index text-right"]),onClick:b},q(c.value?"play_arrow":e.index+1),3),e.withCover?(r(),C("div",me,[n(Q,{src:e.song.cover,type:"track"},null,8,["src"])])):M("",!0),$("div",ge,[$("span",fe,[n(w,{to:`/track/${p(Z)(e.song.id)}`,class:"linkOnHover"},{default:i(()=>[n(D,{text:e.song.title},null,8,["text"])]),_:1},8,["to"])]),$("span",pe,[n(w,{to:`/search/artist:${e.song.artist}`,class:"linkOnHover"},{default:i(()=>[n(D,{text:e.song.artist},null,8,["text"])]),_:1},8,["to"])])]),e.withAlbum&&!p(ee)?(r(),C("div",ye,[n(D,{text:e.song.album},null,8,["text"])])):M("",!0),e.selected||c.value||e.song.favourite?(r(),C("div",{key:2,class:O([{favourite:e.song.favourite},"favourite-icon icon text-right material-symbols-rounded"]),onClick:y},q(e.song.favourite?"favorite":"heart_plus"),3)):M("",!0),$("div",he,q(e.song.duration=="-1:59"?"N/A":e.song.duration),1),M("",!0)],34)]),_:1},8,["liked","playlistId","song"])}}});const Se=te(we,[["__scopeId","data-v-2ee6be8d"]]);export{Se as P};
