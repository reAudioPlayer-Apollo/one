import{m as P,j as S,q as d,o as m,f as _,w as C,g as p,u as b,G as k,a as i,_ as T,i as A,e as j,c as N,d as B,t as D}from"./index.137aa168.js";import{F as E,T as M,a as O,c as q}from"./song.a7128768.js";import{T as x,P as V}from"./TrackInfo.18c3fb8a.js";const F=i("br",null,null,-1),H=P({__name:"ImportSpotifyPlaylist",props:{playlist:{type:Object,required:!0}},setup(n,{expose:r}){const e=n,u=S(),c=d([{name:"playlist",type:"dropdown",required:!0,value:null,options:u.playlistsAsDropdown}]),o=d(null),l=d(null),s=d([]),h=async()=>{if(o.value.load(),s.value.length==0){const t=await fetch(`/api/spotify/playlists/${e.playlist.id}`);s.value=await t.json()}o.value.show()},w=()=>{const t=new CustomEvent("player.play",{detail:{artist:"Spotify Playlist",title:e.playlist.name,source:e.playlist.href}});window.dispatchEvent(t)},y=async t=>{if(t==="new"){const a=await q(e.playlist.name,e.playlist.description,e.playlist.cover);return c.value[0].options=u.playlistsAsDropdown,c.value[0].value=a,a}return Number(t)},f=async(t,a=null)=>{s.value[t].added||(a!=null||(a=l.value.toObject().playlist),a=await y(a),await O(a!=null?a:l.value.toObject().playlist,s.value[t]),s.value[t].added=!0)},g=async()=>{let t=l.value.toObject().playlist;t=await y(t),s.value.forEach((a,v)=>{f(v,t)})};return r({show:h}),(t,a)=>(m(),_(M,{ref_key:"modal",ref:o,name:"Import Playlist",submitName:"Add All",onSubmit:g,onClose:a[0]||(a[0]=v=>t.$emit("close"))},{default:C(()=>[p(x,{title:n.playlist.name,cover:n.playlist.cover,icons:[{name:"share",onClick:()=>b(k)(n.playlist.href)},{name:"play_arrow",onClick:w}]},null,8,["title","cover","icons"]),p(E,{ref_key:"form",ref:l,options:c.value},null,8,["options"]),F,p(V,{songs:s.value,onAdd:f},null,8,["songs"])]),_:1},512))}});const L={components:{AddPlaylistToPlaylist:H},name:"PlaylistItem",methods:{parseCover:A,redirect(){this.spotify?this.$refs.import.show():this.$router.push(this.href)}},props:{cover:String,title:String,description:String,href:String,spotify:Boolean,id:String}},G={class:"wrapper drop-shadow-md"},W=["src"],z=["innerHTML"];function J(n,r,e,u,c,o){const l=j("add-playlist-to-playlist");return m(),N("div",G,[e.spotify?(m(),_(l,{key:0,playlist:{cover:e.cover,name:e.title,description:e.description,id:e.id,href:e.href},ref:"import"},null,8,["playlist"])):B("",!0),i("div",{class:"item",onClick:r[0]||(r[0]=(...s)=>o.redirect&&o.redirect(...s))},[i("img",{src:o.parseCover(e.cover)},null,8,W),i("h4",null,D(e.title),1),i("p",{class:"hideIfMobile",innerHTML:e.description},null,8,z)])])}const U=T(L,[["render",J],["__scopeId","data-v-d4f59dc3"]]);export{U as P};
