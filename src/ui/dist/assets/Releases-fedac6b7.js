import{i as K,q as v,s as Q,G as k,D as j,E as z,o as n,c,g as p,L as G,d,a as s,f as P,K as H,h as T,M as B,N as Y,t as w,J as h,w as U,O as y,b as W,F as A,j as X,C as Z,m as ee,n as te,Q as se,_ as le}from"./index-e4efca28.js";import{C as ae}from"./CollectionHeader-2276c980.js";import{p as oe}from"./playerInPicture-af203fdf.js";const R=g=>(ee("data-v-28b41b95"),g=g(),te(),g),re={key:0,class:"fill-page"},ne={class:"p-4 overflow-hidden h-full"},ue={class:"releases w-full"},ie={class:"current"},ce={key:0,class:"w-max flex flex-col gap-4"},de={class:"flex justify-between w-full items-center"},ve={class:"flex gap-4 items-center"},pe={class:"info"},me={key:0},fe={key:1,class:"m-0 text-muted text-sm"},_e=["title"],he={class:"actions"},xe={key:1,class:"h-96 flex flex-col justify-center"},ye=R(()=>s("span",{class:"italic text-sm text-muted"}," Nothing to preview ",-1)),ge=[ye],ke={class:"flex items-center gap-4 w-max"},we={key:0,class:"flex justify-end mb-2"},Ce=R(()=>s("span",{class:"material-symbols-rounded"}," done_all ",-1)),be={class:"entries overflow-y-auto flex flex-col gap-2"},De=["onClick"],$e={class:"info overflow-hidden"},Re={class:"m-0 overflow-hidden"},Me={class:"m-0 overflow-hidden text-sm text-muted"},Se=["title"],Ee=["onClick"],Ne=["onClick"],Ie=["onClick"],qe={key:1,class:"flex flex-col items-center"},je=R(()=>s("span",{class:"italic text-sm text-muted"}," No releases in this queue ",-1)),Pe=[je],F="reap.releases.seen",L="reap.releases.remember",Te=K({__name:"Releases",setup(g){const C=v(!0),o=v("unseen"),M=t=>{const e=new Date(t),u=Math.floor((Date.now()-e.getTime())/1e3/60/60/24);return u==0?"Today":u==1?"Yesterday":u<100?`${u} days ago`:u<365?`${Math.floor(u/30)} months ago`:e.toLocaleDateString()},O=Q();k(o,t=>{const e={queue:t};O.replace({query:e})});const f=j(()=>{switch(o.value){case"unseen":return x.value.filter(t=>!_.value.includes(t.url));case"out-today":return V.value;case"watching":return i.value;case"all":return x.value;case"seen":return _.value.map(t=>x.value.find(e=>e.url==t))}}),b=t=>{oe(t.artist,t.title,t.url)},r=v(null),S=v(null),D=new Date,x=v([]),E=t=>{r.value=t,se(()=>{var e;(e=S.value)==null||e.show()})},V=j(()=>x.value.filter(t=>{const e=new Date(t.releaseDate);return D.getMonth()==e.getMonth()&&D.getDate()==e.getDate()&&D.getFullYear()==e.getFullYear()})),N=t=>{i.value.find(e=>e.url==t.url)||i.value.push(t)},I=t=>{i.value=i.value.filter(e=>e.url!=t.url)},$=t=>{var u;let e=!1;t.url===((u=a.value)==null?void 0:u.url)&&(e=!0),_.value.includes(t.url)||_.value.push(t.url),e&&b(a.value)},_=v([]),i=v([]),a=v(null);return z(async()=>{var e;C.value=!0;const t=await fetch("/api/releases");x.value=await t.json(),C.value=!1,_.value=((e=localStorage.getItem(F))==null?void 0:e.split(","))??[],i.value=JSON.parse(localStorage.getItem(L)??"[]")}),k(f,t=>{a.value=t[0]??null}),k(_,t=>{localStorage.setItem(F,t.join(","))},{deep:!0}),k(i,t=>{localStorage.setItem(L,JSON.stringify(t))},{deep:!0}),(t,e)=>{var u,q;return n(),c(A,null,[C.value?(n(),c("div",re,[p(G)])):d("",!0),s("div",ne,[r.value?(n(),P(H,{key:0,id:(u=r.value.url)==null?void 0:u.replace("https://open.spotify.com/album/",""),ref_key:"addReleaseRef",ref:S,album:{id:(q=r.value.url)==null?void 0:q.replace("https://open.spotify.com/album/",""),title:r.value.title,artist:r.value.artists.join(", "),cover:r.value.cover,href:r.value.url,releaseDate:r.value.releaseDate},artist:r.value.artist,cover:r.value.cover,href:r.value.url,title:r.value.title},null,8,["id","album","artist","cover","href","title"])):d("",!0),p(ae),s("div",ue,[s("div",ie,[a.value?(n(),c("div",ce,[a.value?(n(),P(T,{key:0,class:"rounded-3xl",src:a.value.cover},null,8,["src"])):d("",!0),s("div",de,[s("div",ve,[s("span",{class:"preview material-symbols-rounded ms-fill text-5xl cursor-pointer",onClick:e[0]||(e[0]=l=>b(a.value))}," play_circle "),s("div",pe,[a.value?(n(),c("h3",me,[p(B,{text:a.value.title},null,8,["text"])])):d("",!0),a.value?(n(),c("p",fe,[p(Y,{artist:a.value.artist},null,8,["artist"])])):d("",!0),a.value?(n(),c("p",{key:2,class:"m-0 text-muted text-xs",title:a.value.releaseDate},w(M(a.value.releaseDate)),9,_e)):d("",!0)])]),s("div",he,[s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:e[1]||(e[1]=h(l=>E(a.value),["stop"])),title:"Add to playlist"}," add "),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:e[2]||(e[2]=h(l=>i.value.find(m=>m.url===a.value.url)?I(a.value):N(a.value),["stop"])),title:"Pin"},w(i.value.find(l=>l.url===a.value.url)?"playlist_remove":"push_pin"),1),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:e[3]||(e[3]=h(l=>$(a.value),["stop"])),title:"Mark as seen"}," done_all ")])])])):(n(),c("div",xe,ge))]),p(Z,{class:"queue w-full p-2 h-full flex flex-col gap-2 relative"},{default:U(()=>[s("div",ke,[s("h5",{class:y(["cursor-pointer",{selected:o.value=="unseen"}]),onClick:e[4]||(e[4]=l=>o.value="unseen")}," Unseen ",2),s("h5",{class:y(["cursor-pointer",{selected:o.value=="out-today"}]),onClick:e[5]||(e[5]=l=>o.value="out-today")}," Out Today ",2),s("h5",{class:y(["cursor-pointer",{selected:o.value=="watching"}]),onClick:e[6]||(e[6]=l=>o.value="watching")}," Pinned ",2),s("h5",{class:y(["cursor-pointer",{selected:o.value=="seen"}]),onClick:e[7]||(e[7]=l=>o.value="seen")}," Seen ",2),s("h5",{class:y(["cursor-pointer",{selected:o.value=="all"}]),onClick:e[8]||(e[8]=l=>o.value="all")}," All ",2)]),o.value==="unseen"&&f.value.length?(n(),c("div",we,[s("span",{class:"cursor-pointer text-sm text-muted hover:text-primary flex items-center gap-2",onClick:e[9]||(e[9]=l=>f.value.forEach($))},[W(" Mark all as seen "),Ce])])):d("",!0),s("div",be,[f.value.length?(n(!0),c(A,{key:0},X(f.value,l=>(n(),c("div",{class:"entry",onClick:m=>{a.value=l,b(l)}},[p(T,{class:"rounded-xl",src:l.cover},null,8,["src"]),s("div",$e,[s("p",Re,[p(B,{text:l.title},null,8,["text"])]),s("p",Me,[p(Y,{artist:l.artist},null,8,["artist"])])]),s("p",{class:"text-sm m-0 text-muted",title:l.releaseDate},w(M(l.releaseDate)),9,Se),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:h(m=>E(l),["stop"]),title:"Add to playlist"}," add ",8,Ee),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:h(m=>i.value.find(J=>J.url===l.url)?I(l):N(l),["stop"]),title:"Pin"},w(i.value.find(m=>m.url===l.url)?"playlist_remove":"push_pin"),9,Ne),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:h(m=>$(l),["stop"]),title:"Mark as seen"}," done_all ",8,Ie)],8,De))),256)):d("",!0)]),f.value.length?d("",!0):(n(),c("div",qe,Pe))]),_:1})])])],64)}}});const Fe=le(Te,[["__scopeId","data-v-28b41b95"]]);export{Fe as default};
