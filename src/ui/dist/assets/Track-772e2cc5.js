import{F as C}from"./FixedPlaylistHeader-b2f41f22.js";import{P as I}from"./song-c16c9c3c.js";import{_ as A}from"./EditSong.vue_vue_type_script_setup_true_lang-45fc013d.js";import{d as E}from"./vuedraggable.umd-4d0bf115.js";import{p as H}from"./playerInPicture-af203fdf.js";import{_ as g,o as r,c as n,a as s,t as u,d as _,e as c,g as p,C as f,x as T,F as P,p as v,bO as M,y as S,w as B,b as O,i as V,f as D,I as L,bA as j,k as F,l as J}from"./index-817bd093.js";import{_ as R}from"./ImportSpotifySong.vue_vue_type_script_setup_true_lang-1d352f43.js";import"./Dropdown-88dae077.js";import"./TrackInfo-150c1d8f.js";const q={name:"MiniPlayer",props:{src:String,artist:String,title:String,display:{type:Boolean,default:!0}},data(){return{playing:!1}},methods:{get(a){fetch(`/api/${a}`)},pause(){this.get("pause")},play(){this.get("play")},playPause(){this.$refs.player.onended||(this.$refs.player.onended=()=>{this.playing=!1}),H(this.title,this.artist,this.src),console.log(this.src)}}},z={class:"miniPlayer"},G=["src"];function K(a,t,i,h,e,o){return r(),n("div",z,[s("audio",{ref:"player",src:i.src},null,8,G),i.display?(r(),n("span",{key:0,class:"material-icons-round circle",onClick:t[0]||(t[0]=(...y)=>o.playPause&&o.playPause(...y))},u(e.playing?"pause":"play_arrow"),1)):_("",!0)])}const Q=g(q,[["render",K],["__scopeId","data-v-481752d5"]]);const U={components:{ImportSpotifySong:R,MiniPlayer:Q},name:"SpotifyPlaylistEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,cover:String,album:String,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch(`/api/playlists/${this.$route.params.id}/tracks`,{method:"DELETE",body:JSON.stringify({songId:this.id})})},onselect(){this.$refs.addSong.show()},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},W={class:"track"},X=["src"],Y={class:"trackwrapper"},Z={class:"title"},$={class:"artist"};function tt(a,t,i,h,e,o){const y=c("ImportSpotifySong"),m=c("mini-player");return r(),n(P,null,[p(y,{ref:"addSong",song:{id:i.id,title:i.title,artist:i.artist,cover:i.cover,preview:i.preview,href:i.source}},null,8,["song"]),s("div",{class:f([{selected:e.highlighted},"playlistEntry"]),onClick:t[2]||(t[2]=(...d)=>o.onselect&&o.onselect(...d)),onDblclick:t[3]||(t[3]=()=>{o.playAt(),o.onselect()}),onMouseleave:t[4]||(t[4]=d=>e.hovering=!1),onMouseover:t[5]||(t[5]=d=>e.hovering=!0)},[p(m,{artist:i.artist,class:f([{hidden:!e.hovering},"miniPlayer"]),src:i.source,title:i.title,onClick:t[0]||(t[0]=T(()=>{},["stop"]))},null,8,["artist","class","src","title"]),e.hovering?_("",!0):(r(),n("span",{key:0,class:"id",onClick:t[1]||(t[1]=(...d)=>a.edit&&a.edit(...d))},u(i.index+1),1)),s("div",W,[s("img",{src:i.cover||"/assets/img/music_placeholder.png"},null,8,X),s("div",Y,[s("span",Z,u(i.title),1),s("span",$,u(i.artist),1)]),_("",!0)])],34)],64)}const et=g(U,[["render",tt],["__scopeId","data-v-b3cfff1d"]]);const it={components:{PlaylistHeader:I,FixedPlaylistHeader:C,draggable:E,SpotifyPlaylistEntry:et,EditSong:A},data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",album:"N/A",cover:v(null),src:"",id:-1,recommendations:[]}},methods:{getId(){return M(this.$route.params.id)},onPlaylistRearrange(a){a.moved},headerVisibilityChanged(a){this.fixedHeaderHidden=a},editSong(){this.$refs.editSongPopup.show()},addToPlaylist(){},updatePlaylist(){this.getId()&&this.$route.path.includes("/track/")&&fetch(`/api/tracks/${this.getId()}`).then(async a=>{if(a.status==404){this.$router.push("/");return}const t=await a.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=v(t.cover),this.src=t.source,this.album=t.album||"N/A",this.id=t.id,document.title=`${this.title} â€¢ ${this.artist}`;const h=await(await fetch("/api/spotify/recommendations",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...h)})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},b=a=>(F("data-v-e4cc4a2d"),a=a(),J(),a),st={class:"playlist"},at=["src"],ot={class:"details"},lt=b(()=>s("hr",null,null,-1)),rt={class:"padding-20"},nt={key:0,class:"grid"},dt=b(()=>s("hr",null,null,-1)),ct={class:"playlistEntries"};function ut(a,t,i,h,e,o){const y=c("EditSong"),m=c("fixed-playlist-header"),d=c("h7"),k=c("PlaylistHeader"),w=c("spotify-playlist-entry"),x=L("observe-visibility");return r(),n("div",st,[p(y,{ref:"editSongPopup",song:{cover:e.cover,album:e.album,title:e.title,artist:e.artist,source:e.src,id:e.id},onClose:o.updatePlaylist},null,8,["song","onClose"]),p(m,{ref:"fixedHeading",class:f({hidden:e.fixedHeaderHidden}),title:`${e.artist} - ${e.title}`,onLoadPlaylist:o.loadPlaylist},null,8,["class","title","onLoadPlaylist"]),S((r(),n("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...l)=>o.editSong&&o.editSong(...l))},[s("img",{src:e.cover,class:"cover"},null,8,at),s("div",ot,[p(d,null,{default:B(()=>[O("Song")]),_:1}),s("h1",null,u(e.title),1),s("h5",null,u(e.artist),1)])])),[[x,o.headerVisibilityChanged]]),lt,s("div",rt,[s("span",{id:"loadPlaylist",class:"material-icons-outlined",onClick:t[1]||(t[1]=(...l)=>o.loadPlaylist&&o.loadPlaylist(...l))},"play_circle_filled"),S(s("span",{id:"addToPlaylist",class:"material-icons-outlined",onClick:t[2]||(t[2]=(...l)=>o.addToPlaylist&&o.addToPlaylist(...l))},"add_circle",512),[[j,!1]]),e.recommendations.length?(r(),n("div",nt,[s("h2",null,u("Recommendations based on "+e.title),1),p(k),dt,s("div",ct,[(r(!0),n(P,null,V(e.recommendations,(l,N)=>(r(),D(w,{id:l.id,album:l.album,artist:l.artists.join(", "),cover:l.cover,duration:l.duration,favourite:l.favourite,index:N,preview:l.preview,source:l.href,title:l.title,"no-add":""},null,8,["id","album","artist","cover","duration","favourite","index","preview","source","title"]))),256))])])):_("",!0)])])}const Pt=g(it,[["render",ut],["__scopeId","data-v-e4cc4a2d"]]);export{Pt as default};
