import{F as w,G as x}from"./FixedPlaylistHeader.bc91b958.js";import{d as k}from"./vuedraggable.umd.de0531ac.js";import{S as T}from"./SpotifyPlaylistEntry.57c6fc96.js";import{_ as H,H as I,s as N,o as c,c as p,g as l,k as A,m as C,a,w as u,b as V,t as d,e as r,l as O,p as j,h as E}from"./index.c9ec6f55.js";import{A as R}from"./AddSongToPlaylist.8ebaff1d.js";import"./MiniPlayer.ec59e54c.js";const U=new I("reapOne.track",22),q={components:{AddSongToPlaylist:R,FixedPlaylistHeader:w,GridHeader:x,draggable:k,SpotifyPlaylistEntry:T},data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",cover:"/assets/img/music_placeholder.png",src:"",recommendations:[]}},computed:N("player",{currentSong:s=>s.song.id}),methods:{getId(){return U.decode(this.$route.params.id)},onPlaylistRearrange(s){s.moved},headerVisibilityChanged(s){this.fixedHeaderHidden=s},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.addSongPopup.showModal=!0},updateIsPlaying(){console.log("Updating is playing",this.currentSong),this.playlist.forEach(s=>{s.playing=s.id==this.currentSong})},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch(`/api/tracks/${this.getId()}`).then(async s=>{if(s.status==404){this.$router.push("/");return}const e=await s.json();console.log(e),this.title=e.title||"N/A",this.artist=e.artist||"N/A",this.cover=e.cover||"/assets/img/music_placeholder.png",this.src=e.source,document.title=`${this.title} \u2022 ${this.artist}`;const n=await(await fetch("/api/spotify/recommendations",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...n)})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},h=s=>(j("data-v-10f86b35"),s=s(),E(),s),B={class:"playlist"},D=["src"],F={class:"details"},G=h(()=>a("hr",null,null,-1)),J={class:"padding-20"},L={class:"grid"},M=h(()=>a("hr",null,null,-1)),z={class:"playlistEntries"};function K(s,e,y,n,i,o){const m=r("AddSongToPlaylist"),_=r("fixed-playlist-header"),g=r("h7"),f=r("grid-header"),v=r("spotify-playlist-entry"),P=r("draggable"),S=O("observe-visibility");return c(),p("div",B,[l(m,{cover:i.cover,title:i.title,artist:i.artist,ref:"addSongPopup",src:i.src},null,8,["cover","title","artist","src"]),l(_,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:A({hidden:i.fixedHeaderHidden}),title:s.playlistName},null,8,["onLoadPlaylist","class","title"]),C((c(),p("div",{class:"padding-20 songdetails",onClick:e[0]||(e[0]=(...t)=>o.editPlaylist&&o.editPlaylist(...t))},[a("img",{class:"cover",src:i.cover},null,8,D),a("div",F,[l(g,null,{default:u(()=>[V("Song")]),_:1}),a("h1",null,d(i.title),1),a("h5",null,d(i.artist),1)])])),[[S,o.headerVisibilityChanged]]),G,a("div",J,[a("span",{id:"loadPlaylist",onClick:e[1]||(e[1]=(...t)=>o.loadPlaylist&&o.loadPlaylist(...t)),class:"material-icons-outlined"},"play_circle_filled"),a("span",{id:"addToPlaylist",onClick:e[2]||(e[2]=(...t)=>o.addToPlaylist&&o.addToPlaylist(...t)),class:"material-icons-outlined"},"add_circle"),a("div",L,[a("h2",null,d("Recommendations based on "+i.title),1),l(f),M,a("div",z,[l(P,{modelValue:i.recommendations,"onUpdate:modelValue":e[3]||(e[3]=t=>i.recommendations=t)},{item:u(({element:t})=>[l(v,{onRequestUpdate:o.updatePlaylist,index:i.recommendations.findIndex(b=>b.src==t.src),source:t.src,id:t.id,title:t.title,album:t.album,artist:t.artists.join(", "),preview:t.preview,cover:t.cover,favourite:t.favourite,duration:t.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}const tt=H(q,[["render",K],["__scopeId","data-v-10f86b35"]]);export{tt as default};
