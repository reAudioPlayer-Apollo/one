import{F as E}from"./FixedPlaylistHeader.8b130c57.js";import{P as I}from"./song.6a60a886.js";import{_ as H}from"./EditSong.vue_vue_type_script_setup_true_lang.42f3815c.js";import{d as T}from"./vuedraggable.umd.6e1f6451.js";import{_ as g,o as u,c as p,a,t as c,d as _,e as n,g as d,C as m,p as f,bO as A,y as v,w as P,b as V,I as M,bJ as O,k as B,l as D}from"./index.c970909a.js";import"./Dropdown.7541a2ee.js";const j={name:"MiniPlayer",props:{src:String,artist:String,title:String,display:{type:Boolean,default:!0}},data(){return{playing:!1}},methods:{get(s){fetch(`/api/${s}`)},pause(){this.get("pause")},play(){this.get("play")},playPause(){this.$refs.player.onended||(this.$refs.player.onended=()=>{this.playing=!1});const s=new CustomEvent("player.play",{detail:{title:this.title,artist:this.artist,source:this.src}});window.dispatchEvent(s)}}},J={class:"miniPlayer"},L=["src"];function R(s,t,o,y,e,i){return u(),p("div",J,[a("audio",{src:o.src,ref:"player"},null,8,L),o.display?(u(),p("span",{key:0,onClick:t[0]||(t[0]=(...h)=>i.playPause&&i.playPause(...h)),class:"material-icons-round circle"},c(e.playing?"pause":"play_arrow"),1)):_("",!0)])}const q=g(j,[["render",R],["__scopeId","data-v-6ce9ef8c"]]);const U={components:{MiniPlayer:q},name:"SpotifyPlaylistEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,cover:String,album:String,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch(`/api/playlists/${this.$route.params.id}/tracks`,{method:"DELETE",body:JSON.stringify({songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},F={class:"track"},z=["src"],G={class:"trackwrapper"},K={class:"title"},Q={class:"artist"};function W(s,t,o,y,e,i){const h=n("mini-player");return u(),p("div",{onDblclick:t[2]||(t[2]=()=>{i.playAt(),i.onselect()}),onClick:t[3]||(t[3]=(...r)=>i.onselect&&i.onselect(...r)),onMouseover:t[4]||(t[4]=r=>e.hovering=!0),onMouseleave:t[5]||(t[5]=r=>e.hovering=!1),class:m(["playlistEntry",{selected:e.highlighted}])},[d(h,{class:m(["miniPlayer",{hidden:!e.hovering}]),title:o.title,artist:o.artist,src:o.source},null,8,["class","title","artist","src"]),e.hovering?_("",!0):(u(),p("span",{key:0,onClick:t[0]||(t[0]=(...r)=>s.edit&&s.edit(...r)),class:"id"},c(o.index+1),1)),a("div",F,[a("img",{src:o.cover||"/assets/img/music_placeholder.png"},null,8,z),a("div",G,[a("span",K,c(o.title),1),a("span",Q,c(o.artist),1)]),_("",!0)]),a("span",{onClick:t[1]||(t[1]=(...r)=>i.add&&i.add(...r)),class:"material-icons-round edit",ref:"add"},"add",512)],34)}const X=g(U,[["render",W],["__scopeId","data-v-d2738e1c"]]);const Y={components:{PlaylistHeader:I,FixedPlaylistHeader:E,draggable:T,SpotifyPlaylistEntry:X,EditSong:H},data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",album:"N/A",cover:f(null),src:"",id:-1,recommendations:[]}},methods:{getId(){return A(this.$route.params.id)},onPlaylistRearrange(s){s.moved},headerVisibilityChanged(s){this.fixedHeaderHidden=s},editSong(){this.$refs.editSongPopup.show()},addToPlaylist(){},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch(`/api/tracks/${this.getId()}`).then(async s=>{if(s.status==404){this.$router.push("/");return}const t=await s.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=f(t.cover),this.src=t.source,this.album=t.album||"N/A",this.id=t.id,document.title=`${this.title} \u2022 ${this.artist}`;const y=await(await fetch("/api/spotify/recommendations",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...y)})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},b=s=>(B("data-v-43ec8edb"),s=s(),D(),s),Z={class:"playlist"},$=["src"],tt={class:"details"},et=b(()=>a("hr",null,null,-1)),it={class:"padding-20"},st={class:"grid"},at=b(()=>a("hr",null,null,-1)),lt={class:"playlistEntries"};function ot(s,t,o,y,e,i){const h=n("EditSong"),r=n("fixed-playlist-header"),S=n("h7"),k=n("PlaylistHeader"),x=n("spotify-playlist-entry"),w=n("draggable"),C=M("observe-visibility");return u(),p("div",Z,[d(h,{ref:"editSongPopup",song:{cover:e.cover,album:e.album,title:e.title,artist:e.artist,source:e.src,id:e.id},onClose:i.updatePlaylist},null,8,["song","onClose"]),d(r,{ref:"fixedHeading",class:m({hidden:e.fixedHeaderHidden}),title:`${e.artist} - ${e.title}`,onLoadPlaylist:i.loadPlaylist},null,8,["class","title","onLoadPlaylist"]),v((u(),p("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...l)=>i.editSong&&i.editSong(...l))},[a("img",{src:e.cover,class:"cover"},null,8,$),a("div",tt,[d(S,null,{default:P(()=>[V("Song")]),_:1}),a("h1",null,c(e.title),1),a("h5",null,c(e.artist),1)])])),[[C,i.headerVisibilityChanged]]),et,a("div",it,[a("span",{id:"loadPlaylist",class:"material-icons-outlined",onClick:t[1]||(t[1]=(...l)=>i.loadPlaylist&&i.loadPlaylist(...l))},"play_circle_filled"),v(a("span",{id:"addToPlaylist",class:"material-icons-outlined",onClick:t[2]||(t[2]=(...l)=>i.addToPlaylist&&i.addToPlaylist(...l))},"add_circle",512),[[O,!1]]),a("div",st,[a("h2",null,c("Recommendations based on "+e.title),1),d(k),at,a("div",lt,[d(w,{modelValue:e.recommendations,"onUpdate:modelValue":t[3]||(t[3]=l=>e.recommendations=l)},{item:P(({element:l})=>[d(x,{id:l.id,album:l.album,artist:l.artists.join(", "),cover:l.cover,duration:l.duration,favourite:l.favourite,index:e.recommendations.findIndex(N=>N.source==l.source),preview:l.preview,source:l.source,title:l.title,onRequestUpdate:i.updatePlaylist},null,8,["id","album","artist","cover","duration","favourite","index","preview","source","title","onRequestUpdate"])]),_:1},8,["modelValue"])])])])])}const ht=g(Y,[["render",ot],["__scopeId","data-v-43ec8edb"]]);export{ht as default};
