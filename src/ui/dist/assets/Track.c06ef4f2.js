import{F as M,G as F}from"./FixedPlaylistHeader.72c743db.js";import{F as H}from"./FindSources.ffe3bb4a.js";import{_ as C,j as S,e as a,o as v,c as y,g as c,w as g,a as s,x as p,z as f,q as O,k as P,l as x,s as b,t as m,d as w,bD as U,b as D,v as L}from"./index.12f03f32.js";import{d as J}from"./vuedraggable.umd.6a1c2ae3.js";import{M as q}from"./MiniPlayer.833aaa56.js";import{A as z}from"./AddSongToPlaylist.fdee1322.js";const B={name:"EditSong",components:{FindSources:H},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number},mounted(){this.$refs.upSong.addEventListener("change",()=>{const i=new FormData;var t=this.$refs.upSong.files[0],d=t.slice(0,t.size,t.type),h=new File([d],this.id+".mp3",{type:t.type});i.append("file",h),fetch("/api/config/tracks",{method:"POST",body:i}).then(e=>e.text()).then(e=>this.dSource=e)}),this.$refs.upCover.addEventListener("change",()=>{const i=new FormData;var t=this.$refs.upCover.files[0],d=t.slice(0,t.size,t.type);const h=t.name.split(".").pop();var e=new File([d],this.id+`.${h}`,{type:t.type});i.append("file",e),fetch("/api/config/images",{method:"POST",body:i}).then(o=>o.text()).then(o=>this.dCover=o)})},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{parseCover:S,opencontextmenu(i){this.$refs.findSourcesEdit.show(i)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/tracks/${this.id}`,{method:"PUT",body:JSON.stringify({source:this.dSource,title:this.dTitle,artist:this.dArtist,album:this.dAlbum,cover:this.dCover})}).then(i=>{console.log(i),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(i=>i.json()).then(i=>{console.log(i),this.dTitle=i.title,this.dAlbum=i.album,this.dArtist=i.artists.join(", "),this.dCover=i.cover,this.dSource=i.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},u=i=>(P("data-v-53f22ab0"),i=i(),x(),i),R={class:"wrapper"},j={class:"header"},G=u(()=>s("h3",null,"Edit song",-1)),K=u(()=>s("span",{class:"material-icons-round"}," close ",-1)),Q=[K],W=u(()=>s("h4",null,"Source",-1)),X={class:"content"},Y=u(()=>s("span",{class:"material-symbols-rounded"},"file_upload",-1)),Z=[Y],$={type:"file",ref:"upSong",style:{display:"none"},accept:"audio/mp3"},tt=u(()=>s("h4",null,"Title",-1)),et={class:"content"},st=u(()=>s("h4",null,"Album",-1)),it={class:"content"},ot=u(()=>s("h4",null,"Artist",-1)),lt={class:"content"},nt=u(()=>s("h4",null,"Cover",-1)),dt={class:"content"},rt=u(()=>s("span",{class:"material-symbols-rounded"},"file_upload",-1)),at=[rt],ct={type:"file",ref:"upCover",style:{display:"none"},accept:"image/*"},ut=["src"],ht={class:"confirm"};function pt(i,t,d,h,e,o){const _=a("FindSources"),r=a("vue-final-modal");return v(),y("div",null,[c(r,{onContextmenu:t[11]||(t[11]=O(()=>{},["stop"])),onClick:o.hideFindSourcesCtx,modelValue:e.showModal,"onUpdate:modelValue":t[12]||(t[12]=l=>e.showModal=l),classes:"modal-container","content-class":"modal-content"},{default:g(()=>[s("div",R,[s("div",j,[G,s("button",{class:"modal-close",onClick:t[0]||(t[0]=l=>e.showModal=!1)},Q)]),W,c(_,{ref:"findSourcesEdit",src:e.dSource,title:e.dTitle,artist:e.dArtist},{default:g(()=>[s("div",X,[s("button",{onClick:t[1]||(t[1]=()=>i.$refs.upSong.click())},Z),s("input",$,null,512),p(s("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>e.dSource=l),type:"text",ref:"source"},null,512),[[f,e.dSource]]),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[3]||(t[3]=(...l)=>o.opencontextmenu&&o.opencontextmenu(...l))},"more_vert",512)])]),_:1},8,["src","title","artist"]),tt,s("div",et,[p(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.dTitle=l),type:"text"},null,512),[[f,e.dTitle]])]),st,s("div",it,[p(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.dAlbum=l),type:"text",ref:"album"},null,512),[[f,e.dAlbum]])]),ot,s("div",lt,[p(s("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.dArtist=l),type:"text"},null,512),[[f,e.dArtist]])]),nt,s("div",dt,[s("button",{onClick:t[7]||(t[7]=()=>i.$refs.upCover.click())},at),s("input",ct,null,512),p(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[8]||(t[8]=l=>e.dCover=l),ref:"cover"},null,512),[[f,e.dCover]]),s("img",{onClick:t[9]||(t[9]=(...l)=>o.openInNewTab&&o.openInNewTab(...l)),class:"addSong cover",src:o.parseCover(e.dCover)},null,8,ut)]),s("div",ht,[s("button",{onClick:t[10]||(t[10]=(...l)=>o.add&&o.add(...l)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}const mt=C(B,[["render",pt],["__scopeId","data-v-53f22ab0"]]);const _t={components:{MiniPlayer:q},name:"SpotifyPlaylistEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,cover:String,album:String,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch(`/api/playlists/${this.$route.params.id}/tracks`,{method:"DELETE",body:JSON.stringify({songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},ft={class:"track"},vt=["src"],yt={class:"trackwrapper"},gt={class:"title"},St={class:"artist"};function bt(i,t,d,h,e,o){const _=a("mini-player");return v(),y("div",{onDblclick:t[2]||(t[2]=()=>{o.playAt(),o.onselect()}),onClick:t[3]||(t[3]=(...r)=>o.onselect&&o.onselect(...r)),onMouseover:t[4]||(t[4]=r=>e.hovering=!0),onMouseleave:t[5]||(t[5]=r=>e.hovering=!1),class:b(["playlistEntry",{selected:e.highlighted}])},[c(_,{class:b(["miniPlayer",{hidden:!e.hovering}]),title:d.title,artist:d.artist,src:d.source},null,8,["class","title","artist","src"]),e.hovering?w("",!0):(v(),y("span",{key:0,onClick:t[0]||(t[0]=(...r)=>i.edit&&i.edit(...r)),class:"id"},m(d.index+1),1)),s("div",ft,[s("img",{src:d.cover||"/assets/img/music_placeholder.png"},null,8,vt),s("div",yt,[s("span",gt,m(d.title),1),s("span",St,m(d.artist),1)]),w("",!0)]),s("span",{onClick:t[1]||(t[1]=(...r)=>o.add&&o.add(...r)),class:"material-icons-round edit",ref:"add"},"add",512)],34)}const Ct=C(_t,[["render",bt],["__scopeId","data-v-d2738e1c"]]);const wt={components:{AddSongToPlaylist:z,FixedPlaylistHeader:M,GridHeader:F,draggable:J,SpotifyPlaylistEntry:Ct,EditSong:mt},data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",album:"N/A",cover:S(null),src:"",id:-1,recommendations:[]}},methods:{getId(){return U(this.$route.params.id)},onPlaylistRearrange(i){i.moved},headerVisibilityChanged(i){this.fixedHeaderHidden=i},editSong(){this.$refs.editSongPopup.showModal=!0},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch(`/api/tracks/${this.getId()}`).then(async i=>{if(i.status==404){this.$router.push("/");return}const t=await i.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=S(t.cover),this.src=t.source,this.album=t.album||"N/A",this.id=t.id,document.title=`${this.title} \u2022 ${this.artist}`;const h=await(await fetch("/api/spotify/recommendations",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...h)})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()},currentSong(){this.updateIsPlaying()}}},k=i=>(P("data-v-8fc42bfd"),i=i(),x(),i),Pt={class:"playlist"},xt=["src"],kt={class:"details"},Tt=k(()=>s("hr",null,null,-1)),At={class:"padding-20"},Nt={class:"grid"},Et=k(()=>s("hr",null,null,-1)),It={class:"playlistEntries"};function Vt(i,t,d,h,e,o){const _=a("AddSongToPlaylist"),r=a("EditSong"),l=a("fixed-playlist-header"),T=a("h7"),A=a("grid-header"),N=a("spotify-playlist-entry"),E=a("draggable"),I=L("observe-visibility");return v(),y("div",Pt,[c(_,{cover:e.cover,title:e.title,artist:e.artist,ref:"addSongPopup",href:e.src,exists:""},null,8,["cover","title","artist","href"]),c(r,{onClose:o.updatePlaylist,ref:"editSongPopup",cover:e.cover,id:e.id,title:e.title,album:e.album,artist:e.artist,source:e.src},null,8,["onClose","cover","id","title","album","artist","source"]),c(l,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:b({hidden:e.fixedHeaderHidden}),title:`${e.artist} - ${e.title}`},null,8,["onLoadPlaylist","class","title"]),p((v(),y("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...n)=>o.editSong&&o.editSong(...n))},[s("img",{class:"cover",src:e.cover},null,8,xt),s("div",kt,[c(T,null,{default:g(()=>[D("Song")]),_:1}),s("h1",null,m(e.title),1),s("h5",null,m(e.artist),1)])])),[[I,o.headerVisibilityChanged]]),Tt,s("div",At,[s("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...n)=>o.loadPlaylist&&o.loadPlaylist(...n)),class:"material-icons-outlined"},"play_circle_filled"),s("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...n)=>o.addToPlaylist&&o.addToPlaylist(...n)),class:"material-icons-outlined"},"add_circle"),s("div",Nt,[s("h2",null,m("Recommendations based on "+e.title),1),c(A),Et,s("div",It,[c(E,{modelValue:e.recommendations,"onUpdate:modelValue":t[3]||(t[3]=n=>e.recommendations=n)},{item:g(({element:n})=>[c(N,{onRequestUpdate:o.updatePlaylist,index:e.recommendations.findIndex(V=>V.src==n.src),source:n.src,id:n.id,title:n.title,album:n.album,artist:n.artists.join(", "),preview:n.preview,cover:n.cover,favourite:n.favourite,duration:n.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}const Lt=C(wt,[["render",Vt],["__scopeId","data-v-8fc42bfd"]]);export{Lt as default};
