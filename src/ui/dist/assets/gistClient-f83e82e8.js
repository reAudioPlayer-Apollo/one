import{cm as w,cr as d}from"./index-a3be8f1c.js";const r=async(t=null)=>{const a=await w(),n=t??a.github.githubPat;if(!n)throw new Error("No GitHub PAT found");return{Authorization:"Bearer "+n}},y=(t,a="reAudioPlayer One",n="Fully managed with reAudioPlayer One",e=!1)=>{const s={public:e,description:n,files:{[`_${a}.md`]:{content:`# reAudioPlayer One

This gist was created with reAudioPlayer One

https://reaudioplayer.github.io/one/`}}};for(const[i,o]of Object.entries(t))s.files[i]={content:JSON.stringify(o,null,4)};return JSON.stringify(s)},u=async()=>(await w()).github.gistId,c=async()=>{const t=await r(),a=await fetch(`https://api.github.com/gists/${await u()}`,{headers:t});try{return await a.json()}catch{return null}},h=async(t,a="one.lib.json")=>{const n=await r(),e=await fetch(`https://api.github.com/gists/${await u()}`,{method:"PATCH",headers:n,body:y(t,a)});if(!e.ok)return d.addError("Failed to update gist","",3e3),null;const s=await e.json();return d.addSuccess("Gist updated","",3e3),s},g=async(t,a="reAudioPlayer One",n=!1,e="Fully managed with reAudioPlayer One")=>{const s=await r(),i=await fetch("https://api.github.com/gists",{method:"POST",headers:s,body:y(t,a,e,n)});if(console.log(i),!i.ok)return d.addError("Failed to create gist","",3e3),null;const o=await i.json();return!n&&o.id&&await fetch("/api/config",{method:"PUT",body:JSON.stringify({github:{gistId:o.id}})}),d.addSuccess("Gist created","",3e3),o},p={connected:async()=>!!await u(),get:c,getContent:async(t="my.one.collection")=>{var e,s;const n=(s=(e=(await c()).files)==null?void 0:e[t])==null?void 0:s.content;return n?JSON.parse(n):[]},saveOrUpdate:async(t,a="reAudioPlayer One",n=!1)=>{const e=await c();return e!=null&&e.files?await h(t,a):await g(t,a,n)},save:g,update:h,delete:async()=>{const t=await r();return await(await fetch(`https://api.github.com/gists/${await u()}`,{method:"DELETE",headers:t})).json()},search:async(t=null)=>{const a=await r(t),e=await(await fetch("https://api.github.com/gists",{headers:a})).json(),s="my.one.collection",i=e==null?void 0:e.find(o=>{var l;return(l=o.files)==null?void 0:l[s]});return i==null?void 0:i.id},gistUrl:async()=>{const t=await c();return t==null?void 0:t.html_url}};export{p as G};
