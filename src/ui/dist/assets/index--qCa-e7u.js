import{e as C,aF as x,l as h,a7 as D,v as q,o as a,c as l,a as o,F as m,h as N,i as k,w as _,t as f,C as p,g as c,E as B,d as u,u as v,L as F,K as $,q as L,I as O,N as V,_ as j}from"./index-5KRJtp2M.js";const E={class:"downloader py-2 pr-2 grid gap-4 grid-cols-2 items-start"},I={class:"downloads"},M={class:"main"},S={class:"m-0 mb-4"},T={class:"status"},z={class:"flex flex-col"},A={key:0,class:"info"},K=["href"],P={class:"wrap-progress"},Y={key:0,class:"material-symbols-rounded downloading"},G=["onClick"],H=["onClick"],J=["onClick"],Q={key:1,class:"col-span-2 flex flex-row justify-center items-center"},R={class:"new-download"},U=C({__name:"index",setup(W){const t=x(),g=s=>{V.addYesNo("Are you sure you want to redownload this song?",void 0,void 0,()=>{console.log("[downloader] reDownload",s),t.downloadFromDb(s)})},i={title:"",artist:"",album:{name:"",href:"",id:""},cover:"",source:"",href:""},w=h(),r=h([{name:"source",type:"text",accept:"audio/mp3",required:!0,onChange:async s=>{const n=await D(s);r.value.find(e=>e.name==="title").value=n.title,r.value.find(e=>e.name==="artist").value=n.artist,r.value.find(e=>e.name==="album").value=n.album,r.value.find(e=>e.name==="cover").value=n.cover,r.value.find(e=>e.name==="source").value=n.source},value:i.source},{name:"title",type:"text",icon:"title",required:!0,value:i.title},{name:"artist",type:"text",icon:"person",required:!0,value:i.artist},{name:"album",type:"text",icon:"album",value:i.album.name},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:i.cover}]),b=async()=>{const s=w.value.toObject();s.id=new Date().getTime(),console.log("[downloader] requestDownload",s),t.downloadOther(s)};return q(()=>{var s,n;t.prefill!=null&&(r.value=r.value.map(e=>{var d;return e.value=((d=t.prefill)==null?void 0:d[e.name])??e.value,e}),(n=(s=r.value.find(e=>e.name==="source"))==null?void 0:s.onChange)==null||n.call(s,t.prefill.source))}),(s,n)=>(a(),l("div",E,[o("div",I,[(a(!0),l(m,null,N(v(t).states,e=>{var d;return a(),l(m,{key:e.song.id},[e.internal?u("",!0):(a(),k(p,{key:0,class:$([["song",{downloading:((d=v(t).states[e.song.id??""])==null?void 0:d.status)=="downloading"}],"p-4 card items-center"])},{default:_(()=>[e.status!=="pending"?(a(),l(m,{key:0},[o("main",M,[o("h2",S,f(e.song.title),1),o("div",T,[e.song?(a(),k(p,{key:0,class:"info p-4"},{default:_(()=>[c(B,{src:e.song.cover,class:"cover"},null,8,["src"]),o("div",z,[o("span",null,f(e.song.album.name),1),o("span",null,f(e.song.artist),1)])]),_:2},1024)):u("",!0),e.status==="error"?(a(),l(m,{key:1},[n[1]||(n[1]=o("div",{class:"error"},[o("span",null,"This song could not be downloaded:"),o("ul",{class:"block list-disc ml-8"},[o("li",null," verify that the source link is working "),o("li",null,"try again later")])],-1)),e.song?(a(),l("div",A,[n[0]||(n[0]=o("span",{class:"material-symbols-rounded"},"link",-1)),o("a",{href:e.song.source,target:"_blank",rel:"noopener noreferrer"},f(e.song.source),9,K)])):u("",!0)],64)):u("",!0)])]),o("aside",null,[o("div",P,[e.status=="downloading"?(a(),l("span",Y," south ")):e.status=="finished"?(a(),l("span",{key:1,class:"material-symbols-rounded cursor-pointer finished",onClick:y=>v(t).download(e.song.id)}," download_for_offline ",8,G)):e.status=="downloaded"&&e.song.id?(a(),l("span",{key:2,class:"material-symbols-rounded cursor-pointer downloaded",onClick:y=>g(e.song.id)}," download_done ",8,H)):e.status=="error"&&e.song.id?(a(),l("span",{key:3,class:"material-symbols-rounded cursor-pointer error",onClick:y=>g(e.song.id)}," error ",8,J)):u("",!0)])])],64)):(a(),l("div",Q,[c(F)]))]),_:2},1032,["class"]))],64)}),128))]),o("div",R,[c(p,{class:"custom p-4 flex flex-col"},{default:_(()=>[c(L,{ref_key:"form",ref:w,options:r.value},null,8,["options"]),c(O,{icon:"download_for_offline",label:"Download",class:"w-full mt-8",onClick:b})]),_:1})])]))}}),Z=j(U,[["__scopeId","data-v-cdd93e28"]]);export{Z as default};
