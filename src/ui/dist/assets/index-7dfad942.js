import{_ as I,f as E,o,c as _,g as p,w as y,l as te,m as se,a as s,C as K,H as V,i as g,t as b,d as w,e as M,n as f,D as j,E as R,r as re,L as le,h as T,F as D,j as ie,B as L,q as ce,J as ue,M as G,K as X,N as C,O as P,b as de,Q as Z,A as _e,R as ve}from"./index-6756a2b3.js";import{F}from"./FullShelf-f3741ded.js";import{E as pe}from"./Error-ac78d0f5.js";import{P as me}from"./Playlist-67d3ec4d.js";import{P as ee}from"./PlaylistItem-680ea694.js";import{p as fe}from"./playerInPicture-af203fdf.js";const he={name:"CollectionHeader",props:{href:String}},q=u=>(te("data-v-a26d5560"),u=u(),se(),u),ye={class:"wrapper"},ge=q(()=>s("div",{class:"collection"},"Playlists",-1)),xe=q(()=>s("div",{class:"collection"},"Releases",-1)),we=q(()=>s("div",{class:"collection"},"Artists",-1)),ke=q(()=>s("div",{class:"collection"},"Albums",-1));function $e(u,r,e,d,m,n){const c=E("router-link");return o(),_("div",ye,[p(c,{class:"link",to:"/collection/playlists"},{default:y(()=>[ge]),_:1}),p(c,{class:"link",to:"/collection/releases"},{default:y(()=>[xe]),_:1}),p(c,{class:"link",to:"/collection/artists"},{default:y(()=>[we]),_:1}),p(c,{class:"link",to:"/collection/albums"},{default:y(()=>[ke]),_:1})])}const Ce=I(he,[["render",$e],["__scopeId","data-v-a26d5560"]]),be={components:{Card:K,Cover:V},name:"CardWithImageAndText",props:{cover:String,title:String,description:String,playlistType:{type:String,default:null},imageType:{type:String,default:"playlist"}}};const Se={class:"item"},Ie={class:"title"},Ae={key:0,class:"material-symbols-rounded"},Te=["title"],De=["title","innerHTML"];function Me(u,r,e,d,m,n){const c=E("Cover"),t=E("Card");return o(),g(t,{class:"wrapper drop-shadow-md","with-hover":""},{default:y(()=>[s("div",Se,[p(c,{src:e.cover,type:e.imageType,name:e.title},null,8,["src","type","name"]),s("div",null,[s("div",Ie,[[null,"classic"].includes(e.playlistType)?w("",!0):(o(),_("span",Ae,b(e.playlistType=="smart"?"neurology":"bolt"),1)),s("h4",{title:e.title},b(e.title),9,Te)]),s("p",{class:"text-muted text-xs hideIfMobile",title:e.description,innerHTML:e.description},null,8,De)])])]),_:1})}const ae=I(be,[["render",Me],["__scopeId","data-v-3e6883c1"]]),B=M({__name:"FetchLoader",props:{response:{type:Promise,required:!0},error:{type:Function,default:u=>`Failed to fetch (${u.status})`}},setup(u){const r=u,e=f(!1),d=f(""),m=async()=>{if(!r.response)return;e.value=!0,d.value="";const n=await r.response;e.value=!1,n.ok||(d.value=r.error(n))};return j(m),R(()=>r.response,m),(n,c)=>e.value?(o(),g(le,{key:0})):d.value?(o(),g(pe,{key:1,msg:d.value},null,8,["msg"])):u.response?re(n.$slots,"default",{key:2}):w("",!0)}}),Pe={class:"albums"},Re=M({__name:"Albums",setup(u){const r=f([]),e=f(null);return j(async()=>{e.value=fetch("/api/albums");const m=await(await e.value).json();r.value=m.sort((n,c)=>n.name.localeCompare(c.name))}),(d,m)=>(o(),g(B,{response:e.value},{default:y(()=>[s("div",Pe,[p(F,{heading:"In your library"},{default:y(()=>[(o(!0),_(D,null,T(r.value,n=>(o(),g(ae,{title:n.name,description:n.artists.join(", "),cover:n.image,onClick:c=>d.$router.push(n.href),imageType:"album"},null,8,["title","description","cover","onClick"]))),256))]),_:1})])]),_:1},8,["response"]))}});const Ee=I(Re,[["__scopeId","data-v-6f9bc52c"]]),Fe={class:"playlists"},je=M({__name:"Playlists",setup(u){const r=ie(),e=L(()=>r.playlists),d=f([]),m=f(null);return j(async()=>{m.value=fetch("/api/spotify/playlists");const c=await(await m.value).json();d.value=c}),(n,c)=>(o(),_("div",Fe,[e.value.length?(o(),g(F,{key:0,heading:"Playlists"},{default:y(()=>[(o(!0),_(D,null,T(e.value,(t,h)=>(o(),g(me,{key:h,cover:t.cover,href:t==null?void 0:t.href,name:t.name,type:t.type,id:t.id},null,8,["cover","href","name","type","id"]))),128))]),_:1})):w("",!0),p(B,{response:m.value,error:t=>`Failed to fetch Spotify playlists (${t.status})`},{default:y(()=>[d.value.length?(o(),g(F,{key:0,heading:"Import From Spotify"},{default:y(()=>[p(ee,{title:"Liked",description:"your liked tracks",spotify:!0,id:"liked"}),(o(!0),_(D,null,T(d.value,(t,h)=>(o(),g(ee,{key:h,cover:t.cover,description:t.description,title:t.name,id:t.id,spotify:!0,href:`https://open.spotify.com/playlist/${t.id}`},null,8,["cover","description","title","id","href"]))),128))]),_:1})):w("",!0)]),_:1},8,["response","error"])]))}}),Q=u=>(te("data-v-a22e8b2e"),u=u(),se(),u),Ne={key:0,class:"fill-page"},Le={key:1,class:"p-4 overflow-hidden h-full"},Be={class:"releases w-full"},qe={class:"current"},He={key:0,class:"w-max flex flex-col gap-4"},Oe={class:"flex justify-between w-full items-center"},Ye={class:"flex gap-4 items-center"},Je={class:"info"},Ve={key:0},Ke={key:1,class:"m-0 text-muted text-sm"},Qe=["title"],We={class:"actions"},ze={key:1,class:"h-96 flex flex-col justify-center"},Ue=Q(()=>s("span",{class:"italic text-sm text-muted"}," Nothing to preview ",-1)),Ge=[Ue],Xe={class:"flex items-center gap-4 w-max"},Ze={key:0,class:"flex justify-end mb-2"},et=Q(()=>s("span",{class:"material-symbols-rounded"}," done_all ",-1)),tt={class:"entries overflow-y-auto flex flex-col gap-2"},st=["onClick"],lt={class:"info overflow-hidden"},at={class:"m-0 overflow-hidden"},ot={class:"m-0 overflow-hidden text-sm text-muted"},nt=["title"],rt=["onClick"],it=["onClick"],ct=["onClick"],ut={key:1,class:"flex flex-col items-center"},dt=Q(()=>s("span",{class:"italic text-sm text-muted"}," No releases in this queue ",-1)),_t=[dt],Y="reap.releases.seen",J="reap.releases.remember",vt=M({__name:"Releases",setup(u){const r=f(!0),e=f("unseen"),d=a=>{const l=new Date(a),x=Math.floor((Date.now()-l.getTime())/1e3/60/60/24);return x==0?"Today":x==1?"Yesterday":x<100?`${x} days ago`:x<365?`${Math.floor(x/30)} months ago`:l.toLocaleDateString()},m=ce();R(e,a=>{const l={queue:a};m.replace({query:l})});const n=L(()=>{switch(e.value){case"unseen":return A.value.filter(a=>!$.value.includes(a.url));case"out-today":return oe.value;case"watching":return k.value;case"all":return A.value;case"seen":return $.value.map(a=>A.value.find(l=>l.url==a)).filter(a=>a)}}),c=a=>{fe(a.artist,a.title,a.url)},t=f(null),h=f(null),H=new Date,A=f([]),W=a=>{t.value=a,Z(()=>{var l;(l=h.value)==null||l.show()})},oe=L(()=>A.value.filter(a=>{const l=new Date(a.releaseDate);return H.getMonth()==l.getMonth()&&H.getDate()==l.getDate()&&H.getFullYear()==l.getFullYear()})),z=a=>{k.value.find(l=>l.url==a.url)||k.value.push(a)},U=a=>{k.value=k.value.filter(l=>l.url!=a.url)},O=a=>{var x;let l=!1;a.url===((x=v.value)==null?void 0:x.url)&&(l=!0),$.value.includes(a.url)||$.value.push(a.url),l&&Z(()=>c(v.value))},$=f([]),k=f([]),v=f(null);return j(async()=>{var l;r.value=!0;const a=await fetch("/api/releases");A.value=await a.json(),r.value=!1,$.value=((l=localStorage.getItem(Y))==null?void 0:l.split(","))??[],$.value=$.value.filter(x=>A.value.find(N=>N.url==x)),k.value=JSON.parse(localStorage.getItem(J)??"[]")}),R(n,a=>{v.value=a[0]??null}),R($,a=>{a.length?localStorage.setItem(Y,a.join(",")):localStorage.removeItem(Y)},{deep:!0}),R(k,a=>{a.length?localStorage.setItem(J,JSON.stringify(a)):localStorage.removeItem(J)},{deep:!0}),(a,l)=>{var x,N;return r.value?(o(),_("div",Ne,[p(le)])):(o(),_("div",Le,[t.value?(o(),g(ue,{key:0,id:(x=t.value.url)==null?void 0:x.replace("https://open.spotify.com/album/",""),ref_key:"addReleaseRef",ref:h,album:{id:(N=t.value.url)==null?void 0:N.replace("https://open.spotify.com/album/",""),title:t.value.title,artist:t.value.artists.join(", "),cover:t.value.cover,href:t.value.url,releaseDate:t.value.releaseDate},artist:t.value.artist,cover:t.value.cover,href:t.value.url,title:t.value.title},null,8,["id","album","artist","cover","href","title"])):w("",!0),s("div",Be,[s("div",qe,[v.value?(o(),_("div",He,[v.value?(o(),g(V,{key:0,class:"rounded-3xl",src:v.value.cover},null,8,["src"])):w("",!0),s("div",Oe,[s("div",Ye,[s("span",{class:"preview material-symbols-rounded ms-fill text-5xl cursor-pointer",onClick:l[0]||(l[0]=i=>c(v.value))}," play_circle "),s("div",Je,[v.value?(o(),_("h3",Ve,[p(G,{text:v.value.title},null,8,["text"])])):w("",!0),v.value?(o(),_("p",Ke,[p(X,{artist:v.value.artist},null,8,["artist"])])):w("",!0),v.value?(o(),_("p",{key:2,class:"m-0 text-muted text-xs",title:v.value.releaseDate},b(d(v.value.releaseDate)),9,Qe)):w("",!0)])]),s("div",We,[s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:l[1]||(l[1]=C(i=>W(v.value),["stop"])),title:"Add to playlist"}," add "),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:l[2]||(l[2]=C(i=>k.value.find(S=>S.url===v.value.url)?U(v.value):z(v.value),["stop"])),title:"Pin"},b(k.value.find(i=>i.url===v.value.url)?"playlist_remove":"push_pin"),1),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:l[3]||(l[3]=C(i=>O(v.value),["stop"])),title:"Mark as seen"}," done_all ")])])])):(o(),_("div",ze,Ge))]),p(K,{class:"queue w-full p-2 h-full flex flex-col gap-2 relative"},{default:y(()=>[s("div",Xe,[s("h5",{class:P(["cursor-pointer",{selected:e.value=="unseen"}]),onClick:l[4]||(l[4]=i=>e.value="unseen")}," Unseen ",2),s("h5",{class:P(["cursor-pointer",{selected:e.value=="out-today"}]),onClick:l[5]||(l[5]=i=>e.value="out-today")}," Out Today ",2),s("h5",{class:P(["cursor-pointer",{selected:e.value=="watching"}]),onClick:l[6]||(l[6]=i=>e.value="watching")}," Pinned ",2),s("h5",{class:P(["cursor-pointer",{selected:e.value=="seen"}]),onClick:l[7]||(l[7]=i=>e.value="seen")}," Seen ",2),s("h5",{class:P(["cursor-pointer",{selected:e.value=="all"}]),onClick:l[8]||(l[8]=i=>e.value="all")}," All ",2)]),e.value==="unseen"&&n.value.length?(o(),_("div",Ze,[s("span",{class:"cursor-pointer text-sm text-muted hover:text-primary flex items-center gap-2",onClick:l[9]||(l[9]=i=>n.value.forEach(O))},[de(" Mark all as seen "),et])])):w("",!0),s("div",tt,[n.value.length?(o(!0),_(D,{key:0},T(n.value,i=>(o(),_("div",{class:"entry",onClick:S=>{v.value=i,c(i)}},[p(V,{class:"rounded-xl",src:i.cover},null,8,["src"]),s("div",lt,[s("p",at,[p(G,{text:i.title},null,8,["text"])]),s("p",ot,[p(X,{artist:i.artist},null,8,["artist"])])]),s("p",{class:"text-sm m-0 text-muted",title:i.releaseDate},b(d(i.releaseDate)),9,nt),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:C(S=>W(i),["stop"]),title:"Add to playlist"}," add ",8,rt),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:C(S=>k.value.find(ne=>ne.url===i.url)?U(i):z(i),["stop"]),title:"Pin"},b(k.value.find(S=>S.url===i.url)?"playlist_remove":"push_pin"),9,it),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:C(S=>O(i),["stop"]),title:"Mark as seen"}," done_all ",8,ct)],8,st))),256)):w("",!0)]),n.value.length?w("",!0):(o(),_("div",ut,_t))]),_:1})])]))}}});const pt=I(vt,[["__scopeId","data-v-a22e8b2e"]]);const mt={components:{Card:K},name:"ArtistItem",methods:{follow(u){u.stopPropagation();const r=this.following?"DELETE":"POST";fetch("/api/spotify/following",{method:r,body:JSON.stringify({artistId:this.id})}).then(e=>{e.status==200&&(this.following=!this.following)})}},data(){return{following:this.initiallyFollowing}},props:{cover:String,name:String,description:String,id:String,initiallyFollowing:Boolean,showFollowButton:Boolean}},ft={class:"item"},ht=["src"],yt={class:"flex gap-2 items-center justify-between"},gt=["innerHTML"];function xt(u,r,e,d,m,n){const c=E("add-artist-to-playlist"),t=E("Card");return o(),g(t,{class:"wrapper","with-hover":"",onClick:r[1]||(r[1]=C(h=>u.$router.push("/artist/"+e.name),["stop"]))},{default:y(()=>[p(c,{ref:"import",artist:{id:e.id,name:e.name,href:`https://open.spotify.com/artist/${e.id}`,image:e.cover}},null,8,["artist"]),s("div",ft,[s("img",{src:e.cover},null,8,ht),s("div",yt,[s("div",null,[s("h4",null,b(e.name),1),s("p",{innerHTML:e.description},null,8,gt)]),e.showFollowButton?(o(),_("span",{key:0,class:"material-symbols-rounded text-muted text-md",onClick:r[0]||(r[0]=C((...h)=>n.follow&&n.follow(...h),["stop"]))},b(m.following?"person_check":"person_add"),1)):w("",!0)])])]),_:1})}const wt=I(mt,[["render",xt],["__scopeId","data-v-8fde1a37"]]),kt={class:"artists"},$t=M({__name:"Artists",setup(u){const r=f([]),e=f([]),d=f(null),m=f(null);return j(async()=>{d.value=fetch("/api/artists");let n=await d.value,c=await n.json();e.value=c.sort((t,h)=>t.name.localeCompare(h.name)),m.value=fetch("/api/spotify/artists"),n=await m.value,c=await n.json(),r.value=c.sort((t,h)=>t.name.localeCompare(h.name))}),(n,c)=>(o(),_("div",kt,[p(B,{response:d.value},{default:y(()=>[p(F,{heading:"In your library"},{default:y(()=>[(o(!0),_(D,null,T(e.value,t=>(o(),g(ae,{title:t.name,cover:t.image,onClick:h=>n.$router.push(`/artist/${t.name}`),imageType:"artist"},null,8,["title","cover","onClick"]))),256))]),_:1})]),_:1},8,["response"]),p(B,{response:m.value},{default:y(()=>[p(F,{heading:"Following on Spotify"},{default:y(()=>[(o(!0),_(D,null,T(r.value,(t,h)=>(o(),g(wt,{id:t.id,key:h,cover:t.cover,description:t.description,name:t.name,"initially-following":"","show-follow-button":""},null,8,["id","cover","description","name"]))),128))]),_:1})]),_:1},8,["response"])]))}});const Ct=I($t,[["__scopeId","data-v-4bad4a22"]]),bt={class:"parent"},St={class:"collection"},It=M({__name:"index",setup(u){const r=_e(),e=L(()=>{switch(r.path.split("/")[2]){case"albums":return Ee;case"playlists":return je;case"releases":return pt;case"artists":return Ct}});return(d,m)=>(o(),_("div",bt,[p(Ce,{class:"header"}),s("main",St,[(o(),g(ve(e.value)))])]))}});const Et=I(It,[["__scopeId","data-v-93dbfd1c"]]);export{Et as default};
