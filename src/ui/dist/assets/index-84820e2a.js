import{_ as I,f as F,o,c as _,g as v,w as y,l as te,m as se,a as l,C as K,H as V,i as g,t as C,d as w,e as M,n as f,D as j,E as R,r as re,L as le,h as T,F as D,j as ie,B,q as ue,J as ce,M as G,K as X,N as b,O as P,b as de,Q as Z,A as _e,R as pe}from"./index-c248245e.js";import{F as E}from"./FullShelf-ad1a6004.js";import{E as ve}from"./Error-cd77547d.js";import{P as me}from"./Playlist-9cebdc4e.js";import{P as ee}from"./PlaylistItem-9fd7219c.js";import{p as fe}from"./playerInPicture-af203fdf.js";const he={name:"CollectionHeader",props:{href:String}},q=c=>(te("data-v-a26d5560"),c=c(),se(),c),ye={class:"wrapper"},ge=q(()=>l("div",{class:"collection"},"Playlists",-1)),xe=q(()=>l("div",{class:"collection"},"Releases",-1)),we=q(()=>l("div",{class:"collection"},"Artists",-1)),ke=q(()=>l("div",{class:"collection"},"Albums",-1));function $e(c,r,e,d,m,n){const u=F("router-link");return o(),_("div",ye,[v(u,{class:"link",to:"/collection/playlists"},{default:y(()=>[ge]),_:1}),v(u,{class:"link",to:"/collection/releases"},{default:y(()=>[xe]),_:1}),v(u,{class:"link",to:"/collection/artists"},{default:y(()=>[we]),_:1}),v(u,{class:"link",to:"/collection/albums"},{default:y(()=>[ke]),_:1})])}const be=I(he,[["render",$e],["__scopeId","data-v-a26d5560"]]),Ce={components:{Card:K,Cover:V},name:"CardWithImageAndText",props:{cover:String,title:String,description:String,playlistType:{type:String,default:null},imageType:{type:String,default:"playlist"}}};const Se={class:"item"},Ie={class:"title"},Ae={key:0,class:"material-symbols-rounded"},Te=["innerHTML"];function De(c,r,e,d,m,n){const u=F("Cover"),t=F("Card");return o(),g(t,{class:"wrapper drop-shadow-md","with-hover":""},{default:y(()=>[l("div",Se,[v(u,{src:e.cover,type:e.imageType,name:e.title},null,8,["src","type","name"]),l("div",Ie,[[null,"classic"].includes(e.playlistType)?w("",!0):(o(),_("span",Ae,C(e.playlistType=="smart"?"neurology":"bolt"),1)),l("h4",null,C(e.title),1)]),l("p",{class:"text-muted text-xs hideIfMobile",innerHTML:e.description},null,8,Te)])]),_:1})}const ae=I(Ce,[["render",De],["__scopeId","data-v-847f5a33"]]),L=M({__name:"FetchLoader",props:{response:{type:Promise,required:!0},error:{type:Function,default:c=>`Failed to fetch (${c.status})`}},setup(c){const r=c,e=f(!1),d=f(""),m=async()=>{if(!r.response)return;e.value=!0,d.value="";const n=await r.response;e.value=!1,n.ok||(d.value=r.error(n))};return j(m),R(()=>r.response,m),(n,u)=>e.value?(o(),g(le,{key:0})):d.value?(o(),g(ve,{key:1,msg:d.value},null,8,["msg"])):c.response?re(n.$slots,"default",{key:2}):w("",!0)}}),Me={class:"albums"},Pe=M({__name:"Albums",setup(c){const r=f([]),e=f(null);return j(async()=>{e.value=fetch("/api/albums");const m=await(await e.value).json();r.value=m.sort((n,u)=>n.name.localeCompare(u.name))}),(d,m)=>(o(),g(L,{response:e.value},{default:y(()=>[l("div",Me,[v(E,{heading:"In your library"},{default:y(()=>[(o(!0),_(D,null,T(r.value,n=>(o(),g(ae,{title:n.name,description:n.artists.join(", "),cover:n.image,onClick:u=>d.$router.push(n.href),imageType:"album"},null,8,["title","description","cover","onClick"]))),256))]),_:1})])]),_:1},8,["response"]))}});const Re=I(Pe,[["__scopeId","data-v-6f9bc52c"]]),Fe={class:"playlists"},Ee=M({__name:"Playlists",setup(c){const r=ie(),e=B(()=>r.playlists),d=f([]),m=f(null);return j(async()=>{m.value=fetch("/api/spotify/playlists");const u=await(await m.value).json();d.value=u}),(n,u)=>(o(),_("div",Fe,[e.value.length?(o(),g(E,{key:0,heading:"Playlists"},{default:y(()=>[(o(!0),_(D,null,T(e.value,(t,h)=>(o(),g(me,{key:h,cover:t.cover,href:t==null?void 0:t.href,name:t.name,type:t.type,id:t.id},null,8,["cover","href","name","type","id"]))),128))]),_:1})):w("",!0),v(L,{response:m.value,error:t=>`Failed to fetch Spotify playlists (${t.status})`},{default:y(()=>[d.value.length?(o(),g(E,{key:0,heading:"Import From Spotify"},{default:y(()=>[v(ee,{title:"Liked",description:"your liked tracks",spotify:!0,id:"liked"}),(o(!0),_(D,null,T(d.value,(t,h)=>(o(),g(ee,{key:h,cover:t.cover,description:t.description,title:t.name,id:t.id,spotify:!0,href:`https://open.spotify.com/playlist/${t.id}`},null,8,["cover","description","title","id","href"]))),128))]),_:1})):w("",!0)]),_:1},8,["response","error"])]))}}),Q=c=>(te("data-v-a22e8b2e"),c=c(),se(),c),je={key:0,class:"fill-page"},Ne={key:1,class:"p-4 overflow-hidden h-full"},Be={class:"releases w-full"},Le={class:"current"},qe={key:0,class:"w-max flex flex-col gap-4"},He={class:"flex justify-between w-full items-center"},Oe={class:"flex gap-4 items-center"},Ye={class:"info"},Je={key:0},Ve={key:1,class:"m-0 text-muted text-sm"},Ke=["title"],Qe={class:"actions"},We={key:1,class:"h-96 flex flex-col justify-center"},ze=Q(()=>l("span",{class:"italic text-sm text-muted"}," Nothing to preview ",-1)),Ue=[ze],Ge={class:"flex items-center gap-4 w-max"},Xe={key:0,class:"flex justify-end mb-2"},Ze=Q(()=>l("span",{class:"material-symbols-rounded"}," done_all ",-1)),et={class:"entries overflow-y-auto flex flex-col gap-2"},tt=["onClick"],st={class:"info overflow-hidden"},lt={class:"m-0 overflow-hidden"},at={class:"m-0 overflow-hidden text-sm text-muted"},ot=["title"],nt=["onClick"],rt=["onClick"],it=["onClick"],ut={key:1,class:"flex flex-col items-center"},ct=Q(()=>l("span",{class:"italic text-sm text-muted"}," No releases in this queue ",-1)),dt=[ct],Y="reap.releases.seen",J="reap.releases.remember",_t=M({__name:"Releases",setup(c){const r=f(!0),e=f("unseen"),d=a=>{const s=new Date(a),x=Math.floor((Date.now()-s.getTime())/1e3/60/60/24);return x==0?"Today":x==1?"Yesterday":x<100?`${x} days ago`:x<365?`${Math.floor(x/30)} months ago`:s.toLocaleDateString()},m=ue();R(e,a=>{const s={queue:a};m.replace({query:s})});const n=B(()=>{switch(e.value){case"unseen":return A.value.filter(a=>!$.value.includes(a.url));case"out-today":return oe.value;case"watching":return k.value;case"all":return A.value;case"seen":return $.value.map(a=>A.value.find(s=>s.url==a)).filter(a=>a)}}),u=a=>{fe(a.artist,a.title,a.url)},t=f(null),h=f(null),H=new Date,A=f([]),W=a=>{t.value=a,Z(()=>{var s;(s=h.value)==null||s.show()})},oe=B(()=>A.value.filter(a=>{const s=new Date(a.releaseDate);return H.getMonth()==s.getMonth()&&H.getDate()==s.getDate()&&H.getFullYear()==s.getFullYear()})),z=a=>{k.value.find(s=>s.url==a.url)||k.value.push(a)},U=a=>{k.value=k.value.filter(s=>s.url!=a.url)},O=a=>{var x;let s=!1;a.url===((x=p.value)==null?void 0:x.url)&&(s=!0),$.value.includes(a.url)||$.value.push(a.url),s&&Z(()=>u(p.value))},$=f([]),k=f([]),p=f(null);return j(async()=>{var s;r.value=!0;const a=await fetch("/api/releases");A.value=await a.json(),r.value=!1,$.value=((s=localStorage.getItem(Y))==null?void 0:s.split(","))??[],$.value=$.value.filter(x=>A.value.find(N=>N.url==x)),k.value=JSON.parse(localStorage.getItem(J)??"[]")}),R(n,a=>{p.value=a[0]??null}),R($,a=>{a.length?localStorage.setItem(Y,a.join(",")):localStorage.removeItem(Y)},{deep:!0}),R(k,a=>{a.length?localStorage.setItem(J,JSON.stringify(a)):localStorage.removeItem(J)},{deep:!0}),(a,s)=>{var x,N;return r.value?(o(),_("div",je,[v(le)])):(o(),_("div",Ne,[t.value?(o(),g(ce,{key:0,id:(x=t.value.url)==null?void 0:x.replace("https://open.spotify.com/album/",""),ref_key:"addReleaseRef",ref:h,album:{id:(N=t.value.url)==null?void 0:N.replace("https://open.spotify.com/album/",""),title:t.value.title,artist:t.value.artists.join(", "),cover:t.value.cover,href:t.value.url,releaseDate:t.value.releaseDate},artist:t.value.artist,cover:t.value.cover,href:t.value.url,title:t.value.title},null,8,["id","album","artist","cover","href","title"])):w("",!0),l("div",Be,[l("div",Le,[p.value?(o(),_("div",qe,[p.value?(o(),g(V,{key:0,class:"rounded-3xl",src:p.value.cover},null,8,["src"])):w("",!0),l("div",He,[l("div",Oe,[l("span",{class:"preview material-symbols-rounded ms-fill text-5xl cursor-pointer",onClick:s[0]||(s[0]=i=>u(p.value))}," play_circle "),l("div",Ye,[p.value?(o(),_("h3",Je,[v(G,{text:p.value.title},null,8,["text"])])):w("",!0),p.value?(o(),_("p",Ve,[v(X,{artist:p.value.artist},null,8,["artist"])])):w("",!0),p.value?(o(),_("p",{key:2,class:"m-0 text-muted text-xs",title:p.value.releaseDate},C(d(p.value.releaseDate)),9,Ke)):w("",!0)])]),l("div",Qe,[l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:s[1]||(s[1]=b(i=>W(p.value),["stop"])),title:"Add to playlist"}," add "),l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:s[2]||(s[2]=b(i=>k.value.find(S=>S.url===p.value.url)?U(p.value):z(p.value),["stop"])),title:"Pin"},C(k.value.find(i=>i.url===p.value.url)?"playlist_remove":"push_pin"),1),l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:s[3]||(s[3]=b(i=>O(p.value),["stop"])),title:"Mark as seen"}," done_all ")])])])):(o(),_("div",We,Ue))]),v(K,{class:"queue w-full p-2 h-full flex flex-col gap-2 relative"},{default:y(()=>[l("div",Ge,[l("h5",{class:P(["cursor-pointer",{selected:e.value=="unseen"}]),onClick:s[4]||(s[4]=i=>e.value="unseen")}," Unseen ",2),l("h5",{class:P(["cursor-pointer",{selected:e.value=="out-today"}]),onClick:s[5]||(s[5]=i=>e.value="out-today")}," Out Today ",2),l("h5",{class:P(["cursor-pointer",{selected:e.value=="watching"}]),onClick:s[6]||(s[6]=i=>e.value="watching")}," Pinned ",2),l("h5",{class:P(["cursor-pointer",{selected:e.value=="seen"}]),onClick:s[7]||(s[7]=i=>e.value="seen")}," Seen ",2),l("h5",{class:P(["cursor-pointer",{selected:e.value=="all"}]),onClick:s[8]||(s[8]=i=>e.value="all")}," All ",2)]),e.value==="unseen"&&n.value.length?(o(),_("div",Xe,[l("span",{class:"cursor-pointer text-sm text-muted hover:text-primary flex items-center gap-2",onClick:s[9]||(s[9]=i=>n.value.forEach(O))},[de(" Mark all as seen "),Ze])])):w("",!0),l("div",et,[n.value.length?(o(!0),_(D,{key:0},T(n.value,i=>(o(),_("div",{class:"entry",onClick:S=>{p.value=i,u(i)}},[v(V,{class:"rounded-xl",src:i.cover},null,8,["src"]),l("div",st,[l("p",lt,[v(G,{text:i.title},null,8,["text"])]),l("p",at,[v(X,{artist:i.artist},null,8,["artist"])])]),l("p",{class:"text-sm m-0 text-muted",title:i.releaseDate},C(d(i.releaseDate)),9,ot),l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:b(S=>W(i),["stop"]),title:"Add to playlist"}," add ",8,nt),l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:b(S=>k.value.find(ne=>ne.url===i.url)?U(i):z(i),["stop"]),title:"Pin"},C(k.value.find(S=>S.url===i.url)?"playlist_remove":"push_pin"),9,rt),l("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:b(S=>O(i),["stop"]),title:"Mark as seen"}," done_all ",8,it)],8,tt))),256)):w("",!0)]),n.value.length?w("",!0):(o(),_("div",ut,dt))]),_:1})])]))}}});const pt=I(_t,[["__scopeId","data-v-a22e8b2e"]]);const vt={components:{Card:K},name:"ArtistItem",methods:{follow(c){c.stopPropagation();const r=this.following?"DELETE":"POST";fetch("/api/spotify/following",{method:r,body:JSON.stringify({artistId:this.id})}).then(e=>{e.status==200&&(this.following=!this.following)})}},data(){return{following:this.initiallyFollowing}},props:{cover:String,name:String,description:String,id:String,initiallyFollowing:Boolean,showFollowButton:Boolean}},mt={class:"item"},ft=["src"],ht=["innerHTML"];function yt(c,r,e,d,m,n){const u=F("add-artist-to-playlist"),t=F("Card");return o(),g(t,{class:"wrapper","with-hover":"",onClick:r[1]||(r[1]=b(h=>c.$router.push("/artist/"+e.name),["stop"]))},{default:y(()=>[v(u,{ref:"import",artist:{id:e.id,name:e.name,href:`https://open.spotify.com/artist/${e.id}`,image:e.cover}},null,8,["artist"]),l("div",mt,[l("img",{src:e.cover},null,8,ft),l("h4",null,C(e.name),1),l("p",{innerHTML:e.description},null,8,ht),e.showFollowButton?(o(),_("button",{key:0,class:"followButton",onClick:r[0]||(r[0]=b((...h)=>n.follow&&n.follow(...h),["stop"]))},C(m.following?"unfollow":"Follow"),1)):w("",!0)])]),_:1})}const gt=I(vt,[["render",yt],["__scopeId","data-v-353b4692"]]),xt={class:"artists"},wt=M({__name:"Artists",setup(c){const r=f([]),e=f([]),d=f(null),m=f(null);return j(async()=>{d.value=fetch("/api/artists");let n=await d.value,u=await n.json();e.value=u.sort((t,h)=>t.name.localeCompare(h.name)),m.value=fetch("/api/spotify/artists"),n=await m.value,u=await n.json(),r.value=u.sort((t,h)=>t.name.localeCompare(h.name))}),(n,u)=>(o(),_("div",xt,[v(L,{response:d.value},{default:y(()=>[v(E,{heading:"In your library"},{default:y(()=>[(o(!0),_(D,null,T(e.value,t=>(o(),g(ae,{title:t.name,cover:t.image,onClick:h=>n.$router.push(`/artist/${t.name}`),imageType:"artist"},null,8,["title","cover","onClick"]))),256))]),_:1})]),_:1},8,["response"]),v(L,{response:m.value},{default:y(()=>[v(E,{heading:"Following on Spotify"},{default:y(()=>[(o(!0),_(D,null,T(r.value,(t,h)=>(o(),g(gt,{id:t.id,key:h,cover:t.cover,description:t.description,name:t.name,"initially-following":"","show-follow-button":""},null,8,["id","cover","description","name"]))),128))]),_:1})]),_:1},8,["response"])]))}});const kt=I(wt,[["__scopeId","data-v-4bad4a22"]]),$t={class:"parent"},bt=M({__name:"index",setup(c){const r=_e(),e=B(()=>{switch(r.path.split("/")[2]){case"albums":return Re;case"playlists":return Ee;case"releases":return pt;case"artists":return kt}});return(d,m)=>(o(),_("div",$t,[v(be,{class:"header"}),l("main",null,[(o(),g(pe(e.value)))])]))}});const Mt=I(bt,[["__scopeId","data-v-1e72bbc0"]]);export{Mt as default};
