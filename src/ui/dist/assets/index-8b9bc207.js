import{e as N,aH as S,n as x,a9 as q,y as B,o as s,c as n,a as o,F as c,h as F,i as C,w as y,b as u,t as l,C as g,g as f,H as T,d as t,u as v,aI as I,z as V,L as $,Q as z,v as L,I as O,N as j,l as H,m as M,_ as A}from"./index-c7b070b4.js";const _=h=>(H("data-v-50028c6e"),h=h(),M(),h),E={class:"downloader py-2 pr-2 grid gap-4 grid-cols-2 items-start"},P={class:"downloads"},Q={class:"main"},Y={class:"m-0 mb-4"},G={class:"status"},J={class:"flex flex-col"},K={key:0,class:"info"},R=_(()=>o("span",{class:"material-symbols-rounded"},"cloud",-1)),U={key:1,class:"info"},W=_(()=>o("span",{class:"material-symbols-rounded"},"file_download",-1)),X={class:"info"},Z=_(()=>o("span",{class:"material-symbols-rounded"},"percent",-1)),ee={key:2,class:"info"},oe=_(()=>o("span",{class:"material-symbols-rounded"},"speed",-1)),se={key:3,class:"info"},ne=_(()=>o("span",{class:"material-symbols-rounded"},"timer",-1)),ae=_(()=>o("div",{class:"error"},[o("span",null,"This song could not be downloaded:"),o("ul",{class:"block list-disc ml-8"},[o("li",null," verify that the source link is working "),o("li",null,"try again later")])],-1)),le={key:0,class:"info"},re=_(()=>o("span",{class:"material-symbols-rounded"},"link",-1)),de=["href"],te={class:"wrap-progress"},ie=["aria-valuenow"],ce={key:1,class:"material-symbols-rounded downloading"},ue=["onClick"],_e=["onClick"],me=["onClick"],pe={key:1,class:"col-span-2 flex flex-row justify-center items-center"},fe={class:"new-download"},ve=N({__name:"index",setup(h){const i=S(),w=a=>{j.addYesNo("Are you sure you want to redownload this song?",null,null,()=>{console.log("[downloader] reDownload",a),i.downloadFromDb(a)})},m={title:"",artist:"",album:{name:"",href:"",id:""},cover:"",source:"",href:""},k=x(null),r=x([{name:"source",type:"text",accept:"audio/mp3",required:!0,onChange:async a=>{const d=await q(a);r.value.find(e=>e.name==="title").value=d.title,r.value.find(e=>e.name==="artist").value=d.artist,r.value.find(e=>e.name==="album").value=d.album,r.value.find(e=>e.name==="cover").value=d.cover,r.value.find(e=>e.name==="source").value=d.source},value:m.source},{name:"title",type:"text",icon:"title",required:!0,value:m.title},{name:"artist",type:"text",icon:"person",required:!0,value:m.artist},{name:"album",type:"text",icon:"album",value:m.album.name},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:m.cover}]),D=async()=>{const a=k.value.toObject();a.id=new Date().getTime(),console.log("[downloader] requestDownload",a),i.downloadOther(a)};return B(()=>{var a,d;i.prefill!=null&&(r.value=r.value.map(e=>{var p;return e.value=((p=i.prefill)==null?void 0:p[e.name])??e.value,e}),(d=(a=r.value.find(e=>e.name==="source"))==null?void 0:a.onChange)==null||d.call(a,i.prefill.source))}),(a,d)=>(s(),n("div",E,[o("div",P,[(s(!0),n(c,null,F(v(i).states,e=>{var p;return s(),n(c,{key:e.songId},[e.internal?t("",!0):(s(),C(g,{key:0,class:z([["song",{downloading:((p=v(i).states[e.songId])==null?void 0:p.status)=="downloading"}],"p-4 card items-center"])},{default:y(()=>[e.status!=="pending"?(s(),n(c,{key:0},[o("main",Q,[o("h2",Y,[e.song?(s(),n(c,{key:0},[u(l(e.song.title),1)],64)):(s(),n(c,{key:1},[u(l(e.filename),1)],64))]),o("div",G,[e.song?(s(),C(g,{key:0,class:"info p-4"},{default:y(()=>[f(T,{src:e.song.cover,class:"cover"},null,8,["src"]),o("div",J,[o("span",null,l(e.song.album.name),1),o("span",null,l(e.song.artist),1)])]),_:2},1024)):t("",!0),e.status!=="error"?(s(),n(c,{key:1},[e.downloaded||e.total?(s(),n("div",K,[R,u(" "+l(v(I)(e.downloaded))+" / "+l(v(I)(e.total)),1)])):t("",!0),e.chunk?(s(),n("div",U,[W,u(" "+l(e.chunk),1)])):t("",!0),o("div",X,[Z,u(" "+l(e.status==="downloading"?e.percent:100)+"% ",1)]),e.speed!=="0"?(s(),n("div",ee,[oe,u(" "+l(e.speed),1)])):t("",!0),e.elapsed!=="0"||e.eta!==0?(s(),n("div",se,[ne,u(" "+l(e.elapsed)+" / "+l(e.eta)+"s ",1)])):t("",!0)],64)):(s(),n(c,{key:2},[ae,e.song?(s(),n("div",le,[re,o("a",{href:e.song.source,target:"_blank",rel:"noopener noreferrer"},l(e.song.source),9,de)])):t("",!0)],64))])]),o("aside",null,[o("div",te,[e.status=="downloading"?(s(),n("div",{key:0,class:"progress-bar",role:"progressbar","aria-valuenow":e.percent,"aria-valuemin":"0","aria-valuemax":"100",style:V({"--progress":e.percent+"%"})},null,12,ie)):t("",!0),e.status=="downloading"?(s(),n("span",ce," south ")):e.status=="finished"?(s(),n("span",{key:2,class:"material-symbols-rounded cursor-pointer finished",onClick:b=>v(i).download(e.songId)}," download_for_offline ",8,ue)):e.status=="downloaded"?(s(),n("span",{key:3,class:"material-symbols-rounded cursor-pointer downloaded",onClick:b=>w(e.songId)}," download_done ",8,_e)):e.status=="error"?(s(),n("span",{key:4,class:"material-symbols-rounded cursor-pointer error",onClick:b=>w(e.songId)}," error ",8,me)):t("",!0)])])],64)):(s(),n("div",pe,[f($)]))]),_:2},1032,["class"]))],64)}),128))]),o("div",fe,[f(g,{class:"custom p-4 flex flex-col"},{default:y(()=>[f(L,{ref_key:"form",ref:k,options:r.value},null,8,["options"]),f(O,{icon:"download_for_offline",label:"Download",class:"w-full mt-8",onClick:D})]),_:1})])]))}});const ye=A(ve,[["__scopeId","data-v-50028c6e"]]);export{ye as default};
