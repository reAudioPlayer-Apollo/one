import{e as N,aH as S,n as x,a9 as I,y as T,o,c as a,a as s,F as c,h as V,i as C,w as y,b as h,t as i,C as g,g as m,H as q,d as l,u as p,aI as D,z as E,L as F,Q as $,v as z,I as L,N as O,l as j,m as H,_ as M}from"./index-CFO58RnV.js";const v=f=>(j("data-v-91911899"),f=f(),H(),f),A={class:"downloader py-2 pr-2 grid gap-4 grid-cols-2 items-start"},P={class:"downloads"},Q={class:"main"},Y={class:"m-0 mb-4"},G={class:"status"},J={class:"flex flex-col"},K={key:0,class:"info"},R=v(()=>s("span",{class:"material-symbols-rounded"},"cloud",-1)),U={key:1,class:"info"},W=v(()=>s("span",{class:"material-symbols-rounded"},"file_download",-1));const X=v(()=>s("div",{class:"error"},[s("span",null,"This song could not be downloaded:"),s("ul",{class:"block list-disc ml-8"},[s("li",null," verify that the source link is working "),s("li",null,"try again later")])],-1)),Z={key:0,class:"info"},ee=v(()=>s("span",{class:"material-symbols-rounded"},"link",-1)),oe=["href"],se={class:"wrap-progress"},ae=["aria-valuenow"],ne={key:1,class:"material-symbols-rounded downloading"},le=["onClick"],te=["onClick"],re=["onClick"],de={key:1,class:"col-span-2 flex flex-row justify-center items-center"},ie={class:"new-download"},ce=N({__name:"index",setup(f){const d=S(),w=n=>{O.addYesNo("Are you sure you want to redownload this song?",null,null,()=>{console.log("[downloader] reDownload",n),d.downloadFromDb(n)})},u={title:"",artist:"",album:{name:"",href:"",id:""},cover:"",source:"",href:""},k=x(null),t=x([{name:"source",type:"text",accept:"audio/mp3",required:!0,onChange:async n=>{const r=await I(n);t.value.find(e=>e.name==="title").value=r.title,t.value.find(e=>e.name==="artist").value=r.artist,t.value.find(e=>e.name==="album").value=r.album,t.value.find(e=>e.name==="cover").value=r.cover,t.value.find(e=>e.name==="source").value=r.source},value:u.source},{name:"title",type:"text",icon:"title",required:!0,value:u.title},{name:"artist",type:"text",icon:"person",required:!0,value:u.artist},{name:"album",type:"text",icon:"album",value:u.album.name},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:u.cover}]),B=async()=>{const n=k.value.toObject();n.id=new Date().getTime(),console.log("[downloader] requestDownload",n),d.downloadOther(n)};return T(()=>{var n,r;d.prefill!=null&&(t.value=t.value.map(e=>{var _;return e.value=((_=d.prefill)==null?void 0:_[e.name])??e.value,e}),(r=(n=t.value.find(e=>e.name==="source"))==null?void 0:n.onChange)==null||r.call(n,d.prefill.source))}),(n,r)=>(o(),a("div",A,[s("div",P,[(o(!0),a(c,null,V(p(d).states,e=>{var _;return o(),a(c,{key:e.songId},[e.internal?l("",!0):(o(),C(g,{key:0,class:$([["song",{downloading:((_=p(d).states[e.songId])==null?void 0:_.status)=="downloading"}],"p-4 card items-center"])},{default:y(()=>[e.status!=="pending"?(o(),a(c,{key:0},[s("main",Q,[s("h2",Y,[e.song?(o(),a(c,{key:0},[h(i(e.song.title),1)],64)):(o(),a(c,{key:1},[h(i(e.filename),1)],64))]),s("div",G,[e.song?(o(),C(g,{key:0,class:"info p-4"},{default:y(()=>[m(q,{src:e.song.cover,class:"cover"},null,8,["src"]),s("div",J,[s("span",null,i(e.song.album.name),1),s("span",null,i(e.song.artist),1)])]),_:2},1024)):l("",!0),e.status!=="error"?(o(),a(c,{key:1},[e.downloaded||e.total?(o(),a("div",K,[R,h(" "+i(p(D)(e.downloaded))+" / "+i(p(D)(e.total)),1)])):l("",!0),e.chunk?(o(),a("div",U,[W,h(" "+i(e.chunk),1)])):l("",!0),l("",!0),l("",!0),l("",!0)],64)):(o(),a(c,{key:2},[X,e.song?(o(),a("div",Z,[ee,s("a",{href:e.song.source,target:"_blank",rel:"noopener noreferrer"},i(e.song.source),9,oe)])):l("",!0)],64))])]),s("aside",null,[s("div",se,[e.status=="downloading"?(o(),a("div",{key:0,class:"progress-bar",role:"progressbar","aria-valuenow":e.percent,"aria-valuemin":"0","aria-valuemax":"100",style:E({"--progress":e.percent+"%"})},null,12,ae)):l("",!0),e.status=="downloading"?(o(),a("span",ne," south ")):e.status=="finished"?(o(),a("span",{key:2,class:"material-symbols-rounded cursor-pointer finished",onClick:b=>p(d).download(e.song.id)}," download_for_offline ",8,le)):e.status=="downloaded"?(o(),a("span",{key:3,class:"material-symbols-rounded cursor-pointer downloaded",onClick:b=>w(e.song.id)}," download_done ",8,te)):e.status=="error"?(o(),a("span",{key:4,class:"material-symbols-rounded cursor-pointer error",onClick:b=>w(e.song.id)}," error ",8,re)):l("",!0)])])],64)):(o(),a("div",de,[m(F)]))]),_:2},1032,["class"]))],64)}),128))]),s("div",ie,[m(g,{class:"custom p-4 flex flex-col"},{default:y(()=>[m(z,{ref_key:"form",ref:k,options:t.value},null,8,["options"]),m(L,{icon:"download_for_offline",label:"Download",class:"w-full mt-8",onClick:B})]),_:1})])]))}}),_e=M(ce,[["__scopeId","data-v-91911899"]]);export{_e as default};
