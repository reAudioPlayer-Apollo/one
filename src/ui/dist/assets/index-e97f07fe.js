import{i as q,cb as N,q as x,c as n,a as e,F as u,j as S,u as p,g as f,w as y,C as h,bT as B,o as s,f as C,b as d,t as a,h as F,d as r,cc as I,y as T,L as V,I as $,c7 as j,m as L,n as O,_ as z}from"./index-7c89f80c.js";import{I as A}from"./IconButton-a69e4be2.js";import{F as E}from"./Form-8cf344bb.js";import"./Dropdown-e8239bd5.js";const t=v=>(L("data-v-0651bc0d"),v=v(),O(),v),M={class:"downloader py-2 pr-2 grid gap-4 grid-cols-2 items-start"},P={class:"downloads"},Y={class:"main"},G={class:"m-0 mb-4"},H={class:"status"},J={class:"flex flex-col"},K={key:0,class:"info"},Q=t(()=>e("span",{class:"material-symbols-rounded"},"cloud",-1)),R={key:1,class:"info"},U=t(()=>e("span",{class:"material-symbols-rounded"},"file_download",-1)),W={class:"info"},X=t(()=>e("span",{class:"material-symbols-rounded"},"percent",-1)),Z={key:2,class:"info"},oo=t(()=>e("span",{class:"material-symbols-rounded"},"speed",-1)),eo={key:3,class:"info"},so=t(()=>e("span",{class:"material-symbols-rounded"},"timer",-1)),no=t(()=>e("div",{class:"error"},[e("span",null,"This song could not be downloaded:"),e("ul",{class:"block list-disc ml-8"},[e("li",null," verify that the source link is working "),e("li",null," try again later ")])],-1)),ao={key:0,class:"info"},lo=t(()=>e("span",{class:"material-symbols-rounded"},"link",-1)),ro=["href"],to={class:"wrap-progress"},io=["aria-valuenow"],co={key:1,class:"material-symbols-rounded downloading"},uo=["onClick"],_o=["onClick"],mo=["onClick"],po={key:1,class:"col-span-2 flex flex-row justify-center items-center"},fo={class:"new-download"},vo=q({__name:"index",setup(v){const _=N(),g=l=>{j.addYesNo("Are you sure you want to redownload this song?",null,null,()=>{console.log("[downloader] reDownload",l),_.downloadFromDb(l)})},m={title:"",artist:"",album:"",cover:"",source:"",href:""},w=x(null),i=x([{name:"source",type:"text",accept:"audio/mp3",required:!0,onChange:async l=>{const c=await B(l);i.value.find(o=>o.name==="title").value=c.title,i.value.find(o=>o.name==="artist").value=c.artist,i.value.find(o=>o.name==="album").value=c.album,i.value.find(o=>o.name==="cover").value=c.cover,i.value.find(o=>o.name==="source").value=c.source},value:m.source},{name:"title",type:"text",icon:"title",required:!0,value:m.title},{name:"artist",type:"text",icon:"person",required:!0,value:m.artist},{name:"album",type:"text",icon:"album",value:m.album},{name:"cover",type:"upload",accept:"image/*",imagePreview:!0,value:m.cover}]),D=async()=>{const l=w.value.toObject();l.id=new Date().getTime(),console.log("[downloader] requestDownload",l),_.downloadOther(l)};return(l,c)=>(s(),n("div",M,[e("div",P,[(s(!0),n(u,null,S(p(_).states,o=>{var k;return s(),C(h,{key:o.songId,class:$([["song",{downloading:((k=p(_).states[o.songId])==null?void 0:k.status)=="downloading"}],"p-4 card items-center"])},{default:y(()=>[o.status!=="pending"?(s(),n(u,{key:0},[e("main",Y,[e("h2",G,[o.song?(s(),n(u,{key:0},[d(a(o.song.title),1)],64)):(s(),n(u,{key:1},[d(a(o.filename),1)],64))]),e("div",H,[o.song?(s(),C(h,{key:0,class:"info p-4"},{default:y(()=>[f(F,{src:o.song.cover,class:"cover"},null,8,["src"]),e("div",J,[e("span",null,a(o.song.album),1),e("span",null,a(o.song.artist),1)])]),_:2},1024)):r("",!0),o.status!=="error"?(s(),n(u,{key:1},[o.downloaded||o.total?(s(),n("div",K,[Q,d(" "+a(p(I)(o.downloaded))+" / "+a(p(I)(o.total)),1)])):r("",!0),o.chunk?(s(),n("div",R,[U,d(" "+a(o.chunk),1)])):r("",!0),e("div",W,[X,d(" "+a(o.status==="downloading"?o.percent:100)+"% ",1)]),o.speed!=="0"?(s(),n("div",Z,[oo,d(" "+a(o.speed),1)])):r("",!0),o.elapsed!=="0"||o.eta!==0?(s(),n("div",eo,[so,d(" "+a(o.elapsed)+" / "+a(o.eta)+"s ",1)])):r("",!0)],64)):(s(),n(u,{key:2},[no,o.song?(s(),n("div",ao,[lo,e("a",{href:o.song.source,target:"_blank",rel:"noopener noreferrer"},a(o.song.source),9,ro)])):r("",!0)],64))])]),e("aside",null,[e("div",to,[o.status=="downloading"?(s(),n("div",{key:0,class:"progress-bar",role:"progressbar","aria-valuenow":o.percent,"aria-valuemin":"0","aria-valuemax":"100",style:T({"--progress":o.percent+"%"})},null,12,io)):r("",!0),o.status=="downloading"?(s(),n("span",co," south ")):o.status=="finished"?(s(),n("span",{key:2,class:"material-symbols-rounded cursor-pointer finished",onClick:b=>p(_).download(o.songId)}," download_for_offline ",8,uo)):o.status=="downloaded"?(s(),n("span",{key:3,class:"material-symbols-rounded cursor-pointer downloaded",onClick:b=>g(o.songId)}," download_done ",8,_o)):o.status=="error"?(s(),n("span",{key:4,class:"material-symbols-rounded cursor-pointer error",onClick:b=>g(o.songId)}," error ",8,mo)):r("",!0)])])],64)):(s(),n("div",po,[f(V)]))]),_:2},1032,["class"])}),128))]),e("div",fo,[f(h,{class:"custom p-4 flex flex-col"},{default:y(()=>[f(E,{ref_key:"form",ref:w,options:i.value},null,8,["options"]),f(A,{icon:"download_for_offline",label:"Download",class:"w-full mt-8",onClick:D})]),_:1})])]))}});const ko=z(vo,[["__scopeId","data-v-0651bc0d"]]);export{ko as default};
