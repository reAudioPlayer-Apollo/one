import{_ as T,f as E,o as n,c as d,g as v,w as _,a as s,C as K,E as V,i as h,t as b,d as x,e as R,l as f,v as j,B as P,r as oe,L as ee,h as D,F as M,j as ne,A as N,m as re,G as ie,M as G,H as U,J as $,K as A,b as X,O as Z,z as ue,Q as ce}from"./index-CTxjSbok.js";import{F}from"./FullShelf-WiVa8WAT.js";import{E as de}from"./Error-CQEMgMn-.js";import{P as O}from"./PlaylistCard-wbTFFeyA.js";import{p as pe}from"./playerInPicture-Dfp9IAsf.js";const ve={name:"CollectionHeader",props:{href:String}},me={class:"wrapper"};function fe(y,a,e,c,m,r){const u=E("router-link");return n(),d("div",me,[v(u,{class:"link",to:"/collection/playlists"},{default:_(()=>a[0]||(a[0]=[s("div",{class:"collection"},"Playlists",-1)])),_:1}),v(u,{class:"link",to:"/collection/releases"},{default:_(()=>a[1]||(a[1]=[s("div",{class:"collection"},"Releases",-1)])),_:1}),v(u,{class:"link",to:"/collection/artists"},{default:_(()=>a[2]||(a[2]=[s("div",{class:"collection"},"Artists",-1)])),_:1}),v(u,{class:"link",to:"/collection/albums"},{default:_(()=>a[3]||(a[3]=[s("div",{class:"collection"},"Albums",-1)])),_:1})])}const _e=T(ve,[["render",fe],["__scopeId","data-v-780f7ad5"]]),ye={components:{Card:K,Cover:V},name:"CardWithImageAndText",props:{cover:String,title:String,description:String,playlistType:{type:String,default:null},imageType:{type:String,default:"playlist"}}},he={class:"item"},ge={class:"title"},xe={key:0,class:"material-symbols-rounded"},we=["title"],ke=["title","innerHTML"];function Ce(y,a,e,c,m,r){const u=E("Cover"),o=E("Card");return n(),h(o,{class:"wrapper drop-shadow-md","with-hover":""},{default:_(()=>[s("div",he,[v(u,{src:e.cover,type:e.imageType,name:e.title},null,8,["src","type","name"]),s("div",null,[s("div",ge,[[null,"classic"].includes(e.playlistType)?x("",!0):(n(),d("span",xe,b(e.playlistType=="smart"?"neurology":"bolt"),1)),s("h4",{title:e.title},b(e.title),9,we)]),s("p",{class:"text-muted text-xs hideIfMobile",title:e.description,innerHTML:e.description},null,8,ke)])])]),_:1})}const te=T(ye,[["render",Ce],["__scopeId","data-v-19795e3d"]]),B=R({__name:"FetchLoader",props:{response:{type:Promise,required:!0},error:{type:Function,default:y=>`Failed to fetch (${y.status})`}},setup(y){const a=y,e=f(!1),c=f(""),m=async()=>{if(!a.response)return;e.value=!0,c.value="";const r=await a.response;e.value=!1,r.ok||(c.value=a.error(r))};return j(m),P(()=>a.response,m),(r,u)=>e.value?(n(),h(ee,{key:0})):c.value?(n(),h(de,{key:1,msg:c.value},null,8,["msg"])):y.response?oe(r.$slots,"default",{key:2}):x("",!0)}}),$e={class:"albums"},be=R({__name:"Albums",setup(y){const a=f([]),e=f(null);return j(async()=>{e.value=fetch("/api/albums");const m=await(await e.value).json();a.value=m.sort((r,u)=>r.name.localeCompare(u.name))}),(c,m)=>(n(),h(B,{response:e.value},{default:_(()=>[s("div",$e,[v(F,{heading:"In your library"},{default:_(()=>[(n(!0),d(M,null,D(a.value,r=>(n(),h(te,{title:r.name,description:r.artists.join(", "),cover:r.image,onClick:u=>c.$router.push(r.href),imageType:"album"},null,8,["title","description","cover","onClick"]))),256))]),_:1})])]),_:1},8,["response"]))}}),Se=T(be,[["__scopeId","data-v-33e7fc43"]]),Ie={class:"playlists"},Te=R({__name:"Playlists",setup(y){const a=ne(),e=N(()=>a.playlists),c=f([]),m=f(null);return j(async()=>{m.value=fetch("/api/spotify/playlists");const u=await(await m.value).json();c.value=u}),(r,u)=>(n(),d("div",Ie,[e.value.length?(n(),h(F,{key:0,heading:"Playlists"},{default:_(()=>[(n(!0),d(M,null,D(e.value,o=>(n(),h(O,{playlist:o},null,8,["playlist"]))),256))]),_:1})):x("",!0),v(B,{response:m.value,error:o=>`Failed to fetch Spotify playlists (${o.status})`},{default:_(()=>[c.value.length?(n(),h(F,{key:0,heading:"Import From Spotify"},{default:_(()=>[v(O,{playlist:{href:"/liked",name:"Liked",description:"your liked tracks",type:"classic",cover:null,id:"liked",plays:0},"is-spotify":""}),(n(!0),d(M,null,D(c.value,o=>(n(),h(O,{playlist:{...o,href:`https://open.spotify.com/playlist/${o.id}`,type:"classic"},"is-spotify":""},null,8,["playlist"]))),256))]),_:1})):x("",!0)]),_:1},8,["response","error"])]))}}),De={key:0,class:"fill-page"},Me={key:1},Re={class:"releases w-full"},Ae={class:"current"},Pe={key:0,class:"w-max flex flex-col gap-4"},Ee={class:"flex justify-between w-full items-center"},Fe={class:"flex gap-4 items-center"},je={class:"info"},Le={key:0},Ne={key:1,class:"m-0 text-muted text-sm"},Be=["title"],qe={class:"actions"},He={key:1,class:"h-96 flex flex-col justify-center"},Oe={class:"flex items-center gap-4 w-max"},Ye={key:0,class:"flex justify-between mb-2"},Je={class:"entries overflow-y-auto flex flex-col gap-2"},Ve=["onClick"],Ke={class:"info overflow-hidden"},Qe={class:"m-0 overflow-hidden"},ze={class:"m-0 overflow-hidden text-sm text-muted"},We=["title"],Ge=["onClick"],Ue=["onClick"],Xe=["onClick"],Ze={key:1,class:"flex flex-col items-center"},Y="reap.releases.seen",J="reap.releases.remember",et=R({__name:"Releases",setup(y){const a=f(!0),e=f("unseen"),c=l=>{const t=new Date(l),g=Math.floor((Date.now()-t.getTime())/1e3/60/60/24);return g==0?"Today":g==1?"Yesterday":g<100?`${g} days ago`:g<365?`${Math.floor(g/30)} months ago`:t.toLocaleDateString()},m=re();P(e,l=>{const t={queue:l};m.replace({query:t})});const r=N(()=>{switch(e.value){case"unseen":return S.value.filter(l=>!C.value.includes(l.url));case"out-today":return se.value;case"watching":return k.value;case"all":return S.value;case"seen":return C.value.map(l=>S.value.find(t=>t.url==l)).filter(l=>l)}}),u=l=>{pe(l.artist,l.title,l.url)},o=f(null),w=f(null),q=new Date,S=f([]),Q=l=>{o.value=l,Z(()=>{var t;(t=w.value)==null||t.show()})},se=N(()=>S.value.filter(l=>{const t=new Date(l.releaseDate);return q.getMonth()==t.getMonth()&&q.getDate()==t.getDate()&&q.getFullYear()==t.getFullYear()})),z=l=>{k.value.find(t=>t.url==l.url)||k.value.push(l)},W=l=>{k.value=k.value.filter(t=>t.url!=l.url)},H=l=>{var g;let t=!1;l.url===((g=p.value)==null?void 0:g.url)&&(t=!0),C.value.includes(l.url)||C.value.push(l.url),t&&Z(()=>u(p.value))},C=f([]),k=f([]),p=f(null),le=()=>{a.value=!0,fetch("/api/releases",{headers:{"X-Cache-Control":"no-cache"}}).then(l=>l.json()).then(l=>{S.value=l,a.value=!1})};return j(async()=>{var t;a.value=!0;const l=await fetch("/api/releases");S.value=await l.json(),a.value=!1,C.value=((t=localStorage.getItem(Y))==null?void 0:t.split(","))??[],C.value=C.value.filter(g=>S.value.find(L=>L.url==g)),k.value=JSON.parse(localStorage.getItem(J)??"[]")}),P(r,l=>{p.value=l[0]??null}),P(C,l=>{l.length?localStorage.setItem(Y,l.join(",")):localStorage.removeItem(Y)},{deep:!0}),P(k,l=>{l.length?localStorage.setItem(J,JSON.stringify(l)):localStorage.removeItem(J)},{deep:!0}),(l,t)=>{var g,L;return a.value?(n(),d("div",De,[v(ee)])):(n(),d("div",Me,[o.value?(n(),h(ie,{key:0,id:(g=o.value.url)==null?void 0:g.replace("https://open.spotify.com/album/",""),ref_key:"addReleaseRef",ref:w,album:{id:(L=o.value.url)==null?void 0:L.replace("https://open.spotify.com/album/",""),title:o.value.title,artist:o.value.artists.join(", "),cover:o.value.cover,href:o.value.url,releaseDate:o.value.releaseDate},artist:o.value.artist,cover:o.value.cover,href:o.value.url,title:o.value.title},null,8,["id","album","artist","cover","href","title"])):x("",!0),s("div",Re,[s("div",Ae,[p.value?(n(),d("div",Pe,[p.value?(n(),h(V,{key:0,class:"rounded-3xl",src:p.value.cover,"with-ambient":""},null,8,["src"])):x("",!0),s("div",Ee,[s("div",Fe,[s("span",{class:"preview material-symbols-rounded ms-fill text-5xl cursor-pointer",onClick:t[0]||(t[0]=i=>u(p.value))}," play_circle "),s("div",je,[p.value?(n(),d("h3",Le,[v(G,{text:p.value.title},null,8,["text"])])):x("",!0),p.value?(n(),d("p",Ne,[v(U,{artist:p.value.artist},null,8,["artist"])])):x("",!0),p.value?(n(),d("p",{key:2,class:"m-0 text-muted text-xs",title:p.value.releaseDate},b(c(p.value.releaseDate)),9,Be)):x("",!0)])]),s("div",qe,[s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:t[1]||(t[1]=$(i=>Q(p.value),["stop"])),title:"Add to playlist"}," add "),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:t[2]||(t[2]=$(i=>k.value.find(I=>I.url===p.value.url)?W(p.value):z(p.value),["stop"])),title:"Pin"},b(k.value.find(i=>i.url===p.value.url)?"playlist_remove":"push_pin"),1),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:t[3]||(t[3]=$(i=>H(p.value),["stop"])),title:"Mark as seen"}," done_all ")])])])):(n(),d("div",He,t[10]||(t[10]=[s("span",{class:"italic text-sm text-muted"}," Nothing to preview ",-1)])))]),v(K,{class:"queue w-full p-2 h-full flex flex-col gap-2 relative"},{default:_(()=>[s("div",Oe,[s("h5",{class:A(["cursor-pointer",{selected:e.value=="unseen"}]),onClick:t[4]||(t[4]=i=>e.value="unseen")}," Unseen ",2),s("h5",{class:A(["cursor-pointer",{selected:e.value=="out-today"}]),onClick:t[5]||(t[5]=i=>e.value="out-today")}," Out Today ",2),s("h5",{class:A(["cursor-pointer",{selected:e.value=="watching"}]),onClick:t[6]||(t[6]=i=>e.value="watching")}," Pinned ",2),s("h5",{class:A(["cursor-pointer",{selected:e.value=="seen"}]),onClick:t[7]||(t[7]=i=>e.value="seen")}," Seen ",2),s("h5",{class:A(["cursor-pointer",{selected:e.value=="all"}]),onClick:t[8]||(t[8]=i=>e.value="all")}," All ",2)]),e.value==="unseen"&&r.value.length?(n(),d("div",Ye,[s("span",{class:"cursor-pointer text-sm text-muted hover:text-primary flex items-center gap-2",onClick:le},t[11]||(t[11]=[X(" Refresh "),s("span",{class:"material-symbols-rounded"}," refresh ",-1)])),s("span",{class:"cursor-pointer text-sm text-muted hover:text-primary flex items-center gap-2",onClick:t[9]||(t[9]=i=>r.value.forEach(H))},t[12]||(t[12]=[X(" Mark all as seen "),s("span",{class:"material-symbols-rounded"}," done_all ",-1)]))])):x("",!0),s("div",Je,[r.value.length?(n(!0),d(M,{key:0},D(r.value,i=>(n(),d("div",{class:"entry",onClick:I=>{p.value=i,u(i)}},[v(V,{class:"rounded-xl",src:i.cover},null,8,["src"]),s("div",Ke,[s("p",Qe,[v(G,{text:i.title},null,8,["text"])]),s("p",ze,[v(U,{artist:i.artist},null,8,["artist"])])]),s("p",{class:"text-sm m-0 text-muted",title:i.releaseDate},b(c(i.releaseDate)),9,We),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:$(I=>Q(i),["stop"]),title:"Add to playlist"}," add ",8,Ge),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:$(I=>k.value.find(ae=>ae.url===i.url)?W(i):z(i),["stop"]),title:"Pin"},b(k.value.find(I=>I.url===i.url)?"playlist_remove":"push_pin"),9,Ue),s("span",{class:"material-symbols-rounded cursor-pointer text-muted hover:text-primary",onClick:$(I=>H(i),["stop"]),title:"Mark as seen"}," done_all ",8,Xe)],8,Ve))),256)):x("",!0)]),r.value.length?x("",!0):(n(),d("div",Ze,t[13]||(t[13]=[s("span",{class:"italic text-sm text-muted"}," No releases in this queue ",-1)])))]),_:1})])]))}}}),tt=T(et,[["__scopeId","data-v-fbc407e7"]]),st={components:{Card:K},name:"ArtistItem",methods:{follow(y){y.stopPropagation();const a=this.following?"DELETE":"POST";fetch("/api/spotify/following",{method:a,body:JSON.stringify({artistId:this.id})}).then(e=>{e.status==200&&(this.following=!this.following)})}},data(){return{following:this.initiallyFollowing}},props:{cover:String,name:String,description:String,id:String,initiallyFollowing:Boolean,showFollowButton:Boolean}},lt={class:"item"},at=["src"],ot={class:"flex gap-2 items-center justify-between"},nt=["innerHTML"];function rt(y,a,e,c,m,r){const u=E("add-artist-to-playlist"),o=E("Card");return n(),h(o,{class:"wrapper","with-hover":"",onClick:a[1]||(a[1]=$(w=>y.$router.push("/artist/"+e.name),["stop"]))},{default:_(()=>[v(u,{ref:"import",artist:{id:e.id,name:e.name,href:`https://open.spotify.com/artist/${e.id}`,image:e.cover}},null,8,["artist"]),s("div",lt,[s("img",{src:e.cover},null,8,at),s("div",ot,[s("div",null,[s("h4",null,b(e.name),1),s("p",{innerHTML:e.description},null,8,nt)]),e.showFollowButton?(n(),d("span",{key:0,class:"material-symbols-rounded text-muted text-md",onClick:a[0]||(a[0]=$((...w)=>r.follow&&r.follow(...w),["stop"]))},b(m.following?"person_check":"person_add"),1)):x("",!0)])])]),_:1})}const it=T(st,[["render",rt],["__scopeId","data-v-286e9794"]]),ut={class:"artists"},ct=R({__name:"Artists",setup(y){const a=f([]),e=f([]),c=f(null),m=f(null);return j(async()=>{c.value=fetch("/api/artists");let r=await c.value,u=await r.json();e.value=u.sort((o,w)=>o.name.localeCompare(w.name)),m.value=fetch("/api/spotify/artists"),r=await m.value,u=await r.json(),a.value=u.sort((o,w)=>o.name.localeCompare(w.name))}),(r,u)=>(n(),d("div",ut,[v(B,{response:c.value},{default:_(()=>[v(F,{heading:"In your library"},{default:_(()=>[(n(!0),d(M,null,D(e.value,o=>(n(),h(te,{title:o.name,cover:o.image,onClick:w=>r.$router.push(`/artist/${o.name}`),imageType:"artist"},null,8,["title","cover","onClick"]))),256))]),_:1})]),_:1},8,["response"]),v(B,{response:m.value},{default:_(()=>[v(F,{heading:"Following on Spotify"},{default:_(()=>[(n(!0),d(M,null,D(a.value,(o,w)=>(n(),h(it,{id:o.id,key:w,cover:o.cover,description:o.description,name:o.name,"initially-following":"","show-follow-button":""},null,8,["id","cover","description","name"]))),128))]),_:1})]),_:1},8,["response"])]))}}),dt=T(ct,[["__scopeId","data-v-a8a87a8e"]]),pt={class:"parent"},vt={class:"collection"},mt=R({__name:"index",setup(y){const a=ue(),e=N(()=>{switch(a.path.split("/")[2]){case"albums":return Se;case"playlists":return Te;case"releases":return tt;case"artists":return dt}});return(c,m)=>(n(),d("div",pt,[v(_e,{class:"header"}),s("main",vt,[(n(),h(ce(e.value)))])]))}}),xt=T(mt,[["__scopeId","data-v-3e995f8b"]]);export{xt as default};
