import{F as C,G as I}from"./FixedPlaylistHeader.c47091e1.js";import{_ as M}from"./SongCtx.522ecc72.js";import{_ as k,M as N,x as A,i as P,J as T,e as c,o as h,f as b,w as _,g as r,a as e,y as v,n as d,t as y,K as E,I as H,c as m,B as O,b as D,F as q,h as U,k as B,l as L}from"./index.53c4dab8.js";import{_ as j}from"./EditSong.vue_vue_type_script_setup_true_lang.3c2b067b.js";const F={name:"PlaylistEntry",components:{SongCtx:M,EditSong:j,Marquee:N},props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},cover:{type:String,default:"/assets/img/music_placeholder.png"},title:{type:String,default:"N/A"},album:{type:String,default:"N/A"},duration:{type:String,default:"N/A"},favourite:{type:Boolean,default:!1},playing:{type:Boolean,default:!1}},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks"}},computed:{trackId(){return A(this.id)}},methods:{parseCover:P,getPlaylistId(){return T(this.$route.params.id)},download(){this.$emit("download",this.index)},addToPlaylist(t){fetch(`/api/playlists/${t}/tracks`,{method:"POST",body:JSON.stringify({source:this.source})}).then(l=>{l.status==200&&this.$emit("requestUpdate")})},remove(){fetch(`/api/playlists/${this.getPlaylistId()}/tracks`,{method:"DELETE",body:JSON.stringify({songId:this.id})}).then(t=>{t.status==200&&this.$emit("requestUpdate")})},update(){this.$refs.editSongPopup.show()},hideCtxMenu(){!this.$refs.songCtx||this.$refs.ctxMenu.hide()},showCtxMenu(t){this.$refs.ctxMenu.show(t)},onselect(){this.highlighted=!this.highlighted,this.hideCtxMenu()},displayPlay(){const t=this.$refs.idOrPlay;t.innerHTML="play_arrow",t.classList.add("material-icons-round")},displayId(){const t=this.$refs.idOrPlay;t.innerHTML=this.index+1,t.classList.remove("material-icons-round")},playAt(){console.log(this.$route.path);const t={index:this.index};this.$route.path.includes("/playlist/")&&(t.playlistIndex=Number(this.getPlaylistId())),this.$route.path.includes("/collection/tracks")&&(t.type="collection"),this.$route.path.includes("/collection/tracks/breaking")&&(t.type="collection/breaking"),fetch("/api/player/at",{method:"POST",body:JSON.stringify(t)})},setFavourite(){fetch(`/api/tracks/${this.id}`,{method:"PUT",body:JSON.stringify({favourite:this.favourited,album:this.album,artist:this.artist,title:this.title,duration:this.duration,cover:this.cover,source:this.source})})}},watch:{favourited(){this.setFavourite()},favourite(){this.favourited=this.favourite,this.highlighted=!1}}},J={class:"h-full flex flex-col justify-center"},V={class:"track"},R=["src"],z={class:"trackwrapper"},G={class:"h-full flex flex-col justify-center w-full album"},K={class:"h-full flex flex-col justify-center grow-0"},Y={class:"h-full flex flex-col justify-center"},Q={class:"duration"},W={class:"h-full flex flex-col justify-center"},X={class:"mobilePlaylist showIfMobile"},Z={class:"track"},$=["src"],tt={class:"trackwrapper"};function et(t,l,s,S,a,i){const g=c("EditSong"),u=c("Marquee"),f=c("router-link"),p=c("SongCtx");return h(),b(p,{artist:s.artist,src:s.source,title:s.title,onDownload:i.download,onAddto:i.addToPlaylist,onRemove:i.remove,onUpdate:i.update,onLike:l[9]||(l[9]=o=>a.favourited=!a.favourited),isAutoPlaylist:a.isAutoPlaylist,liked:a.favourited,ref:"ctxMenu"},{default:_(()=>[r(g,{onClose:t.updatePlaylist,ref:"editSongPopup",song:{title:s.title,artist:s.artist,album:s.album,cover:s.cover,src:s.source,id:s.id}},null,8,["onClose","song"]),e("div",{onDblclick:l[3]||(l[3]=()=>{i.playAt(),i.onselect()}),onClick:l[4]||(l[4]=(...o)=>i.onselect&&i.onselect(...o)),onMouseover:l[5]||(l[5]=(...o)=>i.displayPlay&&i.displayPlay(...o)),onMouseleave:l[6]||(l[6]=(...o)=>i.displayId&&i.displayId(...o)),class:d(["playlistEntry hideIfMobile",{selected:a.highlighted}])},[e("div",J,[e("span",{onClick:l[0]||(l[0]=v((...o)=>i.playAt&&i.playAt(...o),["stop"])),ref:"idOrPlay",class:d([{playing:s.playing},"id"])},y(s.index+1),3)]),e("div",V,[e("img",{src:i.parseCover(s.cover)},null,8,R),e("div",z,[e("span",{class:d(["title",{playing:s.playing}])},[r(f,{class:"linkOnHover",to:`/track/${i.trackId}`},{default:_(()=>[r(u,{text:s.title},null,8,["text"])]),_:1},8,["to"])],2),e("span",{class:d(["artist",{playing:s.playing}])},[r(f,{class:"linkOnHover",to:`/search/artist:${s.artist}`},{default:_(()=>[r(u,{text:s.artist},null,8,["text"])]),_:1},8,["to"])],2)])]),e("div",G,[e("span",{class:d(["",{playing:s.playing}])},[r(u,{text:s.album},null,8,["text"])],2)]),e("div",K,[e("span",{onClick:l[1]||(l[1]=v(o=>a.favourited=!a.favourited,["stop"])),class:d(["favourite material-icons-round",{showfavourite:a.favourited||a.highlighted}])},y(a.favourited?"favorite":"favorite_border"),3)]),e("div",Y,[e("span",Q,y(s.duration),1)]),e("div",W,[e("span",{onClick:l[2]||(l[2]=(...o)=>i.showCtxMenu&&i.showCtxMenu(...o)),class:d(["more material-icons-round",{hidden:!a.highlighted}])},"more_horiz",2)])],34),e("div",X,[e("div",Z,[e("img",{onClick:l[7]||(l[7]=v((...o)=>i.playAt&&i.playAt(...o),["stop"])),src:s.cover||"/assets/img/music_placeholder.png"},null,8,$),e("div",tt,[e("span",{class:d(["title",{playing:s.playing}])},[r(u,{text:s.title},null,8,["text"])],2),e("span",{class:d(["artist",{playing:s.playing}])},[r(u,{text:s.artist},null,8,["text"])],2)])]),e("span",{onClick:l[8]||(l[8]=(...o)=>i.showCtxMenu&&i.showCtxMenu(...o)),class:"more material-symbols-rounded"},"more_horiz")])]),_:1},8,["artist","src","title","onDownload","onAddto","onRemove","onUpdate","isAutoPlaylist","liked"])}const it=k(F,[["render",et],["__scopeId","data-v-a39d028a"]]);const st={components:{PlaylistEntry:it,FixedPlaylistHeader:C,GridHeader:I},props:{src:{type:String,required:!0}},data(){return this.updateTracks(),{fixedHeaderHidden:!0,playlist:[],playlistName:"",store:E()}},watch:{currentSong(){this.updateIsPlaying()}},computed:{currentSong(){return this.store.song.id}},methods:{parseCover:P,download(t){var s;const l=(s=this.playlist)==null?void 0:s[t];window.open(`/api/tracks/${l.id}/download`)},updateIsPlaying(){console.log("Updating is playing",this.currentSong),this.playlist.forEach(t=>{t.playing=t.id==this.currentSong})},headerVisibilityChanged(t){this.fixedHeaderHidden=t},updateTracks(){fetch(this.src).then(t=>t.json()).then(t=>{this.playlist=t.songs,this.playlistName=t.name,this.updateIsPlaying()})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({type:"collection"})})}}},w=t=>(B("data-v-4c449e54"),t=t(),L(),t),lt={class:"playlist"},at={class:"padding-20"},ot=w(()=>e("hr",null,null,-1)),nt={class:"padding-20"},rt={class:"grid"},dt=w(()=>e("hr",null,null,-1)),ct={class:"playlistEntries"};function ut(t,l,s,S,a,i){const g=c("fixed-playlist-header"),u=c("h7"),f=c("grid-header"),p=c("playlist-entry"),o=H("observe-visibility");return h(),m("div",lt,[r(g,{onClick:i.loadPlaylist,ref:"fixedHeading",class:d({hidden:a.fixedHeaderHidden}),title:a.playlistName},null,8,["onClick","class","title"]),O((h(),m("div",at,[r(u,null,{default:_(()=>[D("Playlist")]),_:1}),e("h1",null,y(a.playlistName),1),e("h5",null,"Your "+y(a.playlist.length)+" favourite tracks, auto-generated just for you",1)])),[[o,i.headerVisibilityChanged]]),ot,e("div",nt,[e("span",{id:"loadPlaylist",onClick:l[0]||(l[0]=(...n)=>i.loadPlaylist&&i.loadPlaylist(...n)),class:"material-icons-outlined"},"play_circle_filled"),e("div",rt,[r(f,{class:"hideIfMobile"}),dt,e("div",ct,[(h(!0),m(q,null,U(a.playlist,(n,x)=>(h(),b(p,{key:x,index:x,source:n.source,id:n.id,title:n.title,playing:n.playing,album:n.album,artist:n.artist,cover:i.parseCover(n.cover),favourite:n.favourite,duration:n.duration,onDownload:i.download,onRequestUpdate:i.updateTracks},null,8,["index","source","id","title","playing","album","artist","cover","favourite","duration","onDownload","onRequestUpdate"]))),128))])])])])}const gt=k(st,[["render",ut],["__scopeId","data-v-4c449e54"]]);export{gt as I};
