import{j as U,v as E,m as g,n as p,o as n,f as b,w as j,a as d,t as m,L as q,c as r,r as F,x as M,d as _,F as h,y as k,e as J,k as V,l as N,_ as S,z as L,A as B,u as f,i as P,B as $,C as I,D as A,E as z,G,p as W}from"./index.f61d9b0b.js";const w=U(),H=async e=>{await fetch(`/api/playlists/${e.id}`,{method:"POST",body:JSON.stringify({name:e.name,description:e.description,cover:e.cover})}),await w.fetchPlaylists()},we=async e=>{const t=await fetch(`/api/playlists/${e}`);if(t.status===404)return null;const l=await t.json();for(const c of l.songs)c.href=`/track/${E(c.id)}`;return l},be=async e=>{await fetch(`/api/playlists/${e}`,{method:"DELETE"}),await w.fetchPlaylists()},T=async()=>{const t=await(await fetch("/api/playlists/new")).json();return await w.fetchPlaylists(),t},ke=async(e,t="",l="")=>{const c=await T();return await H({id:c,name:e,description:t,cover:l}),c},ge=async(e,t)=>{await fetch(`/api/playlists/${e}/tracks`,{method:"DELETE",body:JSON.stringify({songId:t})}),await w.fetchPlaylists()},K=e=>(V("data-v-22ff1c46"),e=e(),N(),e),Q={class:"wrapper"},R={class:"header"},X=K(()=>d("span",{class:"material-icons-round"}," close ",-1)),Y=[X],Z={key:0,class:"confirm"},ee=g({__name:"Template",props:{name:{type:String,required:!0},submitName:{type:String,required:!0},secondaryName:{type:String,required:!1,default:null},secondaryType:{type:String,required:!1,default:null}},emits:["submit","close","secondary"],setup(e,{expose:t,emit:l}){const c=p(!1),o=p(!1),u=()=>o.value=!1,a=()=>{c.value=!1,o.value=!0},s=()=>{c.value=!0,o.value=!0},i=()=>{u(),l("close")},y=()=>{l("submit"),i()},C=()=>{l("secondary"),i()};return t({show:a,hide:u,load:s}),(x,v)=>{const O=J("vue-final-modal");return n(),b(O,{onContextmenu:v[0]||(v[0]=k(()=>{},["stop"])),modelValue:o.value,"onUpdate:modelValue":v[1]||(v[1]=D=>o.value=D),classes:"modal-container","content-class":"modal-content"},{default:j(()=>[d("div",Q,[d("div",R,[d("h3",null,m(e.name),1),d("button",{class:"modal-close",onClick:i},Y)]),c.value?(n(),b(q,{key:0})):(n(),r(h,{key:1},[F(x.$slots,"default",{},void 0,!0),e.submitName||e.secondaryName?(n(),r("div",Z,[e.secondaryName?(n(),r("button",{key:0,class:M(["secondary",e.secondaryType]),onClick:C},m(e.secondaryName),3)):_("",!0),e.submitName?(n(),r("button",{key:1,onClick:y,class:"negative"},m(e.submitName),1)):_("",!0)])):_("",!0)],64))])]),_:3},8,["modelValue"])}}});const Se=S(ee,[["__scopeId","data-v-22ff1c46"]]),ae={class:"dropdown"},te={class:"material-symbols-rounded"},se={key:0,class:"dropdown__options"},oe=["onClick"],ne=g({__name:"Dropdown",props:{modelValue:{type:String,required:!0},options:{type:Array,required:!0}},emits:["update:modelValue"],setup(e,{emit:t}){const l=e,c=p(l.modelValue),o=p(!1);L(l,s=>{c.value=s.modelValue},{deep:!0});const u=s=>{c.value=s,t("update:modelValue",s),o.value=!1},a=B(()=>{const s=l.options.find(i=>i.value==c.value);return s?s.label:""});return window.onclick=()=>o.value=!1,(s,i)=>(n(),r("div",ae,[d("div",{class:"dropdown__selected",onClick:i[0]||(i[0]=k(y=>o.value=!o.value,["stop"]))},[d("span",null,m(f(a)),1),d("i",te,m(o.value?"expand_less":"expand_more"),1)]),o.value?(n(),r("div",se,[(n(!0),r(h,null,P(e.options,y=>(n(),r("div",{key:y.value,class:"dropdown__option",onClick:k(C=>u(y.value),["stop"])},m(y.label),9,oe))),128))])):_("",!0)]))}});const le=S(ne,[["__scopeId","data-v-2eeb3ec7"]]),ce=e=>(V("data-v-fba45348"),e=e(),N(),e),re={class:"form"},de={class:"content"},ie=["onClick"],ue=ce(()=>d("span",{class:"material-symbols-rounded"},"file_upload",-1)),me=[ue],ye=["accept","onChange"],_e=["onUpdate:modelValue","onChange"],ve=["onClick","src"],fe=["onUpdate:modelValue","type","onChange"],pe=g({__name:"Form",props:{options:{type:Array,required:!0}},setup(e,{expose:t}){const l=e;return t({toObject:()=>{const o={};return l.options.forEach(u=>{o[u.name]=u.value}),o}}),(o,u)=>(n(),r("div",re,[(n(!0),r(h,null,P(e.options,a=>(n(),r("div",{key:a.name,class:"option"},[d("h4",null,m(f(z)(a.name)),1),d("div",de,[a.type=="upload"?(n(),r(h,{key:0},[d("button",{onClick:()=>{var s,i;return(i=(s=o.$refs["upload-"+a.name])==null?void 0:s[0])==null?void 0:i.click()},class:"icon-button"},me,8,ie),d("input",{type:"file",ref_for:!0,ref:"upload-"+a.name,style:{display:"none"},accept:a.accept,onChange:s=>a==null?void 0:a.onUpload(s.target.files[0])},null,40,ye),$(d("input",{type:"text",class:"addSong cover","onUpdate:modelValue":s=>a.value=s,ref_for:!0,ref:"cover",onChange:s=>a==null?void 0:a.onChange(a.value)},null,40,_e),[[I,a.value]]),a.imagePreview?(n(),r("img",{key:0,onClick:s=>f(G)(a.value),class:"imagePreview",src:f(W)(a.value)},null,8,ve)):_("",!0)],64)):a.type=="dropdown"?(n(),b(le,{key:1,modelValue:a.value,"onUpdate:modelValue":s=>a.value=s,options:a.options},null,8,["modelValue","onUpdate:modelValue","options"])):$((n(),r("input",{key:2,"onUpdate:modelValue":s=>a.value=s,type:a.type,onChange:s=>a.onChange?a==null?void 0:a.onChange(a.value):null},null,40,fe)),[[A,a.value]])])]))),128))]))}});const Ce=S(pe,[["__scopeId","data-v-fba45348"]]),$e=async e=>{console.log("updateSong",e),await fetch(`/api/tracks/${e.id}`,{method:"PUT",body:JSON.stringify({source:e.src,title:e.title,artist:e.artist,album:e.album,cover:e.cover})})},Ve=async e=>await(await fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:e})})).json(),Ne=async(e,t)=>{e==="new"&&(e=await T()),typeof e=="string"&&console.error("playlistId cannot be a string",e),await fetch(`/api/playlists/${e}/tracks`,{method:"POST",body:JSON.stringify({source:t.src||t.source,title:t.title,artist:t.artist,album:t.album,cover:t.cover})})},Pe=async(e,t=!0)=>{await fetch(`/api/tracks/${e}`,{method:"PUT",body:JSON.stringify({favourite:t})})},Te=async e=>{window.open(`/api/tracks/${e}/download`)};export{Ce as F,Se as T,Ne as a,Ve as b,ke as c,Te as d,H as e,Pe as f,we as g,be as h,T as i,ge as r,$e as u};
