import{M as V}from"./MiniPlayer.f577d494.js";import{_ as b,g as p,o as n,c as r,b as _,n as y,t as m,f as O,a as s,p as C,h as k,i as F,w as f,j as c,v as U,F as S,d as w,k as v,e as B,l as E}from"./index.f3ab611c.js";import{F as H}from"./FindSources.7e71ed2f.js";const x={components:{MiniPlayer:V},name:"AlbumEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.$route.params.id),songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},D={class:"track"},J={class:"trackwrapper"};function j(e,t,o,h,d,i){const g=p("mini-player");return n(),r("div",{onDblclick:t[2]||(t[2]=()=>{i.playAt(),i.onselect()}),onClick:t[3]||(t[3]=(...u)=>i.onselect&&i.onselect(...u)),onMouseover:t[4]||(t[4]=u=>d.hovering=!0),onMouseleave:t[5]||(t[5]=u=>d.hovering=!1),class:y(["albumEntry",{selected:d.highlighted}])},[_(g,{class:y(["miniPlayer",{hidden:!d.hovering}]),src:o.preview},null,8,["class","src"]),d.hovering?O("",!0):(n(),r("span",{key:0,onClick:t[0]||(t[0]=(...u)=>e.edit&&e.edit(...u)),class:"id"},m(o.index+1),1)),s("div",D,[s("div",J,[s("span",{class:y(["title",{playing:e.playing}])},m(o.title),3),s("span",{class:y(["artist",{playing:e.playing}])},m(o.artist),3)])]),s("span",{onClick:t[1]||(t[1]=(...u)=>i.add&&i.add(...u)),class:"material-icons-round edit",ref:"add"},"add",512)],34)}var L=b(x,[["render",j],["__scopeId","data-v-4084152e"]]);const z={name:"AlbumHeader"},T=e=>(C("data-v-3678475d"),e=e(),k(),e),q={class:"gridHeader"},G=T(()=>s("span",{class:"id"},"#",-1)),K=T(()=>s("span",{class:"title"},"Title",-1)),Q=[G,K];function R(e,t,o,h,d,i){return n(),r("div",q,Q)}var W=b(z,[["render",R],["__scopeId","data-v-3678475d"]]);const X={name:"AddAlbumToPlaylist",components:{FindSources:H,AlbumEntry:L,AlbumHeader:W},props:{cover:String,artist:String,title:String,href:String,id:String},data(){return{showModal:!1,playlists:[],selectedPlaylist:-1,playlist:[],editSong:!1}},methods:{share(){window.open(this.href)},close(){this.showModal=!1,this.$emit("close")},loadMetadata(){fetch("/api/metadata",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.dTitle=e.title,this.$refs.album.value=e.album,this.dArtist=e.artists.join(", "),this.dCover=e.cover,this.$refs.source.value=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},addAll(){for(let e=0;e<this.playlist.length;e++)this.add(e)},add(e){const t=this.playlist[e],o=this.playlists.findIndex(h=>h==this.selectedPlaylist);if(console.log(t,o),o<0){alert("no playlist selected");return}fetch("/api/add",{method:"POST",body:JSON.stringify({id:o,source:t.src,title:t.title,artist:t.artists.join(", "),album:this.title,cover:this.cover})}).then(h=>{h.status==200&&(t.added=!0)})}},watch:{dSource(){this.loadMetadata()},showModal(){!this.showModal||(fetch("/api/playlists").then(e=>e.json()).then(e=>{this.playlists.length=0,this.playlists.push(...e)}),fetch("/api/spotify/album",{method:"POST",body:JSON.stringify({albumId:this.id})}).then(e=>e.json()).then(e=>{this.playlist.length=0,this.playlist.push(...e)}))}}},a=e=>(C("data-v-76e39b6d"),e=e(),k(),e),Y={class:"wrapper"},Z={class:"header"},$=a(()=>s("h3",null,"Add album",-1)),ee=a(()=>s("span",{class:"material-icons-round"}," close ",-1)),te=[ee],se=a(()=>s("h4",null,"To Playlist",-1)),le=a(()=>s("br",null,null,-1)),ie={key:0},oe=a(()=>s("h4",null,"Source",-1)),de={class:"content"},ne=a(()=>s("h4",null,"Title",-1)),ae={class:"content"},re=a(()=>s("h4",null,"Album",-1)),ue={class:"content"},ce=a(()=>s("h4",null,"Artist",-1)),he={class:"content"},pe=a(()=>s("h4",null,"Cover",-1)),me={class:"content"},ve=["src"],_e={class:"confirm"},ye={key:1},ge=["src"],fe={class:"details"},be={class:"detailswrapper"},Ae=E("Album"),Se=a(()=>s("hr",null,null,-1)),we=a(()=>s("hr",null,null,-1)),Ce={class:"confirm"};function ke(e,t,o,h,d,i){const g=p("FindSources"),u=p("h7"),P=p("album-header"),M=p("album-entry"),N=p("vue-final-modal"),I=F("observe-visibility");return n(),r("div",null,[_(N,{onClick:e.hideFindSourcesCtx,modelValue:d.showModal,"onUpdate:modelValue":t[13]||(t[13]=l=>d.showModal=l),classes:"modal-containerr","content-class":"addAlbumToPlaylistPopup"},{default:f(()=>[s("div",Y,[s("div",Z,[$,s("button",{class:"modal-close",onClick:t[0]||(t[0]=(...l)=>i.close&&i.close(...l))},te)]),se,c(s("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>d.selectedPlaylist=l)},[(n(!0),r(S,null,w(d.playlists,l=>(n(),r("option",{key:l},m(l),1))),128))],512),[[U,d.selectedPlaylist]]),le,d.editSong?(n(),r("div",ie,[oe,_(g,{ref:"findSources",title:o.title,artist:o.artist},{default:f(()=>[s("div",de,[c(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>e.dSource=l),ref:"source"},null,512),[[v,e.dSource]]),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[3]||(t[3]=(...l)=>e.opencontextmenu&&e.opencontextmenu(...l))},"more_vert",512)])]),_:1},8,["title","artist"]),ne,s("div",ae,[c(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.dTitle=l),type:"text"},null,512),[[v,e.dTitle]])]),re,s("div",ue,[c(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.dAlbum=l),type:"text",ref:"album"},null,512),[[v,e.dAlbum]])]),ce,s("div",he,[c(s("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.dArtist=l),type:"text"},null,512),[[v,e.dArtist]])]),pe,s("div",me,[c(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[7]||(t[7]=l=>e.dCover=l),ref:"cover"},null,512),[[v,e.dCover]]),s("img",{onClick:t[8]||(t[8]=(...l)=>i.openInNewTab&&i.openInNewTab(...l)),class:"addSong cover",src:e.dCover?e.dCover:"/assets/img/music_placeholder.png"},null,8,ve)]),s("div",_e,[s("button",{onClick:t[9]||(t[9]=(...l)=>i.add&&i.add(...l)),class:"negative"},"Add")])])):(n(),r("div",ye,[c((n(),r("div",{class:"padding-20 playlisteditor",onClick:t[11]||(t[11]=(...l)=>e.editPlaylist&&e.editPlaylist(...l))},[s("img",{class:"cover",src:o.cover},null,8,ge),s("div",fe,[s("div",be,[_(u,null,{default:f(()=>[Ae]),_:1}),s("span",{class:"material-icons-round share",onClick:t[10]||(t[10]=(...l)=>i.share&&i.share(...l))},"share")]),s("h1",null,m(o.title),1),s("h5",null,m(o.artist),1)])])),[[I,e.headerVisibilityChanged]]),Se,_(P),we,(n(!0),r(S,null,w(d.playlist,(l,A)=>(n(),B(M,{onAdd:i.add,key:A,added:l.added,index:A,cover:l.cover,artist:l.artists.join(", "),title:l.title,source:l.source,preview:l.preview},null,8,["onAdd","added","index","cover","artist","title","source","preview"]))),128))])),s("div",Ce,[s("button",{onClick:t[12]||(t[12]=(...l)=>i.addAll&&i.addAll(...l)),class:"negative"},"Add All")])])]),_:1},8,["onClick","modelValue"])])}var Ne=b(X,[["render",ke],["__scopeId","data-v-76e39b6d"]]);export{Ne as A};
