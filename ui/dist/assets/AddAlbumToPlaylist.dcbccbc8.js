import{M as V}from"./MiniPlayer.88255385.js";import{_ as b,b as m,o as d,c as r,e as _,n as y,t as p,j as O,a as s,p as C,k,d as E,f as g,w as c,v as F,F as S,h as w,l as v,i as U,g as B}from"./index.2f14e5a2.js";import{F as H}from"./FindSources.23aed4a7.js";const D={components:{MiniPlayer:V},name:"AlbumEntry",props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},added:Boolean,preview:String},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.$route.params.id),songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){this.$emit("edit",this.index)},add(){console.log("add"),this.$emit("add",this.index)}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"}}},J={class:"track"},x={class:"trackwrapper"};function j(e,t,o,h,n,i){const f=m("mini-player");return d(),r("div",{onDblclick:t[2]||(t[2]=()=>{i.playAt(),i.onselect()}),onClick:t[3]||(t[3]=(...u)=>i.onselect&&i.onselect(...u)),onMouseover:t[4]||(t[4]=u=>n.hovering=!0),onMouseleave:t[5]||(t[5]=u=>n.hovering=!1),class:y(["albumEntry",{selected:n.highlighted}])},[_(f,{class:y(["miniPlayer",{hidden:!n.hovering}]),title:o.title,artist:o.artist,src:o.source},null,8,["class","title","artist","src"]),n.hovering?O("",!0):(d(),r("span",{key:0,onClick:t[0]||(t[0]=(...u)=>e.edit&&e.edit(...u)),class:"id"},p(o.index+1),1)),s("div",J,[s("div",x,[s("span",{class:y(["title",{playing:e.playing}])},p(o.title),3),s("span",{class:y(["artist",{playing:e.playing}])},p(o.artist),3)])]),s("span",{onClick:t[1]||(t[1]=(...u)=>i.add&&i.add(...u)),class:"material-icons-round edit",ref:"add"},"add",512)],34)}var L=b(D,[["render",j],["__scopeId","data-v-0f1b8355"]]);const z={name:"AlbumHeader"},T=e=>(C("data-v-3678475d"),e=e(),k(),e),q={class:"gridHeader"},G=T(()=>s("span",{class:"id"},"#",-1)),K=T(()=>s("span",{class:"title"},"Title",-1)),Q=[G,K];function R(e,t,o,h,n,i){return d(),r("div",q,Q)}var W=b(z,[["render",R],["__scopeId","data-v-3678475d"]]);const X={name:"AddAlbumToPlaylist",components:{FindSources:H,AlbumEntry:L,AlbumHeader:W},props:{cover:String,artist:String,title:String,href:String,id:String},data(){return{showModal:!1,playlists:[],selectedPlaylist:-1,playlist:[],editSong:!1}},methods:{share(){window.open(this.href)},close(){this.showModal=!1,this.$emit("close")},loadMetadata(){fetch("/api/metadata",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.dTitle=e.title,this.$refs.album.value=e.album,this.dArtist=e.artists.join(", "),this.dCover=e.cover,this.$refs.source.value=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},addAll(){for(let e=0;e<this.playlist.length;e++)this.add(e)},preview(){console.log(this.href);const e=new CustomEvent("player.play",{detail:{artist:this.artist,title:this.title,source:this.href}});window.dispatchEvent(e)},add(e){const t=this.playlist[e],o=this.playlists.findIndex(h=>h==this.selectedPlaylist);if(console.log(t,o),o<0){alert("no playlist selected");return}fetch("/api/add",{method:"POST",body:JSON.stringify({id:o,source:t.src,title:t.title,artist:t.artists.join(", "),album:this.title,cover:this.cover})}).then(h=>{h.status==200&&(t.added=!0)})}},watch:{dSource(){this.loadMetadata()},showModal(){!this.showModal||(fetch("/api/playlists").then(e=>e.json()).then(e=>{this.playlists.length=0,this.playlists.push(...e)}),fetch("/api/spotify/album",{method:"POST",body:JSON.stringify({albumId:this.id})}).then(e=>e.json()).then(e=>{this.playlist.length=0,this.playlist.push(...e)}))}}},a=e=>(C("data-v-727b787a"),e=e(),k(),e),Y={class:"wrapper"},Z={class:"header"},$=a(()=>s("h3",null,"Add album",-1)),ee=a(()=>s("span",{class:"material-icons-round"}," close ",-1)),te=[ee],se=a(()=>s("h4",null,"To Playlist",-1)),le=a(()=>s("br",null,null,-1)),ie={key:0},oe=a(()=>s("h4",null,"Source",-1)),ne={class:"content"},de=a(()=>s("h4",null,"Title",-1)),ae={class:"content"},re=a(()=>s("h4",null,"Album",-1)),ue={class:"content"},ce=a(()=>s("h4",null,"Artist",-1)),he={class:"content"},me=a(()=>s("h4",null,"Cover",-1)),pe={class:"content"},ve=["src"],_e={class:"confirm"},ye={key:1},fe=["src"],ge={class:"details"},be={class:"detailswrapper"},Ae=B("Album"),Se=a(()=>s("hr",null,null,-1)),we=a(()=>s("hr",null,null,-1)),Ce={class:"confirm"};function ke(e,t,o,h,n,i){const f=m("FindSources"),u=m("h7"),P=m("album-header"),M=m("album-entry"),N=m("vue-final-modal"),I=E("observe-visibility");return d(),r("div",null,[_(N,{onClick:e.hideFindSourcesCtx,modelValue:n.showModal,"onUpdate:modelValue":t[14]||(t[14]=l=>n.showModal=l),classes:"modal-containerr","content-class":"addAlbumToPlaylistPopup"},{default:g(()=>[s("div",Y,[s("div",Z,[$,s("button",{class:"modal-close",onClick:t[0]||(t[0]=(...l)=>i.close&&i.close(...l))},te)]),se,c(s("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>n.selectedPlaylist=l)},[(d(!0),r(S,null,w(n.playlists,l=>(d(),r("option",{key:l},p(l),1))),128))],512),[[F,n.selectedPlaylist]]),le,n.editSong?(d(),r("div",ie,[oe,_(f,{ref:"findSources",src:e.dSource,title:o.title,artist:o.artist},{default:g(()=>[s("div",ne,[c(s("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=l=>e.dSource=l),ref:"source"},null,512),[[v,e.dSource]]),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[3]||(t[3]=(...l)=>e.opencontextmenu&&e.opencontextmenu(...l))},"more_vert",512)])]),_:1},8,["src","title","artist"]),de,s("div",ae,[c(s("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.dTitle=l),type:"text"},null,512),[[v,e.dTitle]])]),re,s("div",ue,[c(s("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.dAlbum=l),type:"text",ref:"album"},null,512),[[v,e.dAlbum]])]),ce,s("div",he,[c(s("input",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.dArtist=l),type:"text"},null,512),[[v,e.dArtist]])]),me,s("div",pe,[c(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[7]||(t[7]=l=>e.dCover=l),ref:"cover"},null,512),[[v,e.dCover]]),s("img",{onClick:t[8]||(t[8]=(...l)=>i.openInNewTab&&i.openInNewTab(...l)),class:"addSong cover",src:e.dCover?e.dCover:"/assets/img/music_placeholder.png"},null,8,ve)]),s("div",_e,[s("button",{onClick:t[9]||(t[9]=(...l)=>i.add&&i.add(...l)),class:"negative"},"Add")])])):(d(),r("div",ye,[c((d(),r("div",{class:"padding-20 playlisteditor",onClick:t[12]||(t[12]=(...l)=>e.editPlaylist&&e.editPlaylist(...l))},[s("img",{class:"cover",src:o.cover},null,8,fe),s("div",ge,[s("div",be,[_(u,null,{default:g(()=>[Ae]),_:1}),s("span",{class:"material-icons-round share",onClick:t[10]||(t[10]=(...l)=>i.share&&i.share(...l))},"share"),s("span",{class:"material-symbols-rounded share fill",onClick:t[11]||(t[11]=(...l)=>i.preview&&i.preview(...l))},"play_arrow")]),s("h1",null,p(o.title),1),s("h5",null,p(o.artist),1)])])),[[I,e.headerVisibilityChanged]]),Se,_(P),we,(d(!0),r(S,null,w(n.playlist,(l,A)=>(d(),U(M,{onAdd:i.add,key:A,added:l.added,index:A,cover:l.cover,artist:l.artists.join(", "),title:l.title,source:l.src,preview:l.source},null,8,["onAdd","added","index","cover","artist","title","source","preview"]))),128))])),s("div",Ce,[s("button",{onClick:t[13]||(t[13]=(...l)=>i.addAll&&i.addAll(...l)),class:"negative"},"Add All")])])]),_:1},8,["onClick","modelValue"])])}var Ne=b(X,[["render",ke],["__scopeId","data-v-727b787a"]]);export{Ne as A};
