import{S as P,E as w}from"./EditSong.d8f4fadf.js";import{_ as m,M as b,g as d,o as h,e as S,w as f,b as r,a,n as u,t as _,c as v,F as x,d as k}from"./index.3ba6d211.js";import{S as N}from"./SpotifyPlaylistHeader.73d2ef83.js";import"./FindSources.654050db.js";const O={name:"LightPlaylistEntry",components:{SongCtx:P,EditSong:w,Marquee:b},props:{index:Number,id:Number,artist:{type:String,default:"N/A"},title:{type:String,default:"N/A"},cover:{type:String,default:"/assets/img/music_placeholder.png"},source:String,album:{type:String,default:"N/A"},duration:{type:String,default:"N/A"},favourite:{type:Boolean,default:!1},playing:{type:Boolean,default:!1}},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks",hovering:!1}},methods:{download(){window.open("http://localhost:1234/api/download/"+this.id)},addToPlaylist(t){fetch("http://localhost:1234/api/add",{method:"POST",body:JSON.stringify({id:t,source:this.source})}).then(e=>{e.status==200&&this.$emit("requestUpdate")})},update(){this.$refs.editSongPopup.showModal=!0},remove(){fetch("http://localhost:1234/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.$route.params.id),songId:this.id})})},onselect(){this.highlighted=!this.highlighted},playAt(){console.log(this.$route.path);const t={index:this.index};t.playlistIndex=Number(this.$route.params.id),fetch("http://localhost:1234/api/at",{method:"POST",body:JSON.stringify(t)})},setFavourite(){fetch("http://localhost:1234/api/updateSong",{method:"POST",body:JSON.stringify({id:this.id,favourite:this.favourited,album:this.album,artist:this.artist,title:this.title,duration:this.duration,cover:this.cover,source:this.source})})},displayPlay(){const t=this.$refs.idOrPlay;t.innerHTML="play_arrow",t.classList.add("material-icons-round")},displayId(){const t=this.$refs.idOrPlay;t.innerHTML=this.index+1,t.classList.remove("material-icons-round")}},watch:{added(){console.log("change"),this.$refs.add.innerHTML=this.added?"done":"add"},favourited(){this.setFavourite()},favourite(){console.log("mounted",this.title,this.favourite,this.favourited),this.favourited=this.favourite,this.highlighted=!1}}},A={class:"track"},M=["src"],T={class:"trackwrapper"},C={class:"duration"};function L(t,e,s,y,l,i){const p=d("EditSong"),c=d("Marquee"),o=d("router-link"),g=d("SongCtx");return h(),S(g,{onDownload:i.download,onAddto:i.addToPlaylist,onRemove:i.remove,onUpdate:i.update,onLike:e[5]||(e[5]=n=>l.favourited=!l.favourited),isAutoPlaylist:l.isAutoPlaylist,liked:l.favourited,ref:"ctxMenu"},{default:f(()=>[r(p,{onClose:t.updatePlaylist,ref:"editSongPopup",cover:s.cover,id:s.id,title:s.title,album:s.album,artist:s.artist,source:s.source},null,8,["onClose","cover","id","title","album","artist","source"]),a("div",{onDblclick:e[1]||(e[1]=()=>{i.playAt(),i.onselect()}),onClick:e[2]||(e[2]=(...n)=>i.onselect&&i.onselect(...n)),onMouseover:e[3]||(e[3]=(...n)=>i.displayPlay&&i.displayPlay(...n)),onMouseleave:e[4]||(e[4]=(...n)=>i.displayId&&i.displayId(...n)),class:u(["playlistEntry",{selected:l.highlighted}])},[a("span",{onClick:e[0]||(e[0]=(...n)=>i.playAt&&i.playAt(...n)),ref:"idOrPlay",class:u([{playing:s.playing},"id"])},_(s.index+1),3),a("div",A,[a("img",{src:s.cover||"/assets/img/music_placeholder.png"},null,8,M),a("div",T,[a("span",{class:u(["title",{playing:s.playing}])},[r(o,{class:"linkOnHover",to:`/track/${s.id}`},{default:f(()=>[r(c,{text:s.title},null,8,["text"])]),_:1},8,["to"])],2),a("span",{class:u(["artist",{playing:s.playing}])},[r(o,{class:"linkOnHover",to:`/search/${s.artist}`},{default:f(()=>[r(c,{text:s.artist},null,8,["text"])]),_:1},8,["to"])],2)])]),a("span",C,_(s.duration),1)],34)]),_:1},8,["onDownload","onAddto","onRemove","onUpdate","isAutoPlaylist","liked"])}var B=m(O,[["render",L],["__scopeId","data-v-02977fd2"]]);const E={components:{LightPlaylistEntry:B,SpotifyPlaylistHeader:N},name:"BigPlayer",methods:{fetchPlaylist(){fetch("http://localhost:1234/api/playlist",{method:"POST"}).then(t=>t.json()).then(t=>this.playlist=t)},updateData(t){var e,s;if(t.path=="player.song"){this.cover=((e=t==null?void 0:t.data)==null?void 0:e.cover)||"/assets/img/music_placeholder.png",this.currentSongName=((s=t==null?void 0:t.data)==null?void 0:s.title)||"";return}}},data(){const t=()=>{console.log("attempting reconnect");let e=new WebSocket("ws://localhost:1234/ws");e.onclose=()=>{console.log("ws closed"),setTimeout(t,1e3)},e.onopen=()=>{console.log("ws connected")},e.onmessage=s=>{const y=JSON.parse(s.data);this.updateData(y)}};return t(),this.fetchPlaylist(),{cover:"/assets/img/music_placeholder.png",playlist:[],currentSongName:""}}},I={class:"bigPlayer"},D={class:"upNow"},q=["src"],H={class:"playlistOverflow"},J={class:"playlist"};function U(t,e,s,y,l,i){const p=d("spotify-playlist-header"),c=d("light-playlist-entry");return h(),v("div",I,[a("div",D,[a("img",{src:l.cover},null,8,q)]),a("div",H,[a("div",J,[r(p),(h(!0),v(x,null,k(l.playlist.songs,o=>(h(),S(c,{key:o.source,onDownload:t.download,onRequestUpdate:t.updatePlaylist,index:l.playlist.songs.findIndex(g=>g.source==o.source),source:o.source,playing:o.title==l.currentSongName,id:o.id,title:o.title,album:o.album,artist:o.artist,cover:o.cover,favourite:o.favourite,duration:o.duration},null,8,["onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"]))),128))])])])}var W=m(E,[["render",U],["__scopeId","data-v-2fa24877"]]);export{W as default};
