import{_ as x,e as _,l as A,m as h,o as v,c as f,r as T,g as l,w as d,b as u,t as w,f as g,d as V,F as E,i as N,a as o,q as p,p as M,h as F}from"./index.ff638037.js";import{F as U}from"./FindSources.b3ac8d2c.js";const B={name:"SongCtx",props:{liked:Boolean,isAutoPlaylist:Boolean,src:String,artist:String,title:String,playlists:Array},methods:{preview(){const e=new CustomEvent("player.play",{detail:{title:this.title,artist:this.artist,source:this.src}});window.dispatchEvent(e),this.$refs.contextmenu.hide()},hide(){this.$refs.contextmenu.hide()},show(e){const t=this.$refs.box.getBoundingClientRect(),c={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(c),e==null||e.stopPropagation()},like(){this.$emit("like")},remove(){this.$emit("remove")},addto(e){if(e==="new"){fetch("/api/playlists/new").then(t=>t.text()).then(t=>{this.$emit("addto",Number(t.replace("/playlist/","")))});return}this.$emit("addto",e)},download(){this.$emit("download")},update(){this.$emit("update")}}},I={ref:"box"};function P(e,t,c,C,i,n){const r=_("v-contextmenu-item"),m=_("v-contextmenu-divider"),s=_("v-contextmenu-submenu"),k=_("v-contextmenu"),b=A("contextmenu");return h((v(),f("div",I,[T(e.$slots,"default"),l(k,{ref:"contextmenu"},{default:d(()=>[l(r,{onClick:n.preview},{default:d(()=>[u("Preview")]),_:1},8,["onClick"]),l(m),l(r,{onClick:n.like},{default:d(()=>[u(w((c.liked?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1},8,["onClick"]),c.isAutoPlaylist?V("",!0):(v(),g(r,{key:0,onClick:n.remove},{default:d(()=>[u("Remove from this playlist")]),_:1},8,["onClick"])),l(s,{title:"Add to playlist"},{default:d(()=>[l(r,{onClick:t[0]||(t[0]=()=>n.addto("new"))},{default:d(()=>[u("Add to new playlist")]),_:1}),l(m),(v(!0),f(E,null,N(c.playlists,(y,S)=>(v(),g(r,{key:S,onClick:()=>n.addto(S)},{default:d(()=>[u(w(y),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(m),l(r,{onClick:n.update},{default:d(()=>[u("Update Metadata")]),_:1},8,["onClick"]),l(m),l(r,{onClick:n.download},{default:d(()=>[u("Download")]),_:1},8,["onClick"])]),_:1},512)])),[[b,void 0,"contextmenu"]])}const it=x(B,[["render",P]]);const D={name:"EditSong",components:{FindSources:U},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{opencontextmenu(e){this.$refs.findSourcesEdit.show(e)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/tracks/${this.id}`,{method:"PUT",body:JSON.stringify({source:this.dSource,title:this.dTitle,artist:this.dArtist,album:this.dAlbum,cover:this.dCover})}).then(e=>{console.log(e),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.dTitle=e.title,this.dAlbum=e.album,this.dArtist=e.artists.join(", "),this.dCover=e.cover,this.dSource=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},a=e=>(M("data-v-3e0d3db9"),e=e(),F(),e),O={class:"wrapper"},R={class:"header"},J=a(()=>o("h3",null,"Edit song",-1)),L=a(()=>o("span",{class:"material-icons-round"}," close ",-1)),q=[L],X=a(()=>o("h4",null,"Source",-1)),Y={class:"content"},z=a(()=>o("h4",null,"Title",-1)),G={class:"content"},H=a(()=>o("h4",null,"Album",-1)),K={class:"content"},Q=a(()=>o("h4",null,"Artist",-1)),W={class:"content"},Z=a(()=>o("h4",null,"Cover",-1)),j={class:"content"},$=["src"],tt={class:"confirm"};function et(e,t,c,C,i,n){const r=_("FindSources"),m=_("vue-final-modal");return v(),f("div",null,[l(m,{onClick:n.hideFindSourcesCtx,modelValue:i.showModal,"onUpdate:modelValue":t[9]||(t[9]=s=>i.showModal=s),classes:"modal-container","content-class":"modal-content"},{default:d(()=>[o("div",O,[o("div",R,[J,o("button",{class:"modal-close",onClick:t[0]||(t[0]=s=>i.showModal=!1)},q)]),X,l(r,{ref:"findSourcesEdit",src:i.dSource,title:i.dTitle,artist:i.dArtist},{default:d(()=>[o("div",Y,[h(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.dSource=s),type:"text",ref:"source"},null,512),[[p,i.dSource]]),o("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[2]||(t[2]=(...s)=>n.opencontextmenu&&n.opencontextmenu(...s))},"more_vert",512)])]),_:1},8,["src","title","artist"]),z,o("div",G,[h(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.dTitle=s),type:"text"},null,512),[[p,i.dTitle]])]),H,o("div",K,[h(o("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.dAlbum=s),type:"text",ref:"album"},null,512),[[p,i.dAlbum]])]),Q,o("div",W,[h(o("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.dArtist=s),type:"text"},null,512),[[p,i.dArtist]])]),Z,o("div",j,[h(o("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[6]||(t[6]=s=>i.dCover=s),ref:"cover"},null,512),[[p,i.dCover]]),o("img",{onClick:t[7]||(t[7]=(...s)=>n.openInNewTab&&n.openInNewTab(...s)),class:"addSong cover",src:c.cover?c.cover:"/assets/img/music_placeholder.png"},null,8,$)]),o("div",tt,[o("button",{onClick:t[8]||(t[8]=(...s)=>n.add&&n.add(...s)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}const nt=x(D,[["render",et],["__scopeId","data-v-3e0d3db9"]]);export{nt as E,it as S};
