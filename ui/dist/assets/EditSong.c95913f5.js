import{_ as x,b as _,d as A,w as h,o as v,c as f,r as T,e as l,f as d,g as u,t as w,i as g,j as V,F as E,h as N,a as o,l as p,p as M,k as F}from"./index.87a4becd.js";import{F as U}from"./FindSources.3e22f636.js";const B={name:"SongCtx",props:{liked:Boolean,isAutoPlaylist:Boolean,src:String,artist:String,title:String,playlists:Array},methods:{preview(){const e=new CustomEvent("player.play",{detail:{title:this.title,artist:this.artist,source:this.src}});window.dispatchEvent(e),this.$refs.contextmenu.hide()},hide(){this.$refs.contextmenu.hide()},show(e){const t=this.$refs.box.getBoundingClientRect(),c={top:t.height+t.top+window.scrollY,left:t.width+t.left+window.scrollX};this.$refs.contextmenu.show(c),e==null||e.stopPropagation()},like(){this.$emit("like")},remove(){this.$emit("remove")},addto(e){if(e==="new"){fetch("/api/playlists/new").then(t=>t.text()).then(t=>{this.$emit("addto",Number(t.replace("/playlist/","")))});return}this.$emit("addto",e)},download(){this.$emit("download")},update(){this.$emit("update")}}},I={ref:"box"},P=u("Preview"),D=u("Remove from this playlist"),O=u("Add to new playlist"),R=u("Update Metadata"),J=u("Download");function L(e,t,c,C,i,n){const r=_("v-contextmenu-item"),m=_("v-contextmenu-divider"),s=_("v-contextmenu-submenu"),k=_("v-contextmenu"),b=A("contextmenu");return h((v(),f("div",I,[T(e.$slots,"default"),l(k,{ref:"contextmenu"},{default:d(()=>[l(r,{onClick:n.preview},{default:d(()=>[P]),_:1},8,["onClick"]),l(m),l(r,{onClick:n.like},{default:d(()=>[u(w((c.liked?"Remove from":"Save to")+" your Liked Songs"),1)]),_:1},8,["onClick"]),c.isAutoPlaylist?V("",!0):(v(),g(r,{key:0,onClick:n.remove},{default:d(()=>[D]),_:1},8,["onClick"])),l(s,{title:"Add to playlist"},{default:d(()=>[l(r,{onClick:t[0]||(t[0]=()=>n.addto("new"))},{default:d(()=>[O]),_:1}),l(m),(v(!0),f(E,null,N(c.playlists,(y,S)=>(v(),g(r,{key:S,onClick:()=>n.addto(S)},{default:d(()=>[u(w(y),1)]),_:2},1032,["onClick"]))),128))]),_:1}),l(m),l(r,{onClick:n.update},{default:d(()=>[R]),_:1},8,["onClick"]),l(m),l(r,{onClick:n.download},{default:d(()=>[J]),_:1},8,["onClick"])]),_:1},512)])),[[b,void 0,"contextmenu"]])}var ct=x(B,[["render",L]]);const X={name:"EditSong",components:{FindSources:U},props:{cover:String,album:String,artist:String,source:String,title:String,id:Number},data(){return{showModal:!1,dCover:this.cover,dAlbum:this.album,dArtist:this.artist,dTitle:this.title,dSource:this.source}},methods:{opencontextmenu(e){this.$refs.findSourcesEdit.show(e)},hideFindSourcesCtx(){this.$refs.findSourcesEdit.hide()},add(){this.showModal=!1,console.log("fetch"),fetch(`/api/tracks/${this.id}`,{method:"PUT",body:JSON.stringify({source:this.dSource,title:this.dTitle,artist:this.dArtist,album:this.dAlbum,cover:this.dCover})}).then(e=>{console.log(e),this.$emit("close")})},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.dTitle=e.title,this.dAlbum=e.album,this.dArtist=e.artists.join(", "),this.dCover=e.cover,this.dSource=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{id(){this.dCover=this.cover,this.dAlbum=this.album,this.dArtist=this.artist,this.dTitle=this.title,this.dSource=this.source}}},a=e=>(M("data-v-731b19d0"),e=e(),F(),e),Y={class:"wrapper"},q={class:"header"},z=a(()=>o("h3",null,"Edit song",-1)),G=a(()=>o("span",{class:"material-icons-round"}," close ",-1)),H=[G],K=a(()=>o("h4",null,"Source",-1)),Q={class:"content"},W=a(()=>o("h4",null,"Title",-1)),Z={class:"content"},j=a(()=>o("h4",null,"Album",-1)),$={class:"content"},tt=a(()=>o("h4",null,"Artist",-1)),et={class:"content"},ot=a(()=>o("h4",null,"Cover",-1)),st={class:"content"},it=["src"],nt={class:"confirm"};function lt(e,t,c,C,i,n){const r=_("FindSources"),m=_("vue-final-modal");return v(),f("div",null,[l(m,{onClick:n.hideFindSourcesCtx,modelValue:i.showModal,"onUpdate:modelValue":t[9]||(t[9]=s=>i.showModal=s),classes:"modal-container","content-class":"modal-content"},{default:d(()=>[o("div",Y,[o("div",q,[z,o("button",{class:"modal-close",onClick:t[0]||(t[0]=s=>i.showModal=!1)},H)]),K,l(r,{ref:"findSourcesEdit",src:i.dSource,title:i.dTitle,artist:i.dArtist},{default:d(()=>[o("div",Q,[h(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>i.dSource=s),type:"text",ref:"source"},null,512),[[p,i.dSource]]),o("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[2]||(t[2]=(...s)=>n.opencontextmenu&&n.opencontextmenu(...s))},"more_vert",512)])]),_:1},8,["src","title","artist"]),W,o("div",Z,[h(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>i.dTitle=s),type:"text"},null,512),[[p,i.dTitle]])]),j,o("div",$,[h(o("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>i.dAlbum=s),type:"text",ref:"album"},null,512),[[p,i.dAlbum]])]),tt,o("div",et,[h(o("input",{"onUpdate:modelValue":t[5]||(t[5]=s=>i.dArtist=s),type:"text"},null,512),[[p,i.dArtist]])]),ot,o("div",st,[h(o("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[6]||(t[6]=s=>i.dCover=s),ref:"cover"},null,512),[[p,i.dCover]]),o("img",{onClick:t[7]||(t[7]=(...s)=>n.openInNewTab&&n.openInNewTab(...s)),class:"addSong cover",src:c.cover?c.cover:"/assets/img/music_placeholder.png"},null,8,it)]),o("div",nt,[o("button",{onClick:t[8]||(t[8]=(...s)=>n.add&&n.add(...s)),class:"negative"},"Save")])])]),_:1},8,["onClick","modelValue"])])}var ut=x(X,[["render",lt],["__scopeId","data-v-731b19d0"]]);export{ut as E,ct as S};
