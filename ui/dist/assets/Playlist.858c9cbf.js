import{F as A,G as U}from"./FixedPlaylistHeader.868eb444.js";import{P as $}from"./PlaylistEntry.07ef592e.js";import{F as E}from"./FindSources.57db17e0.js";import{H as P,_ as S,b as c,o as v,c as f,e as p,f as g,a as s,w as m,l as _,p as N,k as C,n as H,j as F,t as w,g as J,d as R}from"./index.7dbe1ace.js";import{d as L}from"./vuedraggable.umd.77489433.js";import"./EditSong.ded24798.js";const B=new P("reapOne.playlist",22),q={name:"AddSong",components:{FindSources:E},data(){return{showModal:!1,cover:"",artist:"",title:""}},watch:{showModal(){!this.showModal||navigator.clipboard.readText().then(t=>{!this.isValidHttpUrl(t)||(this.$refs.source.value=t,this.loadMetadata())})}},methods:{isValidHttpUrl(t){let e;try{e=new URL(t)}catch{return!1}return e.protocol==="http:"||e.protocol==="https:"},opencontextmenu(t){this.$refs.findSources.show(t)},hideFindSourcesCtx(){this.$refs.findSources.hide()},getId(){return Number(B.decode(this.$route.params.id))},add(){this.showModal=!1,console.log("fetch"),fetch("/api/add",{method:"POST",body:JSON.stringify({id:this.getId(),source:this.$refs.source.value,title:this.title,artist:this.artist,album:this.$refs.album.value,cover:this.cover})}).then(t=>{console.log(t),this.$emit("close")})},loadMetadata(){fetch("/api/metadata",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(t=>t.json()).then(t=>{console.log(t),this.title=t.title,this.$refs.album.value=t.album,this.artist=t.artists.join(", "),this.cover=t.cover,this.$refs.source.value=t.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}}},y=t=>(N("data-v-231c30bd"),t=t(),C(),t),G={class:"wrapper"},z={class:"header"},W=y(()=>s("h3",null,"Add song",-1)),K=y(()=>s("span",{class:"material-icons-round"}," close ",-1)),Q=[K],X=y(()=>s("h4",null,"Source",-1)),Y={class:"content"},Z=y(()=>s("h4",null,"Title",-1)),j={class:"content"},ee=y(()=>s("h4",null,"Album",-1)),te={class:"content"},se={type:"text",ref:"album"},oe=y(()=>s("h4",null,"Artist",-1)),le={class:"content"},ie=y(()=>s("h4",null,"Cover",-1)),ne={class:"content"},ae=["src"],de={class:"confirm"};function re(t,e,d,r,o,l){const u=c("FindSources"),i=c("vue-final-modal");return v(),f("div",null,[p(i,{onClick:l.hideFindSourcesCtx,modelValue:o.showModal,"onUpdate:modelValue":e[8]||(e[8]=h=>o.showModal=h),classes:"modal-container","content-class":"modal-content"},{default:g(()=>{var h;return[s("div",G,[s("div",z,[W,s("button",{class:"modal-close",onClick:e[0]||(e[0]=n=>o.showModal=!1)},Q)]),X,p(u,{ref:"findSources",src:(h=t.$refs.source)==null?void 0:h.value,title:o.title,artist:o.artist},{default:g(()=>[s("div",Y,[s("input",{onChange:e[1]||(e[1]=(...n)=>l.loadMetadata&&l.loadMetadata(...n)),type:"text",ref:"source"},null,544),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:e[2]||(e[2]=(...n)=>l.opencontextmenu&&l.opencontextmenu(...n))},"more_vert",512)])]),_:1},8,["src","title","artist"]),Z,s("div",j,[m(s("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>o.title=n),type:"text"},null,512),[[_,o.title]])]),ee,s("div",te,[s("input",se,null,512)]),oe,s("div",le,[m(s("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>o.artist=n),type:"text"},null,512),[[_,o.artist]])]),ie,s("div",ne,[m(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[5]||(e[5]=n=>o.cover=n),ref:"cover"},null,512),[[_,o.cover]]),s("img",{onClick:e[6]||(e[6]=(...n)=>l.openInNewTab&&l.openInNewTab(...n)),class:"addSong cover",src:o.cover?o.cover:"/assets/img/music_placeholder.png"},null,8,ae)]),s("div",de,[s("button",{onClick:e[7]||(e[7]=(...n)=>l.add&&l.add(...n)),class:"negative"},"Add")])])]}),_:1},8,["onClick","modelValue"])])}var ce=S(q,[["render",re],["__scopeId","data-v-231c30bd"]]);const x=new P("reapOne.playlist",22),pe={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String,playlistCover:String},data(){return{showModal:!1,cover:"",name:this.playlistName,description:this.playlistDescription,cover:this.playlistCover}},methods:{apply(){this.showModal=!1,console.log("fetch"),fetch("/api/updatePlaylist",{method:"POST",body:JSON.stringify({id:Number(x.decode(this.$route.params.id)),name:this.name||"N/A",description:this.description||"N/A",cover:this.cover||"/assets/img/music_placeholder.png"})}).then(t=>{console.log(t),this.$emit("close")})},remove(){fetch(`/api/playlist/${Number(x.decode(this.$route.params.id))}`,{method:"DELETE"}).then(()=>{this.$router.push("/")})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription},playlistCover(){this.cover=this.playlistCover}}},b=t=>(N("data-v-cfb558c6"),t=t(),C(),t),ue={class:"wrapper"},he={class:"header"},me=b(()=>s("h3",null,"Edit details",-1)),ye=b(()=>s("span",{class:"material-icons-round"}," close ",-1)),_e=[ye],ve=b(()=>s("h4",null,"Name",-1)),fe={class:"content"},ge=b(()=>s("h4",null,"Description",-1)),be={class:"content"},we=b(()=>s("h4",null,"Cover",-1)),Pe={class:"content"},Se=["src"],Ne={class:"confirm"};function Ce(t,e,d,r,o,l){const u=c("vue-final-modal");return v(),f("div",null,[p(u,{modelValue:o.showModal,"onUpdate:modelValue":e[7]||(e[7]=i=>o.showModal=i),classes:"modal-container","content-class":"modal-content"},{default:g(()=>[s("div",ue,[s("div",he,[me,s("button",{class:"modal-close",onClick:e[0]||(e[0]=i=>o.showModal=!1)},_e)]),ve,s("div",fe,[m(s("input",{"onUpdate:modelValue":e[1]||(e[1]=i=>o.name=i),type:"text",ref:"name"},null,512),[[_,o.name]])]),ge,s("div",be,[m(s("input",{"onUpdate:modelValue":e[2]||(e[2]=i=>o.description=i),type:"text",ref:"description"},null,512),[[_,o.description]])]),we,s("div",Pe,[m(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":e[3]||(e[3]=i=>o.cover=i),ref:"cover"},null,512),[[_,o.cover]]),s("img",{onClick:e[4]||(e[4]=(...i)=>l.openInNewTab&&l.openInNewTab(...i)),class:"addSong cover",src:o.cover?o.cover:"/assets/img/music_placeholder.png"},null,8,Se)]),s("div",Ne,[s("button",{onClick:e[5]||(e[5]=(...i)=>l.remove&&l.remove(...i)),class:"negative left"},"Delete"),s("button",{onClick:e[6]||(e[6]=(...i)=>l.apply&&l.apply(...i)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}var xe=S(pe,[["render",Ce],["__scopeId","data-v-cfb558c6"]]);const I=new P("reapOne.playlist",22),Ie={components:{PlaylistEntry:$,FixedPlaylistHeader:A,GridHeader:U,AddSong:ce,EditPlaylist:xe,draggable:L},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:"",playlistCover:null}},methods:{getId(){return I.decode(this.$route.params.id)},download(t){var d;const e=(d=this.playlist)==null?void 0:d[t];window.open("/api/download/"+e.id)},onPlaylistRearrange(t){const e=t.moved;!e||fetch("/api/rearrange",{method:"POST",body:JSON.stringify({playlistIndex:Number(this.getId()),songOldIndex:e.oldIndex,songNewIndex:e.newIndex})})},connect(){const t=this;console.log("attempting reconnect");let e=new WebSocket("ws://localhost:1234/ws");e.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},e.onopen=()=>{console.log("ws connected")},e.onmessage=function(d){const r=JSON.parse(d.data);t.updateData(r)}},headerVisibilityChanged(t){this.fixedHeaderHidden=t},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(t){var e;if(t.path=="player.song"){let d=((e=t==null?void 0:t.data)==null?void 0:e.title)||"N/A";for(const r of this.playlist)r.playing=r.title==d}},updatePlaylist(){if(!!this.getId()&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlist/create").then(t=>t.text()).then(t=>{const e=I.encode(t);console.log(e),this.$router.push(e)});return}fetch("/api/playlist",{method:"POST",body:JSON.stringify({id:Number(this.getId())})}).then(async t=>{if(t.status==404){this.$router.push("/");return}const e=await t.json();this.playlist=e.songs,this.playlistName=e.name,this.playlistDescription=e.description,this.playlistCover=e.cover,document.title=`${this.playlistName} - reAudioPlayer One`,console.log(this.playlist),this.connect()})}},loadPlaylist(){fetch("/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"playlist"})})}},computed:{autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},estimatedDuration(){let t=0,e=!1;if(!this.playlist.length)return"";for(const u of this.playlist){e=e||u.duration=="-1:59";const i=u.duration=="-1:59"?"3:00":u.duration,[h,n]=i.split(":");t+=Number(h*60)+Number(n)}const d=t,r=Math.floor(d/60),o=Math.floor(r/60),l=e?", about ":", ";return o?l+`${o} hr ${r-o*60} min`:r?l+`${r} min ${d-r*60} sec`:l+t+" sec"}},watch:{$route(){this.updatePlaylist()}}},D=t=>(N("data-v-db9cf5e6"),t=t(),C(),t),De={class:"playlist"},Me=["src"],Ve={class:"details"},Te=J("Playlist"),ke={class:"muted description"},Oe={class:"mobileMenu showIfMobile"},Ae=D(()=>s("hr",null,null,-1)),Ue={class:"padding-20"},$e={class:"grid"},Ee=D(()=>s("hr",null,null,-1)),He={class:"playlistEntries"};function Fe(t,e,d,r,o,l){const u=c("AddSong"),i=c("EditPlaylist"),h=c("fixed-playlist-header"),n=c("h7"),M=c("grid-header"),V=c("playlist-entry"),T=c("draggable"),k=R("observe-visibility");return v(),f("div",De,[p(u,{onClose:l.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),p(i,{onClose:l.updatePlaylist,playlistCover:o.playlistCover,playlistName:o.playlistName,playlistDescription:o.playlistDescription,ref:"editPlaylistPopup"},null,8,["onClose","playlistCover","playlistName","playlistDescription"]),p(h,{onLoadPlaylist:l.loadPlaylist,ref:"fixedHeading",class:H({hidden:o.fixedHeaderHidden}),title:o.playlistName},null,8,["onLoadPlaylist","class","title"]),m((v(),f("div",{class:"padding-20 playlisteditor",onClick:e[0]||(e[0]=(...a)=>l.editPlaylist&&l.editPlaylist(...a))},[o.playlistCover?(v(),f("img",{key:0,class:"cover",src:o.playlistCover},null,8,Me)):F("",!0),s("div",Ve,[p(n,{class:"hideIfMobile"},{default:g(()=>[Te]),_:1}),s("h1",null,w(o.playlistName),1),s("h5",null,w(o.playlistDescription),1),s("p",ke,w(l.autogeneratedDescription),1)])])),[[k,l.headerVisibilityChanged]]),s("div",Oe,[s("span",{onClick:e[1]||(e[1]=()=>t.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),Ae,s("div",Ue,[s("span",{id:"loadPlaylist",onClick:e[2]||(e[2]=(...a)=>l.loadPlaylist&&l.loadPlaylist(...a)),class:"material-icons-outlined"},"play_circle_filled"),s("span",{id:"addToPlaylist",onClick:e[3]||(e[3]=(...a)=>l.addToPlaylist&&l.addToPlaylist(...a)),class:"material-icons-outlined"},"add_circle"),s("div",$e,[p(M),Ee,s("div",He,[p(T,{modelValue:o.playlist,"onUpdate:modelValue":e[4]||(e[4]=a=>o.playlist=a),onChange:l.onPlaylistRearrange},{item:g(({element:a})=>[p(V,{onDownload:l.download,onRequestUpdate:l.updatePlaylist,index:o.playlist.findIndex(O=>O.source==a.source),source:a.source,playing:a.playing,id:a.id,title:a.title,album:a.album,artist:a.artist,cover:a.cover,favourite:a.favourite,duration:a.duration},null,8,["onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}var ze=S(Ie,[["render",Fe],["__scopeId","data-v-db9cf5e6"]]);export{ze as default};
