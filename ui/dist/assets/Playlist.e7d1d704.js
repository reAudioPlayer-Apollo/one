import{F as $,G as E}from"./FixedPlaylistHeader.fe576915.js";import{P as H}from"./PlaylistEntry.30bd861d.js";import{F as U}from"./FindSources.68b83a66.js";import{H as P,_ as S,b as c,o as _,c as f,e as u,f as g,a as s,w as y,l as v,p as x,k as N,n as A,j as F,t as w,g as J,d as R}from"./index.10406a89.js";import{d as L}from"./vuedraggable.umd.3c9faafa.js";import"./EditSong.882948e4.js";const B=new P("reapOne.playlist",22),q={name:"AddSong",components:{FindSources:U},data(){return{showModal:!1,cover:"",artist:"",title:""}},watch:{showModal(){!this.showModal||navigator.clipboard.readText().then(e=>{!this.isValidHttpUrl(e)||(this.$refs.source.value=e,this.loadMetadata())})}},methods:{isValidHttpUrl(e){let t;try{t=new URL(e)}catch{return!1}return t.protocol==="http:"||t.protocol==="https:"},opencontextmenu(e){this.$refs.findSources.show(e)},hideFindSourcesCtx(){this.$refs.findSources.hide()},getId(){return Number(B.decode(this.$route.params.id))},add(){this.showModal=!1,console.log("fetch"),fetch("/api/add",{method:"POST",body:JSON.stringify({id:this.getId(),source:this.$refs.source.value,title:this.title,artist:this.artist,album:this.$refs.album.value,cover:this.cover})}).then(e=>{console.log(e),this.$emit("close")})},loadMetadata(){fetch("/api/metadata",{method:"POST",body:JSON.stringify({url:this.$refs.source.value})}).then(e=>e.json()).then(e=>{console.log(e),this.title=e.title,this.$refs.album.value=e.album,this.artist=e.artists.join(", "),this.cover=e.cover,this.$refs.source.value=e.src})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")}}},m=e=>(x("data-v-231c30bd"),e=e(),N(),e),G={class:"wrapper"},z={class:"header"},W=m(()=>s("h3",null,"Add song",-1)),K=m(()=>s("span",{class:"material-icons-round"}," close ",-1)),Q=[K],X=m(()=>s("h4",null,"Source",-1)),Y={class:"content"},Z=m(()=>s("h4",null,"Title",-1)),j={class:"content"},tt=m(()=>s("h4",null,"Album",-1)),et={class:"content"},st={type:"text",ref:"album"},lt=m(()=>s("h4",null,"Artist",-1)),ot={class:"content"},it=m(()=>s("h4",null,"Cover",-1)),nt={class:"content"},at=["src"],dt={class:"confirm"};function rt(e,t,d,r,l,o){const p=c("FindSources"),a=c("vue-final-modal");return _(),f("div",null,[u(a,{onClick:o.hideFindSourcesCtx,modelValue:l.showModal,"onUpdate:modelValue":t[8]||(t[8]=h=>l.showModal=h),classes:"modal-container","content-class":"modal-content"},{default:g(()=>{var h;return[s("div",G,[s("div",z,[W,s("button",{class:"modal-close",onClick:t[0]||(t[0]=i=>l.showModal=!1)},Q)]),X,u(p,{ref:"findSources",src:(h=e.$refs.source)==null?void 0:h.value,title:l.title,artist:l.artist},{default:g(()=>[s("div",Y,[s("input",{onChange:t[1]||(t[1]=(...i)=>o.loadMetadata&&o.loadMetadata(...i)),type:"text",ref:"source"},null,544),s("span",{class:"material-icons-round more",ref:"sourceMore",onClick:t[2]||(t[2]=(...i)=>o.opencontextmenu&&o.opencontextmenu(...i))},"more_vert",512)])]),_:1},8,["src","title","artist"]),Z,s("div",j,[y(s("input",{"onUpdate:modelValue":t[3]||(t[3]=i=>l.title=i),type:"text"},null,512),[[v,l.title]])]),tt,s("div",et,[s("input",st,null,512)]),lt,s("div",ot,[y(s("input",{"onUpdate:modelValue":t[4]||(t[4]=i=>l.artist=i),type:"text"},null,512),[[v,l.artist]])]),it,s("div",nt,[y(s("input",{type:"text",class:"addSong cover","onUpdate:modelValue":t[5]||(t[5]=i=>l.cover=i),ref:"cover"},null,512),[[v,l.cover]]),s("img",{onClick:t[6]||(t[6]=(...i)=>o.openInNewTab&&o.openInNewTab(...i)),class:"addSong cover",src:l.cover?l.cover:"/assets/img/music_placeholder.png"},null,8,at)]),s("div",dt,[s("button",{onClick:t[7]||(t[7]=(...i)=>o.add&&o.add(...i)),class:"negative"},"Add")])])]}),_:1},8,["onClick","modelValue"])])}var ct=S(q,[["render",rt],["__scopeId","data-v-231c30bd"]]);const C=new P("reapOne.playlist",22),ut={name:"EditPlaylist",props:{playlistName:String,playlistDescription:String},data(){return{showModal:!1,cover:"",name:this.playlistName,description:this.playlistDescription}},methods:{apply(){this.showModal=!1,console.log("fetch"),fetch("/api/updatePlaylist",{method:"POST",body:JSON.stringify({id:Number(C.decode(this.$route.params.id)),name:this.name,description:this.description})}).then(e=>{console.log(e),this.$emit("close")})},remove(){fetch(`/api/playlist/${Number(C.decode(this.$route.params.id))}`,{method:"DELETE"}).then(()=>{this.$router.push("/")})}},watch:{playlistName(){this.name=this.playlistName},playlistDescription(){this.description=this.playlistDescription}}},b=e=>(x("data-v-1e90d607"),e=e(),N(),e),pt={class:"wrapper"},ht={class:"header"},mt=b(()=>s("h3",null,"Edit details",-1)),yt=b(()=>s("span",{class:"material-icons-round"}," close ",-1)),_t=[yt],ft=b(()=>s("h4",null,"Name",-1)),vt={class:"content"},gt=b(()=>s("h4",null,"Description",-1)),bt={class:"content"},wt={class:"confirm"};function Pt(e,t,d,r,l,o){const p=c("vue-final-modal");return _(),f("div",null,[u(p,{modelValue:l.showModal,"onUpdate:modelValue":t[5]||(t[5]=a=>l.showModal=a),classes:"modal-container","content-class":"modal-content"},{default:g(()=>[s("div",pt,[s("div",ht,[mt,s("button",{class:"modal-close",onClick:t[0]||(t[0]=a=>l.showModal=!1)},_t)]),ft,s("div",vt,[y(s("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>l.name=a),type:"text",ref:"name"},null,512),[[v,l.name]])]),gt,s("div",bt,[y(s("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>l.description=a),type:"text",ref:"description"},null,512),[[v,l.description]])]),s("div",wt,[s("button",{onClick:t[3]||(t[3]=(...a)=>o.remove&&o.remove(...a)),class:"negative left"},"Delete"),s("button",{onClick:t[4]||(t[4]=(...a)=>o.apply&&o.apply(...a)),class:"negative"},"Save")])])]),_:1},8,["modelValue"])])}var St=S(ut,[["render",Pt],["__scopeId","data-v-1e90d607"]]);const I=new P("reapOne.playlist",22),xt={components:{PlaylistEntry:H,FixedPlaylistHeader:$,GridHeader:E,AddSong:ct,EditPlaylist:St,draggable:L},name:"Playlist",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,playlist:[],playlistName:"N/A",playlistDescription:""}},methods:{getId(){return I.decode(this.$route.params.id)},download(e){var d;const t=(d=this.playlist)==null?void 0:d[e];window.open("/api/download/"+t.id)},onPlaylistRearrange(e){const t=e.moved;!t||fetch("/api/rearrange",{method:"POST",body:JSON.stringify({playlistIndex:Number(this.getId()),songOldIndex:t.oldIndex,songNewIndex:t.newIndex})})},connect(){const e=this;console.log("attempting reconnect");let t=new WebSocket("ws://localhost:1234/ws");t.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},t.onopen=()=>{console.log("ws connected")},t.onmessage=function(d){const r=JSON.parse(d.data);e.updateData(r)}},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(e){var t;if(e.path=="player.song"){let d=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const r of this.playlist)r.playing=r.title==d}},updatePlaylist(){if(!!this.getId()&&!!this.$route.path.includes("/playlist/")){if(this.$route.params.id=="create"){fetch("/api/playlist/create").then(e=>e.text()).then(e=>{const t=I.encode(e);console.log(t),this.$router.push(t)});return}fetch("/api/playlist",{method:"POST",body:JSON.stringify({id:Number(this.getId())})}).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();this.playlist=t.songs,this.playlistName=t.name,this.playlistDescription=t.description,document.title=`${this.playlistName} - reAudioPlayer One`,console.log(this.playlist),this.connect()})}},loadPlaylist(){fetch("/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"playlist"})})}},computed:{playlistCover(){var e,t;return(t=(e=this.playlist)==null?void 0:e[0])==null?void 0:t.cover},autogeneratedDescription(){return`${this.playlist.length} ${this.playlist.length==1?"song":"songs"}${this.estimatedDuration}`},estimatedDuration(){let e=0,t=!1;if(!this.playlist.length)return"";for(const p of this.playlist){t=t||p.duration=="-1:59";const a=p.duration=="-1:59"?"3:00":p.duration,[h,i]=a.split(":");e+=Number(h*60)+Number(i)}const d=e,r=Math.floor(d/60),l=Math.floor(r/60),o=t?", about ":", ";return l?o+`${l} hr ${r-l*60} min`:r?o+`${r} min ${d-r*60} sec`:o+e+" sec"}},watch:{$route(){this.updatePlaylist()}}},D=e=>(x("data-v-49d4b5c9"),e=e(),N(),e),Nt={class:"playlist"},Ct=["src"],It={class:"details"},Dt=J("Playlist"),Mt={class:"muted description"},Vt={class:"mobileMenu showIfMobile"},kt=D(()=>s("hr",null,null,-1)),Tt={class:"padding-20"},Ot={class:"grid"},$t=D(()=>s("hr",null,null,-1)),Et={class:"playlistEntries"};function Ht(e,t,d,r,l,o){const p=c("AddSong"),a=c("EditPlaylist"),h=c("fixed-playlist-header"),i=c("h7"),M=c("grid-header"),V=c("playlist-entry"),k=c("draggable"),T=R("observe-visibility");return _(),f("div",Nt,[u(p,{onClose:o.updatePlaylist,ref:"addSongPopup"},null,8,["onClose"]),u(a,{onClose:o.updatePlaylist,playlistName:l.playlistName,playlistDescription:l.playlistDescription,ref:"editPlaylistPopup"},null,8,["onClose","playlistName","playlistDescription"]),u(h,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:A({hidden:l.fixedHeaderHidden}),title:l.playlistName},null,8,["onLoadPlaylist","class","title"]),y((_(),f("div",{class:"padding-20 playlisteditor",onClick:t[0]||(t[0]=(...n)=>o.editPlaylist&&o.editPlaylist(...n))},[o.playlistCover?(_(),f("img",{key:0,class:"cover",src:o.playlistCover},null,8,Ct)):F("",!0),s("div",It,[u(i,{class:"hideIfMobile"},{default:g(()=>[Dt]),_:1}),s("h1",null,w(l.playlistName),1),s("h5",null,w(l.playlistDescription),1),s("p",Mt,w(o.autogeneratedDescription),1)])])),[[T,o.headerVisibilityChanged]]),s("div",Vt,[s("span",{onClick:t[1]||(t[1]=()=>e.$emit("toggleFullSidebar")),class:"material-symbols-rounded"},"menu")]),kt,s("div",Tt,[s("span",{id:"loadPlaylist",onClick:t[2]||(t[2]=(...n)=>o.loadPlaylist&&o.loadPlaylist(...n)),class:"material-icons-outlined"},"play_circle_filled"),s("span",{id:"addToPlaylist",onClick:t[3]||(t[3]=(...n)=>o.addToPlaylist&&o.addToPlaylist(...n)),class:"material-icons-outlined"},"add_circle"),s("div",Ot,[u(M),$t,s("div",Et,[u(k,{modelValue:l.playlist,"onUpdate:modelValue":t[4]||(t[4]=n=>l.playlist=n),onChange:o.onPlaylistRearrange},{item:g(({element:n})=>[u(V,{onDownload:o.download,onRequestUpdate:o.updatePlaylist,index:l.playlist.findIndex(O=>O.source==n.source),source:n.source,playing:n.playing,id:n.id,title:n.title,album:n.album,artist:n.artist,cover:n.cover,favourite:n.favourite,duration:n.duration},null,8,["onDownload","onRequestUpdate","index","source","playing","id","title","album","artist","cover","favourite","duration"])]),_:1},8,["modelValue","onChange"])])])])])}var Bt=S(xt,[["render",Ht],["__scopeId","data-v-49d4b5c9"]]);export{Bt as default};
