import{S as v,E as p}from"./EditSong.8c332886.js";import{H as f,_ as x,M as _,b as d,o as P,i as S,f as h,e as r,a as o,n,t as c}from"./index.ea90892d.js";const k=new f("reapOne.track",22),b=new f("reapOne.playlist",22),w={name:"PlaylistEntry",components:{SongCtx:v,EditSong:p,Marquee:_},props:{index:Number,id:Number,source:String,artist:{type:String,default:"N/A"},cover:{type:String,default:"/assets/img/music_placeholder.png"},title:{type:String,default:"N/A"},album:{type:String,default:"N/A"},duration:{type:String,default:"N/A"},favourite:{type:Boolean,default:!1},playing:{type:Boolean,default:!1}},data(){return{highlighted:!1,favourited:this.favourite,isAutoPlaylist:this.$route.path=="/collection/tracks"}},computed:{trackId(){return k.encode(this.id)}},methods:{getPlaylistId(){return b.decode(this.$route.params.id)},download(){this.$emit("download",this.index)},addToPlaylist(e){fetch("/api/add",{method:"POST",body:JSON.stringify({id:e,source:this.source})}).then(t=>{t.status==200&&this.$emit("requestUpdate")})},remove(){fetch("/api/remove",{method:"POST",body:JSON.stringify({playlistId:Number(this.getPlaylistId()),songId:this.id})}).then(e=>{e.status==200&&this.$emit("requestUpdate")})},update(){this.$refs.editSongPopup.showModal=!0},hideCtxMenu(){this.$refs.ctxMenu.hide()},showCtxMenu(e){console.log("show"),this.$refs.ctxMenu.show(e)},onselect(){this.highlighted=!this.highlighted,this.hideCtxMenu()},displayPlay(){const e=this.$refs.idOrPlay;e.innerHTML="play_arrow",e.classList.add("material-icons-round")},displayId(){const e=this.$refs.idOrPlay;e.innerHTML=this.index+1,e.classList.remove("material-icons-round")},playAt(){console.log(this.$route.path);const e={index:this.index};this.$route.path.includes("/playlist/")&&(e.playlistIndex=Number(this.getPlaylistId())),this.$route.path.includes("/collection/tracks")&&(e.type="collection"),fetch("/api/at",{method:"POST",body:JSON.stringify(e)})},setFavourite(){fetch("/api/updateSong",{method:"POST",body:JSON.stringify({id:this.id,favourite:this.favourited,album:this.album,artist:this.artist,title:this.title,duration:this.duration,cover:this.cover,source:this.source})})}},watch:{favourited(){this.setFavourite()},favourite(){console.log("mounted",this.title,this.favourite,this.favourited),this.favourited=this.favourite,this.highlighted=!1}}},C={class:"track"},M=["src"],O={class:"trackwrapper"},A={class:"duration"};function N(e,t,i,I,a,s){const g=d("EditSong"),u=d("Marquee"),y=d("router-link"),m=d("SongCtx");return P(),S(m,{onDownload:s.download,onAddto:s.addToPlaylist,onRemove:s.remove,onUpdate:s.update,onLike:t[7]||(t[7]=l=>a.favourited=!a.favourited),isAutoPlaylist:a.isAutoPlaylist,liked:a.favourited,ref:"ctxMenu"},{default:h(()=>[r(g,{onClose:e.updatePlaylist,ref:"editSongPopup",cover:i.cover,id:i.id,title:i.title,album:i.album,artist:i.artist,source:i.source},null,8,["onClose","cover","id","title","album","artist","source"]),o("div",{onDblclick:t[3]||(t[3]=()=>{s.playAt(),s.onselect()}),onClick:t[4]||(t[4]=(...l)=>s.onselect&&s.onselect(...l)),onMouseover:t[5]||(t[5]=(...l)=>s.displayPlay&&s.displayPlay(...l)),onMouseleave:t[6]||(t[6]=(...l)=>s.displayId&&s.displayId(...l)),class:n(["playlistEntry",{selected:a.highlighted}])},[o("span",{onClick:t[0]||(t[0]=(...l)=>s.playAt&&s.playAt(...l)),ref:"idOrPlay",class:n([{playing:i.playing},"id"])},c(i.index+1),3),o("div",C,[o("img",{src:i.cover||"/assets/img/music_placeholder.png"},null,8,M),o("div",O,[o("span",{class:n(["title",{playing:i.playing}])},[r(y,{class:"linkOnHover",to:`/track/${s.trackId}`},{default:h(()=>[r(u,{text:i.title},null,8,["text"])]),_:1},8,["to"])],2),o("span",{class:n(["artist",{playing:i.playing}])},[r(y,{class:"linkOnHover",to:`/search/${i.artist}`},{default:h(()=>[r(u,{text:i.artist},null,8,["text"])]),_:1},8,["to"])],2)])]),o("span",{class:n(["album",{playing:i.playing}])},[r(u,{text:i.album},null,8,["text"])],2),o("span",{onClick:t[1]||(t[1]=l=>a.favourited=!a.favourited),class:n(["favourite material-icons-round",{showfavourite:a.favourited||a.highlighted}])},c(a.favourited?"favorite":"favorite_border"),3),o("span",A,c(i.duration),1),o("span",{onClick:t[2]||(t[2]=(...l)=>s.showCtxMenu&&s.showCtxMenu(...l)),class:n(["more material-icons-round",{hidden:!a.highlighted}])},"more_horiz",2)],34)]),_:1},8,["onDownload","onAddto","onRemove","onUpdate","isAutoPlaylist","liked"])}var H=x(w,[["render",N],["__scopeId","data-v-a69ae9a0"]]);export{H as P};
