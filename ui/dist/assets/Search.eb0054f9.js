import{A as x}from"./ArtistItem.ee77b181.js";import{I as M}from"./ReleaseItem.4e6f6800.js";import{M as C}from"./MiniPlayer.bca879e9.js";import{_ as w,b as u,d as V,o,c,e as k,f as y,a as r,w as I,v as q,F as f,h as v,t as h,p as N,k as B,g as D,j as m,l as O,i as d}from"./index.87a4becd.js";import{S as j}from"./Shelf.d06785d2.js";import{L}from"./Loader.2a2c4051.js";import"./FindSources.3e22f636.js";import"./SpotifyPlaylistEntry.4ca170de.js";import"./SpotifyPlaylistHeader.95a886d3.js";import"./AddAlbumToPlaylist.43936ffa.js";const E={components:{MiniPlayer:C},name:"AddSongToPlaylist",props:{cover:String,artist:String,title:String,href:String,preview:String},data(){return{showModal:!1,selectedPlaylist:-1,track:{},playlists:[]}},methods:{preview(){console.log(this.href);const t=new CustomEvent("player.play",{detail:{artist:this.artist,title:this.title,source:this.href}});window.dispatchEvent(t)},share(){window.open(this.href)},close(){this.showModal=!1,this.$emit("close")},loadMetadata(){fetch("/api/browse/track",{method:"POST",body:JSON.stringify({url:this.href})}).then(t=>t.json()).then(t=>{this.track=t})},openInNewTab(){window.open(this.cover?this.cover:"/assets/img/music_placeholder.png")},add(){const t=this.track,s=this.playlists.findIndex(i=>i==this.selectedPlaylist);if(console.log(t,s),s<0){alert("no playlist selected");return}fetch(`/api/playlists/${s}/tracks`,{method:"POST",body:JSON.stringify({source:t.src,title:t.title,artist:t.artists.join(", "),album:this.title,cover:this.cover})}).then(i=>{i.status==200&&(t.added=!0,this.close())})}},watch:{showModal(){!this.showModal||(fetch("/api/playlists").then(t=>t.json()).then(t=>{this.playlists.length=0,this.playlists.push(...t)}),this.loadMetadata())}}},T=t=>(N("data-v-3f1e2694"),t=t(),B(),t),F={class:"wrapper"},J={class:"header"},U=T(()=>r("h3",null,"Add song",-1)),K=T(()=>r("span",{class:"material-icons-round"}," close ",-1)),R=[K],Y=T(()=>r("h4",null,"To Playlist",-1)),z=T(()=>r("br",null,null,-1)),G=["src"],H={class:"details"},Q={class:"detailswrapper"},W=D("Song"),X={class:"confirm"};function Z(t,s,i,b,l,n){const _=u("h7"),g=u("mini-player"),p=u("vue-final-modal"),S=V("observe-visibility");return o(),c("div",null,[k(p,{modelValue:l.showModal,"onUpdate:modelValue":s[6]||(s[6]=a=>l.showModal=a),classes:"modal-container","content-class":"addAlbumToPlaylistPopup"},{default:y(()=>[r("div",F,[r("div",J,[U,r("button",{class:"modal-close",onClick:s[0]||(s[0]=(...a)=>n.close&&n.close(...a))},R)]),Y,I(r("select",{"onUpdate:modelValue":s[1]||(s[1]=a=>l.selectedPlaylist=a)},[(o(!0),c(f,null,v(l.playlists,a=>(o(),c("option",{key:a},h(a),1))),128))],512),[[q,l.selectedPlaylist]]),z,r("div",null,[I((o(),c("div",{class:"padding-20 playlisteditor",onClick:s[4]||(s[4]=(...a)=>t.editPlaylist&&t.editPlaylist(...a))},[r("img",{class:"cover",src:i.cover},null,8,G),r("div",H,[r("div",Q,[k(_,null,{default:y(()=>[W]),_:1}),r("span",{class:"material-icons-round share",onClick:s[2]||(s[2]=(...a)=>n.share&&n.share(...a))},"share"),r("span",{class:"material-symbols-rounded share fill",onClick:s[3]||(s[3]=(...a)=>n.preview&&n.preview(...a))},"play_arrow")]),r("h1",null,h(i.title),1),r("h5",null,h(i.artist),1)])])),[[S,t.headerVisibilityChanged]])]),r("div",X,[k(g,{class:"miniPlayer",title:i.title,artist:i.artist,src:l.track.src},null,8,["title","artist","src"]),r("button",{onClick:s[5]||(s[5]=(...a)=>n.add&&n.add(...a)),class:"negative"},"Add")])])]),_:1},8,["modelValue"])])}var $=w(E,[["render",Z],["__scopeId","data-v-3f1e2694"]]);const tt={components:{AddSongToPlaylist:$},name:"SearchItem",methods:{redirect(){this.$refs.addAlbum.showModal=!0}},props:{cover:String,title:String,artist:String,releaseDate:String,href:String,preview:String}},et={class:"wrapper"},st=["src"],rt={key:0,class:"note"};function it(t,s,i,b,l,n){const _=u("add-song-to-playlist");return o(),c("div",et,[k(_,{href:i.href,cover:i.cover,title:i.title,artist:i.artist,preview:i.preview,ref:"addAlbum"},null,8,["href","cover","title","artist","preview"]),r("div",{class:"item",onClick:s[0]||(s[0]=(...g)=>n.redirect&&n.redirect(...g))},[r("img",{src:i.cover},null,8,st),r("h4",null,h(i.title),1),r("p",null,h(i.artist),1),i.releaseDate?(o(),c("p",rt,"Released on "+h(i.releaseDate),1)):m("",!0)])])}var ot=w(tt,[["render",it],["__scopeId","data-v-22efcb8d"]]);const lt={name:"TrackItem",methods:{redirect(){console.log("redirect"),this.$router.push(this.href)}},props:{cover:String,title:String,artist:String,href:String}},at={class:"wrapper"},nt=["src"];function ct(t,s,i,b,l,n){return o(),c("div",at,[r("div",{class:"item",onClick:s[0]||(s[0]=(..._)=>n.redirect&&n.redirect(..._))},[r("img",{src:i.cover},null,8,nt),r("h4",null,h(i.title),1),r("p",null,h(i.artist),1)])])}var dt=w(lt,[["render",ct],["__scopeId","data-v-7c9e5298"]]);const ut={name:"Search",components:{Shelf:j,Item:M,SearchItem:ot,ArtistItem:x,TrackItem:dt,Loader:L},data(){return{query:"",spotifyTracks:[],spotifyArtists:[],tracks:[],artists:[],youtubeTracks:[],loading:!1}},methods:{search(){this.query=this.$route.params.query,this.query&&(this.loading=!0,fetch("/api/search",{method:"POST",body:JSON.stringify({query:this.query})}).then(t=>t.json()).then(t=>{this.spotifyTracks.length=0,this.spotifyArtists.length=0,this.tracks.length=0,this.artists.length=0,this.youtubeTracks.length=0,this.spotifyTracks.push(...t.spotifyTracks||[]),this.spotifyArtists.push(...t.spotifyArtists||[]),this.tracks.push(...t.tracks||[]),this.artists.push(...t.artists||[]),this.youtubeTracks.push(...t.youtubeTracks||[]),this.loading=!1}))},enterText(t){t.key==="Enter"&&this.$router.push("/search/"+this.query)}},watch:{$route(){this.search()}},mounted(){this.search(),this.$refs.searchBox.focus()}},ht={class:"search"},_t={key:0,class:"fillPage"};function pt(t,s,i,b,l,n){const _=u("Loader"),g=u("TrackItem"),p=u("Shelf"),S=u("search-item"),a=u("Item"),A=u("artist-item");return o(),c("div",ht,[I(r("input",{onKeyup:s[0]||(s[0]=(...e)=>n.enterText&&n.enterText(...e)),ref:"searchBox","onUpdate:modelValue":s[1]||(s[1]=e=>l.query=e),type:"text"},null,544),[[O,l.query]]),l.loading?(o(),c("div",_t,[k(_)])):(o(),c(f,{key:1},[l.tracks.length?(o(),d(p,{key:0,heading:"Songs"},{default:y(()=>[(o(!0),c(f,null,v(l.tracks,e=>(o(),d(g,{key:e.url,cover:e.cover,href:e.url,artist:e.artists.join(", "),title:e.title},null,8,["cover","href","artist","title"]))),128))]),_:1})):m("",!0),l.spotifyTracks.length?(o(),d(p,{key:1,heading:"Songs (Spotify)"},{default:y(()=>[(o(!0),c(f,null,v(l.spotifyTracks,e=>(o(),d(S,{key:e.url,preview:e.preview,cover:e.cover,href:e.url,artist:e.artists.join(", "),title:e.title},null,8,["preview","cover","href","artist","title"]))),128))]),_:1})):m("",!0),l.youtubeTracks.length?(o(),d(p,{key:2,heading:"Songs (Youtube)"},{default:y(()=>[(o(!0),c(f,null,v(l.youtubeTracks,e=>(o(),d(S,{key:e.url,cover:e.cover,href:e.url,artist:e.artists.join(", "),title:e.title},null,8,["cover","href","artist","title"]))),128))]),_:1})):m("",!0),l.artists.length?(o(),d(p,{key:3,heading:"Artists"},{default:y(()=>[(o(!0),c(f,null,v(l.artists,e=>(o(),d(a,{key:e.url,cover:e.cover,href:e.url,artist:e.artists.join(", "),title:e.title},null,8,["cover","href","artist","title"]))),128))]),_:1})):m("",!0),l.spotifyArtists.length?(o(),d(p,{key:4,heading:"Artists (Spotify)"},{default:y(()=>[(o(!0),c(f,null,v(l.spotifyArtists,(e,P)=>(o(),d(A,{key:P,cover:e.cover,description:e.description,name:e.name,id:e.id,showFollowButton:!0},null,8,["cover","description","name","id"]))),128))]),_:1})):m("",!0)],64))])}var It=w(ut,[["render",pt],["__scopeId","data-v-31e22cdd"]]);export{It as default};
