import{F as w,G as x}from"./FixedPlaylistHeader.c83bf18e.js";import{d as k}from"./vuedraggable.umd.7d438837.js";import{S}from"./SpotifyPlaylistEntry.8f321e33.js";import{_ as N,H,o as p,c as u,g as n,k as T,m as I,a as i,w as h,b as C,t as c,e as r,l as V,p as O,h as A}from"./index.ff638037.js";import"./MiniPlayer.2298e0df.js";const D=new H("reapOne.track",22),R={components:{FixedPlaylistHeader:w,GridHeader:x,draggable:k,SpotifyPlaylistEntry:S},name:"Track",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",cover:"/assets/img/music_placeholder.png",recommendations:[]}},methods:{getId(){return D.decode(this.$route.params.id)},onPlaylistRearrange(e){e.moved},connect(){const e=this;console.log("attempting reconnect");let t=new WebSocket("ws://localhost:1234/ws");t.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},t.onopen=()=>{console.log("ws connected")},t.onmessage=function(d){const l=JSON.parse(d.data);e.updateData(l)}},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(e){var t;if(e.path=="player.song"){let d=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const l of this.playlist)l.playing=l.title==d}},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch(`/api/tracks/${this.getId()}`).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=t.cover||"/assets/img/music_placeholder.png",document.title=`${this.title} \u2022 ${this.artist}`,this.connect();const l=await(await fetch("/api/spotify/recommendations",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...l)})},loadPlaylist(){fetch("/api/player/load",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()}}},y=e=>(O("data-v-dca4d0b3"),e=e(),A(),e),q={class:"playlist"},B=["src"],E={class:"details"},J=y(()=>i("hr",null,null,-1)),U={class:"padding-20"},F={class:"grid"},G=y(()=>i("hr",null,null,-1)),L={class:"playlistEntries"};function M(e,t,d,l,o,a){const m=r("fixed-playlist-header"),_=r("h7"),f=r("grid-header"),g=r("spotify-playlist-entry"),v=r("draggable"),P=V("observe-visibility");return p(),u("div",q,[n(m,{onLoadPlaylist:a.loadPlaylist,ref:"fixedHeading",class:T({hidden:o.fixedHeaderHidden}),title:e.playlistName},null,8,["onLoadPlaylist","class","title"]),I((p(),u("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...s)=>a.editPlaylist&&a.editPlaylist(...s))},[i("img",{class:"cover",src:o.cover},null,8,B),i("div",E,[n(_,null,{default:h(()=>[C("Song")]),_:1}),i("h1",null,c(o.title),1),i("h5",null,c(o.artist),1)])])),[[P,a.headerVisibilityChanged]]),J,i("div",U,[i("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...s)=>a.loadPlaylist&&a.loadPlaylist(...s)),class:"material-icons-outlined"},"play_circle_filled"),i("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...s)=>a.addToPlaylist&&a.addToPlaylist(...s)),class:"material-icons-outlined"},"add_circle"),i("div",F,[i("h2",null,c("Recommendations based on "+o.title),1),n(f),G,i("div",L,[n(v,{modelValue:o.recommendations,"onUpdate:modelValue":t[3]||(t[3]=s=>o.recommendations=s)},{item:h(({element:s})=>[n(g,{onRequestUpdate:a.updatePlaylist,index:o.recommendations.findIndex(b=>b.src==s.src),source:s.src,id:s.id,title:s.title,album:s.album,artist:s.artists.join(", "),preview:s.preview,cover:s.cover,favourite:s.favourite,duration:s.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}const X=N(R,[["render",M],["__scopeId","data-v-dca4d0b3"]]);export{X as default};
