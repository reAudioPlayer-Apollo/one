import{F as w,G as S}from"./FixedPlaylistHeader.af206544.js";import{d as x}from"./vuedraggable.umd.768a80be.js";import{S as N}from"./SpotifyPlaylistEntry.bbd80630.js";import{_ as k,H as T,o as p,c as u,e as r,n as H,w as I,a as i,f as h,t as c,g as C,p as O,k as V,b as n,d as A}from"./index.caf9dd62.js";import"./MiniPlayer.7244a030.js";const D=new T("reapOne.track",22),J={components:{FixedPlaylistHeader:w,GridHeader:S,draggable:x,SpotifyPlaylistEntry:N},name:"Track",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",cover:"/assets/img/music_placeholder.png",recommendations:[]}},methods:{getId(){return D.decode(this.$route.params.id)},onPlaylistRearrange(e){e.moved},connect(){const e=this;console.log("attempting reconnect");let t=new WebSocket("ws://localhost:1234/ws");t.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},t.onopen=()=>{console.log("ws connected")},t.onmessage=function(d){const l=JSON.parse(d.data);e.updateData(l)}},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(e){var t;if(e.path=="player.song"){let d=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const l of this.playlist)l.playing=l.title==d}},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch("/api/track",{method:"POST",body:JSON.stringify({id:Number(this.getId())})}).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=t.cover||"/assets/img/music_placeholder.png",document.title=`${this.title} \u2022 ${this.artist}`,this.connect();const l=await(await fetch("/api/spotify/recommend",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...l)})},loadPlaylist(){fetch("/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()}}},y=e=>(O("data-v-30c0f7b0"),e=e(),V(),e),R={class:"playlist"},q=["src"],B={class:"details"},E=C("Song"),U=y(()=>i("hr",null,null,-1)),F={class:"padding-20"},G={class:"grid"},L=y(()=>i("hr",null,null,-1)),M={class:"playlistEntries"};function z(e,t,d,l,a,o){const m=n("fixed-playlist-header"),_=n("h7"),f=n("grid-header"),g=n("spotify-playlist-entry"),v=n("draggable"),P=A("observe-visibility");return p(),u("div",R,[r(m,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:H({hidden:a.fixedHeaderHidden}),title:e.playlistName},null,8,["onLoadPlaylist","class","title"]),I((p(),u("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...s)=>o.editPlaylist&&o.editPlaylist(...s))},[i("img",{class:"cover",src:a.cover},null,8,q),i("div",B,[r(_,null,{default:h(()=>[E]),_:1}),i("h1",null,c(a.title),1),i("h5",null,c(a.artist),1)])])),[[P,o.headerVisibilityChanged]]),U,i("div",F,[i("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...s)=>o.loadPlaylist&&o.loadPlaylist(...s)),class:"material-icons-outlined"},"play_circle_filled"),i("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...s)=>o.addToPlaylist&&o.addToPlaylist(...s)),class:"material-icons-outlined"},"add_circle"),i("div",G,[i("h2",null,c("Recommendations based on "+a.title),1),r(f),L,i("div",M,[r(v,{modelValue:a.recommendations,"onUpdate:modelValue":t[3]||(t[3]=s=>a.recommendations=s)},{item:h(({element:s})=>[r(g,{onRequestUpdate:o.updatePlaylist,index:a.recommendations.findIndex(b=>b.src==s.src),source:s.src,id:s.id,title:s.title,album:s.album,artist:s.artists.join(", "),preview:s.preview,cover:s.cover,favourite:s.favourite,duration:s.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}var Y=k(J,[["render",z],["__scopeId","data-v-30c0f7b0"]]);export{Y as default};
