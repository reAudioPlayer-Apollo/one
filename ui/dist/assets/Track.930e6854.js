import{F as w,G as S}from"./FixedPlaylistHeader.0a3253c0.js";import{d as x}from"./vuedraggable.umd.8f36c380.js";import{S as N}from"./SpotifyPlaylistEntry.33212a5e.js";import{_ as k,o as p,c as u,b as d,n as T,j as H,a as i,w as h,t as c,l as C,p as V,h as O,g as n,i as A}from"./index.e7c3ee76.js";import"./MiniPlayer.20b50cbc.js";const D={components:{FixedPlaylistHeader:w,GridHeader:S,draggable:x,SpotifyPlaylistEntry:N},name:"Track",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",cover:"/assets/img/music_placeholder.png",recommendations:[]}},methods:{onPlaylistRearrange(e){e.moved},connect(){const e=this;console.log("attempting reconnect");let t=new WebSocket("ws://localhost:1234/ws");t.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},t.onopen=()=>{console.log("ws connected")},t.onmessage=function(r){const l=JSON.parse(r.data);e.updateData(l)}},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(e){var t;if(e.path=="player.song"){let r=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const l of this.playlist)l.playing=l.title==r}},updatePlaylist(){!this.$route.params.id||!this.$route.path.includes("/track/")||fetch("http://localhost:1234/api/track",{method:"POST",body:JSON.stringify({id:Number(this.$route.params.id)})}).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=t.cover||"/assets/img/music_placeholder.png",document.title=`${this.title} \u2022 ${this.artist}`,this.connect();const l=await(await fetch("http://localhost:1234/api/spotify/recommend",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...l)})},loadPlaylist(){fetch("http://localhost:1234/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.$route.params.id),type:"track"})})}},watch:{$route(){this.updatePlaylist()}}},m=e=>(V("data-v-a940a120"),e=e(),O(),e),I={class:"playlist"},J=["src"],R={class:"details"},q=C("Song"),B=m(()=>i("hr",null,null,-1)),E={class:"padding-20"},U={class:"grid"},F=m(()=>i("hr",null,null,-1)),G={class:"playlistEntries"};function L(e,t,r,l,a,o){const y=n("fixed-playlist-header"),_=n("h7"),f=n("grid-header"),v=n("spotify-playlist-entry"),g=n("draggable"),P=A("observe-visibility");return p(),u("div",I,[d(y,{onLoadPlaylist:o.loadPlaylist,ref:"fixedHeading",class:T({hidden:a.fixedHeaderHidden}),title:e.playlistName},null,8,["onLoadPlaylist","class","title"]),H((p(),u("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...s)=>o.editPlaylist&&o.editPlaylist(...s))},[i("img",{class:"cover",src:a.cover},null,8,J),i("div",R,[d(_,null,{default:h(()=>[q]),_:1}),i("h1",null,c(a.title),1),i("h5",null,c(a.artist),1)])])),[[P,o.headerVisibilityChanged]]),B,i("div",E,[i("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...s)=>o.loadPlaylist&&o.loadPlaylist(...s)),class:"material-icons-outlined"},"play_circle_filled"),i("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...s)=>o.addToPlaylist&&o.addToPlaylist(...s)),class:"material-icons-outlined"},"add_circle"),i("div",U,[i("h2",null,c("Recommendations based on "+a.title),1),d(f),F,i("div",G,[d(g,{modelValue:a.recommendations,"onUpdate:modelValue":t[3]||(t[3]=s=>a.recommendations=s)},{item:h(({element:s})=>[d(v,{onRequestUpdate:o.updatePlaylist,index:a.recommendations.findIndex(b=>b.src==s.src),source:s.src,id:s.id,title:s.title,album:s.album,artist:s.artists.join(", "),preview:s.preview,cover:s.cover,favourite:s.favourite,duration:s.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}var Q=k(D,[["render",L],["__scopeId","data-v-a940a120"]]);export{Q as default};
