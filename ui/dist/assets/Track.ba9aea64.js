import{F as w,G as S}from"./FixedPlaylistHeader.9acd08d3.js";import{d as x}from"./vuedraggable.umd.713ed89d.js";import{S as N}from"./SpotifyPlaylistEntry.892a992d.js";import{_ as k,H as T,o as p,c as h,b as r,n as H,j as I,a as i,w as u,t as c,l as C,p as O,h as V,g as n,i as A}from"./index.afe0a5f0.js";import"./MiniPlayer.a87b2845.js";const D=new T("reapOne.track",22),J={components:{FixedPlaylistHeader:w,GridHeader:S,draggable:x,SpotifyPlaylistEntry:N},name:"Track",data(){return this.updatePlaylist(),{fixedHeaderHidden:!0,title:"N/A",artist:"N/A",cover:"/assets/img/music_placeholder.png",recommendations:[]}},methods:{getId(){return D.decode(this.$route.params.id)},onPlaylistRearrange(e){e.moved},connect(){const e=this;console.log("attempting reconnect");let t=new WebSocket("ws://localhost:1234/ws");t.onclose=function(){console.log("ws closed"),setTimeout(this.connect,1e3)},t.onopen=()=>{console.log("ws connected")},t.onmessage=function(d){const l=JSON.parse(d.data);e.updateData(l)}},headerVisibilityChanged(e){this.fixedHeaderHidden=e},addToPlaylist(){this.$refs.addSongPopup.showModal=!0},editPlaylist(){this.$refs.editPlaylistPopup.showModal=!0},updateData(e){var t;if(e.path=="player.song"){let d=((t=e==null?void 0:e.data)==null?void 0:t.title)||"N/A";for(const l of this.playlist)l.playing=l.title==d}},updatePlaylist(){!this.getId()||!this.$route.path.includes("/track/")||fetch("http://localhost:1234/api/track",{method:"POST",body:JSON.stringify({id:Number(this.getId())})}).then(async e=>{if(e.status==404){this.$router.push("/");return}const t=await e.json();console.log(t),this.title=t.title||"N/A",this.artist=t.artist||"N/A",this.cover=t.cover||"/assets/img/music_placeholder.png",document.title=`${this.title} \u2022 ${this.artist}`,this.connect();const l=await(await fetch("http://localhost:1234/api/spotify/recommend",{method:"POST",body:JSON.stringify({query:`${this.artist} ${this.title}`})})).json();this.recommendations.push(...l)})},loadPlaylist(){fetch("http://localhost:1234/api/loadPlaylist",{method:"POST",body:JSON.stringify({id:Number(this.getId()),type:"track"})})}},watch:{$route(){this.updatePlaylist()}}},y=e=>(O("data-v-5fd5aa57"),e=e(),V(),e),R={class:"playlist"},q=["src"],B={class:"details"},E=C("Song"),U=y(()=>i("hr",null,null,-1)),F={class:"padding-20"},G={class:"grid"},L=y(()=>i("hr",null,null,-1)),M={class:"playlistEntries"};function j(e,t,d,l,o,a){const m=n("fixed-playlist-header"),_=n("h7"),f=n("grid-header"),g=n("spotify-playlist-entry"),v=n("draggable"),P=A("observe-visibility");return p(),h("div",R,[r(m,{onLoadPlaylist:a.loadPlaylist,ref:"fixedHeading",class:H({hidden:o.fixedHeaderHidden}),title:e.playlistName},null,8,["onLoadPlaylist","class","title"]),I((p(),h("div",{class:"padding-20 songdetails",onClick:t[0]||(t[0]=(...s)=>a.editPlaylist&&a.editPlaylist(...s))},[i("img",{class:"cover",src:o.cover},null,8,q),i("div",B,[r(_,null,{default:u(()=>[E]),_:1}),i("h1",null,c(o.title),1),i("h5",null,c(o.artist),1)])])),[[P,a.headerVisibilityChanged]]),U,i("div",F,[i("span",{id:"loadPlaylist",onClick:t[1]||(t[1]=(...s)=>a.loadPlaylist&&a.loadPlaylist(...s)),class:"material-icons-outlined"},"play_circle_filled"),i("span",{id:"addToPlaylist",onClick:t[2]||(t[2]=(...s)=>a.addToPlaylist&&a.addToPlaylist(...s)),class:"material-icons-outlined"},"add_circle"),i("div",G,[i("h2",null,c("Recommendations based on "+o.title),1),r(f),L,i("div",M,[r(v,{modelValue:o.recommendations,"onUpdate:modelValue":t[3]||(t[3]=s=>o.recommendations=s)},{item:u(({element:s})=>[r(g,{onRequestUpdate:a.updatePlaylist,index:o.recommendations.findIndex(b=>b.src==s.src),source:s.src,id:s.id,title:s.title,album:s.album,artist:s.artists.join(", "),preview:s.preview,cover:s.cover,favourite:s.favourite,duration:s.duration},null,8,["onRequestUpdate","index","source","id","title","album","artist","preview","cover","favourite","duration"])]),_:1},8,["modelValue"])])])])])}var Y=k(J,[["render",j],["__scopeId","data-v-5fd5aa57"]]);export{Y as default};
